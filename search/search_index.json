{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Bienvenido a mi web","text":"<p>Soy Adri\u00e1n Jaramillo.</p> <p>Aqu\u00ed estar\u00e9 posteando todas las pr\u00e1cticas que haga durante el curso 2021/2022 y 2022/2023 de 2\u00ba ASIR.</p> <p>Este blog est\u00e1 hecho con 2 objetivos principales en mente:</p> <ul> <li>Simpleza para m\u00ed a la hora de hacer tareas, y para los profesores a la hora de corregirlas.</li> <li>Crear documentaciones que sirvan tanto para futuros estudiantes del IES Gonzalo Nazareno como para m\u00ed, o cualquier estudiante de ASIR en general.</li> </ul> <p>Espero que lo posteado aqu\u00ed te sea utilidad, intento hacer mis pr\u00e1cticas siempre lo mejor posible.</p> <p>Todos los posts de este blog son pr\u00e1cticas NO corregidas. Es decir, que pueden tener fallos...etc. As\u00ed que sigue la documentaci\u00f3n con cuidado, y sabiendo que en cualquier momento puedes estar haciendo algo que vaya a dar fallos. En un futuro cuando tenga tiempos libres, actualizar\u00e9 los posts con correcciones e indicar\u00e9 en el post si est\u00e1 corregido o no (todo esto contando con que reciba las correcciones exactas de los profesores, claro).  </p> <p>A\u00fan as\u00ed, suelo ser bastante detallista y me gusta ir probando todo poco a poco y comprobar que nada falla y hace lo que se pide, pero a\u00fan as\u00ed, no est\u00e1 de m\u00e1s avisar.</p>"},{"location":"practica-escenario-libvirt/","title":"Pr\u00e1ctica: Instalaci\u00f3n y configuraci\u00f3n inicial de los servidores Vagrant Libvirt","text":""},{"location":"practica-escenario-libvirt/#entrega","title":"Entrega","text":""},{"location":"practica-escenario-libvirt/#parte-1","title":"Parte 1","text":"<p>IP \"p\u00fablica\" de zeus</p> <p><code>172.22.0.213</code></p>"},{"location":"practica-escenario-libvirt/#parte-2","title":"Parte 2","text":"<p>Actualizar esta entrada en la wiki de Redmine con informaci\u00f3n sobre el escenario</p> <p>Hecho.</p>"},{"location":"practica-escenario-libvirt/#realizacion","title":"Realizaci\u00f3n","text":"<p>Escenario de trabajo a usar durante el curso:</p> <p></p>"},{"location":"practica-escenario-libvirt/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear escenario Vagrant</p> <p>Requisitos: <pre><code>vagrant box add rockylinux/8\nvagrant box add generic/ubuntu2004\n</code></pre> (libvirt)</p> <p><code>Vagrantfile</code>: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\nconfig.vm.provider :libvirt do |libvirt|\n  libvirt.cpus = 1\n  libvirt.memory = 512\nend\n\n  config.vm.define :zeus do |zeus|\n    zeus.vm.box = \"debian/bullseye64\"\n    zeus.vm.hostname = \"zeus\"\n    zeus.vm.network :public_network,\n      :dev =&gt; \"br0\",\n      :mode =&gt; \"bridge\",\n      :type =&gt; \"bridge\"\n    zeus.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-dmz-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"172.16.0.1\",\n      :libvirt__netmask =&gt; '255.255.0.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    zeus.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-interna-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :hera do |hera|\n    hera.vm.box = \"rockylinux/8\"\n    hera.vm.hostname = \"hera\"\n    hera.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-dmz-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"172.16.0.200\",\n      :libvirt__netmask =&gt; '255.255.0.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :apolo do |apolo|\n    apolo.vm.box = \"debian/bullseye64\"\n    apolo.vm.hostname = \"apolo\"\n    apolo.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-interna-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.102\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :ares do |ares|\n    ares.vm.box = \"generic/ubuntu2004\"\n    ares.vm.hostname = \"ares\"\n    ares.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-interna-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.101\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#ejercicio-2","title":"Ejercicio 2","text":"<p>Actualizar paqueter\u00eda en todos los servidores</p> <p>En zeus, apolo y ares: <pre><code>sudo apt update\nsudo apt upgrade\n</code></pre></p> <p>En hera: <pre><code>sudo dnf check-update\nsudo dnf update\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#ejercicio-3","title":"Ejercicio 3","text":"<p>Contrase\u00f1a en todos los servidores (para poder modificar desde consola en caso necesario)</p> <p>En zeus, apolo, ares y hera: <pre><code>sudo passwd vagrant\n</code></pre> Contrase\u00f1a: 1234</p>"},{"location":"practica-escenario-libvirt/#ejercicio-4","title":"Ejercicio 4","text":"<p>Crear usuario profesor en todos los servidores. Usa sudo sin contrase\u00f1a.</p>"},{"location":"practica-escenario-libvirt/#en-zeus-apolo-y-ares","title":"En zeus, apolo y ares","text":"<p><pre><code>sudo adduser profesor\nsudo usermod -aG sudo profesor\n</code></pre> Contrase\u00f1a: 1234</p> <p><code>/etc/sudoers</code>: <pre><code># Mis cambios\nprofesor    ALL=(ALL) NOPASSWD:ALL\n</code></pre> (al final del fichero)</p>"},{"location":"practica-escenario-libvirt/#en-hera","title":"En hera","text":"<p><pre><code>sudo adduser profesor\nsudo passwd profesor\nsudo usermod -aG wheel profesor\n</code></pre> Contrase\u00f1a: 1234</p> <p><code>/etc/sudoers</code>: <pre><code># Mis cambios\nprofesor    ALL=(ALL) NOPASSWD:ALL\n</code></pre> (al final del fichero)</p>"},{"location":"practica-escenario-libvirt/#ejercicio-5","title":"Ejercicio 5","text":"<p>Copiar clave p\u00fablica ssh de josedom en los servidores al usuario profesor</p>"},{"location":"practica-escenario-libvirt/#en-zeus-apolo-y-ares_1","title":"En zeus, apolo y ares","text":"<pre><code>mkdir .ssh\ntouch .ssh/authorized_keys\n</code></pre> <p>Copio la clave: <pre><code>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCmjoVIoZCx4QFXvljqozXGqxxlSvO7V2aizqyPgMfGqnyl0J9YXo6zrcWYwyWMnMdRdwYZgHqfiiFCUn2QDm6ZuzC4Lcx0K3ZwO2lgL4XaATykVLneHR1ib6RNroFcClN69cxWsdwQW6dpjpiBDXf8m6/qxVP3EHwUTsP8XaOV7WkcCAqfYAMvpWLISqYme6e+6ZGJUIPkDTxavu5JTagDLwY+py1WB53eoDWsG99gmvyit2O1Eo+jRWN+mgRHIxJTrFtLS6o4iWeshPZ6LvCZ/Pum12Oj4B4bjGSHzrKjHZgTwhVJ/LDq3v71/PP4zaI3gVB9ZalemSxqomgbTlnT jose@debian\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#en-hera_1","title":"En hera","text":"<p>Lo mismo que arriba, a diferencia de hacer: <pre><code>chmod -R go= ~/.ssh\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#ejercicio-6","title":"Ejercicio 6","text":"<p>Definir nombre largo y corto en todos los servidores, con el dominio <code>adrianj.gonzalonazareno.org</code></p>"},{"location":"practica-escenario-libvirt/#en-zeus","title":"En zeus","text":"<p><code>/etc/hosts</code>: <pre><code>127.0.0.1   localhost\n127.0.0.2   bullseye\n::1     localhost ip6-localhost ip6-loopback\nff02::1     ip6-allnodes\nff02::2     ip6-allrouters\n\n127.0.1.1 zeus.adrianj.gonzalonazareno.org zeus\n</code></pre></p> <p>Compruebo nombre largo: <pre><code>vagrant@zeus:~$ hostname -f\nzeus.adrianj.gonzalonazareno.org\n</code></pre></p> <p>Compruebo nombre corto: <pre><code>vagrant@zeus:~$ ping zeus -c 1\nPING zeus.adrianj.gonzalonazareno.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from zeus.adrianj.gonzalonazareno.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.077 ms\n\n--- zeus.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.077/0.077/0.077/0.000 ms\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#en-apolo","title":"En apolo","text":"<p><code>/etc/hosts</code>: <pre><code>127.0.0.1   localhost\n127.0.0.2   bullseye\n::1     localhost ip6-localhost ip6-loopback\nff02::1     ip6-allnodes\nff02::2     ip6-allrouters\n\n127.0.1.1 apolo.adrianj.gonzalonazareno.org apolo\n</code></pre></p> <p>Compruebo nombre largo: <pre><code>vagrant@apolo:~$ hostname -f\napolo.adrianj.gonzalonazareno.org\n</code></pre></p> <p>Compruebo nombre corto: <pre><code>vagrant@apolo:~$ ping apolo -c 1\nPING apolo.adrianj.gonzalonazareno.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from apolo.adrianj.gonzalonazareno.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.070 ms\n\n--- apolo.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.070/0.070/0.070/0.000 ms\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#en-ares","title":"En ares","text":"<p><code>/etc/hosts</code>: <pre><code>127.0.0.1   localhost\n127.0.1.1   ubuntu2004.localdomain\n\n# The following lines are desirable for IPv6 capable hosts\n::1     localhost ip6-localhost ip6-loopback\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n\n127.0.0.1 ubuntu2004.localdomain\n\n127.0.2.1 ares.adrianj.gonzalonazareno.org ares\n</code></pre></p> <p>Compruebo nombre largo: <pre><code>vagrant@ares:~$ hostname -f\nares.adrianj.gonzalonazareno.org\n</code></pre></p> <p>Compruebo nombre corto: <pre><code>vagrant@ares:~$ ping ares -c 1\nPING ares.adrianj.gonzalonazareno.org (127.0.2.1) 56(84) bytes of data.\n64 bytes from ares.adrianj.gonzalonazareno.org (127.0.2.1): icmp_seq=1 ttl=64 time=0.136 ms\n\n--- ares.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.136/0.136/0.136/0.000 ms\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#en-hera_2","title":"En hera","text":"<p><code>/etc/hosts</code>: <pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n127.0.1.1 hera.adrianj.gonzalonazareno.org hera\n</code></pre></p> <p>Compruebo nombre largo: <pre><code>[vagrant@hera ~]$ hostname -f\nhera.adrianj.gonzalonazareno.org\n</code></pre></p> <p>Compruebo nombre corto: <pre><code>[vagrant@hera ~]$ ping hera -c 1\nPING hera.adrianj.gonzalonazareno.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from hera.adrianj.gonzalonazareno.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.071 ms\n\n--- hera.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.071/0.071/0.071/0.000 ms\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#ejercicio-7","title":"Ejercicio 7","text":"<p>Instalar bind9 en apolo</p> <pre><code>sudo apt install bind9\n</code></pre>"},{"location":"practica-escenario-libvirt/#ejercicio-8","title":"Ejercicio 8","text":"<p>SNAT en zeus + puerta de enlace</p> <pre><code>sudo modprobe iptable_nat\necho iptable_nat &gt;&gt; /etc/modules\necho 1 &gt; /proc/sys/net/ipv4/ip_forward\nsudo iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE\nsudo apt install iptables-persistent\nsudo ip route del default\nsudo ip route add default via 172.22.0.1\n</code></pre> <p>En <code>/etc/sysctl.conf</code> descomentar: <pre><code>net.ipv4.ip_forward=1\n</code></pre></p> <p><code>/etc/network/interfaces</code>: <pre><code># interfaces(5) file used by ifup(8) and ifdown(8)\n# Include files from /etc/network/interfaces.d:\nsource-directory /etc/network/interfaces.d\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\n# The primary network interface\nallow-hotplug eth0\niface eth0 inet dhcp\n    post-up ip route del default dev $IFACE\n#VAGRANT-BEGIN\n# The contents below are automatically generated by Vagrant. Do not modify.\nauto eth1\niface eth1 inet dhcp\n    post-up ip route add default via 172.22.0.1\n#VAGRANT-END\n\n#VAGRANT-BEGIN\n# The contents below are automatically generated by Vagrant. Do not modify.\nauto eth2\niface eth2 inet static\n      address 172.16.0.1\n      netmask 255.255.0.0\n#VAGRANT-END\n\n#VAGRANT-BEGIN\n# The contents below are automatically generated by Vagrant. Do not modify.\nauto eth3\niface eth3 inet static\n      address 10.0.1.1\n      netmask 255.255.255.0\n#VAGRANT-END\n</code></pre></p> <p>Puerta de enlace apolo</p> <pre><code>sudo ip route del default\nsudo ip route add default via 10.0.1.1\n</code></pre> <p><code>/etc/network/interfaces</code>: <pre><code># interfaces(5) file used by ifup(8) and ifdown(8)\n# Include files from /etc/network/interfaces.d:\nsource-directory /etc/network/interfaces.d\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\n# The primary network interface\nallow-hotplug eth0\niface eth0 inet dhcp\n    post-up ip route del default dev $IFACE\n#VAGRANT-BEGIN\n# The contents below are automatically generated by Vagrant. Do not modify.\nauto eth1\niface eth1 inet static\n      address 10.0.1.102\n      netmask 255.255.255.0\n      gateway 10.0.1.1\n#VAGRANT-END\n</code></pre></p> <p>Puerta de enlace ares</p> <pre><code>sudo ip route del default\nsudo ip route add default via 10.0.1.1\n</code></pre> <p><code>/etc/netplan/50-vagrant.yaml</code>: <pre><code>---\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    eth1:\n      addresses:\n          - 10.0.1.101/24\n      routes:\n          - to: default\n            via: 10.0.1.1\n</code></pre></p> <p>Puerta de enlace hera</p> <pre><code>sudo ip route del default\nsudo ip route add default via 172.16.0.1\n</code></pre> <p><code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>: <pre><code>DEVICE=\"eth0\"\nBOOTPROTO=\"dhcp\"\nDEFROUTE=no\nONBOOT=\"yes\"\nTYPE=\"Ethernet\"\nPERSISTENT_DHCLIENT=\"yes\"\n</code></pre></p> <p><code>/etc/sysconfig/network-scripts/ifcfg-eth1</code>: <pre><code>#VAGRANT-BEGIN\n# The contents below are automatically generated by Vagrant. Do not modify.\nNM_CONTROLLED=yes\nBOOTPROTO=none\nONBOOT=yes\nIPADDR=172.16.0.200\nNETMASK=255.255.0.0\nGATEWAY=172.16.0.1\nDEFROUTE=yes\nDEVICE=eth1\nPEERDNS=no\n#VAGRANT-END\n</code></pre></p>"},{"location":"practica-escenario-libvirt/#ejercicio-9","title":"Ejercicio 9","text":"<p>ssh config en mi m\u00e1quina para acceder a todos los servidores</p> <p><code>~/.ssh/config</code>: <pre><code>#####################\n# escenario libvirt #\n#####################\n\nHost zeus-clase\n    HostName 172.22.0.213\n    User vagrant\n\nHost apolo-clase\n  HostName 10.0.1.102\n  User vagrant\n  ProxyJump zeus-clase\n\nHost ares-clase\n  HostName 10.0.1.101\n  User vagrant\n  ProxyJump zeus-clase\n\nHost hera-clase\n  HostName 172.16.0.200   \n  User vagrant\n  ProxyJump zeus-clase\n</code></pre></p> <p>En principio esa es mi configuraci\u00f3n de conexiones para cuando est\u00e9 en la red de clase.</p> <p>Evidentemente, esta configuraci\u00f3n crecer\u00e1 cuando a\u00f1ada conexiones para mi casa.</p>"},{"location":"2asir19-20/auditoria-practica-bd/","title":"1. Activa desde SQL*Plus la auditor\u00eda de los intentos de acceso fallidos al sistema. Comprueba su funcionamiento.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#habilitamos-la-auditoria-para-los-intentos-de-login-fallidos","title":"Habilitamos la auditor\u00eda para los intentos de login fallidos","text":"<p>Para poder auditar actividad, necesitamos el privilegio de sistema <code>AUDIT SYSTEM</code></p> <p>Con auditar b\u00e1sicamente nos referimos a activar el registro de determinados eventos que sucedan en relaci\u00f3n a Oracle</p> <p>Como necesitamos ese permiso, activaremos la auditor\u00eda para los intentos de login fallidos como sysdba Este ser\u00e1 el siguiente comando a usar para activarla <pre><code>audit create session whenever not successful;\n</code></pre></p>"},{"location":"2asir19-20/auditoria-practica-bd/#parametros-de-inicializacion","title":"Par\u00e1metros de inicializaci\u00f3n","text":"<pre><code>alter system set audit_trail=db scope=spfile sid='*';\nalter system set audit_file_dest='/opt/oracle/audit/orcl/' scope=spfile sid='*';\n</code></pre> <p>Para que de verdad se almacenen los resultados de las auditor\u00edas, debemos dar un valor al par\u00e1metro de inicializaci\u00f3n <code>AUDIT_TRAIL</code>. El valor podr\u00e1 ser cualquiera, mientras que no sea nada, que es como se encontraba este par\u00e1metro desde la instalaci\u00f3n de Oracle al principio. Si el par\u00e1metro no tiene un valor, no se registran los eventos de auditor\u00eda, aunque hayamos habilitado los que queramos.</p>"},{"location":"2asir19-20/auditoria-practica-bd/#hacemos-intentos-de-inicio-de-sesion-fallidos-intencionados-para-que-se-vayan-auditando","title":"Hacemos intentos de inicio de sesi\u00f3n fallidos intencionados, para que se vayan auditando","text":"<p>Sysdba permite entrar con cualquier contrase\u00f1a, as\u00ed que no podemos probar \u00e9ste evento usando ese rol (sys as sysdba)</p> <p>En su lugar por ejemplo, voy fallar en los inicios de sesi\u00f3n con el usuario <code>HR</code>. Una vez fallar varias veces, utilizaremos la siguiente query para ver los resultados auditados:</p> <pre><code>select username, action, action_name, timestamp\n    from dba_audit_trail;\n</code></pre> <pre><code>USERNAME\n--------------------------------------------------------------------------------\n    ACTION ACTION_NAME          TIMESTAMP\n---------- ---------------------------- ---------\nSYSTEM\n       100 LOGON            05-MAR-20\n\nSYSTEM\n       100 LOGON            05-MAR-20\n\nSYSTEM\n       100 LOGON            05-MAR-20\n\nHR\n       100 LOGON            05-MAR-20\n\nHR\n       100 LOGON            05-MAR-20\n\nHR\n       100 LOGON            05-MAR-20\n\nHR\n       100 LOGON            05-MAR-20\n\n7 rows selected.\n</code></pre> <p>La vista <code>DBA_AUDIT_TRAIL</code> muestra absolutamente todas las entradas de auditor\u00edas que Oracle ha registrado</p> <p>Como podemos observar, los \u00fanicos eventos registrados est\u00e1n relacionados con hacer login (ya que es el \u00fanico evento que hemos habilitado para su registro). En este caso los eventos indican fallos de login. Tienen c\u00f3digo <code>100</code> y nombre <code>LOGON</code></p>"},{"location":"2asir19-20/auditoria-practica-bd/#2-realiza-un-procedimiento-en-plsql-que-te-muestre-los-accesos-fallidos-junto-con-el-motivo-de-los-mismos-transformando-el-codigo-de-error-almacenado-en-un-mensaje-de-texto-comprensible","title":"2. Realiza un procedimiento en PL/SQL que te muestre los accesos fallidos junto con el motivo de los mismos, transformando el c\u00f3digo de error almacenado en un mensaje de texto comprensible.","text":"<p>select username, action, action_name, timestamp, returncode from dba_audit_trail;</p> <pre><code>CREATE OR REPLACE Function FuncionFallo(p_codigo varchar2)\nreturn varchar2\nIS\nBEGIN\n    CASE p_codigo\n    WHEN '1017' THEN\n        RETURN 'LOGIN ERROR';\n    WHEN '2004' THEN\n        RETURN '';\n    ELSE\n        RETURN 'UNKNOWN ERROR';\n    END CASE;\nEND;\n\nCREATE OR REPLACE Procedure failed_accesses\n\nIS\n    cursor c_audit is\n    select username, action, action_name, timestamp, returncode \n    from dba_audit_trail;\n\n    v_fallo varchar2(20);\n{\"usuario\":\"valor\",\"usuario\":\"valor2\"}\n\nBEGIN\n\n   for v_audit in c_audit loop\n        v_fallo:=FuncionFallo(v_audit.returncode);\n        dbms_output.put_line(v_audit.username||chr(9)||v_audit.action||chr(9)||v_audit.action_name||chr(9)||v_audit.timestamp||chr(9)||v_fallo);\n    end loop;\nEND;\n</code></pre> <p>Return codes and messages (commonly seen) ORA-01017: invalid username/password; logon denied ORA-01045: user lacks CREATE SESSION privilege; logon denied ORA-03136: inbound connection timed out ORA-28000: the account is locked ORA-28001: the password has expired ORA-28003: password verification for the specified password failed ORA-28007: the password cannot be reused ORA-28043: invalid bind credentials for DB-OID connection</p>"},{"location":"2asir19-20/auditoria-practica-bd/#3-activa-la-auditoria-de-las-operaciones-dml-realizadas-por-scott-comprueba-su-funcionamiento","title":"3. Activa la auditor\u00eda de las operaciones DML realizadas por SCOTT. Comprueba su funcionamiento.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#activacion-de-la-auditoria","title":"Activaci\u00f3n de la auditor\u00eda","text":"<p>Todas las operaciones DML existentes son: * SELECT * INSERT * UPDATE * DELETE * MERGE * CALL * EXPLAIN PLAN * LOCK TABLE</p> <p>La herramienta nativa que nos ofrece Oracle para controlar la auditor\u00eda nos dejar\u00e1 auditar todos esos eventos, menos: * MERGE * EXPLAIN PLAN</p> <p>Con el siguiente comando entonces, activaremos la auditor\u00eda para dichos eventos: <pre><code>AUDIT SELECT TABLE, INSERT TABLE, UPDATE TABLE, DELETE TABLE, EXECUTE PROCEDURE, LOCK TABLE\n    BY SCOTT BY ACCESS;\n</code></pre></p> <p>Con audit, la opci\u00f3n <code>EXECUTE PROCEDURE</code> es pr\u00e1cticamente lo mismo que decir que estamos auditando las sentencias <code>CALL</code>. \u00bfPor qu\u00e9? B\u00e1sicamente, porque al decir que auditamos <code>EXECUTE PROCEDURE</code>, s\u00f3lo se registran eventos cuando se ejecuten \u00f3rdenes <code>CALL</code> (tal y como se dice en la documentaci\u00f3n oficial de audit)</p> <p>Una vez que la acci\u00f3n se haya realizado con \u00e9xito, aparece lo siguiente: <pre><code>Audit succeeded.\n</code></pre></p>"},{"location":"2asir19-20/auditoria-practica-bd/#comprobacion-de-insert-table","title":"Comprobaci\u00f3n de INSERT TABLE","text":"<p>A\u00f1adimos el siguiente registro a una tabla <code>TEST</code> que hemos creado en SCOTT, precisamente para probar estas acciones de auditor\u00eda <pre><code>INSERT INTO TEST\nVALUES (1,'value2', 'value3'); \n</code></pre></p> <p>Luego, comprobamos que se haya registrado el evento correspondiente <pre><code>SELECT username, action, action_name, timestamp, returncode\n    FROM dba_audit_trail\n    WHERE action_name='INSERT' AND username='SCOTT'\n    ORDER BY timestamp;\n</code></pre></p> <p>Evidentemente, filtramos S\u00d3LO los eventos de INSERT hechos por SCOTT en este caso, y ordenamos por fecha. As\u00ed nos saldr\u00e1n los m\u00e1s nuevos al final (ordenando ascendente, como funciona por defecto)</p> <p><pre><code>USERNAME                                                                 ACTION ACTION_NAME          TIMESTAMP RETURNCODE\n-------------------------------------------------------------------------------------------------------------------------------- ---------- ---------------------------- --------- ----------\nSCOTT                                                                     2 INSERT           05-MAR-20    984\nSCOTT                                                                     2 INSERT           05-MAR-20      0\nSCOTT                                                                     2 INSERT           05-MAR-20      0\nSCOTT                                                                     2 INSERT           10-MAR-20      0\n</code></pre> El \u00faltimo evento de INSERT, datado a 10 de Marzo, es el que indica la acci\u00f3n que hemos realizado antes, ya que es el \u00faltimo y \u00fanico evento de INSERT en la fecha actual (realizado por SCOTT claro)</p>"},{"location":"2asir19-20/auditoria-practica-bd/#comprobacion-de-update-table","title":"Comprobaci\u00f3n de UPDATE TABLE","text":""},{"location":"2asir19-20/auditoria-practica-bd/#comprobacion-de-select-table","title":"Comprobaci\u00f3n de SELECT TABLE","text":""},{"location":"2asir19-20/auditoria-practica-bd/#comprobacion-de-delete-table","title":"Comprobaci\u00f3n de DELETE TABLE","text":""},{"location":"2asir19-20/auditoria-practica-bd/#comprobacion-de-execute-procedure","title":"Comprobaci\u00f3n de EXECUTE PROCEDURE","text":""},{"location":"2asir19-20/auditoria-practica-bd/#comprobacion-de-lock-table","title":"Comprobaci\u00f3n de LOCK TABLE","text":""},{"location":"2asir19-20/auditoria-practica-bd/#4-realiza-una-auditoria-de-grano-fino-para-almacenar-informacion-sobre-la-insercion-de-empleados-del-departamento-10-en-la-tabla-emp-de-scott","title":"4. Realiza una auditor\u00eda de grano fino para almacenar informaci\u00f3n sobre la inserci\u00f3n de empleados del departamento 10 en la tabla emp de scott.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#5-explica-la-diferencia-entre-auditar-una-operacion-by-access-o-by-session","title":"5. Explica la diferencia entre auditar una operaci\u00f3n by access o by session.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#6-documenta-las-diferencias-entre-los-valores-db-y-db-extended-del-parametro-audit_trail-de-oracle-demuestralas-poniendo-un-ejemplo-de-la-informacion-sobre-una-operacion-concreta-recopilada-con-cada-uno-de-ellos","title":"6. Documenta las diferencias entre los valores db y db, extended del par\u00e1metro audit_trail de ORACLE. Demu\u00e9stralas poniendo un ejemplo de la informaci\u00f3n sobre una operaci\u00f3n concreta recopilada con cada uno de ellos.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#7-localiza-en-enterprise-manager-las-posibilidades-para-realizar-una-auditoria-e-intenta-repetir-con-dicha-herramienta-los-apartados-1-3-y-4","title":"7. Localiza en Enterprise Manager las posibilidades para realizar una auditor\u00eda e intenta repetir con dicha herramienta los apartados 1, 3 y 4.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#8-averigua-si-en-postgres-se-pueden-realizar-los-apartados-1-3-y-4-si-es-asi-documenta-el-proceso-adecuadamente","title":"8. Averigua si en Postgres se pueden realizar los apartados 1, 3 y 4. Si es as\u00ed, documenta el proceso adecuadamente.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#9-averigua-si-en-mysql-se-pueden-realizar-los-apartados-1-3-y-4-si-es-asi-documenta-el-proceso-adecuadamente","title":"9. Averigua si en MySQL se pueden realizar los apartados 1, 3 y 4. Si es as\u00ed, documenta el proceso adecuadamente.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#10-averigua-las-posibilidades-que-ofrece-mongodb-para-auditar-los-cambios-que-va-sufriendo-un-documento","title":"10.  Averigua las posibilidades que ofrece MongoDB para auditar los cambios que va sufriendo un documento.","text":""},{"location":"2asir19-20/auditoria-practica-bd/#11-averigua-si-en-mongodb-se-pueden-auditar-los-accesos-al-sistema","title":"11.  Averigua si en MongoDB se pueden auditar los accesos al sistema.","text":""},{"location":"2asir19-20/database-interconnection/","title":"Enunciado","text":"<p>Los servidores enlazados siempre tendr\u00e1n que estar instalados en m\u00e1quinas diferentes</p> <p>En \u00e9sta pr\u00e1ctica veremos varias formas de crear un enlace entre distintos servidores de bases de datos</p> <p>Tipos de enlace a crear:</p> <ul> <li> <p>2 servidores de bases de datos ORACLE</p> </li> <li> <p>2 servidores de bases de datos PostgreSQL</p> </li> <li> <p>1 servidor ORACLE y 1 PostgreSQL/MySQL empleando Heterogeneous Services</p> </li> </ul> <p>En todos ellos, es necesario explicar la configuraci\u00f3n necesaria para ambos extremos y demostrar su funcionamiento</p>"},{"location":"2asir19-20/database-interconnection/#1-registro-de-acciones-previas-en-cada-maquina","title":"1. Registro de acciones previas en cada m\u00e1quina","text":""},{"location":"2asir19-20/database-interconnection/#oracle1","title":"Oracle1","text":"<ul> <li>A\u00f1adimos lo siguiente en <code>/etc/apt/sources.list</code> <pre><code># Oracle XE Debian repository\ndeb http://oss.oracle.com/debian unstable main non-free\n</code></pre></li> <li>Crea usuarios y grupos <pre><code>sudo addgroup --system oinstall\nsudo addgroup --system dba\nsudo adduser --system --ingroup oinstall --shell /bin/bash oracle\nsudo adduser oracle dba\n</code></pre></li> <li>sysctl Creamos el fichero <code>/etc/sysctl.d/local-oracle.conf</code> con el siguiente contenido <pre><code>fs.file-max = 65536\nfs.aio-max-nr = 1048576\n# semaphores: semmsl, semmns, semopm, semmni\nkernel.sem = 250 32000 100 128\n# (Oracle recommends total machine Ram -1 byte)\nkernel.shmmax = 2147483648\nkernel.shmall = 2097152\nkernel.shmmni = 4096\nnet.ipv4.ip_local_port_range = 1024 65000\nvm.hugetlb_shm_group = 124\nvm.nr_hugepages = 64\n</code></pre> <p>El valor de <code>vm.hugetlb_shm_group</code>, debe ser el GID del grupo dba</p> </li> </ul> <p>Para cargar \u00e9sta configuraci\u00f3n, hacemos <pre><code>sudo sysctl -p /etc/sysctl.d/local-oracle.conf\n</code></pre></p> <ul> <li> <p>Security limits Crear fichero <code>/etc/security/limits.d/local-oracle.conf</code> con el siguiente contenido <pre><code>oracle          soft    nproc           2047\noracle          hard    nproc           16384\noracle          soft    nofile          1024\noracle          hard    nofile          65536\noracle          soft    memlock         204800\noracle          hard    memlock         204800\n</code></pre></p> </li> <li> <p>Enlaces simb\u00f3licos requeridos (estos son los que se recomiendan crear, pero en mi caso algunos no los necesitaba, porque simplemente el binario ya exist\u00eda en el directorio, o ya hab\u00eda un symlink creado en el mismo) <pre><code>sudo ln -s /usr/bin/awk /bin/awk\nsudo ln -s /usr/bin/basename /bin/basename\nsudo ln -s /usr/bin/rpm /bin/rpm\nsudo ln -s /usr/lib/x86_64-linux-gnu /usr/lib64\n</code></pre></p> </li> <li> <p>Estructura de directorios necesaria para instalar Oracle <pre><code>sudo mkdir -p /opt/oracle/product/12.1.0.2\nsudo mkdir -p /opt/oraInventory\nsudo chown -R oracle:dba /opt/oracle/\nsudo chown -R oracle:dba /opt/oraInventory\n</code></pre></p> </li> <li> <p>Pre-instalaci\u00f3n de Oracle 12c Instalamos algunos paquetes necesarios <pre><code>sudo apt install build-essential binutils libcap-dev gcc g++ libc6-dev ksh libaio-dev make libxi-dev libxtst-dev libxau-dev libxcb1-dev sysstat rpm xauth unzip\n</code></pre> Adem\u00e1s de todos esos paquetes, hay uno en espec\u00edfico que he necesitado porque el instalador utiliza el binario <code>xdpyinfo</code> (para comprobar cierta informaci\u00f3n acerca del DISPLAY de la m\u00e1quina) <pre><code>sudo apt install x11-utils\n</code></pre></p> </li> </ul> <p>Luego cuando tengamos Oracle 12c descargado, lo descomprimimos en el home de nuestro usuario  <pre><code>unzip linuxx64_12201_database.zip\n</code></pre> Creamos una serie de variables de entorno <pre><code>export ORACLE_HOSTNAME=localhost\nexport ORACLE_OWNER=oracle\nexport ORACLE_BASE=/opt/oracle\nexport ORACLE_HOME=/opt/oracle/product/12.1.0.2/dbhome_1\nexport ORACLE_UNQNAME=orcl\nexport ORACLE_SID=orcl\nexport PATH=$PATH:$ORACLE_HOME/bin\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/x86_64-linux-gnu:/bin/lib:/lib/x86_64-linux-gnu/:/usr/lib64\n</code></pre></p> <ul> <li>Instalaci\u00f3n de Oracle 12c Debemos ejecutar el instalador como usuario \"oracle\". Para logearnos, primero le asignamos una contrase\u00f1a (ser\u00e1 1234) <pre><code>sudo passwd oracle\n</code></pre> Y nos conectamos <pre><code>su - oracle\n</code></pre> Ahora s\u00ed, ejecutamos el instalador <pre><code>/home/debian/database/runInstaller -IgnoreSysPreReqs\n</code></pre></li> </ul> <p>Estamos instalando Oracle en Debian, distribuci\u00f3n que no est\u00e1 certificada por Oracle. Por ello el que ejecutemos el instalador dici\u00e9ndole que \"ignore algunas comprobaciones\" o \"pre-requisitos\" (usando -IgnoreSysPreReqs)</p> <ul> <li>Datos importantes introducidos durante la instalaci\u00f3n   </li> </ul> <p>Global database name = orcl Oracle system identifier (SID) = orcl Contrase\u00f1a SYS = Megabyte1 Contrase\u00f1a SYSTEM = Megabyte1  </p>"},{"location":"2asir19-20/database-interconnection/#oracle2","title":"Oracle2","text":""},{"location":"2asir19-20/database-interconnection/#postgresql1","title":"PostgreSQL1","text":"<ul> <li> <p>En el SO Instalamos PostgreSQL y creamos un nuevo usuario <pre><code>sudo apt install postgresql-11\nsudo adduser postgres1_user\n</code></pre> La password de este usuario ser\u00e1 1234 <pre><code>sudo passwd postgres\n</code></pre> Es necesario a\u00f1adirle al usuario postgres una contrase\u00f1a primero, para que nos podamos logear, y as\u00ed entrar como admin a la base de datos  </p> </li> <li> <p>En PostgreSQL Como usuario postgres, creamos un nuevo usuario y su base de datos <pre><code>CREATE USER postgres1_user WITH PASSWORD '1234';\nCREATE DATABASE postgres1_db OWNER postgres1_user;\n</code></pre> Nos logeamos primero como el usuario creado, y nos conectamos a su base de datos <pre><code>su - postgres1_user\npsql -d postgres1_db\n</code></pre> Creamos una tabla que usaremos para probar los enlaces posteriormente <pre><code>CREATE TABLE table1(\n   id serial PRIMARY KEY,\n   name VARCHAR (50),\n   descrip VARCHAR (50)\n);\n</code></pre> Le a\u00f1adimos un registro <pre><code>INSERT INTO table1 VALUES (1, 'Bird', 'Has wings');\n</code></pre></p> </li> <li> <p>Configuraciones para accesos remotos</p> </li> <li>Modificamos el fichero <code>/etc/postgresql/11/main/postgresql.conf</code> <pre><code>listen_addresses = '*'\n</code></pre></li> <li>Modificamos el fichero <code>/etc/postgresql/11/main/pg_hba.conf</code>. A\u00f1ad\u00ed lo siguiente al final   <pre><code>#Added by me\nhost all all 0.0.0.0/0 md5\n</code></pre></li> <li>Al final, tenemos que reiniciar PostgreSQL para que los cambios surtan efecto   <pre><code>sudo systemctl restart postgresql\n</code></pre></li> </ul>"},{"location":"2asir19-20/database-interconnection/#postgresql2","title":"PostgreSQL2","text":"<ul> <li> <p>En el SO Instalamos PostgreSQL y creamos un nuevo usuario <pre><code>sudo apt install postgresql-11\nsudo adduser postgres2_user\n</code></pre> La password de este usuario ser\u00e1 1234 <pre><code>sudo passwd postgres\n</code></pre> Es necesario a\u00f1adirle al usuario postgres una contrase\u00f1a primero, para que nos podamos logear, y as\u00ed entrar como admin a la base de datos  </p> </li> <li> <p>En PostgreSQL Como usuario postgres, creamos un nuevo usuario y su base de datos <pre><code>CREATE USER postgres2_user WITH PASSWORD '1234';\nCREATE DATABASE postgres2_db OWNER postgres2_user;\n</code></pre> Nos logeamos primero como el usuario creado, y nos conectamos a su base de datos <pre><code>su - postgres2_user\npsql -d postgres2_db\n</code></pre> Creamos una tabla que usaremos para probar los enlaces posteriormente <pre><code>CREATE TABLE table2(\n   id serial PRIMARY KEY,\n   name VARCHAR (50),\n   descrip VARCHAR (50)\n);\n</code></pre> Le a\u00f1adimos un registro <pre><code>INSERT INTO table2 VALUES (1, 'Dog', 'Has paws');\n</code></pre></p> </li> <li> <p>Configuraciones para accesos remotos</p> </li> <li>Modificamos el fichero <code>/etc/postgresql/11/main/postgresql.conf</code> <pre><code>listen_addresses = '*'\n</code></pre></li> <li>Modificamos el fichero <code>/etc/postgresql/11/main/pg_hba.conf</code>. A\u00f1ad\u00ed lo siguiente al final   <pre><code>#Added by me\nhost all all 0.0.0.0/0 md5\n</code></pre></li> <li>Al final, tenemos que reiniciar PostgreSQL para que los cambios surtan efecto   <pre><code>sudo systemctl restart postgresql\n</code></pre></li> </ul>"},{"location":"2asir19-20/database-interconnection/#2-enlace-oracle-oracle","title":"2. Enlace ORACLE - ORACLE","text":""},{"location":"2asir19-20/database-interconnection/#3-enlace-postgresql-postgresql","title":"3. Enlace PostgreSQL - PostgreSQL","text":""},{"location":"2asir19-20/database-interconnection/#4-enlace-oracle-postgresql","title":"4. Enlace ORACLE - PostgreSQL","text":""},{"location":"2asir19-20/java-webapp/","title":"Pr\u00e1ctica: Despliegue de CMS java","text":"<p>OUTLINE para hacer:</p> <p>Conexiones a tener en guacamole: -1 VNC linux -1 VNC windows -SSH</p> <p>Funcionalidad a\u00f1adida de grabaciones -Grabaciones en v\u00eddeo de las sesi\u00f3n ssh (se graba por sesi\u00f3n)</p> <p>Funcionalidades que no he podido a\u00f1adir -RDP freerdp2-dev (la que se puede instalar en buster, pero el configure no detecta esa librer\u00eda para que funcione RDP) libfreerdp-dev (la que te pide el manual de guacamole, est\u00e1 en stretch, pero fue eliminada de buster por BUGS...etc)</p> <p>-Telnet (por errores en Windows7 no se activaba correctamente telnet)</p>"},{"location":"2asir19-20/java-webapp/#1-indica-la-aplicacion-escogida-y-su-funcionalidad","title":"1. Indica la aplicaci\u00f3n escogida y su funcionalidad.","text":"<p>Apache Guacamole</p> <p>Consta de un cliente (app web) y un servidor (guacd, que establece las conexiones remotas)</p>"},{"location":"2asir19-20/java-webapp/#2-escribe-una-guia-de-los-pasos-fundamentales-para-realizar-la-instalacion","title":"2. Escribe una gu\u00eda de los pasos fundamentales para realizar la instalaci\u00f3n","text":""},{"location":"2asir19-20/java-webapp/#requisitos-previos","title":"Requisitos previos","text":"<p>-Lo necesitamos para poder compilar guacamole server sudo apt install build-essential</p> <p>install java https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-on-debian-10</p> <p>sudo apt install default-jre java -version</p> <p>install tomcat9 https://tecadmin.net/install-apache-tomcat-9-on-debian/</p> <p>sudo apt install tomcat9</p>"},{"location":"2asir19-20/java-webapp/#instalacion","title":"Instalaci\u00f3n","text":""},{"location":"2asir19-20/java-webapp/#configuracion-guacamole","title":"Configuraci\u00f3n guacamole","text":"<p>GUACAMOLE_HOME is the name given to Guacamole's configuration directory, which is located at /etc/guacamole by default. All configuration files, extensions, etc. reside within this directory. The structure of GUACAMOLE_HOME is rigorously defined</p> <p>BUT</p> <p>If you cannot or do not wish to use /etc/guacamole for GUACAMOLE_HOME, the location can be overridden through any of the following methods: Creating a directory named .guacamole, within the home directory of the user running the servlet container. This directory will automatically be used for GUACAMOLE_HOME if it exists.</p> <p>Por esto, tendremos que crear el directorio <pre><code>sudo mkdir /.guacamole\n</code></pre></p> <p>UTILIZAR EL COMANDO PATCH, COGER EL PARCHE, LLEVARLO A UN FICHERO, Y APLIC\u00c1RSELO AL FICHERO C CORRESPONDIENTE. LA SINTAXIS NO ERA DE GIT, ERA UN DIFF FILE, UN FICHERO DE DIFERENCIAS</p> <p>patch guacenc.c ~/patch (comando usado para evitar el error que ten\u00eda al compilar, teniendo las librer\u00edas necesarias para la grabaci\u00f3n de sesiones)</p> <p>Enlace al parche por el error al compilar con la funcionalidad de grabaci\u00f3n (librer\u00edas de v\u00eddeo instaladas) https://issues.apache.org/jira/browse/GUACAMOLE-638</p>"},{"location":"2asir19-20/java-webapp/#3-has-necesitado-instalar-alguna-libreria-has-necesitado-instalar-un-conector-de-una-base-de-datos","title":"3. \u00bfHas necesitado instalar alguna librer\u00eda? \u00bfHas necesitado instalar un conector de una base de datos?","text":""},{"location":"2asir19-20/java-webapp/#4-entrega-una-captura-de-pantalla-donde-se-vea-la-aplicacion-funcionando","title":"4. Entrega una captura de pantalla donde se vea la aplicaci\u00f3n funcionando.","text":""},{"location":"2asir19-20/java-webapp/#5-realiza-la-configuracion-necesaria-en-apache2-y-tomcat-utilizando-el-protocolo-ajp-para-que-la-aplicacion-sea-servida-por-el-servidor-web","title":"5. Realiza la configuraci\u00f3n necesaria en apache2 y tomcat (utilizando el protocolo AJP) para que la aplicaci\u00f3n sea servida por el servidor web.","text":""},{"location":"2asir19-20/java-webapp/#6-entrega-una-captura-de-pantalla-donde-se-vea-la-aplicacion-funcionando-servida-por-apache2","title":"6. Entrega una captura de pantalla donde se vea la aplicaci\u00f3n funcionando servida por apache2.","text":"<p>Working guides followed</p> <p>install guacamole https://guacamole.apache.org/doc/gug/installing-guacamole.html#deploying-guacamole</p> <p>configuring guacamole https://guacamole.apache.org/doc/gug/configuring-guacamole.html#guacamole-home</p> <p>Guides not followed, maybe working</p> <p>guacamole debian guide (not followed, not sure if works) https://wiki.debian.org/Guacamole</p> <p>tecmint guide for guacamole (not followed) https://www.tecmint.com/guacamole-access-remote-linux-windows-machines-via-web-browser/</p> <p>[ Important data ]</p> <ul> <li>Password vnc server connections (linux server and Windows) passsword 12345678 (NOT VIEW ONLY)</li> </ul> <p>Longitud m\u00e1xima de 8 caracteres en las contrase\u00f1as</p> <ul> <li> <p>Password for vagrant user (porque pas\u00e9 el paquete de guacamole server y client por scp y me logue\u00e9 con contrase\u00f1a) 1234</p> </li> <li> <p>Administrative password TightVNC Server (en windows) 12345678</p> </li> </ul>"},{"location":"2asir19-20/metrics-logs-monitoring/","title":"Informaci\u00f3n general","text":"<p>Es necesario: * Realizar todos los apartados (monitorizaci\u00f3n, m\u00e9tricas, logs) sobre todas las m\u00e1quinas: croqueta, salmorejo, tortilla y serranito * Detallar en la documentaci\u00f3n claramente las caracter\u00edsticas de la implementaci\u00f3n elegida, as\u00ed como la forma de comprobar las caracter\u00edsticas exigidas.</p>"},{"location":"2asir19-20/metrics-logs-monitoring/#0-pasos-previos","title":"0. Pasos previos","text":"<ul> <li> <p>Creaci\u00f3n de la nueva instancia:</p> <ul> <li>Nombre: serranito </li> <li>Creada: imagen</li> <li>OS: Debian Buster</li> <li>Flavor: m1.mini (512 MB RAM &amp; 10 GB disco)</li> </ul> </li> <li> <p>Cambios en el DNS <pre><code>serranito-int   IN    A    10.0.0.13\nserranito       IN    A    172.22.201.133\n</code></pre></p> </li> <li> <p>Le he a\u00f1adido un grupo de seguridad en Openstack a su firewall por nodo, para que permita las conexiones entrantes por el puerto 80. Es necesario hacer esto ya que Zabbix tiene un frontal web que necesita ser accesible para la instalaci\u00f3n del mismo programa, y para su posterior uso.  </p> </li> </ul> <p></p>"},{"location":"2asir19-20/metrics-logs-monitoring/#1-monitorizacion-con-zabbix","title":"1. Monitorizaci\u00f3n con Zabbix","text":"<p>Necesario hacer: * Alertas por uso excesivo de recursos (memoria, disco ra\u00edz, etc.) * Mostrar disponibilidad de los servicios (estado en vivo...etc) * Env\u00edo de alertas por correo, telegram, etc</p> <p>Env\u00edo de alertas por telegram:  https://share.zabbix.com/zabbix-tools-and-utilities/cat-notifications/zabbix-in-telegram</p>"},{"location":"2asir19-20/metrics-logs-monitoring/#instalando-apache-php-en-serranito","title":"Instalando Apache + php en serranito","text":"<p>Ser\u00eda l\u00f3gico que instal\u00e1semos Zabbix en salmorejo, puesto que es donde se encuentra nuestro servidor web principal. Pero como se nos pide tener estos sistemas centralizados en serranito, vamos a tener que instalarle un servidor web</p> <ul> <li>Actualizamos la lista de paquetes, e instalamos los que no tengamos <p>Hacemos esto porque serranito es una m\u00e1quina nueva</p> </li> </ul> <pre><code>sudo apt update\nsudo apt upgrade\n</code></pre> <ul> <li> <p>Instalamos apache + php <pre><code>sudo apt install apache2\nsudo apt install php php-mbstring php-gd php-xml php-bcmath php-ldap php-mysql\n</code></pre></p> </li> <li> <p>Declarando la zona horaria en PHP, en el fichero <code>/etc/zabbix/apache.conf</code> <pre><code>php_value date.timezone Europe/Madrid \n</code></pre></p> </li> </ul>"},{"location":"2asir19-20/metrics-logs-monitoring/#anadiendo-el-repositorio-de-zabbix","title":"A\u00f1adiendo el repositorio de Zabbix","text":"<pre><code>wget https://repo.zabbix.com/zabbix/4.0/debian/pool/main/z/zabbix-release/zabbix-release_4.0-3+buster_all.deb\nsudo dpkg -i zabbix-release_4.0-3+buster_all.deb\n</code></pre>"},{"location":"2asir19-20/metrics-logs-monitoring/#instalando-zabbix-server-y-agent-en-serranito","title":"Instalando Zabbix server y agent en serranito","text":"<pre><code>sudo apt update\nsudo apt install zabbix-server-mysql zabbix-frontend-php zabbix-agent\n</code></pre>"},{"location":"2asir19-20/metrics-logs-monitoring/#configuracion-en-la-base-de-datos","title":"Configuraci\u00f3n en la base de datos","text":"<ul> <li> <p>Nos logeamos como root en tortilla <pre><code>mysql -u root -p\n</code></pre></p> </li> <li> <p>Creamos la base de datos, el usuario para cualquier tipo de acceso, asignamos privilegios... <pre><code>CREATE DATABASE zabbixdb character set utf8 collate utf8_bin;\nCREATE USER 'zabbix'@'%' IDENTIFIED BY '1234';\nGRANT ALL PRIVILEGES ON zabbixdb.* TO 'zabbix'@'%' WITH GRANT OPTION;\nFLUSH PRIVILEGES;\n</code></pre></p> </li> <li> <p>Cargamos el esquema de Zabbix en la nueva base de datos creada</p> <p>Esto tendremos que hacerlo desde serranito, porque es all\u00ed donde instalamos Zabbix, y donde se encuentra el paquete que necesitamos con los datos</p> </li> </ul> <pre><code>cd /usr/share/doc/zabbix-server-mysql\nzcat create.sql.gz | mysql -u zabbix -p zabbixdb -h 172.22.200.158\n</code></pre>"},{"location":"2asir19-20/metrics-logs-monitoring/#modificar-configuracion-de-zabbix-server-para-la-conexion-con-la-base-de-datos","title":"Modificar configuraci\u00f3n de Zabbix server para la conexi\u00f3n con la base de datos","text":"<p>Editamos el fichero <code>/etc/zabbix/zabbix_server.conf</code>, modificando los siguientes par\u00e1metros <pre><code>DBHost=10.0.0.14\nDBName=zabbixdb\nDBUser=zabbix\nDBPassword=1234\n</code></pre></p>"},{"location":"2asir19-20/metrics-logs-monitoring/#reinicio-de-apache-y-zabbix","title":"Reinicio de Apache y Zabbix","text":"<p>Zabbix creates its own apache configuration file /etc/zabbix/apache.conf and make a link to Apache configuration directory. Let\u2019s use the following command to restart Apache service.</p> <pre><code>sudo systemctl restart apache2.service\n</code></pre> <p>Zabbix server configuration file are located at /etc/zabbix/zabbix_server.conf. Restart Zabbix server.</p> <pre><code>sudo systemctl restart zabbix-server\nsudo systemctl restart zabbix-agent\n</code></pre>"},{"location":"2asir19-20/metrics-logs-monitoring/#instalacion-final-web","title":"Instalaci\u00f3n final web","text":"<p>Aunque no hayamos configurado virtualhosts ni a\u00f1adido datos a document roots, Zabbix funcionar\u00e1 para la instalaci\u00f3n accediendo a <code>172.22.201.133/zabbix</code>. Esto se debe al enlace que hizo Zabbix a la configuraci\u00f3n de Apache, creando un alias <code>/zabbix</code> apuntando a <code>/usr/share/zabbix</code>. Por lo tanto, \u00e9ste es el document root real de la aplicaci\u00f3n.</p> <ul> <li>A\u00f1adimos los par\u00e1metros para la conexi\u00f3n con la base de datos</li> </ul> <p></p> <p>En este caso el puerto 0 est\u00e1 indicando que se utilizar\u00e1 el puerto por defecto que usa la base de datos a la que nos vamos a conectar (mariadb en nuestro caso, puerto 3306)</p> <ul> <li>Como hemos instalado Zabbix server en la misma m\u00e1quina donde tenemos el frontal web, la conexi\u00f3n a este servicio va a ser desde localhost. Se rellena el puerto que usa Zabbix server por defecto, as\u00ed que s\u00f3lo nos quedar\u00eda nombrar la conexi\u00f3n, si queremos</li> </ul> <p></p> <ul> <li>Este ser\u00eda el resumen de mi instalaci\u00f3n</li> </ul> <p></p> <ul> <li>Despu\u00e9s de la instalaci\u00f3n podremos hacer login sin problemas <p>Usaremos para el acceso las credenciales por defecto: Username:  Admin Password:  zabbix</p> </li> </ul> <p></p> <ul> <li>Una vez dentro, nos encontraremos con el siguiente panel principal. Viendo esto podremos estar seguros de que la aplicaci\u00f3n web Zabbix se instal\u00f3 y configur\u00f3 correctamente</li> </ul> <p></p>"},{"location":"2asir19-20/metrics-logs-monitoring/#instalando-zabbix-agent-en-las-demas-maquinas-a-monitorizar","title":"Instalando Zabbix Agent en las dem\u00e1s m\u00e1quinas a monitorizar","text":""},{"location":"2asir19-20/metrics-logs-monitoring/#en-croqueta","title":"En croqueta","text":"<ul> <li> <p>A\u00f1adiendo los repositorios de Zabbix para Debian 10 <pre><code>wget https://repo.zabbix.com/zabbix/4.0/debian/pool/main/z/zabbix-release/zabbix-release_4.0-3+buster_all.deb\nsudo dpkg -i zabbix-release_4.0-3+buster_all.deb\n</code></pre></p> </li> <li> <p>Actualizamos la lista de paquetes y lo instalamos a la \u00faltima versi\u00f3n posible <pre><code>sudo apt update\nsudo apt install zabbix-agent\n</code></pre></p> </li> <li> <p>Configurando el fichero <code>/etc/zabbix/zabbix_agentd.conf</code> de Zabbix Agent <pre><code>Server=10.0.0.13\nHostname=croqueta\n</code></pre></p> </li> </ul> <p>Server: IP apuntando a donde est\u00e9 nuestro Zabbix Server (apunta a serranito) Hostname: nombre que queramos que tenga este cliente de Zabbix a la hora de monitorizarlo </p> <ul> <li>Habilitamos siempre al arranque Zabbix Agent, y lo iniciamos  <pre><code>sudo systemctl enable zabbix-agent \nsudo systemctl start zabbix-agent \n</code></pre></li> </ul>"},{"location":"2asir19-20/metrics-logs-monitoring/#en-salmorejo","title":"En salmorejo","text":""},{"location":"2asir19-20/metrics-logs-monitoring/#en-tortilla","title":"En tortilla","text":""},{"location":"2asir19-20/metrics-logs-monitoring/#anadiendo-los-hosts-en-zabbix-server-para-su-monitorizacion","title":"A\u00f1adiendo los hosts en Zabbix Server para su monitorizaci\u00f3n","text":""},{"location":"2asir19-20/metrics-logs-monitoring/#croqueta","title":"Croqueta","text":"<ul> <li>En el panel principal debemos irnos a Configuration / Hosts / Create host. Estaremos en la siguiente pantalla</li> </ul> <ul> <li>Aqu\u00ed tendremos que rellenar los datos del host que queramos a\u00f1adir (en este caso croqueta), para configurar su conexi\u00f3n con Zabbix Server</li> </ul> <ul> <li>Despu\u00e9s de \u00e9sto, asociamos una plantilla al host</li> </ul> <p>Las plantillas son conjuntos de entidades que pueden ser asignadas a varios hosts simult\u00e1neamente. Las entidades podr\u00edamos entenderlas como \"caracter\u00edsticas\" que estamos queriendo monitorizar sobre los hosts, entre otras cosas. Haz click aqu\u00ed para m\u00e1s info</p> <ul> <li>Finalmente, solamente tenemos que a\u00f1adir el host, y veremos que est\u00e1 en la lista. Vemos que aparece croqueta</li> </ul> <p></p>"},{"location":"2asir19-20/metrics-logs-monitoring/#salmorejo","title":"Salmorejo","text":""},{"location":"2asir19-20/metrics-logs-monitoring/#tortilla","title":"Tortilla","text":""},{"location":"2asir19-20/metrics-logs-monitoring/#2-recoleccion-de-metricas-con-cacti","title":"2. Recolecci\u00f3n de m\u00e9tricas con cacti","text":"<p>A hacer en esta parte: recolecci\u00f3n, gesti\u00f3n centralizada, filtrado y representaci\u00f3n gr\u00e1fica de los par\u00e1metros que consideres necesarios</p> <p>-Recolecci\u00f3n de m\u00e9tricas (recolecci\u00f3n de datos simplemente)</p>"},{"location":"2asir19-20/metrics-logs-monitoring/#3-logs-con-graylog","title":"3. Logs con graylog","text":"<p>A hacer en esta parte: Implementa un sistema centralizado de filtrado que permita quedarse con registros con prioridad error, critical, alert o emergency. Representa gr\u00e1ficamente los datos relevantes extraidos de los logs o configura el env\u00edo por correo al administrador de los logs relevantes (una opci\u00f3n o ambas)</p> <p>-Logs (centralizaci\u00f3n de logs)</p>"},{"location":"2asir19-20/metrics-logs-monitoring/#fuentes","title":"Fuentes","text":"<p>https://tecadmin.net/install-zabbix-on-debian/ https://tecadmin.net/install-zabbix-agent-on-ubuntu-and-debian/ https://tecadmin.net/add-host-zabbix-server-monitor/</p>"},{"location":"2asir19-20/p3-bd-pi-oracle/","title":"Pr\u00e1ctica 3 BD (PI): Gesti\u00f3n de usuarios, privilegios y roles","text":"<p>En este post no voy a escribir aqu\u00ed la pr\u00e1ctica, ya que la tengo documentada en un repositorio de github; en concreto en el README. Todos los ejercicios est\u00e1n hechos en Oracle 12c, porque me toc\u00f3 hacer esa parte en la responsabilidad individual. El \u00fanico ejercicio que no est\u00e1 hecho es el 24, que era un procedimiento. Pero no pasa nada, me lo apunto en Trello, y alg\u00fan d\u00eda que est\u00e9 aburrido y no tenga nada que hacer, lo har\u00e9 y actualizar\u00e9 github para a\u00f1adir el ejercicio.</p> <p>Bueno, haced click aqu\u00ed para entrar al repositorio</p> <p>\u00a1Nos vemos! :eyes:</p>"},{"location":"2asir19-20/p5-bd-individua-draft/","title":"Pr\u00e1ctica 5 BD: Gesti\u00f3n del almacenamiento (individual)","text":"<p>AQU\u00cd TERMINAR\u00c9 LA PR\u00c1CTICA </p>"},{"location":"2asir19-20/p5-bd-individua-draft/#alumno-3","title":"Alumno 3","text":""},{"location":"2asir19-20/p5-bd-individua-draft/#oracle","title":"Oracle","text":""},{"location":"2asir19-20/p5-bd-individua-draft/#0-creacion-del-tablespace-ts2-hecho-por-el-alumno-2","title":"0. Creaci\u00f3n del tablespace TS2 hecho por el alumno 2","text":"<ul> <li> <p>Creamos el tablespace TS2 <pre><code>create tablespace ts2\n  datafile '/opt/oracle/oradata/orcl/ts2.dbf' size 1m, '/opt/oracle/oradata/ts2.dbf' size 1M\n autoextend off;\n</code></pre> </p> </li> <li> <p>Crear la tabla donde insertaremos registros <pre><code>create table visitantes(\n  nombre char(2000),\n  edad char(2000),\n  sexo char(2000),\n  domicilio char(2000),\n  ciudad char(2000),\n  telefono char(2000)\n)\nTABLESPACE TS2;\n</code></pre></p> </li> <li> <p>Los insertamos</p> </li> </ul> <pre><code>insert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Ana Acosta',25,'f','Avellaneda 123','Cordoba','4223344');\n\ninsert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Betina Bustos',32,'fem','Bulnes 234','Cordoba','4515151');\n\ninsert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Betina Bustos',32,'f','Bulnes 234','Cordoba','4515151');\n\ninsert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Carlos Caseres',43,'m','Colon 345','Cordoba',03514555666);\n</code></pre> <p>He repetido el a\u00f1adido de registros tal y como hizo el alumno 2, hasta que se llen\u00f3 el tablespace por completo (cosa que se requer\u00eda hacer)</p>"},{"location":"2asir19-20/p5-bd-individua-draft/#1-muestra-los-objetos-a-los-que-pertenecen-las-extensiones-del-tablespace-ts2-creado-por-alumno-2-y-el-tamano-de-cada-una-de-ellas","title":"1. Muestra los objetos a los que pertenecen las extensiones del tablespace TS2 (creado por Alumno 2) y el tama\u00f1o de cada una de ellas.","text":"<pre><code>SELECT SEGMENT_NAME,\n       EXTENT_ID,\n       BYTES\n  FROM DBA_EXTENTS\n WHERE TABLESPACE_NAME = 'TS2'\n</code></pre>"},{"location":"2asir19-20/p5-bd-individua-draft/#2-borra-la-tabla-que-esta-llenando-ts2-consiguiendo-que-vuelvan-a-existir-extensiones-libres-anade-despues-otro-fichero-de-datos-a-ts2","title":"2. Borra la tabla que est\u00e1 llenando TS2 consiguiendo que vuelvan a existir extensiones libres. A\u00f1ade despu\u00e9s otro fichero de datos a TS2.","text":"<p>Con <code>truncate table</code> se borra una tabla, y adem\u00e1s se libera el espacio en disco <pre><code>TRUNCATE TABLE &lt;nombre_tabla&gt;;\n</code></pre></p> <p>A\u00f1adir datafile a tablespace <pre><code>ALTER TABLESPACE TS2\n    ADD DATAFILE '/opt/oracle/oradata/orcl/extra.dbf'; \n</code></pre></p>"},{"location":"2asir19-20/p5-bd-individua-draft/#3-crea-el-tablespace-ts3-gestionado-localmente-con-un-tamano-de-extension-uniforme-de-128k-y-un-fichero-de-datos-asociado-cambia-la-ubicacion-del-fichero-de-datos-y-modifica-la-base-de-datos-para-que-pueda-acceder-al-mismo-crea-en-ts3-dos-tablas-e-inserta-registros-en-las-mismas-comprueba-que-segmentos-tiene-ts3-que-extensiones-tiene-cada-uno-de-ellos-y-en-que-ficheros-se-encuentran","title":"3. Crea el tablespace TS3 gestionado localmente con un tama\u00f1o de extensi\u00f3n uniforme de 128K y un fichero de datos asociado. Cambia la ubicaci\u00f3n del fichero de datos y modifica la base de datos para que pueda acceder al mismo. Crea en TS3 dos tablas e inserta registros en las mismas. Comprueba que segmentos tiene TS3, qu\u00e9 extensiones tiene cada uno de ellos y en qu\u00e9 ficheros se encuentran.","text":"<p>Crear tablespace <pre><code>CREATE TABLESPACE TS3 DATAFILE '/opt/oracle/oradata/orcl/ts3.dbf'\n    EXTENT MANAGEMENT LOCAL UNIFORM SIZE 128K;\n</code></pre></p> <p>Mostrar los segmentos de un tablespace <pre><code>SELECT owner, \n       segment_name,\n       partition_name,\n       segment_type,\n       bytes\n  FROM dba_segments\n WHERE tablespace_name = 'TS3'\n</code></pre></p> <p>Mostrar los extents que componen un segmento, junto con el fichero donde se encuentran <pre><code>SELECT EXTENT_ID,\n       FILE_ID\n  FROM DBA_EXTENTS\n WHERE SEGMENT_NAME = 'nombre_del_segmento'\n</code></pre></p>"},{"location":"2asir19-20/p5-bd-individua-draft/#4-redimensiona-los-ficheros-asociados-a-los-tres-tablespaces-que-has-creado-de-forma-que-ocupen-el-minimo-espacio-posible-para-alojar-sus-objetos","title":"4. Redimensiona los ficheros asociados a los tres tablespaces que has creado de forma que ocupen el m\u00ednimo espacio posible para alojar sus objetos.","text":"<p>Para redimensionar un datafile: <pre><code>alter database\ndatafile\n   '&lt;ruta_al_datafile&gt;'\nresize &lt;nuevo_tama\u00f1o&gt;;\n</code></pre></p> <p>Ejemplo: <pre><code>alter database\ndatafile\n   '/opt/oracle/oradata/orcl/ts3.dbf'\nresize 50M;\n</code></pre></p>"},{"location":"2asir19-20/p5-bd-individua-draft/#5-realiza-un-procedimiento-llamado-informerestricciones-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene-a-que-columna-o-columnas-afectan-y-en-que-consisten-exactamente","title":"5. Realiza un procedimiento llamado InformeRestricciones que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qu\u00e9 columna o columnas afectan y en qu\u00e9 consisten exactamente.","text":""},{"location":"2asir19-20/p5-bd-individua-draft/#6-realiza-un-procedimiento-llamado-mostraralmacenamientousuario-que-reciba-el-nombre-de-un-usuario-y-devuelva-el-espacio-que-ocupan-sus-objetos-agrupando-por-dispositivos-y-archivos","title":"6. Realiza un procedimiento llamado MostrarAlmacenamientoUsuario que reciba el nombre de un usuario y devuelva el espacio que ocupan sus objetos agrupando por dispositivos y archivos:","text":"<pre><code>                Usuario: NombreUsuario\n\n                    Dispositivo:xxxx\n\n                        Archivo: xxxxxxx.xxx\n\n                                Tabla1......nnn K\n                                \u2026\n                                TablaN......nnn K\n                                Indice1.....nnn K\n                                \u2026\n                                IndiceN.....nnn K\n\n                        Total Espacio en Archivo xxxxxxx.xxx: nnnnn K\n\n                        Archivo:...\n                        \u2026\n\n                    Total Espacio en Dispositivo xxxx: nnnnnn K\n\n                    Dispositivo: yyyy\n                    \u2026\n\n                Total Espacio Usuario en la BD: nnnnnnn K\n</code></pre>"},{"location":"2asir19-20/p5-bd-individua-draft/#postgresql","title":"PostgreSQL","text":""},{"location":"2asir19-20/p5-bd-individua-draft/#7-averigua-si-es-posible-establecer-cuotas-de-uso-sobre-los-tablespaces-en-postgresql","title":"7. Averigua si es posible establecer cuotas de uso sobre los tablespaces en PostgreSQL.","text":"<p>Con los tablespaces de PostgreSQL, no hay manera de restringir los tama\u00f1os</p> <p>Explicaci\u00f3n de tablespaces PostgreSQL</p> <p>No hay un sistema nativo de quotas en PostgreSQL, pero hay algunas soluciones para esto</p> <p>Soluciones a las quotas en PostgreSQL</p>"},{"location":"2asir19-20/p5-bd-individua-draft/#mysql","title":"MySQL","text":""},{"location":"2asir19-20/p5-bd-individua-draft/#8-averigua-si-existe-el-concepto-de-extension-extent-en-mysql-y-si-coincide-con-el-existente-en-oracle","title":"8. Averigua si existe el concepto de extensi\u00f3n (extent) en MySQL y si coincide con el existente en ORACLE.","text":"<p>(pages y extents son conceptos pr\u00e1cticamente iguales en MySQL y Oracle, lo \u00fanico que se diferencia son los segmentos, que en MySQL son ficheros f\u00edsicos que componen el tablespace. \u00bfEn MySQL cada segmento corresponder\u00e1 s\u00f3lamente a 1 objeto como en Oracle, o podr\u00e1n convivir m\u00e1s objetos dentro del mismo segmento?)</p> <p>S\u00ed, existe el concepto de extent, y b\u00e1sicamente coincide con el concepto de Oracle.</p> <p>La \u00fanica diferencia que podr\u00eda anotar, ser\u00eda m\u00e1s bien de nomenclatura. Con respecto a las pages en Mysql y los data blocks en Oracle, son pr\u00e1cticamente lo mismo, pero con distinto nombre.</p> <p>En Oracle, un extent es un n\u00famero espec\u00edfico de data blocks contiguos, y que se usan para almacenar un tipo espec\u00edfico de informaci\u00f3n </p> <p>En Mysql, un extent es una agrupaci\u00f3n de pages (cada tablespace est\u00e1 compuesto por pages)</p> <p>Los ficheros de un tablespace son llamados segments por InnoDB</p> <p>Con respecto a InnoDB, es un storage engine:</p> <p>A database engine (or storage engine) is the underlying software component that a database management system (DBMS) uses to create, read, update and delete (CRUD) data from a database</p> <p>Explicaci\u00f3n de data Blocks, extents, y segments en Oracle</p> <p>Explicaci\u00f3n sobre el almacenamiento en MySQL</p> <p>Explicaci\u00f3n de las pages en MySQL</p>"},{"location":"2asir19-20/p5-bd-individua-draft/#mongodb","title":"MongoDB","text":""},{"location":"2asir19-20/p5-bd-individua-draft/#9-averigua-si-en-mongodb-puede-saberse-el-espacio-disponible-para-almacenar-nuevos-documentos","title":"9. Averigua si en MongoDB puede saberse el espacio disponible para almacenar nuevos documentos","text":"<p>(hay manera para hacerlo en mongo nativamente, pero no es trivial ni de hacer 1 solo comando)</p> <p>En MongoDB, los datos se almacenan en forma de documentos (ficheros json), que a su vez, se agrupan en colecciones.</p> <p>Se pueden comprobar tama\u00f1o de las colecciones, almacenamiento usado en la base de datos...</p> <p>Ver espacio usado en la base de datos...etc</p>"},{"location":"2asir19-20/p5-bd-individual/","title":"Alumno 3","text":""},{"location":"2asir19-20/p5-bd-individual/#oracle","title":"Oracle","text":""},{"location":"2asir19-20/p5-bd-individual/#0-creacion-del-tablespace-ts2-hecho-por-el-alumno-2","title":"0. Creaci\u00f3n del tablespace TS2 hecho por el alumno 2","text":"<ul> <li> <p>Creamos el tablespace TS2 <pre><code>create tablespace ts2\n  datafile '/opt/oracle/oradata/orcl/ts2.dbf' size 1m, '/opt/oracle/oradata/ts2.dbf' size 1M\n autoextend off;\n</code></pre> </p> </li> <li> <p>Crear la tabla donde insertaremos registros <pre><code>create table visitantes(\n  nombre char(2000),\n  edad char(2000),\n  sexo char(2000),\n  domicilio char(2000),\n  ciudad char(2000),\n  telefono char(2000)\n)\nTABLESPACE TS2;\n</code></pre></p> </li> <li> <p>Los insertamos</p> </li> </ul> <pre><code>insert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Ana Acosta',25,'f','Avellaneda 123','Cordoba','4223344');\n\ninsert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Betina Bustos',32,'fem','Bulnes 234','Cordoba','4515151');\n\ninsert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Betina Bustos',32,'f','Bulnes 234','Cordoba','4515151');\n\ninsert into visitantes (nombre,edad,sexo,domicilio,ciudad,telefono)\n  values ('Carlos Caseres',43,'m','Colon 345','Cordoba',03514555666);\n</code></pre> <p>He repetido el a\u00f1adido de registros tal y como hizo el alumno 2, hasta que se llen\u00f3 el tablespace por completo (cosa que se requer\u00eda hacer)</p>"},{"location":"2asir19-20/p5-bd-individual/#1-muestra-los-objetos-a-los-que-pertenecen-las-extensiones-del-tablespace-ts2-creado-por-alumno-2-y-el-tamano-de-cada-una-de-ellas","title":"1. Muestra los objetos a los que pertenecen las extensiones del tablespace TS2 (creado por Alumno 2) y el tama\u00f1o de cada una de ellas.","text":"<pre><code>SELECT SEGMENT_NAME,\n       EXTENT_ID,\n       BYTES\n  FROM DBA_EXTENTS\n WHERE TABLESPACE_NAME = 'TS2'\n</code></pre>"},{"location":"2asir19-20/p5-bd-individual/#2-borra-la-tabla-que-esta-llenando-ts2-consiguiendo-que-vuelvan-a-existir-extensiones-libres-anade-despues-otro-fichero-de-datos-a-ts2","title":"2. Borra la tabla que est\u00e1 llenando TS2 consiguiendo que vuelvan a existir extensiones libres. A\u00f1ade despu\u00e9s otro fichero de datos a TS2.","text":"<p>Con <code>truncate table</code> se borra una tabla, y adem\u00e1s se libera el espacio en disco <pre><code>TRUNCATE TABLE &lt;nombre_tabla&gt;;\n</code></pre></p> <p>A\u00f1adir datafile a tablespace <pre><code>ALTER TABLESPACE TS2\n    ADD DATAFILE '/opt/oracle/oradata/orcl/extra.dbf'; \n</code></pre></p>"},{"location":"2asir19-20/p5-bd-individual/#3-crea-el-tablespace-ts3-gestionado-localmente-con-un-tamano-de-extension-uniforme-de-128k-y-un-fichero-de-datos-asociado-cambia-la-ubicacion-del-fichero-de-datos-y-modifica-la-base-de-datos-para-que-pueda-acceder-al-mismo-crea-en-ts3-dos-tablas-e-inserta-registros-en-las-mismas-comprueba-que-segmentos-tiene-ts3-que-extensiones-tiene-cada-uno-de-ellos-y-en-que-ficheros-se-encuentran","title":"3. Crea el tablespace TS3 gestionado localmente con un tama\u00f1o de extensi\u00f3n uniforme de 128K y un fichero de datos asociado. Cambia la ubicaci\u00f3n del fichero de datos y modifica la base de datos para que pueda acceder al mismo. Crea en TS3 dos tablas e inserta registros en las mismas. Comprueba que segmentos tiene TS3, qu\u00e9 extensiones tiene cada uno de ellos y en qu\u00e9 ficheros se encuentran.","text":"<p>Crear tablespace <pre><code>CREATE TABLESPACE TS3 DATAFILE '/opt/oracle/oradata/orcl/ts3.dbf'\n    EXTENT MANAGEMENT LOCAL UNIFORM SIZE 128K;\n</code></pre></p> <p>Mostrar los segmentos de un tablespace <pre><code>SELECT owner, \n       segment_name,\n       partition_name,\n       segment_type,\n       bytes\n  FROM dba_segments\n WHERE tablespace_name = 'TS3'\n</code></pre></p> <p>Mostrar los extents que componen un segmento, junto con el fichero donde se encuentran <pre><code>SELECT EXTENT_ID,\n       FILE_ID\n  FROM DBA_EXTENTS\n WHERE SEGMENT_NAME = 'nombre_del_segmento'\n</code></pre></p>"},{"location":"2asir19-20/p5-bd-individual/#4-redimensiona-los-ficheros-asociados-a-los-tres-tablespaces-que-has-creado-de-forma-que-ocupen-el-minimo-espacio-posible-para-alojar-sus-objetos","title":"4. Redimensiona los ficheros asociados a los tres tablespaces que has creado de forma que ocupen el m\u00ednimo espacio posible para alojar sus objetos.","text":"<p>Para redimensionar un datafile: <pre><code>alter database\ndatafile\n   '&lt;ruta_al_datafile&gt;'\nresize &lt;nuevo_tama\u00f1o&gt;;\n</code></pre></p> <p>Ejemplo: <pre><code>alter database\ndatafile\n   '/opt/oracle/oradata/orcl/ts3.dbf'\nresize 50M;\n</code></pre></p>"},{"location":"2asir19-20/p5-bd-individual/#5-realiza-un-procedimiento-llamado-informerestricciones-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene-a-que-columna-o-columnas-afectan-y-en-que-consisten-exactamente","title":"5. Realiza un procedimiento llamado InformeRestricciones que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qu\u00e9 columna o columnas afectan y en qu\u00e9 consisten exactamente.","text":""},{"location":"2asir19-20/p5-bd-individual/#6-realiza-un-procedimiento-llamado-mostraralmacenamientousuario-que-reciba-el-nombre-de-un-usuario-y-devuelva-el-espacio-que-ocupan-sus-objetos-agrupando-por-dispositivos-y-archivos","title":"6. Realiza un procedimiento llamado MostrarAlmacenamientoUsuario que reciba el nombre de un usuario y devuelva el espacio que ocupan sus objetos agrupando por dispositivos y archivos:","text":"<pre><code>                Usuario: NombreUsuario\n\n                    Dispositivo:xxxx\n\n                        Archivo: xxxxxxx.xxx\n\n                                Tabla1......nnn K\n                                \u2026\n                                TablaN......nnn K\n                                Indice1.....nnn K\n                                \u2026\n                                IndiceN.....nnn K\n\n                        Total Espacio en Archivo xxxxxxx.xxx: nnnnn K\n\n                        Archivo:...\n                        \u2026\n\n                    Total Espacio en Dispositivo xxxx: nnnnnn K\n\n                    Dispositivo: yyyy\n                    \u2026\n\n                Total Espacio Usuario en la BD: nnnnnnn K\n</code></pre>"},{"location":"2asir19-20/p5-bd-individual/#postgresql","title":"PostgreSQL","text":""},{"location":"2asir19-20/p5-bd-individual/#7-averigua-si-es-posible-establecer-cuotas-de-uso-sobre-los-tablespaces-en-postgresql","title":"7. Averigua si es posible establecer cuotas de uso sobre los tablespaces en PostgreSQL.","text":"<p>Con los tablespaces de PostgreSQL, no hay manera de restringir los tama\u00f1os</p> <p>Explicaci\u00f3n de tablespaces PostgreSQL</p> <p>No hay un sistema nativo de quotas en PostgreSQL, pero hay algunas soluciones para esto</p> <p>Soluciones a las quotas en PostgreSQL</p>"},{"location":"2asir19-20/p5-bd-individual/#mysql","title":"MySQL","text":""},{"location":"2asir19-20/p5-bd-individual/#8-averigua-si-existe-el-concepto-de-extension-extent-en-mysql-y-si-coincide-con-el-existente-en-oracle","title":"8. Averigua si existe el concepto de extensi\u00f3n (extent) en MySQL y si coincide con el existente en ORACLE.","text":"<p>S\u00ed, existe el concepto de extent, y b\u00e1sicamente coincide con el concepto de Oracle.</p> <p>La \u00fanica diferencia que podr\u00eda anotar, ser\u00eda m\u00e1s bien de nomenclatura. Con respecto a las pages en Mysql y los data blocks en Oracle, son pr\u00e1cticamente lo mismo, pero con distinto nombre.</p> <p>En Oracle, un extent es un n\u00famero espec\u00edfico de data blocks contiguos, y que se usan para almacenar un tipo espec\u00edfico de informaci\u00f3n </p> <p>En Mysql, un extent es una agrupaci\u00f3n de pages (cada tablespace est\u00e1 compuesto por pages)</p> <p>Los ficheros de un tablespace son llamados segments por InnoDB</p> <p>Con respecto a InnoDB, es un storage engine:</p> <p>A database engine (or storage engine) is the underlying software component that a database management system (DBMS) uses to create, read, update and delete (CRUD) data from a database</p> <p>Explicaci\u00f3n de data Blocks, extents, y segments en Oracle</p> <p>Explicaci\u00f3n sobre el almacenamiento en MySQL</p> <p>Explicaci\u00f3n de las pages en MySQL</p>"},{"location":"2asir19-20/p5-bd-individual/#mongodb","title":"MongoDB","text":""},{"location":"2asir19-20/p5-bd-individual/#9-averigua-si-en-mongodb-puede-saberse-el-espacio-disponible-para-almacenar-nuevos-documentos","title":"9. Averigua si en MongoDB puede saberse el espacio disponible para almacenar nuevos documentos","text":"<p>En MongoDB, los datos se almacenan en forma de documentos (ficheros json), que a su vez, se agrupan en colecciones.</p> <p>Se pueden comprobar tama\u00f1o de las colecciones, almacenamiento usado en la base de datos...</p> <p>Ver espacio usado en la base de datos...etc</p>"},{"location":"2asir19-20/proxy-practica/","title":"Parte 1: Proxy","text":""},{"location":"2asir19-20/proxy-practica/#tarea-1-instala-squid-en-la-maquina-proxy-y-configuralo-para-que-permita-conexiones-desde-la-red-donde-este-tu-ordenador","title":"Tarea 1: Instala squid en la m\u00e1quina <code>proxy</code> y config\u00faralo para que permita conexiones desde la red donde est\u00e9 tu ordenador","text":"<pre><code>sudo apt update\nsudo apt install squid\n</code></pre> <p>Para permitir las conexiones desde la red del PC (la host-only que hay creada para la comunicaci\u00f3n en espec\u00edfico)</p> <p>acl mynetwork src 192.168.200.0/255.255.255.0 http_access allow mynetwork http_access deny all</p>"},{"location":"2asir19-20/proxy-practica/#parte-2-balanceador-de-carga","title":"Parte 2: Balanceador de carga","text":""},{"location":"2asir19-20/proxy-practica/#parte-3-proxy-inverso","title":"Parte 3: Proxy inverso","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/","title":"1. Ejecuci\u00f3n de scripts PHP","text":"<p>Las configuraciones que vamos a realizar son las siguientes:</p> <ul> <li>mod_php + apache2</li> <li>PHP-FPM (socket unix) + apache2</li> <li>PHP-FPM (socket TCP) + apache2</li> <li>PHP-FPM (socket unix) + nginx</li> <li>PHP-FPM (socket TCP) + nginx</li> </ul> <p>Sobre cada una de de ellas, tendremos que hacer una serie de acciones</p>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#combinacion-1-mod_php-apache2","title":"Combinaci\u00f3n 1: mod_php + apache2","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#realiza-la-configuracion-indicada-y-muestra-una-comprobacion-con-phpinfo-donde-se-vea-la-configuracion-actual","title":"Realiza la configuraci\u00f3n indicada y muestra una comprobaci\u00f3n (con phpinfo) donde se vea la configuraci\u00f3n actual","text":"<ul> <li> <p>Instalamos el m\u00f3dulo <pre><code>sudo apt install libapache2-mod-php\n</code></pre></p> </li> <li> <p>Reiniciamos apache <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> </li> <li> <p>Comprobamos que el m\u00f3dulo est\u00e9 cargado y funcionando <pre><code>sudo apache2ctl -M | grep php\n</code></pre> Aqu\u00ed aparece el m\u00f3dulo <pre><code>php7_module (shared)\n</code></pre></p> </li> <li> <p>He aprovechado el document root del virtualhost por defecto, para crear ah\u00ed un <code>info.php</code> de prueba <pre><code>/var/www\n\u2514\u2500\u2500 /var/www/html\n    \u251c\u2500\u2500 /var/www/html/index.html\n    \u2514\u2500\u2500 /var/www/html/info.php\n</code></pre></p> </li> <li> <p>Muestro que el contenido de info.php se carga correctamente </p> </li> </ul>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#explica-brevemente-la-modificacion-en-los-ficheros-de-configuracion-para-la-opcion-actual","title":"Explica brevemente la modificaci\u00f3n en los ficheros de configuraci\u00f3n para la opci\u00f3n actual","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#mostrar-el-funcionamiento-con-esta-configuracion-de-wordpress","title":"Mostrar el funcionamiento con esta configuraci\u00f3n de WordPress","text":"<ul> <li> <p>Podemos descargarnos WordPress aqu\u00ed. Cuando descomprimamos el paquete, podremos el document root que existe por defecto, y renombrar el directorio resultante de Wordpress a <code>/var/www/html</code>. As\u00ed estaremos aprovechando el virtualhost que hay por defecto, y podremos iniciar Wordpress sin m\u00e1s cambios</p> </li> <li> <p>Nos faltar\u00eda tener una base de datos <pre><code>sudo apt install mariadb-server\n</code></pre></p> </li> <li> <p>Nos logeamos como root en mariadb <pre><code>sudo mariadb\n</code></pre></p> </li> <li> <p>Creamos la base de datos para este Wordpress espec\u00edfico <pre><code>CREATE DATABASE wordpress_rend DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;\n</code></pre></p> </li> <li> <p>Con lo siguiente se crear\u00e1 directamente el usuario con el que accederemos a la base de datos, y adem\u00e1s se le conceder\u00e1n todos los privilegios sobre \u00e9sta <pre><code>GRANT ALL ON wordpress_rend.* TO 'wordpress_rend_user'@'localhost' IDENTIFIED BY '1234';\n</code></pre></p> </li> <li> <p>Aplicamos los permisos <pre><code>FLUSH PRIVILEGES;\n</code></pre></p> </li> <li> <p>Nos salimos de mariadb, e instalamos los siguientes paquetes php que necesitaremos (ya sea porque son requeridos por Wordpress, o porque permiten la conexi\u00f3n de php con mariadb) <pre><code>sudo apt install php-curl php-gd php-mbstring php-xml php-xmlrpc php-soap php-intl php-zip php-mysql\n</code></pre></p> </li> <li> <p>Reiniciamos apache para que se apliquen los cambios <pre><code>sudo systemctl restart apache2\n</code></pre></p> </li> <li> <p>Una vez hecho todo esto, Wordpress ya cargar\u00e1 correctamente, y s\u00f3lo tendremos que ir siguiendo los pasos para completar la instalaci\u00f3n.</p> <p>Usuario administrador: rootadri Contrase\u00f1a: 1234</p> </li> <li> <p>Muestro que WordPress funciona con \u00e9sta combinaci\u00f3n de mod_php + apache2 </p> </li> </ul>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#modifica-la-configuracion-de-php-para-aumentar-el-tamano-de-los-ficheros-que-podemos-subir","title":"Modifica la configuraci\u00f3n de PHP para aumentar el tama\u00f1o de los ficheros que podemos subir","text":"<p>Para empezar, es vital saber que los par\u00e1metros de configuraci\u00f3n php que est\u00e1n afectando a nuestro Wordpress actualmente, se encuentran en <code>/etc/php/7.3/apache2/php.ini</code>. \u00bfPor qu\u00e9? Pues porque al estar funcionando con mod_php, es Apache quien realmente est\u00e1 ejecutando el c\u00f3digo php.</p> <p>Con respecto a c\u00f3mo php maneja los tama\u00f1os de las subidas de ficheros...etc, existen 3 par\u00e1metros \u00edntimamente relacionados que influyen en este funcionamiento: * upload_max_filesize (tama\u00f1o m\u00e1ximo permitido para la subida de ficheros) * post_max_size (tama\u00f1o m\u00e1ximo de datos POST que php va a aceptar) * memory_limit (cantidad m\u00e1xima de memoria que un script va a poder consumir)</p> <p>Algo que se recomienda sobre estos 3 par\u00e1metros, es que sus valores se encuentren ajustados de forma escalonada. Para entender esto mejor, mostrar\u00e9 mis valores en <code>/etc/php/7.3/apache2/php.ini</code> por defecto: <pre><code>upload_max_filesize = 2M\npost_max_size = 8M\nmemory_limit = 128M\n</code></pre> Ahora mismo, s\u00f3lo podr\u00edamos subir ficheros de como m\u00e1ximo 2MB, como efectivamente muestro aqu\u00ed abajo:  </p> <p>Aunque ahora mismo nos podr\u00edamos preguntar...\u00bfpor qu\u00e9 existe una diferencia entre <code>upload_max_filesize</code> y <code>post_max_size</code>? Pues porque siempre existe la posibilidad de que en una subida de un fichero, no s\u00f3lo se encuentren los datos del propio fichero en el body de la petici\u00f3n POST, sino que puede haber algo m\u00e1s de informaci\u00f3n adicional en texto. Es por \u00e9sta raz\u00f3n que siempre se deja este margen de seguridad, para tener en cuenta el tama\u00f1o m\u00e1ximo del fichero a poder subir + lo que pueda haber.</p> <p>Dicho todo esto, pasar\u00e9 a modificar los valores de los que he estado hablando. De los 3 que hay, simplemente necesito modificar 2 de ellos. Mi configuraci\u00f3n se quedar\u00eda de la siguiente manera: <pre><code>upload_max_filesize = 10M\npost_max_size = 20M\n</code></pre></p> <p>Para aplicar los cambios, tendremos que reiniciar Apache <pre><code>sudo systemctl restart apache2.service\n</code></pre> Hacemos esto porque, como es Apache quien ejecuta el c\u00f3digo php con su propio m\u00f3dulo, con una configuraci\u00f3n espec\u00edfica de php para \u00e9l, tendremos que reiniciarlo, para que vuelva a leer la configuraci\u00f3n que hemos modificado.</p> <p>Ahora s\u00ed, el tama\u00f1o m\u00e1ximo de archivo que podremos subir es de 10MB, tal y como hemos configurado </p>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#realiza-varias-pruebas-al-menos-5-de-rendimiento-sobre-la-configuracion-actual-y-quedate-con-una-media-de-las-peticiones-respondidas-por-segundo-vamos-a-realizar-pruebas-con-200-peticiones-concurrentes-nota-recuerda-reinciar-el-servidor-web-entre-prueba-y-prueba-despues-de-cada-test-de-ab-para-que-se-reinicien-el-numero-de-procesos-de-apache-manejando-peticiones","title":"Realiza varias pruebas (al menos 5) de rendimiento sobre la configuraci\u00f3n actual y qued\u00e1te con una media de las peticiones respondidas por segundo. Vamos a realizar pruebas con 200 peticiones concurrentes. Nota: Recuerda reinciar el servidor web entre prueba y prueba (despu\u00e9s de cada test de ab, para que se reinicien el n\u00famero de procesos de apache manejando peticiones)","text":"<p>Comando que vamos a realizar para las pruebas <pre><code>ab -t 10 -c 200 -k http://www.wordpress-rend-adri.com/index.php\n</code></pre></p> <p>Como habr\u00e1s podido notar, he cambiado la direcci\u00f3n de acceso a <code>www.wordpress-rend-adri.com</code>, en vez de estar accediendo por la 192.168.1.116. He tenido que hacer este cambio porque realic\u00e9 la instalaci\u00f3n de Wordpress accediendo desde la IP dicha, y entonces todas las URL se guardaron en la base de datos siguiendo ese patr\u00f3n de IP. Por este motivo, al intentar acceder a cualquier enlace estando en clase, no funciona, porque se intentan las conexiones con una IP que no existe en esa red. Por lo tanto encontr\u00e9 el siguiente comando (utilidad que nos aporta la herramienta wp-cli), con el que se reemplazar\u00e1n en la base de datos todas las URLs que tuvieran la IP <code>192.168.1.116</code>, por el nombre <code>www.wordpress-rend-adri.com</code>. <pre><code>sudo wp search-replace http://192.168.1.116 http://www.wordpress-rend-adri.com\n</code></pre> De esta manera estar\u00edamos arreglando el problema de acceso en el instituto a Wordpress, porque al acceder por nombre, ya s\u00f3lo tendr\u00edamos que cambiar la IP en nuestro <code>/etc/hosts</code> cuando cambi\u00e1semos de red para que la conexi\u00f3n funcionase. Tras ejecutar el comando anterior, al recargar la p\u00e1gina en firefox limpiando la cach\u00e9 (ctrl+shift+r), las URLs en nuestro CMS habr\u00e1n cambiado, y ya podremos navegar por \u00e9l sin problemas</p> <ul> <li> <p>Prueba 1 <pre><code>Requests per second:    51.19 [#/sec] (mean)\n</code></pre></p> </li> <li> <p>Prueba 2 <pre><code>Requests per second:    242.43 [#/sec] (mean)\n</code></pre></p> </li> <li> <p>Prueba 3 <pre><code>Requests per second:    48.49 [#/sec] (mean)\n</code></pre></p> </li> <li> <p>Prueba 4 <pre><code>Requests per second:    244.52 [#/sec] (mean)\n</code></pre></p> </li> <li> <p>Prueba 5 <pre><code>Requests per second:    47.34 [#/sec] (mean)\n</code></pre></p> </li> <li> <p>Media de peticiones respondidas por segundo: 126.794</p> </li> </ul>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#combinacion-2-php-fpm-socket-unix-apache2","title":"Combinaci\u00f3n 2: PHP-FPM (socket unix) + apache2","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#realiza-la-configuracion-indicada-y-muestra-una-comprobacion-con-phpinfo-donde-se-vea-la-configuracion-actual_1","title":"Realiza la configuraci\u00f3n indicada y muestra una comprobaci\u00f3n (con phpinfo) donde se vea la configuraci\u00f3n actual","text":"<ul> <li>Lo primero que tenemos que hacer es cambiar el modo mpm en el que est\u00e1 funcionando apache a event. Para ello, es obligatorio que deshabilitemos PRIMERO mod_php.</li> </ul> <p>\u00bfPor qu\u00e9? Porque al tenerlo funcionando por la configuraci\u00f3n anterior que hicimos, y al depender del m\u00f3dulo prefork, es necesario que lo deshabilitemos primero antes de cambiar el m\u00f3dulo prefork por event.</p> <pre><code>sudo a2dismod php7.3\n</code></pre> <ul> <li> <p>Despu\u00e9s de haber hecho esto, podemos deshabilitar prefork, y activar event <pre><code>sudo a2dismod mpm_prefork\n</code></pre> <pre><code>sudo a2enmod mpm_event\n</code></pre></p> </li> <li> <p>Reiniciamos apache para que se apliquen los cambios <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> </li> <li> <p>Comprobamos que tenemos event cargado correctamente <pre><code>sudo apache2ctl -V\n</code></pre> Voy a mostrar S\u00d3LO la informaci\u00f3n relevante de la salida de \u00e9ste comando <pre><code>Server MPM:     event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\n</code></pre></p> </li> <li> <p>Una vez hecho todo esto, si intentamos navegar de nuevo por Wordpress, directamente no cargar\u00e1 nada. Esto sucede porque antes hemos deshabilitado mod_php, y por lo tanto ya no hay nada que se encargue de manejar el c\u00f3digo php. En \u00e9ste punto, es cuando tenemos que instalar php-fpm: <pre><code>sudo apt install php-fpm\n</code></pre></p> </li> <li> <p>Lo siguiente que tendr\u00edamos que configurar, es su funcionamiento mediante socket unix. Por suerte por defecto, ya viene configurado de \u00e9sta manera. El fichero <code>/etc/php/7.3/fpm/pool.d/www.conf</code>, se utiliza para configurar php-fpm, y dentro de ese fichero, viene una l\u00ednea muy importante: <pre><code>listen = /run/php/php7.3-fpm.sock\n</code></pre> Esta l\u00ednea est\u00e1 indicando la direcci\u00f3n donde php-fpm est\u00e1 aceptando peticiones. En este caso, como estamos usando socket, viene indicada la direcci\u00f3n a \u00e9ste.</p> </li> <li> <p>Habilitamos unos m\u00f3dulos necesarios en apache, y reiniciamos <pre><code>sudo a2enmod proxy proxy_fcgi\n</code></pre> <pre><code>sudo systemctl restart apache2.service\n</code></pre> Estos m\u00f3dulos son necesarios porque apache tiene que ser capaz de redirigir las peticiones a ficheros php, a php-fpm para que las procese, y le devuelva un resultado.</p> </li> <li> <p>Despu\u00e9s de todo \u00e9sto, lo \u00fanico que tendremos que hacer es a\u00f1adir el siguiente bloque de configuraci\u00f3n a nuestro virtualhost por defecto que estamos usando <pre><code>    &lt;FilesMatch \\.php$&gt;\n        # 2.4.10+ can proxy to unix socket\n        SetHandler \"proxy:unix:/run/php/php7.3-fpm.sock|fcgi://localhost/\"\n\n        # Else we can just use a tcp socket:\n        # SetHandler \"proxy:fcgi://127.0.0.1:9000\"\n    &lt;/FilesMatch&gt;\n</code></pre> Con \u00e9sta configuraci\u00f3n simplemente lo que estamos diciendo es que, cuando se est\u00e9n haciendo peticiones sobre ficheros que terminen en \".php\", se manden mediante el socket en el que est\u00e1 escuchando php-fpm. Por lo tanto al final, php-fpm ser\u00e1 capaz de procesar esas peticiones, ejecutando todo el c\u00f3digo php que necesite ejecutar, y devolver\u00e1 los resultados a apache. </p> </li> </ul> <p>Al final, para que todo termine de funcionar, tenemos que reiniciar apache una \u00faltima vez <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> <ul> <li>Para terminar, mostrar\u00e9 la p\u00e1gina de phpinfo</li> </ul> <p></p>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#explica-brevemente-la-modificacion-en-los-ficheros-de-configuracion-para-la-opcion-actual_1","title":"Explica brevemente la modificaci\u00f3n en los ficheros de configuraci\u00f3n para la opci\u00f3n actual","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#mostrar-el-funcionamiento-con-esta-configuracion-de-wordpress_1","title":"Mostrar el funcionamiento con esta configuraci\u00f3n de WordPress","text":"<p>No he tenido que hacer ning\u00fan cambio para que Wordpress funcionase de nuevo. Conque se active php-fpm, es suficiente, porque lo \u00fanico que suced\u00eda es que no hab\u00eda nada que pudiera procesar las peticiones php</p>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#modifica-la-configuracion-de-php-para-aumentar-el-tamano-de-los-ficheros-que-podemos-subir_1","title":"Modifica la configuraci\u00f3n de PHP para aumentar el tama\u00f1o de los ficheros que podemos subir","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#realiza-varias-pruebas-al-menos-5-de-rendimiento-sobre-la-configuracion-actual-y-quedate-con-una-media-de-las-peticiones-respondidas-por-segundo-vamos-a-realizar-pruebas-con-200-peticiones-concurrentes-nota-recuerda-reinciar-el-servidor-web-entre-prueba-y-prueba-despues-de-cada-test-de-ab-para-que-se-reinicien-el-numero-de-procesos-de-apache-manejando-peticiones_1","title":"Realiza varias pruebas (al menos 5) de rendimiento sobre la configuraci\u00f3n actual y qued\u00e1te con una media de las peticiones respondidas por segundo. Vamos a realizar pruebas con 200 peticiones concurrentes. Nota: Recuerda reinciar el servidor web entre prueba y prueba (despu\u00e9s de cada test de ab, para que se reinicien el n\u00famero de procesos de apache manejando peticiones)","text":"<p>Comando que vamos a realizar para las pruebas <pre><code>ab -t 10 -c 200 -k http://www.wordpress-rend-adri.com/index.php\n</code></pre></p>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#combinacion-3-php-fpm-socket-tcp-apache2","title":"Combinaci\u00f3n 3: PHP-FPM (socket TCP) + apache2","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#combinacion-4-php-fpm-socket-unix-nginx","title":"Combinaci\u00f3n 4: PHP-FPM (socket unix) + nginx","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#combinacion-5-php-fpm-socket-tcp-nginx","title":"Combinaci\u00f3n 5: PHP-FPM (socket TCP) + nginx","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#que-combinacion-ha-respondido-mas-peticiones-por-segundo-segun-vuestras-pruebas","title":"\u00bfQu\u00e9 combinaci\u00f3n ha respondido m\u00e1s peticiones por segundo seg\u00fan vuestras pruebas?","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#2-aumento-de-rendimiento-en-la-ejecucion-de-scripts-php","title":"2. Aumento de rendimiento en la ejecuci\u00f3n de scripts PHP","text":""},{"location":"2asir19-20/rendimiento-ejec-php-python/#3-ejecucion-de-scripts-python","title":"3. Ejecuci\u00f3n de scripts Python","text":"<p>Instalar django-cms en lugar de mezzanine</p>"},{"location":"2asir19-20/rendimiento-ejec-php-python/#fountain-fuentes-fountain","title":":fountain: Fuentes :fountain:","text":"<p>https://kinsta.com/blog/wordpress-maximum-upload-file-size/# https://www.cyberciti.biz/tips/howto-performance-benchmarks-a-web-server.html https://serversforhackers.com/c/apache-and-php-fpm</p>"},{"location":"2asir19-20/t4-formas-juridicas/","title":"Tipos de empresa","text":""},{"location":"2asir19-20/t4-formas-juridicas/#sociedad-de-responsabilidad-limitada","title":"Sociedad de responsabilidad limitada","text":"<p>Es una sociedad mercantil en la cual la responsabilidad est\u00e1 limitada al capital aportado, y por lo tanto en el caso de que contraigan deudas, no se responde con el patrimonio personal de los socios, sino con el aportado en dicha empresa</p>"},{"location":"2asir19-20/t4-formas-juridicas/#sociedad-de-responsabilidad-limitada-nueva-empresa","title":"Sociedad de responsabilidad limitada nueva empresa","text":"<p>Esta es una especialidad de la sociedad de responsabilidad limitada, y est\u00e1 pensada para peque\u00f1os proyectos empresariales </p>"},{"location":"2asir19-20/t4-formas-juridicas/#sociedad-anonima","title":"Sociedad an\u00f3nima","text":"<p>Es una sociedad mercantil en la cual el capital est\u00e1 dividido seg\u00fan las aportaciones de cada socio</p>"},{"location":"2asir19-20/t4-formas-juridicas/#sociedad-laboral","title":"Sociedad laboral","text":"<p>Es una empresa en la que la mayor\u00eda del capital es propiedad de sus trabajadores</p>"},{"location":"2asir19-20/t4-formas-juridicas/#cooperativas-de-trabajo-asociado","title":"Cooperativas de trabajo asociado","text":"<p>Los miembros de estas cooperativas, son socios y al mismo tiempo, trabajadores</p>"},{"location":"2asir19-20/t4-formas-juridicas/#comunidad-de-bienes","title":"Comunidad de bienes","text":"<p>Es una asociaci\u00f3n entre 2 o m\u00e1s aut\u00f3nomos, que tienen una cosa o un derecho en com\u00fan, y por la que obtienen un beneficio</p>"},{"location":"2asir19-20/t7-cloud-hosting/","title":"Paso 0: preparativos","text":""},{"location":"2asir19-20/t7-cloud-hosting/#instalarconfigurar-proftpd","title":"Instalar/configurar proftpd","text":"<ul> <li>A\u00f1adir el repositorio EPEL No lo hago, porque ya lo tengo</li> <li>Actualizamos los paquetes (por buenas pr\u00e1cticas) <pre><code>sudo yum update\n</code></pre></li> <li>Instalamos el servidor FTP <pre><code>sudo yum install proftpd\n</code></pre></li> <li>A\u00f1adimos las reglas de firewall para permitir la comunicaci\u00f3n FTP <pre><code>sudo firewall-cmd --permanent --add-port=21/tcp\n</code></pre></li> <li>Reiniciamos el servicio firewalld <pre><code>sudo firewall-cmd --reload\n</code></pre></li> <li>Por \u00faltimo, no nos podemos olvidar de abrir el puerto 21 en el firewall de Openstack (esto no lo he hecho a\u00fan)</li> </ul>"},{"location":"2asir19-20/t7-cloud-hosting/#paso-1-creacion-del-usuario","title":"Paso 1: Creaci\u00f3n del usuario","text":""},{"location":"2asir19-20/t7-cloud-hosting/#paso-2-virtualhost-document-root-default-root","title":"Paso 2: VirtualHost + Document Root + Default Root","text":""},{"location":"2asir19-20/t7-cloud-hosting/#paso-3-crear-cname-para-vh","title":"Paso 3: Crear CNAME para VH","text":""},{"location":"2asir19-20/t7-cloud-hosting/#paso-4-crear-usuario-bd-y-la-bd","title":"Paso 4: Crear usuario BD y la BD","text":""},{"location":"2asir19-20/t8-cloud-app-python.md/","title":"Paso 1: instalaci\u00f3n en desarrollo con entorno virtual","text":""},{"location":"2asir19-20/t8-cloud-app-python.md/#instalar-pythonetc","title":"Instalar python...etc","text":"<p>Instalamos todos los paquetes necesarios <pre><code>sudo apt install python3 python3-venv python3-virtualenv virtualenv\n</code></pre></p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#creamos-el-entorno-virtual","title":"Creamos el entorno virtual","text":"<pre><code>python3 -m venv mezzanine-pyenv\n</code></pre>"},{"location":"2asir19-20/t8-cloud-app-python.md/#lo-activamos","title":"Lo activamos","text":"<pre><code>source mezzanine-pyenv/bin/activate\n</code></pre>"},{"location":"2asir19-20/t8-cloud-app-python.md/#instalando-mezzanine","title":"Instalando Mezzanine","text":"<pre><code>pip install mezzanine\n</code></pre>"},{"location":"2asir19-20/t8-cloud-app-python.md/#creamos-el-proyecto","title":"Creamos el proyecto","text":"<p><pre><code>mezzanine-project my_mezzanine\n</code></pre> Nos movemos dentro de ese directorio <pre><code>cd my_mezzanine\n</code></pre></p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#creamos-la-base-de-datos","title":"Creamos la base de datos","text":"<pre><code>python manage.py createdb\n</code></pre> <p>Durante la creaci\u00f3n nos pide un usuario y contrase\u00f1a. En mi caso, ha sido \"Usuario: vagrant\" \"Contrase\u00f1a: 1234\". Pero, \u00bfqu\u00e9 es esta cuenta que hemos configurado? Pues es simplemente la cuenta que se usa a la hora de acceder a la zona de administraci\u00f3n de la p\u00e1gina web.  Es importante que no confundamos esta cuenta como si fuese la cuenta que estuvi\u00e9ramos creando para autenticarnos contra la base de datos, porque sqlite no tiene el concepto de usuarios y contrase\u00f1as para el acceso (usa los permisos del sistema) </p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#permitimos-la-conexion-a-la-app-web","title":"Permitimos la conexi\u00f3n a la app web","text":"<p>En el fichero <code>local_settings.py</code>, tenemos que modificar la siguiente l\u00ednea <pre><code>ALLOWED_HOSTS = [\"localhost\", \"127.0.0.1\", \"::1\"]\n</code></pre> Para quede de la siguiente manera <pre><code>ALLOWED_HOSTS = [\"localhost\", \"127.0.0.1\", \"::1\", \"172.22.0.245\"]\n</code></pre> Lo que estamos haciendo con esto, es permitir el acceso a la aplicaci\u00f3n python, a la m\u00e1quina donde nos queremos conectar (en mi caso es una m\u00e1quina virtual vagrant)</p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#ejecutamos-el-servidor-web","title":"Ejecutamos el servidor web","text":"<pre><code>python manage.py runserver 0.0.0.0:8000\n</code></pre> <p>En mi caso lo abro permitiendo las conexiones desde cualquier IP, porque mi entorno de desarrollo es una VM vagrant</p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#mostramos-la-web","title":"Mostramos la web","text":""},{"location":"2asir19-20/t8-cloud-app-python.md/#accediendo-a-la-parte-de-administracion","title":"Accediendo a la parte de administraci\u00f3n","text":"<p>Para ello, tendremos que acceder a una URL parecida a la siguiente (digo parecida, porque simplemente lo que cambiar\u00eda ser\u00eda la IP) <pre><code>http://192.168.1.104:8000/admin/\n</code></pre> Una vez dentro, la parte de administraci\u00f3n ser\u00eda tal que as\u00ed </p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#paso-2-personalizacion-de-la-web","title":"Paso 2: personalizaci\u00f3n de la web","text":""},{"location":"2asir19-20/t8-cloud-app-python.md/#cambiar-nombre-de-la-pagina","title":"Cambiar nombre de la p\u00e1gina","text":"<p>Dentro de la zona de administraci\u00f3n, tendremos que irnos a \"Site -&gt; Settings -&gt; Site -&gt; Site Title\". Una vez aqu\u00ed, podremos cambiar el nombre de la web al que queramos:  Cuando guardemos, y volvamos a la web principal, veremos que el nombre de la web se cambi\u00f3 correctamente </p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#anadir-post-con-imagen","title":"A\u00f1adir post con imagen","text":"<ul> <li>Dentro de la zona de administraci\u00f3n, tendremos que irnos a \"Content -&gt; Blog posts -&gt; Add blog post\". Una vez aqu\u00ed, simplemente rellenaremos los campos necesarios, y crearemos el post.</li> <li>Cuando lo tengamos creado, nos aparecer\u00e1 el nuevo post en la lista general de posts * Para ver el post directamente en la web principal, la manera m\u00e1s sencilla y r\u00e1pida ser\u00eda hacer click en \"View on site\". Nuestro post ya terminado, quedar\u00eda tal que as\u00ed: </li> </ul>"},{"location":"2asir19-20/t8-cloud-app-python.md/#paso-3-volcado-de-tablas-y-datos","title":"Paso 3: volcado de tablas y datos","text":"<p>Para ello, tendremos que ejecutar lo siguiente en el directorio donde tengamos la app web, y crearemos el fichero json con todos los datos que ten\u00eda la base de datos original SQLite <pre><code>python manage.py dumpdata &gt; db_mezzanine_bak.json\n</code></pre> Luego de hacer esto, se nos quedar\u00eda el siguiente fichero json con los datos <pre><code>-rw-r--r-- 1 vagrant vagrant  20750 Dec 17 09:29 db_mezzanine_bak.json\n</code></pre></p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#paso-4-guardado-en-github","title":"Paso 4: guardado en Github","text":"<p>Por aqu\u00ed dejo el enlace al repositorio donde est\u00e1n: * Mi aplicaci\u00f3n web Mezzanine creada * La copia de seguridad de su base de datos (fichero json con el volcado que hicimos antes)</p> <p>He comentado el directorio <code>/static</code> en el fichero .gitignore de desarrollo, porque en ese directorio est\u00e1 guardada la imagen + thumbnails del post que cre\u00e9 en la web. Por lo tanto, es necesario que este directorio est\u00e9 presente en producci\u00f3n</p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#paso-5-despliegue-en-produccion","title":"Paso 5: despliegue en producci\u00f3n","text":"<p>Realiza el despliegue de la aplicaci\u00f3n en tu entorno de producci\u00f3n (servidor web y servidor de base de datos en el cloud). Utiliza un entorno virtual. </p> <p>Como servidor de aplicaci\u00f3n puedes usar gunicorn (crea una unidad systemd para gestionar este servicio)</p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#instalando-los-paquetes-que-necesitaremos","title":"Instalando los paquetes que necesitaremos","text":"<pre><code>sudo yum install python3 mariadb-devel.x86_64 gcc python3-devel\n</code></pre>"},{"location":"2asir19-20/t8-cloud-app-python.md/#creamos-el-entorno-virtual-en-home","title":"Creamos el entorno virtual (en home)","text":"<pre><code>python3 -m venv mezzanine-pyenv-prod\n</code></pre>"},{"location":"2asir19-20/t8-cloud-app-python.md/#lo-activamos_1","title":"Lo activamos","text":"<pre><code>source mezzanine-pyenv-prod/bin/activate\n</code></pre>"},{"location":"2asir19-20/t8-cloud-app-python.md/#instalando-en-el-entorno-virtual","title":"Instalando en el entorno virtual","text":"<pre><code>pip install mezzanine gunicorn mysqlclient\n</code></pre> <p>Despu\u00e9s de hacer esto, en mi caso se me recomienda actualizar la versi\u00f3n de pip, ya que era muy antigua. Lo actualizo de la siguiente manera: <pre><code>pip install --upgrade pip\n</code></pre></p> <p>Despu\u00e9s de instalar todo esto, podemos desactivar el entorno virtual <pre><code>deactivate\n</code></pre></p>"},{"location":"2asir19-20/t8-cloud-app-python.md/#descarga-de-mezzanine-desde-repositorio","title":"Descarga de Mezzanine desde repositorio","text":"<p>Una vez que ya tenemos lo necesario instalado en el entorno virtual, podremos pasar a descargarnos la app web de mezzanine que hab\u00edamos subido previamente a github.</p> <ul> <li>Nos movemos al directorio padre de donde queramos que est\u00e9 localizado el document root de nuestra app web <pre><code>cd /var/www/\n</code></pre></li> <li> <p>Una vez aqu\u00ed, clonamos el repositorio <pre><code>sudo git clone https://github.com/adriasir123/app_mezzanine.git\n</code></pre></p> <p>En producci\u00f3n hacemos un clonado por https, ya que la idea es que en este repositorio en producci\u00f3n, simplemente hagamos pulls puntualmente. As\u00ed que nos interesa que git se configure por https en este caso en espec\u00edfico</p> </li> <li> <p>Por \u00faltimo en mi caso, quiero cambiar el nombre del document root, ya que cuando clonamos el repositorio, el directorio resultante lleva el nombre que ten\u00eda el repositorio <pre><code>sudo mv app_mezzanine/ mezzanine\n</code></pre></p> </li> </ul>"},{"location":"2asir19-20/t8-cloud-app-python.md/#creacion-de-la-base-de-datos-para-mezzanine-en-tortilla","title":"Creaci\u00f3n de la base de datos para Mezzanine en tortilla","text":"<ul> <li>Nos logeamos como root <pre><code>sudo mysql -u root -p\n</code></pre></li> <li>Creamos la base de datos <pre><code>CREATE DATABASE mezzanine CHARACTER SET utf8 COLLATE utf8_general_ci;\n</code></pre></li> <li>Aplicamos todos los privilegios sobre todas las tablas que habr\u00e1n en la base de datos para mezzanine al usuario mezzanineuser, tanto si accede a la base de datos desde localhost, como si accede desde remoto (cualquier IP de origen) <pre><code>GRANT ALL ON mezzanine.* TO 'mezzanineuser'@'localhost' IDENTIFIED BY '1234';\n</code></pre> <pre><code>GRANT ALL ON mezzanine.* TO 'mezzanineuser'@'%' IDENTIFIED BY '1234';\n</code></pre></li> <li>Hacemos que se apliquen los privilegios <pre><code>FLUSH PRIVILEGES;\n</code></pre></li> </ul>"},{"location":"2asir19-20/t8-cloud-app-python.md/#carga-de-datos-en-tortilla","title":"Carga de datos en tortilla","text":"<ul> <li>Lo primero ser\u00e1 modificar en salmorejo el fichero <code>settings.py</code> de nuestro Mezzanine en producci\u00f3n, para que contenga los datos correctos de conexi\u00f3n a la base de datos que acabamos de crear en tortilla</li> </ul> <pre><code>#############\n# DATABASES #\n#############\n\nDATABASES = {\n    \"default\": {\n        # Add \"postgresql_psycopg2\", \"mysql\", \"sqlite3\" or \"oracle\".\n        \"ENGINE\": \"django.db.backends.mysql\",\n        # DB name or path to database file if using sqlite3.\n        \"NAME\": \"mezzanine\",\n        # Not used with sqlite3.\n        \"USER\": \"mezzanineuser\",\n        # Not used with sqlite3.\n        \"PASSWORD\": \"1234\",\n        # Set to empty string for localhost. Not used with sqlite3.\n        \"HOST\": \"10.0.0.14\",\n        # Set to empty string for default. Not used with sqlite3.\n        \"PORT\": \"3306\",\n    }\n}\n</code></pre> <p>Hacemos esto porque cuando vayamos a cargar los datos desde el fichero json, mirar\u00e1 en ese fichero para saber en qu\u00e9 base de datos tiene que cargar los datos</p> <ul> <li>Lo siguiente que tenemos que modificar en el <code>settings.py</code>, es el siguiente contenido sobre las keys </li> </ul> <pre><code>#####################################\n# KEYS ADDED FROM local_settings.py #\n#####################################\n\nSECRET_KEY = \"oroll-r@3k)+ise#rhol*fa(z%(df9#52if_033vzys5*o_(80\"\nNEVERCACHE_KEY = \"r9e-9_pro-iqwb4s)8ge4n$sq*$7b6bn=zy5=_v()*i(_q0d1#\"\n</code></pre> <p>Estas claves las hemos copiado del fichero <code>local_settings.py</code> que tenemos en la app en desarrollo. Los usos de la SECRET_KEY est\u00e1n descritos en el siguiente enlace https://stackoverflow.com/questions/15170637/effects-of-changing-djangos-secret-key/15383766#15383766 Por ejemplo, uno de los usos que se menciona es el firmado de los objetos json. El fichero que nosotros tenemos para rellenar la base de datos para Mezzanine como lo ten\u00edamos en producci\u00f3n, es de formato json, y puede que en este fichero hubieran datos que utilizaran esta SECRET_KEY para funciones criptogr\u00e1ficas...etc Adem\u00e1s, con django debe de haber alg\u00fan tipo de comprobaci\u00f3n para mostrar un error en caso de que no se encuentren las claves necesarias</p> <ul> <li> <p>Activamos el virtualenv (importante para que reconozca lo que voy a hacer a partir de ahora) <pre><code>source ~/mezzanine-pyenv-prod/bin/activate\n</code></pre></p> </li> <li> <p>Hacemos una creaci\u00f3n inicial de las tablas <pre><code>python manage.py migrate\n</code></pre></p> <p>Esto toma en cuenta la definici\u00f3n de tablas que tuviera django en nuestra app en espec\u00edfico (o modelos de datos), no carga ning\u00fan tipo de datos. S\u00d3LO CREA TABLAS VAC\u00cdAS</p> </li> <li> <p>Ejecutamos lo siguiente para cargar los datos del json (que contiene exactamente los mismos datos que la base de datos SQLite en desarrollo) en nuetra base de datos en tortilla para mezzanine <pre><code>python manage.py loaddata db_mezzanine_bak.json\n</code></pre> Si los datos se han conseguido cargar correctamente, el mensaje que recibiremos es el siguiente <pre><code>Installed 151 object(s) from 1 fixture(s)\n</code></pre></p> </li> </ul>"},{"location":"2asir19-20/t8-cloud-app-python.md/#creacion-de-la-unidad-systemd-para-gunicorn","title":"Creaci\u00f3n de la unidad systemd para gunicorn","text":"<ul> <li> <p>Abrimos un nuevo archivo para configurar la unidad <pre><code>sudo nano /etc/systemd/system/gunicorn.service\n</code></pre></p> </li> <li> <p>Le a\u00f1adimos el siguiente contenido <pre><code>[Unit]\nDescription = daemon gunicorn\nAfter = network.target\n\n[Service]\nUser = centos\nGroup = nginx\nWorkingDirectory = /var/www/mezzanine\nExecStart = /home/centos/mezzanine-pyenv-prod/bin/gunicorn --access-logfile - --workers 3 --bind unix:/var/www/mezzanine/gunicorn.sock mezzanine.wsgi:application\n\n[Install]\nWantedBy = multi-user.target\n</code></pre></p> </li> <li> <p>Recargamos la lista de servicios, para que el nuevo que hemos a\u00f1adido, sea reconocido <pre><code>sudo systemctl daemon-reload\n</code></pre></p> </li> <li> <p>Ya podemos iniciar nuestro servicio <pre><code>sudo systemctl start gunicorn\n</code></pre></p> </li> <li> <p>Cambiar permisos del document root (porque en la unidad systemd los del grupo nginx son los que tienen permiso) sudo chown -R nginx: /var/www/mezzanine/</p> </li> </ul>"},{"location":"2asir19-20/t8-cloud-app-python.md/#configurando-nginx","title":"Configurando NGINX","text":"<ul> <li>Creamos el fichero de configuraci\u00f3n para el virtualhost de nginx <pre><code>sudo touch /etc/nginx/conf.d/mezzanine.conf\n</code></pre></li> <li>Le a\u00f1adimos el siguiente contenido <pre><code>\n</code></pre></li> </ul>"},{"location":"2asir19-20/t8-cloud-app-python.md/#_1","title":"Tarea 8 Cloud:  Instalaci\u00f3n de app python (Mezzanine)","text":""},{"location":"2asir19-20/t8-cloud-app-python.md/#nuevo-registro-dns-para-la-app","title":"Nuevo registro DNS para la app","text":"<p>python.aincrad-adrijara.gonzalonazareno.org</p>"},{"location":"2asir19-20/usuarios-grupos-acl-ldap/","title":"Pr\u00e1ctica: Usuarios, grupos y ACLs en LDAP","text":"<p>Crea 10 usuarios con los nombres que prefieras en LDAP, esos usuarios deben ser objetos de los tipos posixAccount e inetOrgPerson. Estos usuarios tendr\u00e1n un atributo userPassword Crea 3 grupos en LDAP dentro de una unidad organizativa diferente que sean objetos del tipo groupOfNames. Estos grupos ser\u00e1n: comercial, almacen y admin A\u00f1ade usuarios que pertenezcan a:     Solo al grupo comercial     Solo al grupo almacen     Al grupo comercial y almacen     Al grupo admin y comercial     Solo al grupo admin Modifica OpenLDAP apropiadamente para que se pueda obtener los grupos a los que pertenece cada usuario a trav\u00e9s del atributo \"memberOf\" Crea las ACLs necesarias para que los usuarios del grupo almacen puedan ver todos los atributos de todos los usuarios pero solo puedan modificar las suyas Crea las ACLs necesarias para que los usuarios del grupo admin puedan ver y modificar cualquier atributo de cualquier objeto</p>"},{"location":"2asir20-21/compilacion-programaC-con-makefile/","title":"Enunciado","text":"<ol> <li> <p>Elige el programa escrito en C que prefieras y comprueba en las fuentes que exista un fichero Makefile para compilarlo</p> </li> <li> <p>Realiza los pasos necesarios para compilarlo e inst\u00e1lalo en tu equipo en un directorio que no interfiera con tu sistema de paquetes (/opt, /usr/local, etc.)</p> </li> <li> <p>La correcci\u00f3n se har\u00e1 en clase y deber\u00e1s ser capaz de explicar qu\u00e9 son todos los ficheros que se hayan instalado y realizar una desinstalaci\u00f3n limpia.</p> </li> </ol>"},{"location":"2asir20-21/compilacion-programaC-con-makefile/#desarrollo","title":"Desarrollo","text":""},{"location":"2asir20-21/compilacion-programaC-con-makefile/#primera-parte","title":"Primera parte","text":"<p>Elijo <code>gimp</code>, y dentro de su c\u00f3digo fuente existe un fichero Makefile, efectivamente. De hecho son 2:</p> <ul> <li>Makefile.am</li> <li>Makefile.in</li> </ul>"},{"location":"2asir20-21/compilacion-programaC-con-makefile/#segunda-parte","title":"Segunda parte","text":""},{"location":"2asir20-21/compilacion-programaC-con-makefile/#1-requerimientos-pre-compilacion","title":"1. Requerimientos pre-compilaci\u00f3n","text":"<p>Resumen de paquetes requeridos junto con sus versiones <pre><code>     Package Name         Version\n\n+     ATK                  2.2.0\n+     babl                 0.1.78\n+     cairo                1.12.2\n+     Fontconfig           2.12.4\n+     freetype2            2.1.7\n+     GDK-PixBuf           2.30.8\n+     GEGL                 0.4.26\n+     GIO\n+     GLib                 2.56.2\n+     glib-networking\n+     GTK+                 2.24.32\n+     HarfBuzz             0.9.19\n+     libbzip2\n+     libjpeg\n+     liblzma              5.0.0\n+     libmypaint           1.3.0\n+     libpng               1.6.25\n+     libpoppler-glib      0.50.0\n+     librsvg              2.40.6\n+     libtiff\n+     Little CMS           2.8\n+     mypaint-brushes-1.0\n+     pangocairo           1.29.4\n+     poppler-data         0.4.7\n+     zlib\n+     gexiv2               &gt;= 0.10.6\n</code></pre></p> <p>Resumen para la instalaci\u00f3n r\u00e1pida de todos ellos <pre><code>sudo apt update &amp;&amp; sudo apt install poppler-data mypaint-brushes libpoppler-glib-dev liblzma5 libjpeg62-turbo glib-networking fontconfig libfreetype6 libglib2.0-0 gir1.2-glib-2.0 libcairo2 libgdk-pixbuf2.0-0 libharfbuzz-bin libpng16-16 lib64z1 libtiff-dev librsvg2-dev libpango1.0-0 liblcms2-2 libbz2-dev gtk+2.0 libatk1.0-0 libgexiv2-dev\n</code></pre></p> <p>LIBRER\u00cdA babl 0.1.78 Esa versi\u00f3n s\u00f3lo se encuentra en unstable, as\u00ed que...</p> <ul> <li>A\u00f1ado la siguiente l\u00ednea a <code>/etc/apt/sources.list</code> <pre><code>deb http://http.us.debian.org/debian unstable main non-free contrib\n</code></pre></li> <li>Para evitar problemas, en el fichero <code>/etc/apt/preferences.d/priorities</code> a\u00f1ado el siguiente contenido      <pre><code>Package: *\nPin: release a=stable\nPin-Priority: 700\n\nPackage: *\nPin: release a=unstable\nPin-Priority: 600\n</code></pre>      De esta manera, siempre que hagamos un <code>sudo apt install &lt;nombre-paquete&gt;</code>, por defecto lo har\u00e1 de los que est\u00e9n en rama <code>stable</code>, y no <code>unstable</code>. A no ser que le indiquemos lo contrario, claro. </li> <li>Con todo esto hecho, ya S\u00cd podremos instalar la versi\u00f3n que necesitamos de babl      <pre><code>sudo apt install -t unstable libbabl-dev\n</code></pre>      Aunque antes de esto, tenemos que actualizar con la versi\u00f3n de unstable un paquete manualmente para que funcione      <pre><code>sudo apt install -t unstable gcc-8-base\n</code></pre></li> </ul> <p>Con esto, ya tendr\u00edamos la librer\u00eda a una versi\u00f3n que podemos usar <pre><code>libbabl-dev:\n  Installed: 1:0.1.82-1\n  Candidate: 1:0.1.82-1\n  Version table:\n *** 1:0.1.82-1 600\n        600 http://http.us.debian.org/debian unstable/main amd64 Packages\n        100 /var/lib/dpkg/status\n     0.1.62-1 700\n        700 http://deb.debian.org/debian buster/main amd64 Packages\n</code></pre></p> <p>LIBRER\u00cdA GEGL 0.4.26 Esa versi\u00f3n s\u00f3lo se encuentra en unstable, as\u00ed que...</p> <ul> <li><code>sudo apt install -t unstable libgegl-dev</code></li> <li><code>libgegl-dev:      Installed: 1:0.4.26-1      Candidate: 1:0.4.26-1      Version table:      *** 1:0.4.26-1 600           600 http://http.us.debian.org/debian unstable/main amd64 Packages           100 /var/lib/dpkg/status           0.4.12-2 700           700 http://deb.debian.org/debian buster/main amd64 Packages</code></li> </ul> <p>LIBRER\u00cdA libmypaint Por cierto warning a la hora de hacer el configure... <pre><code>WARNING: libmypaint lower than version 1.4.0 is known to crash when\n         parsing MyPaint 2 brushes. Please update.\n</code></pre> ...Mejor que tengamos la versi\u00f3n de unstable</p> <pre><code>sudo apt install -t unstable libmypaint-dev\n</code></pre>"},{"location":"2asir20-21/compilacion-programaC-con-makefile/#2-script-configure","title":"2. Script configure","text":"<p>Sobre la opci\u00f3n <code>--prefix</code> a la hora de hacer un <code>./configure</code> https://stackoverflow.com/questions/62340836/what-does-prefix-in-configure-script-do-when-building-a-software-in-linux</p> <p>En el propio directorio donde tenemos el c\u00f3digo fuente, lo primero, es ejecutar <code>./configure</code>.  </p> <p>\u00bfQu\u00e9 hace este script? Pues lo que nos dice el fichero <code>INSTALL</code> propio de gimp como manual de compilaci\u00f3n es lo siguiente...</p> <p>The `configure' script examines your system, and adapts GIMP to run on it.</p> <p>B\u00e1sicamente lo que esto quiere decir, es que se toman ciertos valores de nuestro sistema en espec\u00edfico, y partiendo de eso, se nos genera un \"Makefile personalizado\". \u00c9ste, posteriormente, ser\u00e1 el usado para la compilaci\u00f3n. </p> <p>Esto es lo que nos dice el propio script <code>configure</code>...</p> <p>Guess values for system-dependent variables and create Makefiles.</p> <p>Una vez que ya tenemos una idea grosso modo de lo que hace este script, lo ejecutamos <pre><code>./configure --disable-python --disable-gimp-console\n</code></pre></p> <ul> <li>Para prevenir ciertos errores que pueden aparecer     tras ejecutar este script...    <pre><code>sudo apt install gcc build-essential intltool\n</code></pre></li> <li><code>--disable-python</code> = deshabilita la compilaci\u00f3n de ciertas extensiones python que no necesitar\u00edamos </li> <li><code>--disable-gimp-console</code> = deshabilita la compilaci\u00f3n del binario para la consola de gimp, que en principio tampoco es necesario</li> </ul> <p>Despu\u00e9s de hacer esto, tendr\u00edamos un output bastante extenso del script, del cual realmente nos interesa s\u00f3lo la siguiente parte...</p> <pre><code>Building GIMP with prefix=/usr/local, datarootdir=${prefix}/share\nDesktop files install into ${datarootdir}\n</code></pre> <p><code>Prefix</code> es la opci\u00f3n que define d\u00f3nde se mover\u00e1n los binarios tras haberlos compilado y otros ficheros, cuando hagamos un <code>make install</code>. Esto pasar\u00e1, claro est\u00e1, despu\u00e9s de haber hecho la compilaci\u00f3n con <code>make</code>.</p> <p>Con gimp, tenemos la suerte de que por defecto <code>/usr/local</code> ser\u00e1 el prefix, pero habr\u00e1 otros binarios que queramos comparar en los que no tengamos esa suerte. Simplemente si esto pasa, ser\u00e1 cuesti\u00f3n de pasar un par\u00e1metro de <code>prefix</code> en el momento de hacer un <code>configure</code>, para indicar el directorio ra\u00edz que queramos.</p> <p>Como \u00faltimo dato en este apartado, a\u00f1adir que se nos ha generado nuestro \"Makefile personalizado\"</p> <pre><code>-rw-r--r--  1 vagrant vagrant    47922 Nov  3 05:08 Makefile\n</code></pre>"},{"location":"2asir20-21/compilacion-programaC-con-makefile/#3-compilacion","title":"3. Compilaci\u00f3n","text":"<p>Ejecutamos <code>make</code>.  </p> <p>Esto lo que har\u00e1 es, teniendo en cuenta el Makefile que se gener\u00f3, compilar todo lo necesario en los directorios dentro del c\u00f3digo fuente.</p> <p>Para un poco de informaci\u00f3n m\u00e1s detallada sobre esto, paso lo siguiente extra\u00eddo del fichero <code>INSTALL</code></p> <pre><code>The `make' command builds several things:\n - A bunch of public libraries in the directories starting with 'libgimp'.\n - The plug-in programs in the 'plug-ins' directory.\n - Some modules in the 'modules' subdirectory.\n - The main GIMP program 'gimp-2.10' in `app'.\n</code></pre>"},{"location":"2asir20-21/compilacion-programaC-con-makefile/#4-instalacion","title":"4. Instalaci\u00f3n","text":"<p>Ejecutamos <code>sudo make install</code>.</p> <p>Necesitamos sudo porque estamos moviendo ficheros a <code>/usr/local</code>, directorio cuyo propietario es root, y otros usuarios no tienen permiso de escritura</p> <p>Esto lo que har\u00e1 es, mover todo lo compilado y generado al directorio ra\u00edz cuyo prefix hayamos establecido previamente.</p> <p>Para m\u00e1s informaci\u00f3n, el fichero <code>INSTALL</code> dice lo siguiente... <pre><code>By default, `make install' will install the package's files in\n/usr/local/bin, /usr/local/lib, /usr/local/man, etc. \n</code></pre></p> <p>Una vez que ya hemos instalado, muestro un resumen de <code>/usr/local</code> para que se vea la estructura que tenemos generada <pre><code>/usr/local/\n\u251c\u2500\u2500 bin\n\u251c\u2500\u2500 etc\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 gimp\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 2.0\n\u251c\u2500\u2500 games\n\u251c\u2500\u2500 include\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 gimp-2.0\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimp\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpbase\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpcolor\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpconfig\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpmath\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpmodule\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpthumb\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 libgimpwidgets\n\u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gimp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 2.0\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 environ\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 interpreters\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 modules\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 plug-ins\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 align-layers\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 animation-optimize\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 animation-play\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 blinds\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 blur\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 border-average\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 busy-dialog\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 cartoon\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 checkerboard\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 cml-explorer\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 color-cube-analyze\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 color-enhance\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 colorify\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 colormap-remap\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 compose\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 contrast-retinex\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 crop-zealous\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 curve-bend\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 decompose\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 depth-merge\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 despeckle\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 destripe\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 edge-dog\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 emboss\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-bmp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-cel\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-compressor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-csource\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-darktable\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-dds\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-desktop-link\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-dicom\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-faxg3\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-fits\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-fli\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-gbr\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-gegl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-gif-load\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-gif-save\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-gih\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-glob\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-header\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-html-table\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-ico\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-jpeg\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-pat\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-pcx\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-pdf-load\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-pdf-save\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-pix\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-png\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-pnm\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-psd\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-psp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-raw-data\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-raw-placeholder\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-rawtherapee\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-sgi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-sunras\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-svg\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-tga\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-tiff\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-xbm\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-xmc\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 file-xwd\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 film\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 filter-pack\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 flame\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 fractal-explorer\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 fractal-trace\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 gfig\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 gimpressionist\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 goat-exercise\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 gradient-flare\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 gradient-map\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 grid\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 guillotine\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 help\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 hot\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 ifs-compose\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 imagemap\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 jigsaw\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 lighting\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 mail\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 map-object\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 max-rgb\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 metadata-editor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 metadata-viewer\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 nl-filter\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 pagecurl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 photocopy\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 plugin-browser\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 print\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 procedure-browser\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 qbist\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 sample-colorize\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 screenshot\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 script-fu\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 selection-to-path\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 sharpen\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 smooth-palette\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 softglow\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 sparkle\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 sphere-designer\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 tile\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 tile-small\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 unit-editor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 van-gogh-lic\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 warp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 wavelet-decompose\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 web-browser\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pkgconfig\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 python2.7\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 dist-packages\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 site-packages\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 python3.7\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 dist-packages\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 python3.8\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 dist-packages\n\u251c\u2500\u2500 libexec\n\u251c\u2500\u2500 man -&gt; share/man\n\u251c\u2500\u2500 sbin\n\u251c\u2500\u2500 share\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 aclocal\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 applications\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ca-certificates\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fonts\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gimp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 2.0\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 brushes\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Basic\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Fun\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 gimp-obsolete-files\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Legacy\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Media\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Sketch\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Splatters\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 Texture\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 dynamics\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Basic\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 FX\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 file-raw\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 fonts\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 fractalexplorer\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 gfig\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 gflare\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 gimpressionist\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Brushes\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Paper\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 Presets\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 gradients\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 gimp-obsolete-files\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 icons\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Color\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 24x24\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 64x64\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 scalable\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 hicolor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Legacy\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 128x128\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 12x12\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 16x16\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 18x18\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 192x192\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 20x20\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 22x22\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 tools\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 24x24\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 256x256\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 32x32\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 48x48\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 64x64\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 96x96\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Symbolic\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 24x24\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 64x64\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 scalable\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Symbolic-High-Contrast\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 24x24\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 64x64\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 scalable\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Symbolic-Inverted\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 24x24\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 64x64\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 scalable\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 Symbolic-Inverted-High-Contrast\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u251c\u2500\u2500 24x24\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u251c\u2500\u2500 64x64\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 scalable\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 images\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 menus\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 palettes\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 patterns\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Animal\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Fabric\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Food\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Legacy\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Paper\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Plant\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Sky\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Stone\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Water\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 Wood\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 images\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 tags\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 themes\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Dark\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ui\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Gray\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ui\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Light\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ui\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 System\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 tips\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 tool-presets\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Crop\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 FX\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Paint\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 Selection\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 Sketch\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 ui\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 plug-ins\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gtk-doc\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 html\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpbase\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpcolor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpconfig\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpmath\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpmodule\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 libgimpthumb\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 libgimpwidgets\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 icons\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 hicolor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 16x16\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 22x22\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 24x24\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 256x256\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 32x32\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 48x48\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 apps\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 locale\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 am\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ar\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ast\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 az\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 be\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 bg\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 br\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 bs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ca\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ca@valencia\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 cs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 csb\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 da\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 de\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 dz\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 el\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 en_CA\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 en_GB\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 eo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 es\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 et\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 eu\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fa\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fr\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ga\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 gd\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 gl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 gu\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 he\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hr\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hu\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 id\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 is\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 it\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ja\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ka\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 kk\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 km\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 kn\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ko\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ky\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 lt\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 lv\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mk\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mr\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ms\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 my\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 nb\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 nds\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ne\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 nl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 nn\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 oc\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pa\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pt\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pt_BR\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ro\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ru\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 rw\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 si\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sk\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sr\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sr@latin\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sv\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ta\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 te\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 th\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tr\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tt\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 uk\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 vi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 xh\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 yi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 zh_CN\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 zh_HK\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 zh_TW\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 LC_MESSAGES\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 man\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 man1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 man5\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 metainfo\n\u2514\u2500\u2500 src\n\n465 directories\n</code></pre></p> <p>He usado la orden... <pre><code>tree -d /usr/local/\n</code></pre> ...s\u00f3lo mostrando directorios, porque ya es suficientemente largo el output como para mostrar ficheros tambi\u00e9n. </p> <p>Pero para que nos hagamos una idea, aqu\u00ed tenemos nuestros binarios ejecutables generados, por ejemplo: <pre><code>vagrant@mimaquina:/usr/local/bin$ ls -la \ntotal 52496\ndrwxr-xr-x  2 root root     4096 Nov  3 06:00 .\ndrwxr-xr-x 11 root root     4096 Nov  3 05:49 ..\nlrwxrwxrwx  1 root root        9 Nov  3 06:00 gimp -&gt; gimp-2.10\n-rwxr-xr-x  1 root root 53624584 Nov  3 06:00 gimp-2.10\n-rwxr-xr-x  1 root root    50760 Nov  3 06:00 gimp-test-clipboard-2.0\n-rwxr-xr-x  1 root root    67328 Nov  3 06:00 gimptool-2.0\n</code></pre></p> <p>Hasta aqu\u00ed, podemos considerar que tenemos gimp instalado.</p>"},{"location":"2asir20-21/compilacion-programaC-con-makefile/#tercera-parte","title":"Tercera parte","text":""},{"location":"2asir20-21/compilacion-programaC-con-makefile/#desinstalacion","title":"Desinstalaci\u00f3n","text":"<p>No viene expl\u00edcitamente dicho en ning\u00fan documento dentro del c\u00f3digo fuente, o al menos yo no lo encontr\u00e9 donde lo dice, pero para la desinstalaci\u00f3n tenemos disponible la opci\u00f3n <code>uninstall</code>.</p> <p>Esto lo s\u00e9 por 2 razones: * Puedo ejecutar un <code>sudo make uninstall</code> y ver que efectivamente, ha funcionado  * En el fichero Makefile generado personalizado para nuestra instalaci\u00f3n, tenemos declarada una fase <code>uninstall</code>...      <pre><code>am__uninstall_files_from_dir = { \\\ntest -z \"$$files\" \\\n|| { test ! -d \"$$dir\" &amp;&amp; test ! -f \"$$dir\" &amp;&amp; test ! -r \"$$dir\"; } \\\n|| { echo \" ( cd '$$dir' &amp;&amp; rm -f\" $$files \")\"; \\\n     $(am__cd) \"$$dir\" &amp;&amp; rm -f $$files; }; \\\n}\n</code></pre>      Entiendo que es ese el bloque de c\u00f3digo que lo define, ya que est\u00e1 borrando, pero hay otras partes en el c\u00f3digo completo que tambi\u00e9n mencionan el <code>uninstall</code></p> <p>Por todo esto, puedo estar bastante seguro de que eso va a funcionar.</p> <p>Efectivamente, si lo ejecuto funciona, y borra lo correspondiente del ra\u00edz <code>/usr/local</code>.</p> <p>Por ejemplo, nos damos cuenta de que ya no tenemos los binarios... <pre><code>vagrant@mimaquina:~/gimp-2.10.22$ ls -la /usr/local/bin/\ntotal 8\ndrwxr-xr-x  2 root root 4096 Nov  3 06:15 .\ndrwxr-xr-x 11 root root 4096 Nov  3 05:49 ..\n</code></pre></p> <p>Eso s\u00ed, es importante anotar que la estructura de directorios que previamente gener\u00f3 en <code>/usr/local</code> la mantiene, s\u00f3lo borra ficheros.  </p> <p>\u00bfPor qu\u00e9 hace esto? Sinceramente no lo s\u00e9, supongo que para futuras instalaciones, no tener que volver a generar toda la estructura de directorios y ahorrar as\u00ed algo de tiempo.</p>"},{"location":"2asir20-21/doc-servidores-fisicos/","title":"Cheatsheet b\u00e1sica","text":"<p>Estado del hardware de la m\u00e1quina en general <pre><code>ipmitool -H 172.22.221.51 -U root -P root -I lanplus chassis status -v\n</code></pre></p> <p>Encender la m\u00e1quina <pre><code>ipmitool -H 172.22.221.51 -U root -P root -I lanplus chassis power on\n</code></pre></p> <p>Apagar la m\u00e1quina <pre><code>ipmitool -H 172.22.221.51 -U root -P root -I lanplus chassis power off\n</code></pre></p> <p>Conectarnos por la interfaz serie redirigida de la m\u00e1quina <pre><code>ipmitool -I lanplus -H 172.22.221.51 -U root -P root sol activate\n</code></pre></p>"},{"location":"2asir20-21/doc-servidores-fisicos/#que-hemos-hecho-en-la-maquina","title":"\u00bfQu\u00e9 hemos hecho en la m\u00e1quina?","text":""},{"location":"2asir20-21/doc-servidores-fisicos/#redireccion-de-puerto-com1-interno","title":"Redirecci\u00f3n de puerto COM1 (interno)","text":"<p>En la BIOS hemos hecho esto, y hemos redirigido su salida por el puerto ethernet IPMI.</p>"},{"location":"2asir20-21/doc-servidores-fisicos/#interfaz-ipmi","title":"Interfaz IPMI","text":"<p>Este puerto realmente no es de red, es un puerto de administraci\u00f3n con IP simplemente. No se puede salir de la red con \u00e9l, por ejemplo.</p> <p>Su configuraci\u00f3n de IP, m\u00e1scara, direcci\u00f3n de broadcast, etc, se hace en la BIOS. </p> <p>En mi caso, mi nodo tiene la ip 172.22.221.51</p>"},{"location":"2asir20-21/doc-servidores-fisicos/#instalacion-del-so","title":"Instalaci\u00f3n del SO","text":"<p>No lo hice yo, pero instalaron Debian 10. </p> <ul> <li>Usuario sin privilegios<ul> <li>Nombre: usuario</li> <li>Contrase\u00f1a: usuario</li> </ul> </li> <li>Usuario con privilegios<ul> <li>Nombre: root</li> <li>Contrase\u00f1a: root </li> </ul> </li> </ul>"},{"location":"2asir20-21/doc-servidores-fisicos/#redireccion-de-salida-grub-por-com1","title":"Redirecci\u00f3n de salida GRUB por COM1","text":"<p>Anotar cambios</p>"},{"location":"2asir20-21/doc-servidores-fisicos/#activacion-de-ttys1","title":"Activaci\u00f3n de ttyS1","text":"<p>Es una terminal de interfaz en modo texto que ofrece el sistema operativo por el puerto COM1.</p> <p>De esta manera, b\u00e1sicamente estamos mandando la l\u00ednea de comandos a trav\u00e9s del puerto COM1, para que as\u00ed, podamos controlarlo desde la interfaz de administraci\u00f3n.</p> <p>ANOTAR CAMBIOS.</p> <p>MEJORA = ACTIVACI\u00d3N DE ESTA TERMINAL AUTOM\u00c1TICAMENTE AL ARRANQUE MEDIANTE SYSTEMD, NO INITD </p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/","title":"1. Crea un documento de texto con cualquier editor o utiliza uno del que dispongas","text":"<p><pre><code>touch para_miguel.txt\n</code></pre> Contenido de ese fichero... <pre><code>vagrant@ejercicio-simetrico-gpg:~$ cat para_miguel.txt\nsi lo ves lo has descrifrado\n</code></pre></p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#2-cifra-este-documento-con-alguna-contrasena-acordada-con-el-companero-de-al-lado","title":"2. Cifra este documento con alguna contrase\u00f1a acordada con el compa\u00f1ero de al lado","text":"<pre><code>gpg -c para_miguel.txt\n</code></pre> <p>Contrase\u00f1a usada al cifrar: hola</p> <p>Se genera... <pre><code>para_miguel.txt.gpg\n</code></pre></p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#3-haz-llegar-por-algun-medio-al-companero-de-al-lado-el-documento-que-acabas-de-cifrar","title":"3. Haz llegar por alg\u00fan medio al compa\u00f1ero de al lado el documento que acabas de cifrar","text":"<p>Nos pasamos los ficheros cifrados por chat privado en slack</p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#4-descifra-el-documento-que-te-ha-hecho-llegar-tu-companero-de-al-lado","title":"4. Descifra el documento que te ha hecho llegar tu compa\u00f1ero de al lado","text":"<pre><code>gpg -d fichero1.gpg\n</code></pre> <p>Contrase\u00f1a usada al descifrar: hola</p> <p>Resultado... <pre><code>gpg: AES256 encrypted data\ngpg: encrypted with 1 passphrase\nhola mundo\n</code></pre></p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#5","title":"5. ...","text":""},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#51-con-que-algoritmo-se-ha-cifrado-el-fichero","title":"5.1 \u00bfCon qu\u00e9 algoritmo se ha cifrado el fichero?","text":"<p>El siguiente comando muestra toda la informaci\u00f3n gpg relacionada con el cifrado</p> <pre><code>gpg --list-packets para_miguel.txt.gpg\n</code></pre> <p>\u00a1Se nos pide la frase de paso para realizar \u00e9sta acci\u00f3n!</p> <p>La salida completa es... <pre><code>gpg: AES256 encrypted data\ngpg: encrypted with 1 passphrase\n# off=0 ctb=8c tag=3 hlen=2 plen=13\n:symkey enc packet: version 4, cipher 9, s2k 3, hash 2\n    salt A7E12EC5F2161D3A, count 65011712 (255)\n# off=15 ctb=d2 tag=18 hlen=2 plen=95 new-ctb\n:encrypted data packet:\n    length: 95\n    mdc_method: 2\n# off=36 ctb=a3 tag=8 hlen=1 plen=0 indeterminate\n:compressed packet: algo=1\n# off=38 ctb=ac tag=11 hlen=2 plen=50\n:literal data packet:\n    mode b (62), created 1602068487, name=\"para_miguel.txt\",\n    raw data: 29 bytes\n</code></pre> ...pero nos interesa que al inicio, nos indica el algoritmo de cifrado usado para generar el fichero con la l\u00ednea: <pre><code>gpg: AES256 encrypted data\n</code></pre></p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#52-vuelve-a-cifrar-el-fichero-usando-el-algoritmo-aes256","title":"5.2 Vuelve a cifrar el fichero usando el algoritmo AES256","text":"<pre><code>gpg -c --cipher-algo AES256 para_miguel_AES256.txt \n</code></pre> <p>Como dato a\u00f1adido, actualmente al cifrar sim\u00e9tricamente sin indicar un algoritmo, por defecto lo hace con AES256. En el primer fichero que cifr\u00e9 en este ejercicio, no marcamos algoritmo, as\u00ed que supuso AES256. Marcar ahora mismo ese algoritmo para cifrar tendr\u00eda poco sentido, ya que no har\u00eda falta...A no ser que nuestro algoritmo por defecto fuese otro.   </p> <p>Si queremos comprobar que de verdad se aplic\u00f3 ese cifrado... <pre><code>gpg --list-packets para_miguel_AES256.txt.gpg\n</code></pre> <pre><code>gpg: AES256 encrypted data\ngpg: encrypted with 1 passphrase\n# off=0 ctb=8c tag=3 hlen=2 plen=13\n:symkey enc packet: version 4, cipher 9, s2k 3, hash 2\n    salt C4A88339D9DEC6C4, count 65011712 (255)\n# off=15 ctb=d2 tag=18 hlen=2 plen=102 new-ctb\n:encrypted data packet:\n    length: 102\n    mdc_method: 2\n# off=36 ctb=a3 tag=8 hlen=1 plen=0 indeterminate\n:compressed packet: algo=1\n# off=38 ctb=ac tag=11 hlen=2 plen=57\n:literal data packet:\n    mode b (62), created 1602071080, name=\"para_miguel_AES256.txt\",\n    raw data: 29 bytes\n</code></pre> En efecto, se aplic\u00f3.</p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#53-puedes-hacer-permanente-esta-configuracion","title":"5.3 \u00bfPuedes hacer permanente \u00e9sta configuraci\u00f3n?","text":"<p>Toda configuraci\u00f3n permanente de gpg se encuentra en la ruta <code>$HOME/.gnupg/gpg.conf</code>. Por defecto este fichero no se crea, as\u00ed que lo creamos <pre><code>touch $HOME/.gnupg/gpg.conf\n</code></pre></p> <p>En ese fichero, para establecer un algoritmo de cifrado sim\u00e9trico por defecto que nosotros queramos, escribimos lo siguiente  <pre><code>personal-cipher-preferences AES256\n</code></pre> A partir de ahora, cada vez que cifremos sim\u00e9tricamente, si no especificamos expl\u00edcitamente otro algoritmo, \u00e9ste ser\u00e1 el utilizado</p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#6-instala-gpg-en-windows-gpg4win-repite-el-ejercicio-en-windows-puedes-encriptar-un-mensaje-en-linux-y-desencriptarlo-en-windows-y-viceversa","title":"6. Instala gpg en windows (Gpg4win), repite el ejercicio en Windows. Puedes encriptar un mensaje en linux y desencriptarlo en windows y viceversa","text":"<p>Descarga aqu\u00ed Gpg4win</p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#encriptacion-en-windows-desencriptacion-en-linux","title":"Encriptaci\u00f3n en Windows - Desencriptaci\u00f3n en Linux","text":"<p>Encripto en Windows con (desde cmd)... <pre><code>gpg -c para_linux.txt\n</code></pre></p> <p>Usar\u00e9 la misma frase de paso que antes, hola</p> <p>Se me genera un <code>para_linux.txt.gpg</code>, el fichero cifrado. Procedo a pasarlo a Linux para su desencriptaci\u00f3n.</p> <p>Una vez lo tengo, desencripto de la misma manera que hicimos anteriormente <pre><code>gpg -d para_linux.txt.gpg\n</code></pre> <pre><code>gpg: AES encrypted data\ngpg: encrypted with 1 passphrase\nfichero a descifrar en linux\n</code></pre> Funcion\u00f3 correctamente</p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#encriptacion-en-linux-desencriptacion-en-windows","title":"Encriptaci\u00f3n en Linux - Desencriptaci\u00f3n en Windows","text":"<p>Encripto en Linux con... <pre><code>gpg -c para_windows.txt\n</code></pre></p> <p>Misma frase de paso, hola</p> <p>Se genera <code>para_windows.txt.gpg</code>, el fichero cifrado. Procedo a pasarlo a Windows para su desencriptaci\u00f3n.</p> <p>Una vez lo tengo, desencripto... </p> <p>Funcion\u00f3 correctamente</p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#7-openssl-es-otra-herramienta-que-nos-permite-cifrar-mensajes-de-forma-simetrica-investiga-como-se-realiza-este-ejercicio-utilizando-esta-herramienta","title":"7. <code>openssl</code> es otra herramienta que nos permite cifrar mensajes de forma sim\u00e9trica, investiga c\u00f3mo se realiza este ejercicio utilizando esta herramienta","text":""},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#proceso-de-cifrado","title":"Proceso de cifrado","text":"<pre><code>openssl enc -v -aes-256-cbc -in con_openssl.txt -out con_openssl.txt.enc\n</code></pre> <p>Misma frase de paso, hola. Introduzco el par\u00e1metro <code>-v</code> para que me muestre informaci\u00f3n detallada del proceso, pero no ser\u00eda obligatorio usarlo</p> <p><pre><code>bufsize=8192\nenter aes-256-cbc encryption password:\nVerifying - enter aes-256-cbc encryption password:\n*** WARNING : deprecated key derivation used.\nUsing -iter or -pbkdf2 would be better.\nbytes read   :       52\nbytes written:       80\n</code></pre> Despu\u00e9s de esto ya tendr\u00edamos generado nuestro fichero cifrado <code>con_openssl.txt.enc</code></p>"},{"location":"2asir20-21/ejercicio-cifrado-simetrico-gpg-openssl/#proceso-de-descifrado","title":"Proceso de descifrado","text":"<p><pre><code>openssl enc -v -aes-256-cbc -d -in con_openssl.txt.enc -out con_openssl_descifrado.txt\n</code></pre> <pre><code>bufsize=8192\nenter aes-256-cbc decryption password:\n*** WARNING : deprecated key derivation used.\nUsing -iter or -pbkdf2 would be better.\nbytes read   :       80\nbytes written:       52\n</code></pre> \u00c9sta operaci\u00f3n nos ha generado nuestro fichero desencriptado <code>con_openssl_descifrado.txt</code> </p> <p>Procedemos a ver su contenido <pre><code>vagrant@ejercicio-simetrico-gpg:~$ cat con_openssl_descifrado.txt\nHas descifrado correctamente el fichero con openssl\n</code></pre></p>"},{"location":"2asir20-21/ejs-modulos-kernel/","title":"Ejercicio 1","text":""},{"location":"2asir20-21/ejs-modulos-kernel/#comprueba-los-modulos-cargados-en-tu-equipo","title":"Comprueba los m\u00f3dulos cargados en tu equipo","text":"<p><code>lsmod</code></p>"},{"location":"2asir20-21/ejs-modulos-kernel/#ejercicio-2","title":"Ejercicio 2","text":""},{"location":"2asir20-21/ejs-modulos-kernel/#cuenta-el-numero-de-modulos-disponibles-en-el-nucleo-que-estas-usando","title":"Cuenta el n\u00famero de m\u00f3dulos disponibles en el n\u00facleo que est\u00e1s usando","text":"<p>find /lib/modules/$(uname -r)/kernel -type f -iname *.ko | wc -l</p>"},{"location":"2asir20-21/ejs-modulos-kernel/#ejercicio-3","title":"Ejercicio 3","text":""},{"location":"2asir20-21/ejs-modulos-kernel/#conecta-un-lapiz-usb-y-observa-la-salida-de-la-instruccion-sudo-dmesg","title":"Conecta un l\u00e1piz USB y observa la salida de la instrucci\u00f3n sudo dmesg","text":"<pre><code>[ 4593.172666] blk_update_request: I/O error, dev sdb, sector 2049 op 0x1:(WRITE) flags 0x0 phys_seg 1 prio class 0\n[ 4593.172678] Buffer I/O error on dev sdb1, logical block 1, lost async page write\n[ 4593.200317] FAT-fs (sdb1): unable to read boot sector to mark fs as dirty\n[ 4593.482408] usb 1-2: new high-speed USB device number 6 using xhci_hcd\n[ 4647.106080] usb 1-2: new high-speed USB device number 7 using xhci_hcd\n[ 4647.254940] usb 1-2: New USB device found, idVendor=abcd, idProduct=1234, bcdDevice= 1.00\n[ 4647.254947] usb 1-2: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[ 4647.254951] usb 1-2: Product: UDisk           \n[ 4647.254954] usb 1-2: Manufacturer: General \n[ 4647.254957] usb 1-2: SerialNumber: \u0409\n[ 4647.257334] usb-storage 1-2:1.0: USB Mass Storage device detected\n[ 4647.257962] scsi host5: usb-storage 1-2:1.0\n[ 4648.278641] scsi 5:0:0:0: Direct-Access     General  UDisk            5.00 PQ: 0 ANSI: 2\n[ 4648.279187] sd 5:0:0:0: Attached scsi generic sg1 type 0\n[ 4648.279543] sd 5:0:0:0: [sdb] 7866368 512-byte logical blocks: (4.03 GB/3.75 GiB)\n[ 4648.279749] sd 5:0:0:0: [sdb] Write Protect is off\n[ 4648.279754] sd 5:0:0:0: [sdb] Mode Sense: 0b 00 00 08\n[ 4648.279901] sd 5:0:0:0: [sdb] No Caching mode page found\n[ 4648.279905] sd 5:0:0:0: [sdb] Assuming drive cache: write through\n[ 4648.300684]  sdb: sdb1\n[ 4648.302644] sd 5:0:0:0: [sdb] Attached SCSI removable disk\n[ 4648.729316] FAT-fs (sdb1): Volume was not properly unmounted. Some data may be corrupt. Please run fsck.\n[ 4704.810503] usb 1-2: USB disconnect, device number 7\n[ 4722.273558] usb 1-3: new high-speed USB device number 8 using xhci_hcd\n[ 4722.430429] usb 1-3: New USB device found, idVendor=abcd, idProduct=1234, bcdDevice= 1.00\n[ 4722.430437] usb 1-3: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[ 4722.430441] usb 1-3: Product: UDisk           \n[ 4722.430445] usb 1-3: Manufacturer: General \n[ 4722.430448] usb 1-3: SerialNumber: \u0409\n[ 4722.432116] usb-storage 1-3:1.0: USB Mass Storage device detected\n[ 4722.432500] scsi host5: usb-storage 1-3:1.0\n[ 4723.446056] scsi 5:0:0:0: Direct-Access     General  UDisk            5.00 PQ: 0 ANSI: 2\n[ 4723.446893] sd 5:0:0:0: Attached scsi generic sg1 type 0\n[ 4723.447188] sd 5:0:0:0: [sdb] 7866368 512-byte logical blocks: (4.03 GB/3.75 GiB)\n[ 4723.447389] sd 5:0:0:0: [sdb] Write Protect is off\n[ 4723.447398] sd 5:0:0:0: [sdb] Mode Sense: 0b 00 00 08\n[ 4723.447549] sd 5:0:0:0: [sdb] No Caching mode page found\n[ 4723.447553] sd 5:0:0:0: [sdb] Assuming drive cache: write through\n[ 4723.484232]  sdb: sdb1\n[ 4723.485775] sd 5:0:0:0: [sdb] Attached SCSI removable disk\n[ 4723.900890] FAT-fs (sdb1): Volume was not properly unmounted. Some data may be corrupt. Please run fsck.\n</code></pre>"},{"location":"2asir20-21/ejs-modulos-kernel/#ejercicio-4","title":"Ejercicio 4","text":""},{"location":"2asir20-21/ejs-modulos-kernel/#elimina-el-modulo-correspondiente-a-algun-dispotivo-no-esencial-y-comprueba-que-ocurre-vuelve-a-cargarlo","title":"Elimina el m\u00f3dulo correspondiente a alg\u00fan dispotivo no esencial y comprueba qu\u00e9 ocurre. Vuelve a cargarlo.","text":"<p><code>sudo modprobe -r psmouse</code></p> <p><code>sudo modprobe psmouse</code></p> <p><code>lsmod | grep psmouse</code></p>"},{"location":"2asir20-21/ejs-modulos-kernel/#ejercicio-5","title":"Ejercicio 5","text":""},{"location":"2asir20-21/ejs-modulos-kernel/#selecciona-un-modulo-que-este-en-uso-en-tu-equipo-y-configura-el-arranque-para-que-no-se-cargue-automaticamente","title":"Selecciona un m\u00f3dulo que est\u00e9 en uso en tu equipo y configura el arranque para que no se cargue autom\u00e1ticamente","text":"<p>Create a file '/etc/modprobe.d/.conf' containing 'blacklist '. <p>Un fichero de configuraci\u00f3n por cada m\u00f3dulo, y dentro de la configuraci\u00f3n del m\u00f3dulo, blacklist o no. Hay otros par\u00e1metros adem\u00e1s como options, install...etc.</p>"},{"location":"2asir20-21/ejs-modulos-kernel/#ejercicio-6","title":"Ejercicio 6","text":""},{"location":"2asir20-21/ejs-modulos-kernel/#carga-el-modulo-loop-obten-informacion-de-que-es-y-para-que-sirve-lista-el-contenido-de-sysmodulesloopparameters-y-configura-el-equipo-para-que-se-puedan-cargar-hasta-32-dispositvos-loop-la-proxima-vez-que-se-arranque","title":"Carga el m\u00f3dulo loop, obt\u00e9n informaci\u00f3n de qu\u00e9 es y para qu\u00e9 sirve. Lista el contenido de /sys/modules/loop/parameters y configura el equipo para que se puedan cargar hasta 32 dispositvos loop la pr\u00f3xima vez que se arranque","text":""},{"location":"2asir20-21/instalacion-debian-10/","title":"NVIDIA sistema h\u00edbrido","text":"<p>explicaci\u00f3n optimus</p> <p>https://www.nvidia.com/en-us/geforce/technologies/optimus/technology/</p> <p>Por defecto el monitor lo controla normalmente la integrada intel, pero cada vez que se abre una aplicaci\u00f3n, el sistema optimus averigua si esa aplicaci\u00f3n es posible que se beneficio del rendimiento de la gr\u00e1fica nvidia, y la activa. La gr\u00e1fica NVIDIA pasa de estado idle a activo seg\u00fan se quiera usar o no.</p> <p>En debian, el hecho de tener simplemente el driver de nvidia, no habilita optimus (sistema h\u00edbrido), pero s\u00ed, si instalamos bumblebee. Bumblebee es lo que habilita realmente, que este sistema h\u00edbrido entre en funcionamiento. ????PERO MIGUEL SIN BUMBLEBEE PARECE TENER UN SISTEMA H\u00cdBRIDO TAMBI\u00c9N</p> <p>(nota: teniendo el sistema h\u00edbrido, uno puede decir si quiere usar s\u00f3lo una gr\u00e1fica, o la otra)</p> <p>Explicaci\u00f3n del sistema optimus en debian</p> <p>https://wiki.debian.org/NVIDIA%20Optimus</p> <p>Con optirun se pueden ejecutar aplicaciones diciendo que sea espec\u00edficamente</p> <p>En mi sistema actualmente tengo sistema h\u00edbrido, porque con lsmod aparecen los drivers nvidia+i915, qoue est\u00e1n siendo usados.</p>"},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/","title":"EJ 0","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#crea-un-nuevo-host-virtual-que-es-accedido-con-el-nombre-wwwmapeocom-cuyo-documentroot-sea-srvmapeo","title":"Crea un nuevo host virtual que es accedido con el nombre www.mapeo.com, cuyo DocumentRoot sea /srv/mapeo","text":"<p>En <code>/etc/hosts</code> del cliente... <pre><code>##########################################\n# EJ4 Mapeo URL resolutions\n##########################################\n172.22.5.252    www.mapeo.com\n##########################################\n</code></pre></p> <p>En <code>/etc/apache2/sites-available/mapeo.conf</code>... <pre><code>&lt;VirtualHost *:80&gt;\n\n        ServerName www.mapeo.com\n        DocumentRoot /srv/mapeo\n\n        &lt;Directory /srv/&gt;\n            Options Indexes FollowSymLinks\n            AllowOverride None\n            Require all granted\n        &lt;/Directory&gt;\n\n        # ErrorLog ${APACHE_LOG_DIR}/error.log\n        # CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Creamos el document root <pre><code>sudo mkdir /srv/mapeo\n</code></pre></p> <p>Habilitamos el site para que est\u00e9 disponible <pre><code>sudo a2ensite mapeo.conf\n</code></pre></p> <p>Reiniciamos Apache <pre><code>sudo systemctl reload apache2\n</code></pre></p> <p>Creamos una p\u00e1gina de test para comprobar que funcione </p>"},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#ej-1","title":"EJ 1","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#cuando-se-entre-a-la-direccion-wwwmapeocom-se-redireccionara-automaticamente-a-wwwmapeocomprincipal-donde-se-mostrara-el-mensaje-de-bienvenida","title":"Cuando se entre a la direcci\u00f3n www.mapeo.com se redireccionar\u00e1 autom\u00e1ticamente a www.mapeo.com/principal, donde se mostrar\u00e1 el mensaje de bienvenida.","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#ej-2","title":"EJ 2","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#en-el-directorio-principal-no-se-permite-ver-la-lista-de-los-ficheros-no-se-permite-que-se-siga-los-enlaces-simbolicos-y-no-se-permite-negociacion-de-contenido-muestra-al-profesor-el-funcionamiento-que-configuracion-tienes-que-poner","title":"En el directorio principal no se permite ver la lista de los ficheros, no se permite que se siga los enlaces simb\u00f3licos y no se permite negociaci\u00f3n de contenido. Muestra al profesor el funcionamiento. \u00bfQu\u00e9 configuraci\u00f3n tienes que poner?","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#ej-3","title":"EJ 3","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#si-accedes-a-la-pagina-wwwmapeocomprincipaldocumentos-se-visualizaran-los-documentos-que-hay-en-homeusuariodoc-por-lo-tanto-se-permitira-el-listado-de-fichero-y-el-seguimiento-de-enlaces-simbolicos-siempre-que-el-propietario-del-enlace-y-del-fichero-al-que-apunta-sean-el-mismo-usuario-explica-bien-y-pon-una-prueba-de-funcionamiento-donde-se-vea-bien-el-seguimiento-de-los-enlaces-simbolicos","title":"Si accedes a la p\u00e1gina www.mapeo.com/principal/documentos se visualizar\u00e1n los documentos que hay en /home/usuario/doc. Por lo tanto se permitir\u00e1 el listado de fichero y el seguimiento de enlaces simb\u00f3licos siempre que el propietario del enlace y del fichero al que apunta sean el mismo usuario. Explica bien y pon una prueba de funcionamiento donde se vea bien el seguimiento de los enlaces simb\u00f3licos.","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#ej-4","title":"EJ 4","text":""},{"location":"2asir20-21/mapeo-urls-sistema-ficheros/#en-todo-el-host-virtual-se-debe-redefinir-los-mensajes-de-error-de-objeto-no-encontrado-y-no-permitido-para-el-ello-se-crearan-dos-ficheros-html-dentro-del-directorio-error-entrega-las-modificaciones-necesarias-en-la-configuracion-y-una-comprobacion-del-buen-funcionamiento","title":"En todo el host virtual se debe redefinir los mensajes de error de objeto no encontrado y no permitido. Para el ello se crearan dos ficheros html dentro del directorio error. Entrega las modificaciones necesarias en la configuraci\u00f3n y una comprobaci\u00f3n del buen funcionamiento.","text":""},{"location":"2asir20-21/p3-integridad-firmas-autenticacion/","title":"Tarea 1: Firmas electr\u00f3nicas","text":""},{"location":"2asir20-21/p3-integridad-firmas-autenticacion/#1-manda-un-documento-y-la-firma-electronica-del-mismo-a-un-companero-verifica-la-firma-que-tu-has-recibido","title":"1. Manda un documento y la firma electr\u00f3nica del mismo a un compa\u00f1ero. Verifica la firma que t\u00fa has recibido.","text":"<p>Este es mi documento <pre><code>-rw-r--r-- 1 vagrant vagrant   14 Oct 28 12:09 file.txt\n</code></pre></p> <p>Genero la firma para \u00e9l <pre><code>gpg --output file.txt.sig --detach-sig file.txt\n</code></pre></p> <p>Y \u00e9sta es la firma resultante <pre><code>-rw-r--r-- 1 vagrant vagrant  438 Oct 28 12:17 file.txt.sig\n</code></pre></p> <p>Fichero y firma, se los mando a Calder\u00f3n.</p> <p>El fichero y firma que Calder\u00f3n me manda a m\u00ed, son los siguientes</p> <pre><code>-rw-r--r-- 1 vagrant vagrant  438 Oct 28 12:41 DocumentoImportanteParaAdrian.sig\n-rw-r--r-- 1 vagrant vagrant   31 Oct 28 12:41 DocumentoImportanteParaAdrian.txt\n</code></pre> <p>Verifico esa firma espec\u00edfica de ese fichero con</p> <pre><code>gpg --verify DocumentoImportanteParaAdrian.sig DocumentoImportanteParaAdrian.txt\n</code></pre> <p>Importante el orden de nombres de ficheros en el comando anterior. Primero debemos escribir la <code>detached signature</code> y segundo, el fichero original del que se gener\u00f3 esa firma.   </p> <pre><code>gpg: Signature made Tue 27 Oct 2020 11:12:50 AM GMT\ngpg:                using RSA key DCFB091C5495684E59BC061EA52A681834F0E596\ngpg: Good signature from \"Jos\u00e9 Miguel Calder\u00f3n Frutos &lt;josemiguelcalderonfrutos@gamil.com&gt;\" [unknown]\ngpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\nPrimary key fingerprint: DCFB 091C 5495 684E 59BC  061E A52A 6818 34F0 E596\n</code></pre> <p>Para que este proceso haya funcionado, tengo que haber tenido primero la clave p\u00fablica de Calder\u00f3n asociada a esa firma en mi anillo de claves.</p> <p>As\u00ed, se podr\u00e1 completar este proceso de desencriptaci\u00f3n del hash del fichero original (a eso es a lo que llamamos firma, al hash de un fichero cifrado con una clave privada).</p>"},{"location":"2asir20-21/p3-integridad-firmas-autenticacion/#2-que-significa-el-mensaje-que-aparece-en-el-momento-de-verificar-la-firma","title":"2. \u00bfQu\u00e9 significa el mensaje que aparece en el momento de verificar la firma?","text":"<pre><code>gpg: Firma correcta de \"Pepe D &lt;josedom24@gmail.com&gt;\" [desconocido]\ngpg: ATENCI\u00d3N: \u00a1Esta clave no est\u00e1 certificada por una firma de confianza!\ngpg:          No hay indicios de que la firma pertenezca al propietario.\nHuellas dactilares de la clave primaria: E8DD 5DA9 3B88 F08A DA1D  26BF 5141 3DDB 0C99 55FC\n</code></pre>"},{"location":"2asir20-21/p3-integridad-firmas-autenticacion/#tarea-2-correo-seguro-con-evolutionthunderbird","title":"Tarea 2: Correo seguro con evolution/thunderbird","text":""},{"location":"2asir20-21/p3-integridad-firmas-autenticacion/#tarea-3-integridad-de-ficheros","title":"Tarea 3: Integridad de ficheros","text":""},{"location":"2asir20-21/p3-integridad-firmas-autenticacion/#tarea-4-integridad-y-autenticidad-apt-secure","title":"Tarea 4: Integridad y autenticidad (apt secure)","text":""},{"location":"2asir20-21/p3-integridad-firmas-autenticacion/#tarea-5-autentificacion-ejemplo-ssh","title":"Tarea 5: Autentificaci\u00f3n: ejemplo SSH","text":""},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/","title":"Tarea 1: Generaci\u00f3n de claves","text":""},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#1-genera-un-par-de-claves-publica-y-privada-en-que-directorio-se-guardan-las-claves-de-un-usuario","title":"1. Genera un par de claves (p\u00fablica y privada). \u00bfEn que directorio se guardan las claves de un usuario?","text":"<p><pre><code>gpg --gen-key\n</code></pre> <pre><code>gpg (GnuPG) 2.2.12; Copyright (C) 2018 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\ngpg: directory '/home/vagrant/.gnupg' created\ngpg: keybox '/home/vagrant/.gnupg/pubring.kbx' created\nNote: Use \"gpg --full-generate-key\" for a full featured key generation dialog.\n\nGnuPG needs to construct a user ID to identify your key.\n\nReal name: Adri\u00e1n Jaramillo Rodr\u00edguez\nEmail address: adristudy@gmail.com\nYou are using the 'utf-8' character set.\nYou selected this USER-ID:\n    \"Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\"\n\nChange (N)ame, (E)mail, or (O)kay/(Q)uit? o\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\ngpg: /home/vagrant/.gnupg/trustdb.gpg: trustdb created\ngpg: key 7E0C48CBBC17F36F marked as ultimately trusted\ngpg: directory '/home/vagrant/.gnupg/openpgp-revocs.d' created\ngpg: revocation certificate stored as '/home/vagrant/.gnupg/openpgp-revocs.d/C34C081A07CA71291F82BFD67E0C48CBBC17F36F.rev'\npublic and secret key created and signed.\n\npub   rsa3072 2020-10-08 [SC] [expires: 2022-10-08]\n      C34C081A07CA71291F82BFD67E0C48CBBC17F36F\nuid                      Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2020-10-08 [E] [expires: 2022-10-08]\n</code></pre></p> <p>decir en qu\u00e9 directorio se guardan las claves</p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#tarea-2-importar-exportar-clave-publica","title":"Tarea 2: Importar / exportar clave p\u00fablica","text":""},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#1-exporta-tu-clave-publica-en-formato-ascii-y-guardalo-en-un-archivo-nombre_apellidoasc-y-envialo-al-companero-con-el-que-vas-a-hacer-esta-practica","title":"1. Exporta tu clave p\u00fablica en formato ASCII y guardalo en un archivo nombre_apellido.asc y env\u00edalo al compa\u00f1ero con el que vas a hacer esta pr\u00e1ctica.","text":"<pre><code>gpg --output adrian_jaramillo.asc --armor --export adristudy@gmail.com\n</code></pre>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#2-importa-las-claves-publicas-recibidas-de-vuestro-companero","title":"2. Importa las claves p\u00fablicas recibidas de vuestro compa\u00f1ero","text":"<pre><code>gpg --import jose_calderon.asc\n</code></pre> <pre><code>gpg: key A52A681834F0E596: public key \"Jos\u00e9 Miguel Calder\u00f3n Frutos &lt;josemiguelcalderonfrutos@gamil.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#3-comprueba-que-las-claves-se-han-incluido-correctamente-en-vuestro-keyring","title":"3. Comprueba que las claves se han incluido correctamente en vuestro keyring.","text":"<pre><code>gpg --list-public-keys \n</code></pre> <pre><code>/home/vagrant/.gnupg/pubring.kbx\n--------------------------------\npub   rsa3072 2020-10-08 [SC] [expires: 2022-10-08]\n      C34C081A07CA71291F82BFD67E0C48CBBC17F36F\nuid           [ultimate] Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2020-10-08 [E] [expires: 2022-10-08]\n\npub   rsa3072 2020-10-07 [SC] [expires: 2020-11-07]\n      DCFB091C5495684E59BC061EA52A681834F0E596\nuid           [ unknown] Jos\u00e9 Miguel Calder\u00f3n Frutos &lt;josemiguelcalderonfrutos@gamil.com&gt;\nsub   rsa3072 2020-10-07 [E] [expires: 2022-10-07]\n</code></pre>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#tarea-3-cifrado-asimetrico-con-claves-publicas","title":"Tarea 3: Cifrado asim\u00e9trico con claves p\u00fablicas","text":""},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#1-cifraremos-un-archivo-cualquiera-y-lo-remitiremos-por-email-a-uno-de-nuestros-companeros-que-nos-proporciono-su-clave-publica","title":"1. Cifraremos un archivo cualquiera y lo remitiremos por email a uno de nuestros compa\u00f1eros que nos proporcion\u00f3 su clave p\u00fablica.","text":"<pre><code>gpg -e -r josemiguelcalderonfrutos@gamil.com para_jose_asimetrico.txt\n</code></pre> <p>Genera <pre><code>-rw-r--r-- 1 vagrant vagrant  509 Oct 18 18:16 para_jose_asimetrico.txt.gpg\n</code></pre></p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#2-nuestro-companero-a-su-vez-nos-remitira-un-archivo-cifrado-para-que-nosotros-lo-descifremos","title":"2. Nuestro compa\u00f1ero, a su vez, nos remitir\u00e1 un archivo cifrado para que nosotros lo descifremos.","text":"<p>El fichero que me ha pasado Jose es... <pre><code>-rw-r--r-- 1 vagrant vagrant  477 Oct 18 18:19 Pruebas.gpg\n</code></pre></p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#3-tanto-nosotros-como-nuestro-companero-comprobaremos-que-hemos-podido-descifrar-los-mensajes-recibidos-respectivamente","title":"3. Tanto nosotros como nuestro compa\u00f1ero comprobaremos que hemos podido descifrar los mensajes recibidos respectivamente.","text":"<pre><code>gpg --decrypt Pruebas.gpg &gt; Pruebas.txt\n</code></pre> <p>Nos la clave p\u00fablica con la que se cifr\u00f3 el fichero. Es la nuestra, claramente, para que s\u00f3lo con nuestra clave privada este mensaje pudiera ser descifrado <pre><code>gpg: encrypted with 3072-bit RSA key, ID 6C17AF823AD42CC6, created 2020-10-08\n      \"Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\"\n</code></pre></p> <p>El contenido del fichero es... <pre><code>vagrant@practica-gpg-openssl-asimetrico:~$ cat Pruebas.txt \nHola adri\n</code></pre></p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#tarea-4-exportar-clave-a-un-servidor-publico-de-claves-pgp","title":"Tarea 4: Exportar clave a un servidor p\u00fablico de claves PGP","text":""},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#1-genera-la-clave-de-revocacion-de-tu-clave-publica-para-utilizarla-en-caso-de-que-haya-problemas","title":"1. Genera la clave de revocaci\u00f3n de tu clave p\u00fablica para utilizarla en caso de que haya problemas.","text":""},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#2-exporta-tu-clave-publica-al-servidor-pgpredirises","title":"2. Exporta tu clave p\u00fablica al servidor <code>pgp.rediris.es</code>","text":"<p><pre><code>gpg --keyserver pgp.rediris.es --send-keys C34C081A07CA71291F82BFD67E0C48CBBC17F36F\n</code></pre> <pre><code>gpg: sending key 7E0C48CBBC17F36F to hkp://pgp.rediris.es\n</code></pre></p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#3-borra-la-clave-publica-de-alguno-de-tus-companeros-de-clase-e-importala-ahora-del-servidor-publico-de-rediris","title":"3. Borra la clave p\u00fablica de alguno de tus compa\u00f1eros de clase e imp\u00f3rtala ahora del servidor p\u00fablico de rediris.","text":"<pre><code>gpg --delete-key josemiguelcalderonfrutos@gamil.com\n</code></pre> <pre><code>gpg (GnuPG) 2.2.12; Copyright (C) 2018 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\npub  rsa3072/A52A681834F0E596 2020-10-07 Jos\u00e9 Miguel Calder\u00f3n Frutos &lt;josemiguelcalderonfrutos@gamil.com&gt;\n\nDelete this key from the keyring? (y/N) y\n</code></pre> <p>Importamos la clave <pre><code>gpg --keyserver pgp.rediris.es --recv-keys DCFB091C5495684E59BC061EA52A681834F0E596\n</code></pre> <pre><code>gpg: key A52A681834F0E596: public key \"Jos\u00e9 Miguel Calder\u00f3n Frutos &lt;josemiguelcalderonfrutos@gamil.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre></p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#tarea-5-cifrado-asimetrico-con-openssl","title":"Tarea 5: Cifrado asim\u00e9trico con openssl","text":""},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#1-genera-un-par-de-claves-publica-y-privada","title":"1. Genera un par de claves (p\u00fablica y privada)","text":"<pre><code>openssl genrsa -des3 -out keypair.pem 2048\n</code></pre> <p>Contrase\u00f1a: hola</p> <p>Aqu\u00ed lo tenemos generado <pre><code>-rw------- 1 vagrant vagrant 1751 Oct 18 18:45 keypair.pem\n</code></pre></p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#2-envia-tu-clave-publica-a-un-companero","title":"2. Env\u00eda tu clave p\u00fablica a un compa\u00f1ero","text":"<p>Exportamos del fichero anterior, nuestra clave p\u00fablica <pre><code>openssl rsa -in keypair.pem -outform PEM -pubout -out public_adri.pem\n</code></pre></p> <pre><code>-rw-r--r-- 1 vagrant vagrant  451 Oct 18 18:52 public_adri.pem\n</code></pre> <p>Esa clave, la env\u00edo a Jose</p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#3-utilizando-la-clave-publica-cifra-un-fichero-de-texto-y-envialo-a-tu-companero","title":"3. Utilizando la clave p\u00fablica cifra un fichero de texto y env\u00edalo a tu compa\u00f1ero","text":"<pre><code>openssl rsautl -encrypt -in para_jose_asimetrico_openssl.txt -out para_jose_asimetrico_openssl.txt.enc -inkey public_jose.pem -pubin\n</code></pre> <p>Fichero generado... <pre><code>-rw-r--r-- 1 vagrant vagrant  256 Oct 18 18:59 para_jose_asimetrico_openssl.txt.enc\n</code></pre></p> <p>Se lo env\u00edo</p>"},{"location":"2asir20-21/practica-cifrado-asimetrico-gpg-openssl/#4-tu-companero-te-ha-mandado-un-fichero-cifrado-muestra-el-proceso-para-el-descifrado","title":"4. Tu compa\u00f1ero te ha mandado un fichero cifrado, muestra el proceso para el descifrado","text":"<pre><code>openssl rsautl -decrypt -inkey keypair.pem -in Pruba.enc -out Pruba.txt\n</code></pre> <pre><code>vagrant@practica-gpg-openssl-asimetrico:~$ cat Pruba.txt \nTonto el que lo lea\n</code></pre>"},{"location":"2asir20-21/practica-infantil-plsql/","title":"Ejercicio 1","text":"<p>Haz una funci\u00f3n llamada DevolverCodDept que reciba el nombre de un departamento y devuelva su c\u00f3digo.</p> <pre><code>CREATE OR REPLACE FUNCTION DevolverCodDept\n( nombre_dept IN varchar2 )\nRETURN number\nIS  v_cod_dept number;  BEGIN  SELECT deptno into v_cod_dept   FROM dept WHERE dname = nombre_dept;\nRETURN v_cod_dept;\nEND;\n/\n</code></pre> <p>Llamada a la funci\u00f3n:</p> <p>Importante <code>set serveroutput on</code> de antemano para que la consola muestre los resultados por pantalla)</p> <pre><code>BEGIN\nDBMS_OUTPUT.PUT_LINE( 'El c\u00f3digo es: ' || DevolverCodDept('RESEARCH') );\nEND;\n/\n</code></pre> <p>En el par\u00e1metro de entrada de la llamada a la funci\u00f3n, cambiar el nombre del departamento seg\u00fan el c\u00f3digo de departamento que queramos averiguar.</p> <p>Resultado:</p> <pre><code>El c\u00f3digo es: 20\n\nProcedimiento PL/SQL terminado correctamente.\n</code></pre>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-2","title":"Ejercicio 2","text":"<p>Realiza un procedimiento llamado HallarNumEmp que recibiendo un nombre de departamento, muestre en pantalla el n\u00famero de empleados de dicho departamento. Puedes utilizar la funci\u00f3n creada en el ejercicio 1.</p> <p>Si el departamento no tiene empleados deber\u00e1 mostrar un mensaje informando de ello. Si el departamento no existe se tratar\u00e1 la excepci\u00f3n correspondiente.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-3","title":"Ejercicio 3","text":"<p>Realiza una funci\u00f3n llamada CalcularCosteSalarial que reciba un nombre de departamento y devuelva la suma de los salarios y comisiones de los empleados de dicho departamento. Trata las excepciones que consideres necesarias.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-4","title":"Ejercicio 4","text":"<p>Realiza un procedimiento MostrarCostesSalariales que muestre los nombres de todos los departamentos y el coste salarial de cada uno de ellos. Puedes usar la funci\u00f3n del ejercicio 3.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-5","title":"Ejercicio 5","text":"<p>Realiza un procedimiento MostrarAbreviaturas que muestre las tres primeras letras del nombre de cada empleado.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-6","title":"Ejercicio 6","text":"<p>Realiza un procedimiento MostrarMasAntiguos que muestre el nombre del empleado m\u00e1s antiguo de cada departamento junto con el nombre del departamento. Trata las excepciones que consideres necesarias.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-7","title":"Ejercicio 7","text":"<p>Realiza un procedimiento MostrarJefes que reciba el nombre de un departamento y muestre los nombres de los empleados de ese departamento que son jefes de otros empleados.Trata las excepciones que consideres necesarias.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-8","title":"Ejercicio 8","text":"<p>Realiza un procedimiento MostrarMejoresVendedores que muestre los nombres de los dos vendedores con m\u00e1s comisiones. Trata las excepciones que consideres necesarias.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-9","title":"Ejercicio 9","text":"<p>Realiza un procedimiento MostrarsodaelpmE que reciba el nombre de un departamento al rev\u00e9s y muestre los nombres de los empleados de ese departamento. Trata las excepciones que consideres necesarias.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-10","title":"Ejercicio 10","text":"<p>Realiza un procedimiento RecortarSueldos que recorte el sueldo un 20% a los empleados cuyo nombre empiece por la letra que recibe como par\u00e1metro.Trata las excepciones que consideres necesarias.</p>"},{"location":"2asir20-21/practica-infantil-plsql/#ejercicio-11","title":"Ejercicio 11","text":"<p>Realiza un procedimiento BorrarBecarios que borre a los dos empleados m\u00e1s nuevos de cada departamento. Trata las excepciones que consideres necesarias.</p>"},{"location":"2asir20-21/practicas-ud1-seg/","title":"Pr\u00e1ctica 2: rclone - Gestionando nuestro almacenamiento en la nube","text":""},{"location":"2asir20-21/practicas-ud1-seg/#tarea-1-instala-rclone-en-tu-equipo","title":"Tarea 1: Instala rclone en tu equipo","text":"<p>Seg\u00fan la documentaci\u00f3n oficial de instalaci\u00f3n de este programa, existen varias formas de hacerlo en Linux. En mi caso, elijo la instalaci\u00f3n a partir de script.</p>"},{"location":"2asir20-21/practicas-ud1-seg/#paso-1","title":"PASO 1","text":"<p>Ejecutamos el script de instalaci\u00f3n:</p> <p><code>curl https://rclone.org/install.sh | sudo bash</code></p> <p>Cuando termina, podemos \"saber\" que se ha instalado correctamente ya que nos aparece el siguiente mensaje:</p> <pre><code>rclone v1.53.1 has successfully installed.\nNow run \"rclone config\" for setup. Check https://rclone.org/docs/ for more details.\n</code></pre>"},{"location":"2asir20-21/practicas-ud1-seg/#tarea-2-configura-2-proveedores-cloud-en-rclone-elijo-box-y-opendrive","title":"Tarea 2: Configura 2 proveedores cloud en rclone (elijo box y opendrive)","text":""},{"location":"2asir20-21/practicas-ud1-seg/#practica-3-integridad-de-ficheros","title":"Pr\u00e1ctica 3: Integridad de ficheros","text":""},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/","title":"Enunciado","text":"<p>Implementa un sistema de instalaci\u00f3n con PXE/TFTP que realice una instalaci\u00f3n completa de un sistema Debian Buster de forma totalmente desatendida, pas\u00e1ndole todos los par\u00e1metros necesarios por \"preseeding\"</p>"},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/#planteamientoorganizacion","title":"Planteamiento/Organizaci\u00f3n","text":"<p>1 VMs en red interna Vagrant</p> <p>1 SERVER (imagen debian buster + fichero preseeding + server PXE + server DHCP + TFTP server)</p> <p>2 CLIENT (booteo con PXE, pedir\u00e1 una IP al DHCP, se instalar\u00e1 el sistema localmente a trav\u00e9s del servidor) (M\u00c1QUINA VAC\u00cdA VIRTUALBOX PARA QUE NO INSTALE NADA EN EL DISCO DURO)</p> <p>(probar a poner por PXE el cliente en modo bridge, y que acceda al PXE del gonzalo nazareno) (no se ha podido porque no hab\u00eda im\u00e1genes booteables, no funciona el PXE de aqu\u00ed)</p> <p>https://wiki.debian.org/PXEBootInstall</p>"},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/#desarrollo","title":"Desarrollo","text":""},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/#1-configuracion-del-servidor-dhcp-servidor","title":"1. Configuraci\u00f3n del servidor DHCP (servidor)","text":"<pre><code>sudo apt install isc-dhcp-server\n</code></pre> <p>En <code>/etc/default/isc-dhcp-server</code> <pre><code>INTERFACESv4=\"eth1\"\n</code></pre> Decimos por qu\u00e9 interfaces servimos peticiones DHCP</p> <p>En <code>/etc/dhcp/dhcpd.conf</code> (propia configuraci\u00f3n de DHCP) <pre><code>default-lease-time 600;\nmax-lease-time 7200;\n\nallow booting;\nallow bootp;\n\n# The next paragraph needs to be modified to fit your case\nsubnet 192.168.0.0 netmask 255.255.255.0 {\n  range 192.168.0.3 192.168.0.10;\n  option broadcast-address 192.168.0.255;\n# the gateway address which can be different\n# (access to the internet for instance)\n#  option routers 192.168.1.1;\n# indicate the dns you want to use\n#  option domain-name-servers 192.168.1.3;\n}\n\ngroup {\n  next-server 192.168.0.2;\n  host tftpclient {\n# tftp client hardware address\n  hardware ethernet  08:00:27:3a:73:29;\n  filename \"pxelinux.0\";\n }\n}\n</code></pre></p> <p>Esta configuraci\u00f3n s\u00f3lo servir\u00eda para el arranque por PXE de una m\u00e1quina concreta, porque si se conectase otra cualquiera no podr\u00eda. </p> <p>Reiniciar servicio para que tenga en cuenta la configuraci\u00f3n <pre><code>sudo systemctl restart isc-dhcp-server\n</code></pre> Comprobar que se est\u00e1 ejecutando <pre><code>sudo systemctl status isc-dhcp-server\n</code></pre></p>"},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/#2-configuracion-del-servidor-tftp-servidor","title":"2. Configuraci\u00f3n del servidor TFTP (servidor)","text":"<pre><code>sudo apt install tftpd-hpa\n</code></pre> <p>https://www.debian.org/releases/jessie/amd64/ch04s05.html.en Importante enlace para que funcione el booteo desde el cliente, por la configuraci\u00f3n del DHCP b\u00e1sicamente</p>"},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/#3-proporcionar-la-imagen-de-instalacion-servidor","title":"3. Proporcionar la imagen de instalaci\u00f3n (servidor)","text":"<p>Nos posicionamos en el directorio de tftp <pre><code>cd /srv/tftp/\n</code></pre></p> <p>Aqu\u00ed, obtenemos la imagen de instalaci\u00f3n por red <pre><code>sudo wget http://ftp.nl.debian.org/debian/dists/buster/main/installer-amd64/current/images/netboot/netboot.tar.gz\n</code></pre></p> <p>Descomprimimos y borramos el comprimido original para mayor limpieza <pre><code>sudo tar -xzf netboot.tar.gz\nsudo rm netboot.tar.gz\n</code></pre></p> <p>Tenemos la siguiente estructura <pre><code>drwxrwxr-x 3 root root 4096 Oct 16 09:01 .\ndrwxr-xr-x 3 root root 4096 Oct 16 08:30 ..\ndrwxrwxr-x 3 root root 4096 Sep 20 23:11 debian-installer\nlrwxrwxrwx 1 root root   47 Sep 20 23:11 ldlinux.c32 -&gt; debian-installer/amd64/boot-screens/ldlinux.c32\nlrwxrwxrwx 1 root root   33 Sep 20 23:11 pxelinux.0 -&gt; debian-installer/amd64/pxelinux.0\nlrwxrwxrwx 1 root root   35 Sep 20 23:11 pxelinux.cfg -&gt; debian-installer/amd64/pxelinux.cfg\n-rw-rw-r-- 1 root root   63 Sep 20 23:11 version.info\n</code></pre></p> <p>Reiniciamos el servicio <pre><code>sudo systemctl restart tftpd-hpa.service\n</code></pre></p>"},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/#4-comprobacion-de-que-el-cliente-arranca-correctamente-el-instalador-por-red","title":"4. Comprobaci\u00f3n de que el cliente arranca correctamente el instalador por red","text":""},{"location":"2asir20-21/tarea-creacion-sistema-automatizado-instalacion/#5-preseeding-instalacion-automatica","title":"5. Preseeding, instalaci\u00f3n autom\u00e1tica","text":"<p>Fichero <code>preseed.cfg</code> en <code>/srv/tftp/</code> <pre><code># Services to use:\n# Choices: security updates (from security.debian.org), release updates, backported software\napt-setup-udeb  apt-setup/services-select   multiselect security, updates\n# for internal use; can be preseeded\nd-i preseed/run/checksum    string  \n# location\n# Choices: Auckland, Chatham Islands\ntzsetup-udeb    tzsetup/country/NZ  select  Pacific/Auckland\n# Allow login as root?\nuser-setup-udeb passwd/root-login   boolean false\n# Device for boot loader installation:\ngrub-installer  grub-installer/bootdev  string  \n# for internal use; can be preseeded\npkgsel  pkgsel/updatedb boolean true\n# for internal use only\nbootstrap-base  base-installer/kernel/linux/initrd-2.6  boolean true\n# Bad archive mirror\nd-i mirror/bad  error   \n# for internal use only\nd-i debconf/language    string  en\n# This is an overview of your currently configured partitions and mount points. Select a partition to modify its settings (file system, mount point, etc.), a free space to create partitions, or a device to initialize its partition table.\n# Choices: Guided partitioning, Configure software RAID, Configure the Logical Volume Manager, Configure encrypted volumes, Configure iSCSI volumes, , SCSI3 (0\\,0\\,0) (sda) - 8.6 GB ATA VBOX HARDDISK, &gt;   ${!TAB}${!ALIGN=RIGHT}#1${!TAB}primary${!TAB}${!ALIGN=RIGHT}8.1 GB${!TAB}${!TAB}f${!TAB}ext4${!TAB}${!TAB}/${!TAB}, &gt;   ${!TAB}${!ALIGN=RIGHT}#5${!TAB}logical${!TAB}${!ALIGN=RIGHT}534.8 MB${!TAB}${!TAB}f${!TAB}swap${!TAB}${!TAB}swap${!TAB}, , Undo changes to partitions, Finish partitioning and write changes to disk\npartman-base    partman/choose_partition    select  90finish__________finish\n# \n# Choices: American Samoa, Australia, Cook Islands, Fiji, French Polynesia, Guam, Kiribati, Marshall Islands, Micronesia\\, Federated States of, Nauru, New Caledonia, New Zealand, Niue, Norfolk Island, Northern Mariana Islands, Palau, Papua New Guinea, Pitcairn, Samoa, Solomon Islands, Tokelau, Tonga, Tuvalu, United States Minor Outlying Islands, Vanuatu, Wallis and Futuna\nd-i localechooser/countrylist/Oceania   select  \n# Full name for the new user:\nuser-setup-udeb passwd/user-fullname    string  pxe-client-user\n# for internal use; can be preseeded\nd-i debian-installer/allow_unauthenticated_ssl  boolean false\n# for internal use\nd-i keyboard-configuration/variantcode  string  \n# Tool to use to generate boot initrd:\n# Choices: \nbootstrap-base  base-installer/initramfs/generator  select  \n# Encryption configuration failure\npartman-crypto  partman-crypto/crypto_root_needs_boot   error   \n#  is too big\npartman-auto-lvm    partman-auto-lvm/big_guided_size    error   \n# Unreachable gateway\nd-i netcfg/gateway_unreachable  error   \n# for internal use; can be preseeded\napt-setup-udeb  apt-setup/multiarch string  \n# location\n# Choices: Godthab, Danmarkshavn, Scoresbysund, Thule\ntzsetup-udeb    tzsetup/country/GL  select  America/Godthab\n# Debootstrap Error\nbootstrap-base  base-installer/debootstrap/error/nogetrel   error   \n# Device for boot loader installation:\n# Choices: Enter device manually, /dev/sda  (ata-VBOX_HARDDISK_VBaeba5a60-2d9f1466)\ngrub-installer  grub-installer/choose_bootdev   select  /dev/sda\n# Failed to mount the floppy\nd-i save-logs/floppy_mount_failed   error   \n# Country, territory or area:\n# Choices: Albania, Andorra, Armenia, Austria, Azerbaijan, Belarus, Belgium, Bosnia and Herzegovina, Bulgaria, Croatia, Cyprus, Czechia, Denmark, Estonia, Faroe Islands, Finland, France, Georgia, Germany, Gibraltar, Greece, Greenland, Guernsey, Holy See (Vatican City State), Hungary, Iceland, Ireland, Isle of Man, Italy, Jersey, Latvia, Liechtenstein, Lithuania, Luxembourg, Macedonia\\, Republic of, Malta, Moldova, Monaco, Montenegro, Netherlands, Norway, Poland, Portugal, Romania, Russian Federation, San Marino, Serbia, Slovakia, Slovenia, Spain, Svalbard and Jan Mayen, Sweden, Switzerland, Ukraine, United Kingdom, \u00c5land Islands\nd-i localechooser/countrylist/Europe    select  ES\n# \n# Choices: Spain, France, other\nd-i localechooser/shortlist/eu  select  \n# Cannot save logs\nd-i save-logs/bad_directory error   \n# for internal use; can be preseeded\nd-i netcfg/disable_autoconfig   boolean false\n# Entering low memory mode\nd-i lowmem/low  note    \n# Location of initial preconfiguration file:\nd-i preseed/url string  \n# city\n# Choices: Almaty, Qyzylorda, Aqtobe, Atyrau, Oral\ntzsetup-udeb    tzsetup/country/KZ  select  Asia/Almaty\n# Netmask:\nd-i netcfg/get_netmask  string  \n# Ignore questions with a priority less than:\n# Choices: critical, high, medium, low\nd-i debconf/priority    select  low\n# for internal use; can be preseeded\nbootstrap-base  base-installer/kernel/linux/extra-packages-2.6  string  \n# Volume group name already in use\npartman-lvm partman-lvm/vgcreate_nameused   error   \n# btrfs root file system not supported without separate /boot\npartman-btrfs   partman-btrfs/btrfs_root    error   \n# Empty password\nuser-setup-udeb user-setup/password-empty   error   \n# country code or \"manual\" (for internal use)\nd-i mirror/country  string  ES\n# Error while creating a new logical volume\npartman-lvm partman-lvm/lvcreate_error  error   \n# Current LVM configuration:\npartman-lvm partman-lvm/displayall  note    \n# for internal use only\nd-i debconf/showold boolean false\n# for internal use only\nuser-setup-udeb passwd/user-uid string  \n# Error\nd-i netcfg/error    error   \n# Use contrib software?\napt-mirror-setup    apt-setup/contrib   boolean false\n# Setting firmware variables for automatic boot\nnobootloader    nobootloader/confirmation_powerpc_pasemi    note    \n# No root file system\npartman-target  partman-target/no_root  error   \n# Install the GRUB boot loader to the Serial ATA RAID disk?\ngrub-installer  grub-installer/sataraid boolean true\n# zone\n# Choices: Eastern, Central, Mountain, Pacific, Alaska, Hawaii, Arizona, East Indiana, Samoa\ntzsetup-udeb    tzsetup/country/US  select  US/Eastern\n# Name of the volume group for the new system:\npartman-auto-lvm    partman-auto-lvm/new_vg_name    string  \n# Debootstrap warning\nbootstrap-base  base-installer/debootstrap/fallback-warning error   \n# Name server addresses:\nd-i netcfg/get_nameservers  string  \n# Translations temporarily not available\nd-i localechooser/translation/none-yet  note    \n# The partition starts from  and ends at .\npartman-base    partman/show_partition_chs  note    \n# \n# Choices: Aruba, Belgium, Netherlands, other\nd-i localechooser/shortlist/nl  select  \n# \n# Choices: \npartman-base    partman/exception_handler   select  \n# Debian archive mirror:\n# Choices: ftp.es.debian.org, ulises.hostalia.com, deb.debian.org, debian-archive.trafficmanager.net, softlibre.unizar.es, debian.redparra.com, debian.grn.cat, ftp.udc.es, ftp.cica.es, ftp.caliu.cat, debian.redimadrid.es, debian.uvigo.es, mirror.librelabucm.org\nd-i mirror/http/mirror  select  deb.debian.org\n# Password input error\ngrub-installer  grub-installer/password-mismatch    error   \n# Failed to mount /target/proc\nnobootloader    nobootloader/mounterr   error   \n# for internal use; can be preseeded\ngrub-installer  grub-installer/skip boolean false\n# No network interfaces detected\nd-i netcfg/no_interfaces    error   \n# Keep default keyboard layout ()?\nd-i keyboard-configuration/unsupported_layout   boolean true\n# \n# Choices: Finland, Sweden, other\nd-i localechooser/shortlist/sv  select  \n# Continue the installation in the selected language?\nd-i localechooser/translation/warn-light    boolean true\n# Unable to install the selected kernel\nbootstrap-base  base-installer/kernel/failed-install    error   \n# location\n# Choices: Tahiti (Society Islands), Marquesas Islands, Gambier Islands\ntzsetup-udeb    tzsetup/country/PF  select  Pacific/Tahiti\n# Amount of volume group to use for guided partitioning:\npartman-auto-lvm    partman-auto-lvm/guided_size    string  some number\n# for internal use; can be preseeded\npartman-iscsi   partman-iscsi/login/all_targets boolean false\n# Configuration of encrypted volumes failed\npartman-crypto  partman-crypto/commit_failed    error   \n# Choose an installation step:\n# Choices: Partition disks\nd-i debian-installer/missing-provide    select  Partition disks\n# Continue without a network mirror?\napt-mirror-setup    apt-setup/no_mirror boolean false\n# Network configuration method:\n# Choices: Retry network autoconfiguration, Retry network autoconfiguration with a DHCP hostname, Configure network manually, , Do not configure the network at this time\nd-i netcfg/dhcp_options select  Configure network manually\n# iSCSI targets on :\n# Choices: \npartman-iscsi   partman-iscsi/login/targets multiselect \n# btrfs file system not supported for /boot\npartman-btrfs   partman-btrfs/btrfs_boot    error   \n# No software RAID devices available\npartman-md  partman-md/delete_no_md error   \n# Failed to delete the software RAID device\npartman-md  partman-md/deletefailed error   \n# for internal use; can be preseeded\ndisk-detect disk-detect/multipath/enable    boolean false\n# Mount point for this partition:\n# Choices: /dos, /windows, Enter manually, Do not mount it\npartman-basicfilesystems    partman-basicfilesystems/fat_mountpoint select  \n# for internal use; can be preseeded\nd-i preseed/url/checksum    string  \n# Really delete the volume group?\npartman-lvm partman-lvm/vgdelete_confirm    boolean true\n# \n# Choices: Algeria, Angola, Benin, Botswana, Burkina Faso, Burundi, Cabo Verde, Cameroon, Central African Republic, Chad, Congo, Congo\\, The Democratic Republic of the, C\u00f4te d'Ivoire, Djibouti, Egypt, Equatorial Guinea, Eritrea, Ethiopia, Gabon, Gambia, Ghana, Guinea, Guinea-Bissau, Kenya, Lesotho, Liberia, Libya, Malawi, Mali, Mauritania, Morocco, Mozambique, Namibia, Niger, Nigeria, Rwanda, Sao Tome and Principe, Senegal, Sierra Leone, Somalia, South Africa, South Sudan, Sudan, Swaziland, Tanzania, Togo, Tunisia, Uganda, Western Sahara, Zambia, Zimbabwe\nd-i localechooser/countrylist/Africa    select  \n# Downloading a file failed:\n# Choices: Retry, Change mirror, Ignore\napt-mirror-setup    apt-setup/mirror/error  select  Retry\n# Debootstrap Error\nbootstrap-base  base-installer/debootstrap/error/unknownrelsig  error   \n# for internal use; can be preseeded\nd-i debian-installer/framebuffer    boolean false\n# \n# Choices: British Indian Ocean Territory, Christmas Island, Cocos (Keeling) Islands, Comoros, French Southern Territories, Heard Island and McDonald Islands, Madagascar, Maldives, Mauritius, Mayotte, R\u00e9union, Seychelles\nd-i localechooser/countrylist/Indian_Ocean  select  \n# No iSCSI targets discovered\npartman-iscsi   partman-iscsi/login/no_targets  error   \n# Debian archive mirror hostname:\nd-i mirror/https/hostname   string  mirror\n# for internal use; can be preseeded\npartman-auto    partman-auto/expert_recipe  string  \n# iSCSI configuration actions\n# Choices: Log into iSCSI targets, Finish\npartman-iscsi   partman-iscsi/mainmenu  select  \n# for internal use only\nd-i debconf/translations-dropped    boolean false\n# Continue the installation in the selected language?\nd-i localechooser/translation/warn-severe   boolean false\n# Cannot install kernel\nbootstrap-base  base-installer/kernel/no-kernels-found  error   \n# Invalid username\nuser-setup-udeb passwd/username-bad error   \n#  is too small\npartman-auto-lvm    partman-auto-lvm/small_guided_size  error   \n# No file system mounted on /target\nbase-installer  base-installer/no_target_mounted    error   \n# Name of the volume group for the new system:\npartman-auto-lvm    partman-auto-lvm/new_vg_name_exists string  \n# Non-existing physical volume\npartman-auto-lvm    partman-auto-lvm/no_such_pv error   \n# \n# Choices: China, India, other\nd-i localechooser/shortlist/bo  select  \n# for internal use; can be preseeded\ngrub-installer  grub-installer/make_active  boolean true\n# The size entered is too large\npartman-partitioning    partman-partitioning/big_new_size   error   \n# Layout of the RAID10 array:\npartman-md  partman-md/raid10layout string  n2\n# for internal use; can be preseeded\nd-i preseed/run string  \n# Debian archive mirror directory:\nd-i mirror/https/directory  string  /debian/\n# Failed to create a swap space\npartman-basicfilesystems    partman-basicfilesystems/create_swap_failed error   \n# Go back to the menu?\npartman-basicmethods    partman-basicmethods/method_only    boolean \n# Ethernet card not found\nd-i ethdetect/cannot_find   error   \n# zone\n# Choices: Moscow-01 - Kaliningrad, Moscow+00 - Moscow, Moscow+01 - Samara, Moscow+02 - Yekaterinburg, Moscow+03 - Omsk, Moscow+04 - Krasnoyarsk, Moscow+05 - Irkutsk, Moscow+06 - Yakutsk, Moscow+07 - Vladivostok, Moscow+08 - Magadan, Moscow+09 - Kamchatka\ntzsetup-udeb    tzsetup/country/RU  select  Europe/Moscow\n# for internal use only\nd-i mirror/codename string  buster\n# Volume group name:\npartman-lvm partman-lvm/vgcreate_name   string  \n# zone\n# Choices: Tarawa (Gilbert Islands), Enderbury (Phoenix Islands), Kiritimati (Line Islands)\ntzsetup-udeb    tzsetup/country/KI  select  Pacific/Tarawa\n# Go back to the menu and correct this problem?\npartman-ext3    partman-ext3/boot_not_ext2_or_ext3  boolean \n# Keyboard model:\n# Choices: \nd-i keyboard-configuration/model    select  \n# Load missing firmware from removable media?\nd-i hw-detect/load_firmware boolean true\n# Set the clock using NTP?\nclock-setup clock-setup/ntp boolean true\n# Invalid passphrase\nd-i netcfg/invalid_pass error   \n# Location for the new partition:\n# Choices: Beginning, End\npartman-partitioning    partman-partitioning/new_partition_place    select  \n# Do you want to resume partitioning?\npartman-target  partman-target/mount_failed boolean true\n# LILO installation failed. Continue anyway?\nlilo-installer  lilo-installer/apt-install-failed   boolean true\n# Do you want to return to the partitioning menu?\npartman-basicfilesystems    partman-basicfilesystems/no_swap    boolean true\n# No devices selected\npartman-crypto  partman-crypto/create/nosel error   \n# LILO installation target:\n# Choices: : software RAID array, Other choice (Advanced)\nlilo-installer  lilo-installer/bootdev_raid select  \n# Error while setting up RAID\npartman-auto-raid   partman-auto-raid/error error   \n# for internal use; can be preseeded\nd-i auto-install/defaultroot    string  d-i/buster/./preseed.cfg\n# Devices for the new volume group:\n# Choices: \npartman-lvm partman-lvm/vgcreate_parts  multiselect \n# Do you intend to use FireWire Ethernet?\nd-i ethdetect/use_firewire_ethernet boolean false\n# Base system installation error\nbootstrap-base  base-installer/debootstrap/error-exitcode   error   \n# LILO installation target:\nlilo-installer  lilo-installer/manual_bootdev   string  \n# Key to function as AltGr:\n# Choices: The default for the keyboard layout, No AltGr key, Right Alt (AltGr), Right Control, Right Logo key, Menu key, Left Alt, Left Logo key, Keypad Enter key, Both Logo keys, Both Alt keys\nd-i keyboard-configuration/altgr    select  The default for the keyboard layout\n# Web server started, but network not running\nd-i save-logs/no_network    note    \n# Debootstrap Error\nbootstrap-base  base-installer/debootstrap/fallback-error   error   \n# No boot loader installed\nnobootloader    nobootloader/confirmation_common    note    \n# Debootstrap Error\nbootstrap-base  base-installer/debootstrap/error/invalidrel error   \n# for internal use only\nd-i debian-installer/language   string  en\n# LILO configured to use a serial console\nlilo-installer  lilo-installer/serial-console   note    \n# Continue with partitioning?\npartman-partitioning    partman-partitioning/unknown_label  boolean true\n# \n# Choices: South Sudan, Jordan, United Arab Emirates, Bahrain, Algeria, Syrian Arab Republic, Saudi Arabia, Sudan, Iraq, Kuwait, Morocco, India, Yemen, Tunisia, Oman, Qatar, Lebanon, Libya, Egypt, other\nd-i localechooser/shortlist/ar  select  \n# Required programs missing\npartman-crypto  partman-crypto/tools_missing    note    \n# Unable to configure GRUB\ngrub-installer  grub-installer/multipath-error  error   \n# zone\n# Choices: Santiago, Easter Island\ntzsetup-udeb    tzsetup/country/CL  select  America/Santiago\n# for internal use; can be preseeded\nd-i preseed/include_command string  \n# for internal use; can be preseeded\nd-i debian-installer/theme  string  \n# Create new empty partition table on this device?\npartman-partitioning    partman-partitioning/confirm_new_label  boolean false\n# \n# Choices: Greece, Cyprus, other\nd-i localechooser/shortlist/el  select  \n# Partition table type:\n# Choices: atari, aix, amiga, bsd, dvh, gpt, mac, msdos, pc98, sun, loop\npartman-partitioning    partman-partitioning/choose_label   select  \n# for internal use\nd-i keyboard-configuration/store_defaults_in_debconf_db boolean true\n# Hostname:\nd-i netcfg/get_hostname string  pxe-client\n# for internal use; can be preseeded\nbootstrap-base  base-installer/kernel/linux/extra-packages  string  \n# No volume group found\npartman-lvm partman-lvm/lvcreate_nofreevg   error   \n# iSCSI target portal address:\npartman-iscsi   partman-iscsi/login/address string  \n# for internal use; can be preseeded\nd-i ethdetect/prompt_missing_firmware   boolean true\n# Volume group to extend:\n# Choices: \npartman-lvm partman-lvm/vgextend_names  select  \n# Proceed to install crypto components despite insufficient memory?\npartman-crypto  partman-crypto/install_udebs_low_mem    boolean \n# No volume group found\npartman-lvm partman-lvm/vgdelete_novg   error   \n# for internal use; can be preseeded\nd-i rescue/enable   boolean false\n# Type of encryption key for this partition:\n# Choices: \npartman-crypto  partman-crypto/keytype  select  \n# New partition size:\npartman-partitioning    partman-partitioning/new_size   string  some number\n# Software RAID device type:\n# Choices: RAID0, RAID1, RAID5, RAID6, RAID10\npartman-md  partman-md/createmain   select  \n# Active devices for the RAID0 array:\n# Choices: \npartman-md  partman-md/raid0devs    multiselect \n# Unusable free space\npartman-auto    partman-auto/unusable_space error   \n# Failed to download crypto components\npartman-crypto  partman-crypto/install_udebs_failure    error   \n# Error while extending volume group\npartman-lvm partman-lvm/vgextend_error  error   \n# Keep current partition layout and configure RAID?\npartman-md  partman-md/confirm_nochanges    boolean false\n# HTTP proxy information (blank for none):\nd-i mirror/http/proxy   string  \n# Install GRUB?\ngrub-installer  grub-installer/grub_not_mature_on_this_platform boolean false\n# Software RAID not available\npartman-md  partman-md/nomd error   \n# Erasing data on  failed\npartman-crypto  partman-crypto/plain_erase_failed   error   \n# iSCSI target username for :\npartman-iscsi   partman-iscsi/login/incoming_username   string  \n# No RAID partitions available\npartman-md  partman-md/noparts  error   \n# Select disk to partition:\n# Choices: SCSI3 (0\\,0\\,0) (sda) - 8.6 GB ATA VBOX HARDDISK\npartman-auto    partman-auto/select_disk    select  /var/lib/partman/devices/=dev=sda\n# Debian archive mirror hostname:\nd-i mirror/http/hostname    string  deb.debian.org\n# Separate file system not allowed here\npartman-target  partman-target/must_be_on_root  error   \n# for internal use; can be preseeded\npartman-auto-crypto partman-auto-crypto/erase_disks boolean true\n# Volume group to delete:\n# Choices: \npartman-lvm partman-lvm/vgdelete_names  select  \n# Really erase the data on ?\npartman-crypto  partman-crypto/plain_warn_erase boolean false\n# for internal use; can be preseeded\nd-i preseed/file    string  \n# HTTP proxy information (blank for none):\nd-i mirror/https/proxy  string  \n# Empty passphrase\npartman-crypto  partman-crypto/passphrase-empty error   \n# No volume group found\npartman-lvm partman-lvm/vgextend_novg   error   \n# Primary network interface:\n# Choices: enp0s3: Intel Corporation 82540EM Gigabit Ethernet Controller, enp0s8: Intel Corporation 82540EM Gigabit Ethernet Controller\nd-i netcfg/choose_interface select  enp0s8: Intel Corporation 82540EM Gigabit Ethernet Controller\n# Encryption configuration actions\n# Choices: Create encrypted volumes, Finish\npartman-crypto  partman-crypto/mainmenu select  \n# Mount options:\n# Choices: \npartman-basicfilesystems    partman-basicfilesystems/mountoptions   multiselect \n# zone\n# Choices: Newfoundland, Atlantic, Eastern, Central, East Saskatchewan, Saskatchewan, Mountain, Pacific\ntzsetup-udeb    tzsetup/country/CA  select  Canada/Eastern\n# Partitioning method:\n# Choices: \npartman-auto    partman-auto/automatically_partition    select  \n# Mount point for this partition:\npartman-basicfilesystems    partman-basicfilesystems/mountpoint_manual  string  \n# Logical volume size:\npartman-lvm partman-lvm/lvcreate_size   string  \n# \n# Choices: India, Sri Lanka, other\nd-i localechooser/shortlist/ta  select  \n# Keep current partition layout and configure encrypted volumes?\npartman-crypto  partman-crypto/confirm_nochanges    boolean false\n# Are you sure you want a bootable logical partition?\npartman-partitioning    partman-partitioning/bootable_logical   boolean false\n# Reserved username\nuser-setup-udeb passwd/username-reserved    error   \n# for internal use only\nd-i anna/retriever  string  net-retriever\n# Write the changes to disks and configure LVM?\nd-i partman-lvm/confirm_nooverwrite boolean false\n# \n# Choices: Russian Federation, Ukraine, other\nd-i localechooser/shortlist/ru  select  \n# Gateway:\nd-i netcfg/get_gateway  string  \n# The size entered is too small\npartman-partitioning    partman-partitioning/small_new_size error   \n# \nd-i debian-installer/shell-plugin   terminal    \n# The free space starts from  and ends at .\npartman-base    partman/show_free_chs   note    \n# Use non-free software?\napt-mirror-setup    apt-setup/non-free  boolean false\n# No physical volumes selected\npartman-lvm partman-lvm/vgextend_nosel  error   \n# Go back to the menu and correct this problem?\npartman-ext3    partman/boot_not_first_partition    boolean \n# Invalid ESSID\nd-i netcfg/invalid_essid    error   \n# Do you want to return to the partitioning menu?\npartman-ext3    partman-ext3/bad_alignment  boolean \n# \n# Choices: China, Singapore, Taiwan, Hong Kong, other\nd-i localechooser/shortlist/zh_TW   select  \n# Invalid network link detection waiting time\nd-i netcfg/bad_link_wait_timeout    error   \n# location\n# Choices: Lisbon, Madeira Islands, Azores\ntzsetup-udeb    tzsetup/country/PT  select  Europe/Lisbon\n# Invalid WEP key\nd-i netcfg/invalid_wep  error   \n# New partition size:\npartman-partitioning    partman-partitioning/new_partition_size string  some number\n# Write the changes to disks and configure LVM?\npartman-lvm partman-lvm/confirm boolean false\n# zone\n# Choices: North-West, Pacific, Sonora, Central, South-East\ntzsetup-udeb    tzsetup/country/MX  select  Mexico/General\n# Network autoconfiguration failed\nd-i netcfg/dhcp_failed  note    \n# for internal use; can be preseeded\nd-i netcfg/dhcpv6_timeout   string  15\n# Failed to process the preconfiguration file\nd-i preseed/load_error  error   \n# Write the changes to disk and configure encrypted volumes?\npartman-crypto  partman-crypto/confirm  boolean false\n# for internal use; can be preseeded\npkgsel  pkgsel/include  string  \n# Use Control+Alt+Backspace to terminate the X server?\nd-i keyboard-configuration/ctrl_alt_bksp    boolean false\n# \n# Choices: Serbia, Montenegro, other\nd-i localechooser/shortlist/sr  select  \n# The encryption key for  is now being created.\npartman-crypto  partman-crypto/entropy  entropy \n# Interactive shell\nd-i di-utils-shell/do-shell note    \n# Downloading local repository key failed:\n# Choices: Retry, Ignore\napt-setup-udeb  apt-setup/local/key-error   select  Retry\n# Debootstrap Error\nbootstrap-base  base-installer/no_codename  error   \n# Partition in use\npartman-base    partman-base/partlocked error   \n# Load missing drivers from removable media?\nd-i hw-detect/load_media    boolean false\n# Continue without a default route?\nd-i netcfg/no_default_route boolean false\n# Go back to the menu and correct errors?\npartman-basicfilesystems    partman-basicfilesystems/swap_check_failed  boolean \n# Spare devices for the RAID array:\n# Choices: \npartman-md  partman-md/raidsparedevs    multiselect \n# Auto-configure networking?\nd-i netcfg/use_autoconfig   boolean true\n# Language:\n# Choices: C${!TAB}-${!TAB}No localization, Basque${!TAB}-${!TAB}Euskara, Catalan${!TAB}-${!TAB}Catal\u00e0, Danish${!TAB}-${!TAB}Dansk, Dutch${!TAB}-${!TAB}Nederlands, English${!TAB}-${!TAB}English, Finnish${!TAB}-${!TAB}Suomi, French${!TAB}-${!TAB}Fran\u00e7ais, Galician${!TAB}-${!TAB}Galego, German${!TAB}-${!TAB}Deutsch, Icelandic${!TAB}-${!TAB}\u00cdslenska, Indonesian${!TAB}-${!TAB}Bahasa Indonesia, Irish${!TAB}-${!TAB}Gaeilge, Italian${!TAB}-${!TAB}Italiano, Northern Sami${!TAB}-${!TAB}S\u00e1megillii, Norwegian Bokmaal${!TAB}-${!TAB}Norsk bokm\u00e5l, Norwegian Nynorsk${!TAB}-${!TAB}Norsk nynorsk, Portuguese${!TAB}-${!TAB}Portugu\u00eas, Portuguese (Brazil)${!TAB}-${!TAB}Portugu\u00eas do Brasil, Spanish${!TAB}-${!TAB}Espa\u00f1ol, Swedish${!TAB}-${!TAB}Svenska, Tagalog${!TAB}-${!TAB}Tagalog\nd-i localechooser/languagelist  select  C\n# Key size for this partition:\n# Choices: \npartman-crypto  partman-crypto/keysize  select  \n# Force UEFI installation?\npartman-efi partman-efi/non_efi_system  boolean \n# for internal use\nbootstrap-base  base-installer/kernel/linux/initramfs-tools/driver-policy   string  most\n# Error while reducing volume group\npartman-lvm partman-lvm/vgreduce_error  error   \n# for internal use\nd-i keyboard-configuration/modelcode    string  pc105\n# Number of active devices for the RAID array:\npartman-md  partman-md/raiddevcount string  \n# Failed to create a file system\npartman-basicfilesystems    partman-basicfilesystems/create_failed  error   \n# Failure of key exchange and association\nd-i netcfg/wpa_supplicant_failed    note    \n# Go back to the menu and resume partitioning?\npartman-efi partman-efi/no_efi  boolean \n# Resize operation failure\npartman-partitioning    partman-partitioning/new_size_commit_failed error   \n# Protocol for file downloads:\n# Choices: http, https, ftp\nd-i mirror/protocol select  http\n# WPA/WPA2 passphrase for wireless device :\nd-i netcfg/wireless_wpa string  \n# for internal use only\nd-i debian-installer/exit/always_halt   boolean false\n# Cannot install base system\nbootstrap-base  base-installer/cannot_install   error   \n# Keep current partition layout and configure LVM?\npartman-lvm partman-lvm/confirm_nochanges   boolean false\n# IPv6 unsupported on point-to-point links\nd-i netcfg/no_ipv6_pointopoint  error   \n# Identical mount points for two file systems\npartman-target  partman-target/same_mountpoint  error   \n# for internal use; can be preseeded\nd-i preseed/early_command   string  \n# for internal use only\npartman-auto-raid   partman-auto-raid/raidnum   string  \n# \n# Choices: China, Taiwan, Singapore, Hong Kong, other\nd-i localechooser/shortlist/zh_CN   select  \n# Insert formatted floppy in drive\nd-i save-logs/insert_floppy note    \n# for internal use\nd-i keyboard-configuration/optionscode  string  \n# Debian archive mirror directory:\nd-i mirror/ftp/directory    string  /debian/\n# Debian version to install:\n# Choices: buster${!TAB}-${!TAB}stable, bullseye${!TAB}-${!TAB}testing, sid${!TAB}-${!TAB}unstable\nd-i mirror/suite    select  stable\n# Unable to configure GRUB\ngrub-installer  grub-installer/sataraid-error   error   \n# FTP proxy information (blank for none):\nd-i mirror/ftp/proxy    string  \n# for internal use; can be preseeded\nd-i netcfg/enable   boolean true\n# Additional parameters for module :\nd-i hw-detect/retry_params  string  \n# for internal use; can be preseeded\nbootstrap-base  base-installer/includes string  \n# Point-to-point address:\nd-i netcfg/get_pointopoint  string  \n# Failed to mount /target/proc\ngrub-installer  grub-installer/mounterr error   \n# \n# Choices: Italy, Switzerland, other\nd-i localechooser/shortlist/it  select  \n# Method for temporarily toggling between national and Latin input:\n# Choices: No temporary switch, Both Logo keys, Right Alt (AltGr), Right Logo key, Left Alt, Left Logo key\nd-i keyboard-configuration/switch   select  No temporary switch\n# \n# Choices: Anguilla, Antigua and Barbuda, Aruba, Bahamas, Barbados, Bermuda, Bonaire\\, Sint Eustatius and Saba, Cayman Islands, Cuba, Dominica, Dominican Republic, Grenada, Guadeloupe, Haiti, Jamaica, Martinique, Montserrat, Puerto Rico, Saint Barth\u00e9lemy, Saint Kitts and Nevis, Saint Lucia, Saint Martin (French part), Saint Vincent and the Grenadines, Sint Maarten (Dutch part), Trinidad and Tobago, Turks and Caicos Islands, Virgin Islands\\, British, Virgin Islands\\, U.S.\nd-i localechooser/countrylist/Caribbean select  \n# Help on partitioning\npartman-target  partman-target/help note    \n# Base system installation error\nbootstrap-base  base-installer/debootstrap/error-abnormal   error   \n# for internal use only\nuser-setup-udeb passwd/user-default-groups  string  audio cdrom dip floppy video plugdev netdev scanner bluetooth debian-tor lpadmin\n# Volume group:\n# Choices: \npartman-lvm partman-lvm/lvcreate_vgnames    select  \n# Keyboard layout:\n# Choices: \nd-i keyboard-configuration/variant  select  \n# \n# Choices: Belgium, Canada, France, Luxembourg, Switzerland, other\nd-i localechooser/shortlist/fr  select  \n# Software RAID configuration actions\n# Choices: Create MD device, Delete MD device, Finish\npartman-md  partman-md/mainmenu select  \n# Logical volume name:\npartman-lvm partman-lvm/lvcreate_name   string  \n# for internal use only\nd-i debconf/frontend    string  \n# Invalid hostname\nd-i netcfg/invalid_hostname error   \n# locale\nd-i localechooser/help/locale   note    \n# for internal use; can be preseeded\nlilo-installer  lilo-installer/skip boolean false\n# \n# Choices: Antigua and Barbuda, Australia, Botswana, Canada, Hong Kong, India, Ireland, Israel, New Zealand, Nigeria, Philippines, Seychelles, Singapore, South Africa, United Kingdom, United States, Zambia, Zimbabwe, other\nd-i localechooser/shortlist/en  select  \n# Write a new empty partition table?\npartman-partitioning    partman-partitioning/confirm_write_new_label    boolean false\n# Cannot access repository\napt-setup-udeb  apt-setup/service-failed    error   \n# Install the GRUB boot loader to the master boot record?\ngrub-installer  grub-installer/with_other_os    boolean true\n# No physical volumes selected\npartman-lvm partman-lvm/vgcreate_nosel  error   \n# Active devices for the RAID array:\n# Choices: \npartman-md  partman-md/raiddevs multiselect \n# Go back to the menu and correct this problem?\npartman-basicfilesystems    partman-basicfilesystems/boot_not_first_partition   boolean \n# Write the changes to disks?\npartman-base    partman/confirm boolean false\n# Passphrase input error\npartman-crypto  partman-crypto/passphrase-mismatch  error   \n# EFI partition too small\npartman-efi partman-efi/too_small_efi   error   \n# Use unrecommended JFS /boot file system?\npartman-jfs partman-jfs/jfs_boot    boolean false\n# Error while deleting volume group\npartman-lvm partman-lvm/vgdelete_error  error   \n# iSCSI initiator username for :\npartman-iscsi   partman-iscsi/login/username    string  \n# Devices to encrypt:\n# Choices: \npartman-crypto  partman-crypto/create/partitions    multiselect \n# No physical volume defined in volume group\npartman-auto-lvm    partman-auto-lvm/no_pv_in_vg    error   \n# Encryption method for this partition:\n# Choices: \npartman-crypto  partman-crypto/crypto_type  select  \n# No logical volume found\npartman-lvm partman-lvm/lvdelete_nolv   error   \n# Unexpected error while creating volume group\npartman-auto-lvm    partman-auto-lvm/vg_create_error    error   \n# Setting firmware variables for automatic boot\nnobootloader    nobootloader/confirmation_powerpc_chrp_pegasos  note    \n# Device in use\npartman-base    partman-base/devicelocked   error   \n# \n# Choices: Bangladesh, India, other\nd-i localechooser/shortlist/bn  select  \n# Encryption configuration failure\npartman-crypto  partman-crypto/crypto_boot_not_possible error   \n# Failed to run preseeded command\nd-i preseed/command_failed  error   \n# for internal use; can be preseeded (deprecated)\nd-i netcfg/disable_dhcp boolean false\n# Failed to load installer component\nd-i anna/install_failed error   \n# Partitioning method:\n# Choices: Guided - use entire disk, Guided - use entire disk and set up LVM, Guided - use entire disk and set up encrypted LVM, Manual\npartman-auto    partman-auto/init_automatically_partition   select  50some_device__________regular\n# Is the system clock set to UTC?\nclock-setup clock-setup/utc boolean true\n# Use weak passphrase?\npartman-crypto  partman-crypto/weak_passphrase  boolean false\n# Number of spare devices for the RAID array:\npartman-md  partman-md/raidsparecount   string  \n# Keymap to use:\n# Choices: American English, Albanian, Arabic, Asturian, Bangladesh, Belarusian, Bengali, Belgian, Bosnian, Brazilian, British English, Bulgarian (BDS layout), Bulgarian (phonetic layout), Burmese, Canadian French, Canadian Multilingual, Catalan, Chinese, Croatian, Czech, Danish, Dutch, Dvorak, Dzongkha, Esperanto, Estonian, Ethiopian, Finnish, French, Georgian, German, Greek, Gujarati, Gurmukhi, Hebrew, Hindi, Hungarian, Icelandic, Irish, Italian, Japanese, Kannada, Kazakh, Khmer, Kirghiz, Korean, Kurdish (F layout), Kurdish (Q layout), Lao, Latin American, Latvian, Lithuanian, Macedonian, Malayalam, Nepali, Northern Sami, Norwegian, Persian, Philippines, Polish, Portuguese, Punjabi, Romanian, Russian, Serbian (Cyrillic), Sindhi, Sinhala, Slovak, Slovenian, Spanish, Swedish, Swiss French, Swiss German, Tajik, Tamil, Telugu, Thai, Tibetan, Turkish (F layout), Turkish (Q layout), Ukrainian, Uyghur, Vietnamese\nd-i keyboard-configuration/xkb-keymap   select  es\n# Install the GRUB boot loader to the master boot record?\ngrub-installer  grub-installer/only_debian  boolean true\n# Checksum error\nd-i preseed/checksum_error  error   \n# Are you sure you want to use a random key?\npartman-crypto  partman-crypto/use_random_for_nonswap   boolean false\n# No DHCP client found\nd-i netcfg/no_dhcp_client   error   \n# LILO installation target:\n# Choices: : Master Boot Record, : new Debian partition, Other choice (Advanced)\nlilo-installer  lilo-installer/bootdev  select  \n# Domain name:\nd-i netcfg/get_domain   string  \n# city\n# Choices: Kinshasa, Lubumbashi\ntzsetup-udeb    tzsetup/country/CD  select  Africa/Kinshasa\n# Are you sure you want to exit now?\nd-i di-utils-reboot/really_reboot   boolean false\n# Devices to remove from the volume group:\n# Choices: \npartman-lvm partman-lvm/vgreduce_parts  multiselect \n# Choose software to install:\n# Choices: Debian desktop environment, ... GNOME, ... Xfce, ... KDE Plasma, ... Cinnamon, ... MATE, ... LXDE, ... LXQt, web server, print server, SSH server, standard system utilities\nd-i tasksel/first   multiselect SSH server, standard system utilities\n# \n# Choices: Antarctica\nd-i localechooser/countrylist/Antarctica    select  \n# Modules to load:\n# Choices: usb-storage (USB storage)\nd-i hw-detect/select_modules    multiselect usb-storage (USB storage)\n# Go back and try a different mirror?\nd-i mirror/no-default   boolean true\n# \n# Choices: Belgium, Germany, Italy, Liechtenstein, Luxembourg, Switzerland, Austria, other\nd-i localechooser/shortlist/de  select  \n# Initialization vector generation algorithm for this partition:\n# Choices: \npartman-crypto  partman-crypto/ivalgorithm  select  \n# Installation complete\nfinish-install  finish-install/reboot_in_progress   note    \n# for internal use; can be preseeded\nd-i preseed/interactive boolean false\n# Malformed IP address\nd-i netcfg/bad_ipaddress    error   \n# Identical labels for two file systems\npartman-target  partman-target/same_label   error   \n# Debian archive mirror country:\n# Choices: enter information manually, Argentina, Armenia, Australia, Austria, Belarus, Belgium, Brazil, Bulgaria, Canada, Chile, China, Costa Rica, Croatia, Czechia, Denmark, El Salvador, Estonia, Finland, France, Georgia, Germany, Greece, Hong Kong, Hungary, India, Indonesia, Iran\\, Islamic Republic of, Israel, Italy, Japan, Kazakhstan, Kenya, Korea\\, Republic of, Kyrgyzstan, Latvia, Lithuania, Luxembourg, Macedonia\\, Republic of, Mexico, Moldova, Netherlands, New Caledonia, New Zealand, Norway, Philippines, Poland, Portugal, Romania, Russian Federation, R\u00e9union, Serbia, Singapore, Slovakia, Slovenia, South Africa, Spain, Sweden, Switzerland, Taiwan, Thailand, Turkey, Ukraine, United Kingdom, United States, Uruguay, Vietnam\nd-i mirror/http/countries   select  ES\n# for internal use; can be preseeded\nd-i netcfg/dhcp_timeout string  25\n# Failed to partition the selected disk\npartman-auto    partman-auto/no_recipe  error   \n# Wireless ESSID for :\nd-i netcfg/wireless_essid_again string  \n# Unable to install \nbootstrap-base  base-installer/kernel/failed-package-install    error   \n# zone\n# Choices: Port Moresby, Bougainville\ntzsetup-udeb    tzsetup/country/PG  select  \n# for internal use; can be preseeded\nfinish-install  finish-install/keep-consoles    boolean false\n# Logical Volume Management\npartman-lvm partman-lvm/help    note    \n# Logical volume:\n# Choices: \npartman-lvm partman-lvm/lvdelete_lvnames    select  \n# Wireless ESSID for :\nd-i netcfg/wireless_essid   string  \n# Unsafe swap space detected\npartman-crypto  partman-crypto/unsafe_swap  error   \n# Flags for the new partition:\n# Choices: \npartman-partitioning    partman-partitioning/set_flags  multiselect \n# What to do with this device:\n# Choices: \npartman-base    partman/storage_device  select  \n# Return to the menu to set the bootable flag?\npartman-ext3    partman-ext3/boot_not_bootable  boolean \n# for internal use; can be preseeded\npartman-base    partman/default_filesystem  string  ext4\n# Language selection no longer possible\nd-i localechooser/translation/no-select note    \n# Typical usage of this partition:\n# Choices: \npartman-basicfilesystems    partman-basicfilesystems/specify_usage  select  \n# for internal use; can be preseeded\n# Choices: cylinder, minimal, optimal\npartman-base    partman/alignment   select  optimal\n# Volume group name already in use\npartman-auto-lvm    partman-auto-lvm/vg_exists  error   \n# Write the changes to the storage devices and configure RAID?\npartman-md  partman-md/confirm  boolean false\n# location\n# Choices: Guayaquil, Galapagos\ntzsetup-udeb    tzsetup/country/EC  select  America/Guayaquil\n# Error while running ''\nd-i hw-detect/modprobe_error    error   \n# Really delete this software RAID device?\npartman-md  partman-md/deleteverify boolean false\n# Error while creating volume group\npartman-lvm partman-lvm/vgcreate_error  error   \n# for internal use; can be preseeded\n# Choices: none, safe-upgrade, full-upgrade\npkgsel  pkgsel/upgrade  select  safe-upgrade\n# How should the debug logs be saved or transferred?\n# Choices: floppy, web, mounted file system\nd-i save-logs/menu  select  \n# for internal use; can be preseeded\ndisk-detect disk-detect/dmraid/enable   boolean false\n# \n# Choices: Argentina, Bolivia, Brazil, Chile, Colombia, Ecuador, French Guiana, Guyana, Paraguay, Peru, Suriname, Uruguay, Venezuela\nd-i localechooser/countrylist/South_America select  \n# city\n# Choices: Ulaanbaatar, Hovd, Choibalsan\ntzsetup-udeb    tzsetup/country/MN  select  Asia/Ulaanbaatar\n# Participate in the package usage survey?\nd-i popularity-contest/participate  boolean false\n# Keep default keyboard options ()?\nd-i keyboard-configuration/unsupported_options  boolean true\n# Error while creating a new logical volume\npartman-lvm partman-lvm/lvcreate_exists error   \n# No volume group name entered\npartman-lvm partman-lvm/vgcreate_nonamegiven    error   \n# How to use this partition:\n# Choices: \npartman-target  partman-target/choose_method    select  \n# Really erase the data on ?\npartman-crypto  partman-crypto/crypto_warn_erase    boolean false\n# Software RAID device to be deleted:\n# Choices: \npartman-md  partman-md/deletemenu   select  \n# \n# Choices: Brazil, Portugal, other\nd-i localechooser/shortlist/pt  select  \n# Failed to install the base system\nbootstrap-base  base-installer/debootstrap-failed   error   \n# for internal use only\nd-i debian-installer/consoledisplay string  \n# Type of encryption key hash for this partition:\n# Choices: \npartman-crypto  partman-crypto/keyhash  select  \n# Remove existing logical volume data?\npartman-lvm partman-lvm/device_remove_lvm   boolean false\n# Dummy template for preseeding unavailable questions\nd-i debian-installer/dummy  string  \n# Country to base default locale settings on:\n# Choices: \nd-i localechooser/preferred-locale  select  \n# DHCP hostname:\nd-i netcfg/dhcp_hostname    string  \n# Partition settings:\n# Choices: \npartman-base    partman/active_partition    select  \n# Web server started\nd-i save-logs/httpd_running note    \n# Proceed with installation to unclean target?\nbase-installer  base-installer/use_unclean_target   boolean true\n# Downloading a file failed:\n# Choices: Retry, Change mirror, Cancel\nd-i retriever/net/error select  Retry\n# Directory in which to save debug logs:\nd-i save-logs/directory string  /mnt\n# Debian archive mirror directory:\nd-i mirror/http/directory   string  /debian/\n# Erasing data on  failed\npartman-crypto  partman-crypto/crypto_erase_failed  error   \n# Choose the next step in the install process:\n# Choices: Choose language, Access software for a blind person using a braille display, Configure the keyboard, Detect network hardware, Configure the network, Choose a mirror of the Debian archive, Download installer components, Set up users and passwords, Free memory (low memory install), Configure the clock, Detect disks, Partition disks, Install the base system, Configure the package manager, Select and install software, Install the GRUB boot loader on a hard disk, Install the LILO boot loader on a hard disk, Continue without boot loader, Finish the installation, Change debconf priority, Save debug logs, Execute a shell, Abort the installation\nd-i debian-installer/main-menu  select  Finish the installation\n# for internal use; can be preseeded\nd-i debian-installer/exit/halt  boolean false\n# Wait another 30 seconds for hwclock to set the clock?\nclock-setup clock-setup/hwclock-wait    boolean false\n# Write previous changes to disk and continue?\npartman-partitioning    partman-partitioning/confirm_resize boolean \n# Password input error\nuser-setup-udeb user-setup/password-mismatch    error   \n# for internal use; can be preseeded\nd-i hw-detect/load-ide  boolean false\n# The resize operation is impossible\npartman-partitioning    partman-partitioning/impossible_resize  error   \n# Invalid input\npartman-auto-lvm    partman-auto-lvm/bad_guided_size    error   \n# Is this information correct?\nd-i netcfg/confirm_static   boolean true\n# Use a network mirror?\napt-mirror-setup    apt-setup/use_mirror    boolean \n# Use unrecommended JFS root file system?\npartman-jfs partman-jfs/jfs_root    boolean false\n# Empty password\npartman-iscsi   partman-iscsi/login/empty_password  error   \n# Method for toggling between national and Latin mode:\n# Choices: Caps Lock, Right Alt (AltGr), Right Control, Right Shift, Right Logo key, Menu key, Alt+Shift, Control+Shift, Control+Alt, Alt+Caps Lock, Left Control+Left Shift, Left Alt, Left Control, Left Shift, Left Logo key, Scroll Lock key, No toggling\nd-i keyboard-configuration/toggle   select  No toggling\n# Continue with the installation?\npartman-base    partman/confirm_nochanges   boolean false\n# No volume group found\npartman-lvm partman-lvm/vgreduce_novg   error   \n# for internal use; can be preseeded\nbootstrap-base  base-installer/excludes string  \n# Encryption package installation failure\npartman-crypto  partman-crypto/module_package_missing   error   \n# Continue without installing a kernel?\nbootstrap-base  base-installer/kernel/skip-install  boolean false\n# Would you like to make this partition active?\nlilo-installer  lilo-installer/activate-part    boolean true\n# No partitions to encrypt\npartman-crypto  partman-crypto/nothing_to_setup note    \n# Continent or region:\n# Choices: Africa, Antarctica, Asia, Atlantic Ocean, Caribbean, Central America, Europe, Indian Ocean, North America, Oceania, South America, other\nd-i localechooser/continentlist select  Europe\n# Continue with partitioning?\npartman-partitioning    partman-partitioning/unsupported_label  boolean false\n# Failed to partition the selected disk\npartman-auto    partman-auto/autopartitioning_failed    error   \n# NTP server to use:\nclock-setup clock-setup/ntp-server  string  0.debian.pool.ntp.org\n# Driver needed by your Ethernet card:\n# Choices: no ethernet card, , none of the above\nd-i ethdetect/module_select select  no ethernet card\n# Label for the file system in this partition:\npartman-basicfilesystems    partman-basicfilesystems/choose_label   string  \n# city\n# Choices: Western (Sumatra\\, Jakarta\\, Java\\, West and Central Kalimantan), Central (Sulawesi\\, Bali\\, Nusa Tenggara\\, East and South Kalimantan), Eastern (Maluku\\, Papua)\ntzsetup-udeb    tzsetup/country/ID  select  Asia/Jakarta\n# Wireless network:\n# Choices:  Enter ESSID manually\nd-i netcfg/wireless_show_essids select  \n# WEP key for wireless device :\nd-i netcfg/wireless_wep string  \n# for internal use; can be preseeded\nd-i preseed/late_command    string  \n# \n# Choices: Afghanistan, Bahrain, Bangladesh, Bhutan, Brunei Darussalam, Cambodia, China, Hong Kong, India, Indonesia, Iran\\, Islamic Republic of, Iraq, Israel, Japan, Jordan, Kazakhstan, Korea\\, Democratic People's Republic of, Korea\\, Republic of, Kuwait, Kyrgyzstan, Lao People's Democratic Republic, Lebanon, Macao, Malaysia, Mongolia, Myanmar, Nepal, Oman, Pakistan, Palestine\\, State of, Philippines, Qatar, Saudi Arabia, Singapore, Sri Lanka, Syrian Arab Republic, Taiwan, Tajikistan, Thailand, Timor-Leste, Turkey, Turkmenistan, United Arab Emirates, Uzbekistan, Vietnam, Yemen\nd-i localechooser/countrylist/Asia  select  \n# for internal use; can be preseeded\nd-i debian-installer/allow_unauthenticated  boolean false\n# location\n# Choices: Yap, Truk, Pohnpei, Kosrae\ntzsetup-udeb    tzsetup/country/FM  select  Pacific/Ponape\n# Kernel to install:\n# Choices: linux-image-4.19.0-10-amd64,linux-image-4.19.0-10-amd64-unsigned,linux-image-4.19.0-10-cloud-amd64,linux-image-4.19.0-10-cloud-amd64-unsigned,linux-image-4.19.0-10-rt-amd64,linux-image-4.19.0-10-rt-amd64-unsigned,linux-image-4.19.0-11-amd64,linux-image-4.19.0-11-amd64-unsigned,linux-image-4.19.0-11-cloud-amd64,linux-image-4.19.0-11-cloud-amd64-unsigned,linux-image-4.19.0-11-rt-amd64,linux-image-4.19.0-11-rt-amd64-unsigned,linux-image-amd64,linux-image-amd64-signed-template,linux-image-cloud-amd64,linux-image-rt-amd64, none\nbootstrap-base  base-installer/kernel/image select  linux-image-amd64\n# location\n# Choices: Madrid, Ceuta, Canary Islands\ntzsetup-udeb    tzsetup/country/ES  select  Europe/Madrid\n# \n# Choices: Canada, Mexico, Saint Pierre and Miquelon, United States\nd-i localechooser/countrylist/North_America select  \n# Initialisation of encrypted volume failed\npartman-crypto  partman-crypto/init_failed  error   \n# Keep current keyboard options in the configuration file?\nd-i keyboard-configuration/unsupported_config_options   boolean true\n# Unable to configure GRUB\ngrub-installer  grub-installer/update-grub-failed   error   \n# Unsupported initrd generator\nbootstrap-base  base-installer/initramfs/unsupported    error   \n# Debootstrap Error\nbootstrap-base  base-installer/debootstrap/error/missingrelentry    error   \n# Failed to retrieve the preconfiguration file\nd-i preseed/retrieve_error  error   \n# Additional locales:\n# Choices: aa_DJ.UTF-8, aa_DJ, aa_ER, aa_ER@saaho, aa_ET, af_ZA.UTF-8, af_ZA, agr_PE, ak_GH, am_ET, an_ES.UTF-8, an_ES, anp_IN, ar_AE.UTF-8, ar_AE, ar_BH.UTF-8, ar_BH, ar_DZ.UTF-8, ar_DZ, ar_EG.UTF-8, ar_EG, ar_IN, ar_IQ.UTF-8, ar_IQ, ar_JO.UTF-8, ar_JO, ar_KW.UTF-8, ar_KW, ar_LB.UTF-8, ar_LB, ar_LY.UTF-8, ar_LY, ar_MA.UTF-8, ar_MA, ar_OM.UTF-8, ar_OM, ar_QA.UTF-8, ar_QA, ar_SA.UTF-8, ar_SA, ar_SD.UTF-8, ar_SD, ar_SS, ar_SY.UTF-8, ar_SY, ar_TN.UTF-8, ar_TN, ar_YE.UTF-8, ar_YE, ayc_PE, az_AZ, az_IR, as_IN, ast_ES.UTF-8, ast_ES, be_BY.UTF-8, be_BY, be_BY@latin, bem_ZM, ber_DZ, ber_MA, bg_BG.UTF-8, bg_BG, bhb_IN.UTF-8, bho_IN, bho_NP, bi_VU, bn_BD, bn_IN, bo_CN, bo_IN, br_FR.UTF-8, br_FR, br_FR@euro, brx_IN, bs_BA.UTF-8, bs_BA, byn_ER, ca_AD.UTF-8, ca_AD, ca_ES.UTF-8, ca_ES, ca_ES@euro, ca_ES@valencia, ca_FR.UTF-8, ca_FR, ca_IT.UTF-8, ca_IT, ce_RU, chr_US, cmn_TW, crh_UA, cs_CZ.UTF-8, cs_CZ, csb_PL, cv_RU, cy_GB.UTF-8, cy_GB, da_DK.UTF-8, da_DK, de_AT.UTF-8, de_AT, de_AT@euro, de_BE.UTF-8, de_BE, de_BE@euro, de_CH.UTF-8, de_CH, de_DE.UTF-8, de_DE, de_DE@euro, de_IT.UTF-8, de_IT, de_LI.UTF-8, de_LU.UTF-8, de_LU, de_LU@euro, doi_IN, dsb_DE, dv_MV, dz_BT, el_GR.UTF-8, el_GR, el_GR@euro, el_CY.UTF-8, el_CY, en_AG, en_AU.UTF-8, en_AU, en_BW.UTF-8, en_BW, en_CA.UTF-8, en_CA, en_DK.UTF-8, en_DK.ISO-8859-15, en_DK, en_GB.UTF-8, en_GB, en_GB.ISO-8859-15, en_HK.UTF-8, en_HK, en_IE.UTF-8, en_IE, en_IE@euro, en_IL, en_IN, en_NG, en_NZ.UTF-8, en_NZ, en_PH.UTF-8, en_PH, en_SC.UTF-8, en_SG.UTF-8, en_SG, en_US.UTF-8, en_US, en_US.ISO-8859-15, en_ZA.UTF-8, en_ZA, en_ZM, en_ZW.UTF-8, en_ZW, eo, es_AR.UTF-8, es_AR, es_BO.UTF-8, es_BO, es_CL.UTF-8, es_CL, es_CO.UTF-8, es_CO, es_CR.UTF-8, es_CR, es_CU, es_DO.UTF-8, es_DO, es_EC.UTF-8, es_EC, es_ES.UTF-8, es_ES, es_ES@euro, es_GT.UTF-8, es_GT, es_HN.UTF-8, es_HN, es_MX.UTF-8, es_MX, es_NI.UTF-8, es_NI, es_PA.UTF-8, es_PA, es_PE.UTF-8, es_PE, es_PR.UTF-8, es_PR, es_PY.UTF-8, es_PY, es_SV.UTF-8, es_SV, es_US.UTF-8, es_US, es_UY.UTF-8, es_UY, es_VE.UTF-8, es_VE, et_EE.UTF-8, et_EE, et_EE.ISO-8859-15, eu_ES.UTF-8, eu_ES, eu_ES@euro, eu_FR.UTF-8, eu_FR, eu_FR@euro, fa_IR, ff_SN, fi_FI.UTF-8, fi_FI, fi_FI@euro, fil_PH, fo_FO.UTF-8, fo_FO, fr_BE.UTF-8, fr_BE, fr_BE@euro, fr_CA.UTF-8, fr_CA, fr_CH.UTF-8, fr_CH, fr_FR.UTF-8, fr_FR, fr_FR@euro, fr_LU.UTF-8, fr_LU, fr_LU@euro, fur_IT, fy_NL, fy_DE, ga_IE.UTF-8, ga_IE, ga_IE@euro, gd_GB.UTF-8, gd_GB, gez_ER, gez_ER@abegede, gez_ET, gez_ET@abegede, gl_ES.UTF-8, gl_ES, gl_ES@euro, gu_IN, gv_GB.UTF-8, gv_GB, ha_NG, hak_TW, he_IL.UTF-8, he_IL, hi_IN, hif_FJ, hne_IN, hr_HR.UTF-8, hr_HR, hsb_DE.UTF-8, hsb_DE, ht_HT, hu_HU.UTF-8, hu_HU, hy_AM, hy_AM.ARMSCII-8, ia_FR, id_ID.UTF-8, id_ID, ig_NG, ik_CA, is_IS.UTF-8, is_IS, it_CH.UTF-8, it_CH, it_IT.UTF-8, it_IT, it_IT@euro, iu_CA, ja_JP.UTF-8, ja_JP.EUC-JP, ka_GE.UTF-8, ka_GE, kab_DZ, kk_KZ.UTF-8, kk_KZ, kk_KZ.RK1048, kl_GL.UTF-8, kl_GL, km_KH, kn_IN, ko_KR.UTF-8, ko_KR.EUC-KR, kok_IN, ks_IN, ks_IN@devanagari, ku_TR.UTF-8, ku_TR, kw_GB.UTF-8, kw_GB, ky_KG, lb_LU, lg_UG.UTF-8, lg_UG, li_BE, li_NL, lij_IT, ln_CD, lo_LA, lt_LT.UTF-8, lt_LT, lv_LV.UTF-8, lv_LV, lzh_TW, mag_IN, mai_IN, mai_NP, mfe_MU, mg_MG.UTF-8, mg_MG, mhr_RU, mi_NZ.UTF-8, mi_NZ, miq_NI, mjw_IN, mk_MK.UTF-8, mk_MK, ml_IN, mn_MN, mni_IN, mr_IN, ms_MY.UTF-8, ms_MY, mt_MT.UTF-8, mt_MT, my_MM, nan_TW, nan_TW@latin, nb_NO.UTF-8, nb_NO, nds_DE, nds_NL, ne_NP, nhn_MX, niu_NU, niu_NZ, nl_AW, nl_BE.UTF-8, nl_BE, nl_BE@euro, nl_NL.UTF-8, nl_NL, nl_NL@euro, nn_NO.UTF-8, nn_NO, nr_ZA, nso_ZA, oc_FR.UTF-8, oc_FR, om_ET, om_KE.UTF-8, om_KE, or_IN, os_RU, pa_IN, pa_PK, pap_AW, pap_CW, pl_PL.UTF-8, pl_PL, ps_AF, pt_BR.UTF-8, pt_BR, pt_PT.UTF-8, pt_PT, pt_PT@euro, quz_PE, raj_IN, ro_RO.UTF-8, ro_RO, ru_RU.UTF-8, ru_RU.KOI8-R, ru_RU, ru_RU.CP1251, ru_UA.UTF-8, ru_UA, rw_RW, sa_IN, sah_RU, sat_IN, sc_IT, sd_IN, sd_IN@devanagari, se_NO, sgs_LT, shn_MM, shs_CA, si_LK, sid_ET, sk_SK.UTF-8, sk_SK, sl_SI.UTF-8, sl_SI, sm_WS, so_DJ.UTF-8, so_DJ, so_ET, so_KE.UTF-8, so_KE, so_SO.UTF-8, so_SO, sq_AL.UTF-8, sq_AL, sq_MK, sr_ME, sr_RS, sr_RS@latin, ss_ZA, st_ZA.UTF-8, st_ZA, sv_FI.UTF-8, sv_FI, sv_FI@euro, sv_SE.UTF-8, sv_SE, sv_SE.ISO-8859-15, sw_KE, sw_TZ, szl_PL, ta_IN, ta_LK, tcy_IN.UTF-8, te_IN, tg_TJ.UTF-8, tg_TJ, th_TH.UTF-8, th_TH, the_NP, ti_ER, ti_ET, tig_ER, tk_TM, tl_PH.UTF-8, tl_PH, tn_ZA, to_TO, tpi_PG, tr_CY.UTF-8, tr_CY, tr_TR.UTF-8, tr_TR, ts_ZA, tt_RU, tt_RU@iqtelif, ug_CN, uk_UA.UTF-8, uk_UA, unm_US, ur_IN, ur_PK, uz_UZ.UTF-8, uz_UZ, uz_UZ@cyrillic, ve_ZA, vi_VN, wa_BE.UTF-8, wa_BE, wa_BE@euro, wae_CH, wal_ET, wo_SN, xh_ZA.UTF-8, xh_ZA, yi_US.UTF-8, yi_US, yo_NG, yue_HK, yuw_PG, zh_CN.UTF-8, zh_CN.GB18030, zh_CN.GBK, zh_CN, zh_HK.UTF-8, zh_HK, zh_SG.UTF-8, zh_SG.GBK, zh_SG, zh_TW.UTF-8, zh_TW.EUC-TW, zh_TW, zu_ZA.UTF-8, zu_ZA\nd-i localechooser/supported-locales multiselect en_US.UTF-8\n# System locale:\n# Choices: C, en_US.UTF-8\nd-i debian-installer/locale select  en_US.UTF-8\n# Partition name:\npartman-partitioning    partman-partitioning/set_name   string  \n# for internal use; can be preseeded\nd-i preseed/include string  \n# Wireless network type for :\n# Choices: WEP/Open Network, WPA/WPA2 PSK\nd-i netcfg/wireless_security_type   select  wpa\n# Username for your account:\nuser-setup-udeb passwd/username string  pxe-client-user\n# Create a normal user account now?\nuser-setup-udeb passwd/make-user    boolean true\n# zone\n# Choices: Asia/Nicosia (Cyprus (most areas)), Asia/Famagusta (Northern Cyprus)\ntzsetup-udeb    tzsetup/country/CY  select  \n# for internal use; can be preseeded\nd-i anna/standard_modules   boolean true\n# \n# Choices: Macedonia\\, Republic of, Albania, other\nd-i localechooser/shortlist/sq  select  \n# Continue installation without /boot partition?\npartman-auto-lvm    partman-auto-lvm/no_boot    boolean \n# Type of wireless network:\n# Choices: Infrastructure (Managed) network, Ad-hoc network (Peer to peer)\nd-i netcfg/wireless_adhoc_managed   select  Infrastructure (Managed) network\n# PCMCIA resource range options:\nd-i hw-detect/pcmcia_resources  string  \n# No physical volumes selected\npartman-lvm partman-lvm/vgreduce_nosel  error   \n# Remove existing software RAID partitions?\npartman-md  partman-md/device_remove_md boolean false\n# location\n# Choices: McMurdo, Rothera, Palmer, Mawson, Davis, Casey, Vostok, Dumont-d'Urville, Syowa\ntzsetup-udeb    tzsetup/country/AQ  select  \n# Error while initializing physical volume\npartman-lvm partman-lvm/pvcreate_error  error   \n# LVM configuration failure\npartman-lvm partman-lvm/commit_failed   error   \n# for internal use; can be preseeded\nd-i auto-install/enable boolean false\n# No usable physical volumes found\npartman-lvm partman-lvm/nopartitions    error   \n# Not enough RAID partitions available\npartman-md  partman-md/notenoughparts   error   \n# for internal use; can be preseeded\npartman-auto    partman-auto/expert_recipe_file string  \n# Write the changes to the storage devices and configure RAID?\nd-i partman-md/confirm_nooverwrite  boolean false\n# Volume group to reduce:\n# Choices: \npartman-lvm partman-lvm/vgreduce_names  select  \n# \n# Choices: Pakistan, India, other\nd-i localechooser/shortlist/pa  select  \n# \n# Choices: Belize, Costa Rica, El Salvador, Guatemala, Honduras, Nicaragua, Panama\nd-i localechooser/countrylist/Central_America   select  \n# No logical volume name entered\npartman-lvm partman-lvm/lvcreate_nonamegiven    error   \n# Select a location in your time zone:\n# Choices: Madrid, Ceuta, Canary Islands, Coordinated Universal Time (UTC)\ntzsetup-udeb    time/zone   select  Europe/Madrid\n# for internal use; can be preseeded\nbootstrap-base  base-installer/debootstrap_script   string  \n# Invalid size\npartman-partitioning    partman-partitioning/bad_new_partition_size error   \n# state\n# Choices: Acre, Alagoas, Amazonas, Amap\u00e1, Bahia, Cear\u00e1, Distrito Federal, Esp\u00edrito Santo, Fernando de Noronha, Goi\u00e1s, Maranh\u00e3o, Minas Gerais, Mato Grosso do Sul, Mato Grosso, Par\u00e1, Para\u00edba, Pernambuco, Piau\u00ed, Paran\u00e1, Rio de Janeiro, Rio Grande do Norte, Rond\u00f4nia, Roraima, Rio Grande do Sul, Santa Catarina, Sergipe, S\u00e3o Paulo, Tocantins\ntzsetup-udeb    tzsetup/country/BR  select  America/Sao_Paulo\n# for internal use; can be preseeded\n# Choices: traditional, label, uuid\npartman-target  partman/mount_style select  uuid\n# Force GRUB installation to the EFI removable media path?\ngrub-installer  grub-installer/force-efi-extra-removable    boolean true\n# \n# Choices: Bouvet Island, Falkland Islands (Malvinas), Saint Helena\\, Ascension and Tristan da Cunha, South Georgia and the South Sandwich Islands\nd-i localechooser/countrylist/Atlantic_Ocean    select  \n# Not enough RAID partitions specified\npartman-auto-raid   partman-auto-raid/notenoughparts    error   \n# for internal use; can be preseeded\ngrub-installer  grub-installer/grub2_instead_of_grub_legacy boolean true\n# for internal use; can be preseeded\nd-i netcfg/hostname string  \n# for internal use only\nbootstrap-base  base-installer/kernel/linux/link_in_boot    boolean false\n# Debootstrap Error\nbootstrap-base  base-installer/debootstrap/error/couldntdl  error   \n# Type for the new partition:\n# Choices: Primary, Logical\npartman-partitioning    partman-partitioning/new_partition_type select  \n# state\n# Choices: Australian Capital Territory, New South Wales, Victoria, Northern Territory, Queensland, South Australia, Tasmania, Western Australia, Eyre Highway, Yancowinna County, Lord Howe Island\ntzsetup-udeb    tzsetup/country/AU  select  Australia/Canberra\n# Error while deleting the logical volume\npartman-lvm partman-lvm/lvdelete_error  error   \n# Debian archive mirror hostname:\nd-i mirror/ftp/hostname string  mirror\n# Devices to add to the volume group:\n# Choices: \npartman-lvm partman-lvm/vgextend_parts  multiselect \n# Installer components to load:\n# Choices: \nd-i anna/choose_modules_lowmem  multiselect \n# Unable to install GRUB in \ngrub-installer  grub-installer/grub-install-failed  error   \n# Failed to partition the selected disk\npartman-auto-lvm    partman-auto-lvm/unusable_recipe    error   \n# Debian archive mirror country:\n# Choices: enter information manually\nd-i mirror/https/countries  select  US\n# for internal use; can be preseeded\npartman-partitioning    partman-partitioning/default_label  string  \n# \npartman-base    partman/exception_handler_note  note    \n# GRUB installation failed\ngrub-installer  grub-installer/apt-install-failed   error   \n# Not installing to unclean target\nbase-installer  base-installer/unclean_target_cancel    error   \n# for internal use; can be preseeded\npartman-auto-raid   partman-auto-raid/recipe    string  \n# for internal use; can be preseeded\nd-i preseed/include/checksum    string  \n# Start PC card services?\nd-i hw-detect/start_pcmcia  boolean true\n# iSCSI login failed\npartman-iscsi   partman-iscsi/login/failed  error   \n# \n# Choices: Cura\u00e7ao\nd-i localechooser/countrylist/other select  \n# IP address:\nd-i netcfg/get_ipaddress    string  \n# Keyfile creation failure\npartman-crypto  partman-crypto/keyfile-problem  error   \n# Continue the install without loading kernel modules?\nd-i anna/no_kernel_modules  boolean false\n# for internal use\nd-i keyboard-configuration/layoutcode   string  es\n# Kill switch enabled on \nd-i netcfg/kill_switch_enabled  note    \n# Go back to the menu and correct this problem?\npartman-basicfilesystems    partman-basicfilesystems/boot_not_ext2  boolean \n# Architecture not supported\nd-i mirror/noarch   error   \n# location\n# Choices: Johnston Atoll, Midway Islands, Wake Island\ntzsetup-udeb    tzsetup/country/UM  select  Pacific/Midway\n# Terminal plugin not available\nd-i debian-installer/terminal-plugin-unavailable    error   \n# Required encryption options missing\npartman-crypto  partman-crypto/options_missing  error   \n# for internal use; can be preseeded\nd-i debian-installer/country    string  ES\n# How to use this free space:\n# Choices: \npartman-base    partman/free_space  select  \n# Do you want to return to the partitioning menu?\npartman-basicfilesystems    partman-basicfilesystems/no_mount_point boolean \n# LVM configuration action:\n# Choices: \npartman-lvm partman-lvm/mainmenu    select  \n# Write the changes to disk and configure encrypted volumes?\nd-i partman-crypto/confirm_nooverwrite  boolean false\n# for internal use; can be preseeded\napt-setup-udeb  apt-setup/security_host string  security.debian.org\n# Invalid file system for this mount point\npartman-basicfilesystems    partman-basicfilesystems/posix_filesystem_required  error   \n# LILO installation failed\nlilo-installer  lilo-installer/failed   error   \n# Mount point for this partition:\n# Choices: / - the root file system, /boot - static files of the boot loader, /home - user home directories, /tmp - temporary files, /usr - static data, /var - variable data, /srv - data for services provided by this system, /opt - add-on application software packages, /usr/local - local hierarchy, Enter manually, Do not mount it\npartman-basicfilesystems    partman-basicfilesystems/mountpoint select  \n# for internal use; can be preseeded\nd-i preseed/boot_command    string  \n# The size entered is invalid\npartman-partitioning    partman-partitioning/bad_new_size   error   \n# Partitioning scheme:\n# Choices: All files in one partition (recommended for new users), Separate /home partition, Separate /home\\, /var\\, and /tmp partitions\npartman-auto    partman-auto/choose_recipe  select  /lib/partman/recipes/30atomic\n# Driver needed for your disk drive:\n# Choices: continue with no disk drive, , none of the above\ndisk-detect disk-detect/module_select   select  continue with no disk drive\n# for internal use; can be preseeded\n# Choices: Network Manager, ifupdown (/etc/network/interfaces), No network configuration\nd-i netcfg/target_network_config    select  ifupdown\n# for internal use; can be preseeded\npartman-auto    partman-auto/method string  \n# Invalid logical volume or volume group name\npartman-lvm partman-lvm/badnamegiven    error   \n# Invalid partition name\nlilo-installer  lilo-installer/manual_bootdev_error error   \n# for internal use; can be preseeded\nd-i debian-installer/exit/poweroff  boolean false\n# \n# Choices: Andorra, Spain, France, Italy, other\nd-i localechooser/shortlist/ca  select  \n# Encryption for this partition:\n# Choices: \npartman-crypto  partman-crypto/cipher   select  \n# for internal use only\nclock-setup clock-setup/system-time-changed boolean true\n# for internal use; can be preseeded\npartman-auto    partman-auto/disk   string  \n# Insufficient memory\nd-i lowmem/insufficient error   \n# Keep the current keyboard layout in the configuration file?\nd-i keyboard-configuration/unsupported_config_layout    boolean true\n# Percentage of the file system blocks reserved for the super-user:\npartman-basicfilesystems    partman-basicfilesystems/specify_reserved   string  \n# \n# Choices: Brazil, Portugal, other\nd-i localechooser/shortlist/pt_BR   select  \n# Go back to the menu and correct errors?\npartman-basicfilesystems    partman-basicfilesystems/check_failed   boolean \n# No partitionable media\ndisk-detect disk-detect/cannot_find error   \n# Debootstrap Error\nbootstrap-base  base-installer/debootstrap/error/nogetrelsig    error   \n# Enable source repositories in APT?\napt-setup-udeb  apt-setup/enable-source-repositories    boolean true\n# Invalid mount point\npartman-basicfilesystems    partman-basicfilesystems/bad_mountpoint error   \n# Installer components to load:\n# Choices: cdrom-checker: Verify the cd contents, cdrom-detect: Detect CDROM devices and mount the CD, crypto-dm-modules-4.19.0-11-amd64-di: devicemapper crypto module, debian-edu-install-udeb: Execute Debian Edu debian-installer profile, debian-edu-profile-udeb: Choose Debian Edu profile, di-utils-exit-installer: Exit installer, driver-injection-disk-detect: Detect OEM driver injection disks, eject-udeb: ejects CDs from d-i menu, emdebian-archive-keyring-udeb: GnuPG keys of the Emdebian archive - udeb, espeakup-udeb: Configure the speech synthesizer voice, event-modules-4.19.0-11-amd64-di: Event support, fuse-modules-4.19.0-11-amd64-di: FUSE modules, iso-scan: Scan hard drives for an installer ISO image, kbd-chooser: Detect a keyboard and select layout, live-installer: Install the system, load-cdrom: Load installer components from CD, load-iso: Load installer components from an installer ISO, load-media: Load installer components from removable media, ltsp-client-builder: build an LTSP environment in the installer target, lvmcfg: Configure the Logical Volume Manager, mbr-udeb: Master Boot Record for IBM-PC compatible computers, mdcfg: Configure MD devices, mouse-modules-4.19.0-11-amd64-di: Mouse support, multipath-modules-4.19.0-11-amd64-di: Multipath support, nbd-modules-4.19.0-11-amd64-di: Network Block Device modules, netcfg-static: Configure a static network, network-console: Continue installation remotely using SSH, openssh-client-udeb: secure shell client for the Debian installer, parted-udeb: Manually partition a hard drive (parted), ppp-modules-4.19.0-11-amd64-di: PPP drivers, ppp-udeb: Point-to-Point Protocol (PPP) - package for Debian Installer, reiserfsprogs-udeb: User-level tools for ReiserFS filesystems, rescue-mode: mount requested partition and start a rescue shell, scsi-nic-modules-4.19.0-11-amd64-di: SCSI drivers for converged NICs, sound-modules-4.19.0-11-amd64-di: sound support, speakup-modules-4.19.0-11-amd64-di: speakup modules, squashfs-modules-4.19.0-11-amd64-di: squashfs modules, udf-modules-4.19.0-11-amd64-di: UDF modules\nd-i anna/choose_modules multiselect \n# Volume group name overlaps with device name\npartman-lvm partman-lvm/vgcreate_devnameused    error   \n# \n# Choices: Argentina, Bolivia, Chile, Colombia, Costa Rica, Cuba, Ecuador, El Salvador, Spain, United States, Guatemala, Honduras, Mexico, Nicaragua, Panama, Paraguay, Peru, Puerto Rico, Dominican Republic, Uruguay, Venezuela, other\nd-i localechooser/shortlist/es  select  \n# for internal use; can be preseeded\nbase-installer  base-installer/install-recommends   boolean true\n# \n# Choices: Cyprus, Turkey, other\nd-i localechooser/shortlist/tr  select  \n# Enable shadow passwords?\nuser-setup-udeb passwd/shadow   boolean true\n# Drivers to include in the initrd:\n# Choices: generic: include all available drivers, targeted: only include drivers needed for this system\nbootstrap-base  base-installer/initramfs-tools/driver-policy    select  most\n# RAID configuration failure\npartman-md  partman-md/commit_failed    error   \n# Country of origin for the keyboard:\n# Choices: \nd-i keyboard-configuration/layout   select  \n# Installation step failed\nd-i debian-installer/main-menu/item-failure error   \n# for internal use; can be preseeded\nd-i preseed/file/checksum   string  \n# Updates management on this system:\n# Choices: No automatic updates, Install security updates automatically\npkgsel  pkgsel/update-policy    select  none\n# Waiting time (in seconds) for link detection:\nd-i netcfg/link_wait_timeout    string  3\n# Debian archive mirror:\n# Choices: \nd-i mirror/https/mirror select  deb.debian.org\n# Unable to automatically remove LVM data\npartman-lvm partman-lvm/device_remove_lvm_span  error   \n# Logical Volume Manager not available\npartman-lvm partman-lvm/nolvm   error   \n# for internal use; can be preseeded\nd-i debian-installer/add-kernel-opts    string  \n# Install the GRUB boot loader to the multipath device?\ngrub-installer  grub-installer/multipath    boolean true\n# Write the changes to disks?\npartman-base    partman/confirm_nooverwrite boolean false\n# for internal use; can be preseeded\npartman-base    partman/early_command   string  \n# Compose key:\n# Choices: No compose key, Right Alt (AltGr), Right Control, Right Logo key, Menu key, Left Logo key, Caps Lock\nd-i keyboard-configuration/compose  select  No compose key\n</code></pre> Luego el fichero <code>/srv/tftp/debian-installer/amd64/boot-screens/syslinux.cfg</code>, lo modificamos para que quede de la siguiente manera... <pre><code># D-I config version 2.0\n# search path for the c32 support libraries (libcom32, libutil etc.)\npath debian-installer/amd64/boot-screens/\ninclude debian-installer/amd64/boot-screens/menu.cfg\ndefault debian-installer/amd64/boot-screens/vesamenu.c32\n\n# Mine\nLABEL Install auto\n    KERNEL debian-installer/amd64/linux\n    INITRD debian-installer/amd64/initrd.gz\n    APPEND preseed/url=tftp://192.168.0.2/preseed.cfg auto=true priority=critical\n#\n\nprompt 0\ntimeout 0\n</code></pre></p> <p>No he conseguido hacer que cargue el fichero preseed, aunque tftp est\u00e9 funcionando. Aparece la nueva opci\u00f3n de instalaci\u00f3n autom\u00e1tica en el men\u00fa de debian installer, pero nunca consigue cargar <code>preseed.cfg</code>.  </p>"},{"location":"aso/compilacion-kernel/","title":"Compilaci\u00f3n de Kernel","text":"<p>Conseguir un kernel lo m\u00e1s peque\u00f1o posible que tenga como m\u00ednimo:</p> <ul> <li>Teclado</li> <li>Conexi\u00f3n de red</li> <li>Pantalla</li> </ul>"},{"location":"aso/compilacion-kernel/#pasos-previos","title":"Pasos previos","text":"<p>Dejo <code>/etc/apt/sources.list</code> de la siguiente manera:</p> <pre><code>sudo nano /etc/apt/sources.list\n</code></pre> <pre><code>deb https://deb.debian.org/debian/ bullseye main\ndeb-src https://deb.debian.org/debian/ bullseye main\n\ndeb https://security.debian.org/debian-security bullseye-security main\ndeb-src https://security.debian.org/debian-security bullseye-security main\n\ndeb https://deb.debian.org/debian/ bullseye-updates main\ndeb-src https://deb.debian.org/debian/ bullseye-updates main\n\ndeb https://deb.debian.org/debian bullseye-backports main\ndeb-src https://deb.debian.org/debian bullseye-backports main\n</code></pre> <p>Actualizo e instalo paquetes:</p> <pre><code>sudo apt update\nsudo apt install linux-source=6.0.3-1~bpo11+1 build-essential qtbase5-dev libncurses-dev\n</code></pre>"},{"location":"aso/compilacion-kernel/#base-de-compilacion","title":"Base de compilaci\u00f3n","text":"<pre><code> atlas@olympus \ue0b0 ~ \ue0b0 mkdir kernel\n atlas@olympus \ue0b0 ~ \ue0b0 cd kernel\n atlas@olympus \ue0b0 ~/kernel \ue0b0 tar xf /usr/src/linux-source-6.0.tar.xz\n atlas@olympus \ue0b0 ~/kernel \ue0b0 cp /boot/config-5.10.0-18-amd64 ~/kernel/linux-source-6.0/.config\n atlas@olympus \ue0b0 ~/kernel \ue0b0\n</code></pre>"},{"location":"aso/compilacion-kernel/#personalizacion-de-compilacion","title":"Personalizaci\u00f3n de compilaci\u00f3n","text":"<p>Reduzco el <code>.config</code> actual con solo los m\u00f3dulos actualmente cargados:</p> <pre><code>make localmodconfig\n</code></pre> <p>Modifico la siguiente l\u00ednea en el <code>Makefile</code> para empezar un versionado de compilaciones marcando con una tag los paquetes generados:</p> <pre><code>nano Makefile\n</code></pre> <pre><code>EXTRAVERSION = -v1\n</code></pre> <p>Para elegir qu\u00e9 m\u00f3dulos quitar y cu\u00e1les dejar, uso el siguiente men\u00fa:</p> <pre><code>make nconfig\n</code></pre>"},{"location":"aso/compilacion-kernel/#compilacion","title":"Compilaci\u00f3n","text":"<p>Podemos hacerla de la manera simple:</p> <pre><code>make -j 12 bindeb-pkg\n</code></pre> <p>O de la manera completa:</p> <pre><code>time make -j 12 bindeb-pkg &amp;&amp; ( speaker-test -t sine -f 500 )&amp; pid=$! ; sleep 0.5s ; kill -9 $pid\n</code></pre> <p>Info</p> <p>Al finalizar, con la manera completa, obtendremos la duraci\u00f3n de la compilaci\u00f3n  y un pitido por los altavoces de aviso</p> <p>Los ficheros deb generados se encontrar\u00e1n en el directorio padre:</p> <pre><code> atlas@olympus \ue0b0 ~/kernel/linux-source-6.0 \ue0b0 cd ..\n atlas@olympus \ue0b0 ~/kernel \ue0b0 ls\n.rw-r--r-- atlas atlas  15 MB Thu Nov 10 13:40:59 2022 \uf187 linux-image-6.0.3-v1_6.0.3-v1-1_amd64.deb\n.rw-r--r-- atlas atlas 8.1 MB Thu Nov 10 13:40:32 2022 \uf187 linux-headers-6.0.3-v1_6.0.3-v1-1_amd64.deb\n.rw-r--r-- atlas atlas 1.2 MB Thu Nov 10 13:40:46 2022 \uf187 linux-libc-dev_6.0.3-v1-1_amd64.deb\n.rw-r--r-- atlas atlas 5.1 KB Thu Nov 10 13:41:00 2022 \uf016 linux-upstream_6.0.3-v1-1_amd64.buildinfo\ndrwxr-xr-x atlas atlas 4.0 KB Thu Nov 10 13:41:54 2022 \uf115 ..\ndrwxr-xr-x atlas atlas 4.0 KB Thu Nov 10 13:40:20 2022 \uf115 linux-source-6.0\n.rw-r--r-- atlas atlas 1.8 KB Thu Nov 10 13:41:00 2022 \uf016 linux-upstream_6.0.3-v1-1_amd64.changes\ndrwxr-xr-x atlas atlas 269 B  Thu Nov 10 13:41:00 2022 \uf115 .\n</code></pre>"},{"location":"aso/compilacion-kernel/#instalacion","title":"Instalaci\u00f3n","text":"<pre><code>sudo dpkg -i linux-image-6.0.3-v1_6.0.3-v1-1_amd64.deb\n</code></pre> <p>Los contenidos estar\u00e1n en <code>/boot</code></p> <p>Para desinstalar:</p> <pre><code>sudo dpkg -P linux-image-6.0.3-v1\n</code></pre> <p>Tambi\u00e9n podr\u00edamos desinstalar borrando manualmente los ficheros de <code>/boot</code> que no necesitemos</p>"},{"location":"aso/compilacion-kernel/#proceso-de-reduccion","title":"Proceso de reducci\u00f3n","text":"<p>Tras instalar un kernel, reiniciar la m\u00e1quina, y cargarlo desde la vista avanzada de grub, pueden pasar 2 cosas:</p> <ul> <li>Que funcione</li> <li>Que no funcione</li> </ul>"},{"location":"aso/compilacion-kernel/#si-funciona","title":"Si funciona","text":"<p>Hago una copia de seguridad versionada del <code>.config</code>:</p> <pre><code>cp .config ../kernel-config-backups/.configv1\n</code></pre> <p>Subo el <code>EXTRAVERSION</code> del <code>Makefile</code> de n\u00famero</p> <p>Limpio los restos de la anterior compilaci\u00f3n:</p> <pre><code>make -j 12 clean\n</code></pre> <p>Compilo de nuevo</p>"},{"location":"aso/compilacion-kernel/#si-no-funciona","title":"Si no funciona","text":"<p>Recupero la copia de seguridad m\u00e1s actualizada del <code>.config</code> que tenga en ese momento:</p> <pre><code>cp ../kernel-config-backups/.configv1 .config\n</code></pre> <p>Limpio los restos de la anterior compilaci\u00f3n:</p> <pre><code>make -j 12 clean\n</code></pre> <p>Compilo de nuevo</p>"},{"location":"aso/compilacion-kernel/#entregas","title":"Entregas","text":"<p>Muestro la cantidad de m\u00f3dulos est\u00e1ticos y din\u00e1micos:</p> <pre><code>cat .config | grep \"=y\" | wc -l\ncat .config | grep \"=m\" | wc -l\n</code></pre> <p></p> <p>Repositorio con el historial de compilaciones:</p> <p>https://github.com/adriasir123/kernel-config-backups</p> <p>Comparaci\u00f3n de tama\u00f1o de los vmlinuz:</p> <p></p> <p>El tama\u00f1o se ha reducido a la mitad</p> <p>Aqu\u00ed puedes descargarte el paquete final:</p> <p>https://www.mediafire.com/file/8taqlicfk2eyos0/linux-image-6.0.3-vfinal_6.0.3-vfinal-147_amd64.deb/file</p>"},{"location":"aso/compilacion-kernel/#conclusiones","title":"Conclusiones","text":"<p>En esta pr\u00e1ctica se aprende mucho sobre la relaci\u00f3n tan directa que hay entre el kernel y el hardware de la m\u00e1quina, pero tiene graves problemas que se deber\u00edan de solucionar:</p> <ul> <li>Llega un momento en que se vuelve repetitiva y ya no aprendes nada nuevo, s\u00f3lo est\u00e1s haciendo las cosas de forma mec\u00e1nica</li> <li>No es para nada igualitaria, genera desigualdad. Este es sin duda el peor problema. Cada persona tiene un port\u00e1til con caracter\u00edsticas diferentes, y no es lo mismo alguien con un procesador i7 que alguien con un i3. Hay gente que ha tenido compilaciones de 1 hora, y otra gente como yo que empec\u00e9 teniendo compilaciones de 12 minutos cuando todav\u00eda no hab\u00eda empezado a quitar m\u00f3dulos</li> </ul> <p>Soluciones que propongo:</p> <ul> <li>En lugar de que el objetivo de la pr\u00e1ctica sea conseguir el kernel m\u00e1s peque\u00f1o posible, cambiarlo a que el objetivo sea llegar a un n\u00famero de compilaciones razonables, por ejemplo 10-20</li> <li>Utilizar OpenStack para las compilaciones, as\u00ed se eliminar\u00eda el problema de la desigualdad que genera la pr\u00e1ctica. Es cierto que al ser m\u00e1quinas virtuales no es la misma experiencia porque el hardware es virtualizado, pero al final el proceso de compilaci\u00f3n es el mismo, y que el hardware sea virtualizado no creo que genere un problema a la hora de aprender</li> </ul>"},{"location":"aso/compilacion-programas-c/","title":"Compilaci\u00f3n de programas en C","text":""},{"location":"aso/compilacion-programas-c/#escenario","title":"Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\nconfig.vm.provider :libvirt do |libvirt|\nlibvirt.cpus = 1\nlibvirt.memory = 512\nend\n\nconfig.vm.define :compilacion do |compilacion|\ncompilacion.vm.box = \"debian/bullseye64\"\ncompilacion.vm.hostname = \"compilacion\"\nend\n\nend\n</code></pre>"},{"location":"aso/compilacion-programas-c/#apache-2454","title":"Apache 2.4.54","text":""},{"location":"aso/compilacion-programas-c/#dependencias","title":"Dependencias","text":"<pre><code>sudo apt update\nsudo apt build-dep apache2 </code></pre>"},{"location":"aso/compilacion-programas-c/#codigo-fuente","title":"C\u00f3digo fuente","text":"<p>Cambio a un directorio apropiado:</p> <pre><code>cd /usr/local/src\n</code></pre> <p>Descargo:</p> <pre><code>sudo wget https://dlcdn.apache.org/httpd/httpd-2.4.54.tar.gz\n</code></pre> <p>Extraigo:</p> <pre><code>sudo gzip -d httpd-2.4.54.tar.gz\nsudo tar xvf httpd-2.4.54.tar\n</code></pre> <p>Entro al directorio generado:</p> <pre><code>cd httpd-2.4.54\n</code></pre>"},{"location":"aso/compilacion-programas-c/#generacion-de-makefile","title":"Generaci\u00f3n de Makefile","text":"<p>Creo el directorio que necesitaremos:</p> <pre><code>sudo mkdir /usr/local/apache2.4.54\n</code></pre> <p>Genero:</p> <pre><code>sudo ./configure --prefix=/usr/local/apache2.4.54\n</code></pre>"},{"location":"aso/compilacion-programas-c/#compilacion","title":"Compilaci\u00f3n","text":"<pre><code>sudo make\n</code></pre>"},{"location":"aso/compilacion-programas-c/#instalacion","title":"Instalaci\u00f3n","text":"<pre><code>sudo make install\n</code></pre>"},{"location":"aso/compilacion-programas-c/#funcionamiento","title":"Funcionamiento","text":"<p>Iniciamos el servidor:</p> <pre><code>sudo /usr/local/apache2.4.54/bin/apachectl -k start\n</code></pre> <p>Mostramos la web por defecto accediendo a la IP de la VM:</p> <p></p> <p>El html que vemos se encuentra en <code>/usr/local/apache2.4.54/htdocs/index.html</code></p> <p>Podemos parar el servidor as\u00ed:</p> <pre><code>sudo /usr/local/apache2.4.54/bin/apachectl -k stop\n</code></pre> <p>Al recargar la p\u00e1gina ver\u00edamos que no funciona:</p> <p></p>"},{"location":"aso/compilacion-programas-c/#desinstalacion","title":"Desinstalaci\u00f3n","text":"<p>Simplemente tendr\u00edamos que borrar el directorio donde hicimos la instalaci\u00f3n, ya que este c\u00f3digo fuente no nos provee de la funci\u00f3n <code>make uninstall</code>:</p> <pre><code>sudo rm -r /usr/local/apache2.4.54\n</code></pre> <p>Despu\u00e9s de un reinicio de la VM nuestro Apache dejar\u00eda de funcionar.</p>"},{"location":"aso/compilacion-programas-c/#nala","title":"Nala","text":""},{"location":"aso/compilacion-programas-c/#anadir-testing","title":"A\u00f1adir Testing","text":"<p>Dejo <code>/etc/apt/sources.list</code> de la siguiente manera:</p> <pre><code>deb https://deb.debian.org/debian bullseye main\ndeb https://deb.debian.org/debian testing main\ndeb-src https://deb.debian.org/debian bullseye main\ndeb https://security.debian.org/debian-security bullseye-security main\ndeb-src https://security.debian.org/debian-security bullseye-security main\ndeb https://deb.debian.org/debian bullseye-updates main\ndeb-src https://deb.debian.org/debian bullseye-updates main\ndeb https://deb.debian.org/debian bullseye-backports main\ndeb-src https://deb.debian.org/debian bullseye-backports main\n</code></pre>"},{"location":"aso/compilacion-programas-c/#requerimientos","title":"Requerimientos","text":"<pre><code>sudo apt update\nsudo apt install git python3-apt pandoc build-essential python3-pip fish\n</code></pre>"},{"location":"aso/compilacion-programas-c/#clonar-main","title":"Clonar main","text":"<pre><code>git clone https://gitlab.com/volian/nala.git\ncd nala\n</code></pre>"},{"location":"aso/compilacion-programas-c/#instalar","title":"Instalar","text":"<pre><code>sudo make install\n</code></pre> <p>Comprobamos que funciona:</p> <pre><code>vagrant@compilacion:~$ nala --version\nnala 0.11.1\n</code></pre>"},{"location":"aso/compilacion-programas-c/#desinstalar","title":"Desinstalar","text":"<pre><code>sudo make uninstall\n</code></pre>"},{"location":"aso/compilacion-programas-c/#vs-apt","title":"VS apt","text":"<ul> <li>Descargas en paralelo</li> <li><code>nala fetch</code> elegir\u00e1 los 3 mirrors m\u00e1s r\u00e1pidos con respecto a latencia (ms) y nos los guardar\u00e1 en un fichero</li> <li><code>nala history</code> guarda las transacciones</li> <li>Mejora visualmente</li> </ul> <p>Aqu\u00ed podemos ver muchas funciones m\u00e1s que puede hacer Nala.</p>"},{"location":"aso/compilacion-programas-c/#opiniones","title":"Opiniones","text":"<p>Creo que Nala a\u00fan est\u00e1 en un estado un poco verde, podr\u00eda tener muchas m\u00e1s funciones, pero actualmente se encuentra oficialmente a\u00f1adido en testing y en unstable.</p> <p>Esto quiere decir que es probable que en la siguiente release stable de Debian (Bookworm) contemos con Nala como paquete oficial.</p> <p>Nala es un frontend de apt como lo son Aptitude y Synaptic, inspirado en dnf, y tan s\u00f3lo por lo vistoso que es y la rapidez que ofrece le veo mucho futuro si se sigue con el desarrollo.</p>"},{"location":"aso/debian11_automatico/","title":"Instalaci\u00f3n autom\u00e1tica de Debian con preseed","text":"<p>Instrucciones generales:</p> <ul> <li>Partimos del preseed.cfg ejemplo de Debian</li> <li>Podemos encontrar la lista de locales posibles en <code>/usr/share/i18n/SUPPORTED</code></li> <li>Contrase\u00f1as cifradas<ul> <li>Instalo: <code>sudo apt install whois</code></li> <li>Cifro: <code>printf \"1234\" | mkpasswd -s -m md5</code></li> </ul> </li> <li>LVM con:<ul> <li><code>/</code></li> <li><code>/var</code></li> <li><code>/home</code></li> </ul> </li> </ul>"},{"location":"aso/debian11_automatico/#tipo-1-iso-modificada","title":"Tipo 1: ISO modificada","text":""},{"location":"aso/debian11_automatico/#11","title":"1.1","text":"<p>Usar\u00e9 la ISO <code>debian-11.5.0-amd64-netinst.iso</code> y el siguiente <code>preseed.cfg</code>:</p> <pre><code># Locales\nd-i debian-installer/language string en_GB:en\nd-i debian-installer/country string ES\nd-i debian-installer/locale string en_GB.UTF-8\n\n# Keyboard\nd-i keyboard-configuration/xkb-keymap select es\n\n# Network\nd-i netcfg/choose_interface select auto\nd-i netcfg/get_hostname string preseed\nd-i netcfg/get_domain string unassigned-domain\nd-i netcfg/wireless_wep string\n\n# Mirror\nd-i mirror/country string ES\nd-i mirror/http/hostname string deb.debian.org\nd-i mirror/http/directory string /debian\nd-i mirror/http/proxy string\nd-i mirror/suite string stable\n\n# Accounts\nd-i passwd/root-password-crypted password $1$EuB1h0/P$IIUGcTg79ZeX72l28Fh0E0\nd-i passwd/user-fullname string preseed\nd-i passwd/username string preseed\nd-i passwd/user-password-crypted password $1$N/qFSN1R$Ub33hbzjj4.jBhbygvN0P/\n\n# Clock and time zone\nd-i clock-setup/utc boolean true\nd-i time/zone string Europe/Madrid\nd-i clock-setup/ntp boolean true\n# Partitioning\nd-i partman-auto/disk string /dev/vda\nd-i partman-lvm/device_remove_lvm boolean true\nd-i partman-auto/method string lvm\nd-i partman-lvm/confirm boolean true\nd-i partman-auto/choose_recipe select mypartitioning\nd-i partman-auto-lvm/new_vg_name string vg00\nd-i partman-auto-lvm/guided_size string max\nd-i partman-lvm/confirm_nooverwrite boolean true\nd-i partman-auto/expert_recipe string                         \\\nmypartitioning ::                                       \\\n512 1 512 xfs                                   \\\n$primary{ } $bootable{ }                \\\nmethod{ format } format{ }              \\\nuse_filesystem{ } filesystem{ xfs }     \\\nmountpoint{ /boot }                     \\\n.                                               \\\n1024 1 1024 linux-swap                          \\\n$defaultignore{ }                       \\\n$lvmok{ }                               \\\nlv_name{ swap }                         \\\nin_vg { vg00 }                          \\\nmethod{ swap } format{ }                \\\n.                                               \\\n3072 1 3072 xfs                                 \\\n$defaultignore{ }                       \\\n$lvmok{ }                               \\\nlv_name{ root }                         \\\nin_vg { vg00 }                          \\\nmethod{ format } format{ }              \\\nuse_filesystem{ } filesystem{ xfs }     \\\nmountpoint{ / }                         \\\n.                                               \\\n6144 1 6144 xfs                                 \\\n$defaultignore{ }                       \\\n$lvmok{ }                               \\\nlv_name{ var }                          \\\nin_vg { vg00 }                          \\\nmethod{ format } format{ }              \\\nuse_filesystem{ } filesystem{ xfs }     \\\nmountpoint{ /var }                      \\\n.                                               \\\n8192 1 1000000000 xfs                           \\\n$defaultignore{ }                       \\\n$lvmok{ }                               \\\nlv_name{ home }                         \\\nin_vg { vg00 }                          \\\nmethod{ format } format{ }              \\\nuse_filesystem{ } filesystem{ xfs }     \\\nmountpoint{ /home }                     \\\n.\n\nd-i partman-partitioning/confirm_write_new_label boolean true\nd-i partman/choose_partition select finish\nd-i partman/confirm boolean true\nd-i partman/confirm_nooverwrite boolean true\n# Base system\nd-i base-installer/kernel/image string linux-image-amd64\n\n# Apt\nd-i apt-setup/services-select multiselect security, updates\nd-i apt-setup/security_host string security.debian.org\n\n# Package selection\ntasksel tasksel/first multiselect standard, ssh-server\npopularity-contest popularity-contest/participate boolean false\n# Boot loader\nd-i grub-installer/only_debian boolean true\nd-i grub-installer/with_other_os boolean true\nd-i grub-installer/bootdev  string default\n\n# Finishing up\nd-i finish-install/reboot_in_progress note\n</code></pre>"},{"location":"aso/debian11_automatico/#12","title":"1.2","text":"<p>Instalo:</p> <pre><code>sudo apt install libarchive-tools\n</code></pre> <p>Extraigo los ficheros de la ISO en mi directorio <code>isofiles</code>:</p> <pre><code>bsdtar -C isofiles -xf debian-11.5.0-amd64-netinst.iso\n</code></pre>"},{"location":"aso/debian11_automatico/#13","title":"1.3","text":"<p>Inserto mi <code>preseed.cfg</code> en el <code>initrd</code>:</p> <pre><code>chmod +w -R isofiles/install.amd/\ngunzip isofiles/install.amd/initrd.gz\necho preseed.cfg | cpio -H newc -o -A -F isofiles/install.amd/initrd\ngzip isofiles/install.amd/initrd\nchmod -w -R isofiles/install.amd/\n</code></pre>"},{"location":"aso/debian11_automatico/#14","title":"1.4","text":"<p>Regenero el checksum:</p> <pre><code>cd isofiles\nchmod +w md5sum.txt\nfind -follow -type f ! -name md5sum.txt -print0 | xargs -0 md5sum &gt; md5sum.txt\nchmod -w md5sum.txt\n</code></pre> <p>Aparece el siguiente warning, pero lo podemos ignorar:</p> <pre><code>find: File system loop detected; \u2018./debian\u2019 is part of the same file system loop as \u2018.\u2019.\n</code></pre>"},{"location":"aso/debian11_automatico/#15","title":"1.5","text":"<p>Genero la nueva ISO modificada:</p> <pre><code>sudo genisoimage -r -J -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o preseed-debian-11.5.0-amd64-netinst.iso .\n</code></pre>"},{"location":"aso/debian11_automatico/#16","title":"1.6","text":"<p>Copio la ISO al pool de im\u00e1genes de libvirt para poder crear una m\u00e1quina a partir de ella:</p> <pre><code>sudo cp preseed-debian-11.5.0-amd64-netinst.iso /var/lib/libvirt/images\n</code></pre>"},{"location":"aso/debian11_automatico/#17","title":"1.7","text":"<p>Para que arranque la instalaci\u00f3n autom\u00e1tica, hacemos lo siguiente:</p> <p></p> <p></p> <p>Cuando termine, tendremos la m\u00e1quina preparada.</p>"},{"location":"aso/debian11_automatico/#18","title":"1.8","text":"<p>Podemos comprobar que el sistema se ha configurado con los datos que hemos proporcionado. Por ejemplo...</p> <p>Usuario y hostname:</p> <p></p> <p>Particiones:</p> <p></p> <p>Sistemas de ficheros correctos:</p> <p></p>"},{"location":"aso/debian11_automatico/#tipo-2-preseedcfg-en-nginx","title":"Tipo 2: <code>preseed.cfg</code> en Nginx","text":""},{"location":"aso/debian11_automatico/#21","title":"2.1","text":"<p>Instalo el servidor web en una VM separada:</p> <pre><code>sudo apt install nginx\n</code></pre> <p>A\u00f1ado el <code>preseed.cfg</code> anterior en la ra\u00edz, y muestro que se ha publicado:</p> <p></p>"},{"location":"aso/debian11_automatico/#22","title":"2.2","text":"<p>Esta vez crearemos una m\u00e1quina a partir de la ISO <code>debian-11.5.0-amd64-netinst.iso</code> sin modificar.</p> <p>Para que arranque la instalaci\u00f3n autom\u00e1tica tomando <code>preseed.cfg</code> desde Nginx, hacemos lo siguiente:</p> <p></p> <p></p> <p></p> <p>Despu\u00e9s de hacer esto, la instalaci\u00f3n autom\u00e1tica se har\u00eda.</p> <p>\u00a1IMPORTANTE LIMITACI\u00d3N DE D-I EN INSTALACIONES POR RED! El hostname del preseed ser\u00e1 ignorado por los motivos explicados aqu\u00ed. A\u00fan as\u00ed, existe una soluci\u00f3n alternativa, aunque no es una soluci\u00f3n real al problema ya que no existe.</p> <p>Tendr\u00edamos que a\u00f1adir lo siguiente al final de <code>preseed.cfg</code>:</p> <pre><code># Forced hostname over what DHCP said\nd-i preseed/late_command string in-target /bin/bash -c 'echo preseed &gt; /etc/hostname'\n</code></pre>"},{"location":"aso/debian11_automatico/#tipo-3-pxe","title":"Tipo 3: PXE","text":""},{"location":"aso/debian11_automatico/#31","title":"3.1","text":"<p>Instalo el servidor DHCP:</p> <pre><code>sudo apt install isc-dhcp-server\n</code></pre> <p>Dejo <code>/etc/default/isc-dhcp-server</code> de la siguiente manera:</p> <pre><code># Defaults for isc-dhcp-server (sourced by /etc/init.d/isc-dhcp-server)\n# Path to dhcpd's config file (default: /etc/dhcp/dhcpd.conf).\nDHCPDv4_CONF=/etc/dhcp/dhcpd.conf\n#DHCPDv6_CONF=/etc/dhcp/dhcpd6.conf\n# Path to dhcpd's PID file (default: /var/run/dhcpd.pid).\n#DHCPDv4_PID=/var/run/dhcpd.pid\n#DHCPDv6_PID=/var/run/dhcpd6.pid\n# Additional options to start dhcpd with.\n#   Don't use options -cf or -pf here; use DHCPD_CONF/ DHCPD_PID instead\n#OPTIONS=\"\"\n# On what interfaces should the DHCP server (dhcpd) serve DHCP requests?\n#   Separate multiple interfaces with spaces, e.g. \"eth0 eth1\".\nINTERFACESv4=\"enp1s0\"\nINTERFACESv6=\"\"\n</code></pre> <p>Hago una copia de seguridad del fichero de configuraci\u00f3n principal original:</p> <pre><code>sudo cp dhcpd.conf dhcpd.conf.back\n</code></pre> <p>Escribo el siguiente <code>dhcpd.conf</code>:</p> <pre><code>default-lease-time 600;\nmax-lease-time 7200;\nallow booting;\nsubnet 192.168.100.0 netmask 255.255.255.0 {\nrange 192.168.100.20 192.168.100.30;\noption broadcast-address 192.168.100.255;\noption routers 192.168.100.1;\noption domain-name-servers 192.168.100.1;\nnext-server 192.168.100.10;\nfilename \"pxelinux.0\";\n}\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart isc-dhcp-server\n</code></pre>"},{"location":"aso/debian11_automatico/#32","title":"3.2","text":"<p>Instalo el servidor TFTP:</p> <pre><code>sudo apt install tftpd-hpa\n</code></pre> <p>Descargo <code>netboot.tar.gz</code> en <code>/srv/tftp</code>:</p> <pre><code>sudo wget https://deb.debian.org/debian/dists/bullseye/main/installer-amd64/current/images/netboot/netboot.tar.gz\n</code></pre> <p>Extraigo:</p> <pre><code>sudo tar -xvf netboot.tar.gz\n</code></pre> <p>Acabo teniendo la siguiente estructura:</p> <pre><code>debian@debian:/srv/tftp$ ls -la\ntotal 16\ndrwxr-xr-x 3 root root 4096 Oct  3 09:52 .\ndrwxr-xr-x 3 root root 4096 Oct  3 09:33 ..\ndrwxr-xr-x 3 root root 4096 Sep  6 22:55 debian-installer\nlrwxrwxrwx 1 root root   47 Sep  6 22:55 ldlinux.c32 -&gt; debian-installer/amd64/boot-screens/ldlinux.c32\nlrwxrwxrwx 1 root root   33 Sep  6 22:55 pxelinux.0 -&gt; debian-installer/amd64/pxelinux.0\nlrwxrwxrwx 1 root root   35 Sep  6 22:55 pxelinux.cfg -&gt; debian-installer/amd64/pxelinux.cfg\n-rw-r--r-- 1 root root   65 Sep  6 22:55 version.info\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart tftpd-hpa\n</code></pre>"},{"location":"aso/debian11_automatico/#33","title":"3.3","text":"<p>Para crear una VM que bootee desde PXE sin ISO, hago los siguientes pasos:</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>Conecto la VM a una red creada por m\u00ed, sin DHCP, para que el servidor PXE sea el \u00fanico con DHCP en la red</p> <p></p> <p>Al principio el arranque falla, pero es porque necesitamos modificarlo en View &gt; Details</p> <p></p> <p>Reiniciamos la m\u00e1quina, y el arranque por PXE funcionar\u00e1:</p> <p></p> <p></p> <p>Usamos de nuevo el m\u00e9todo de carga de <code>preseed.cfg</code> por Nginx. Esta vez instalado en el servidor PXE:</p> <p></p> <p>Terminada la instalaci\u00f3n, volvemos a cambiar el orden de arranque:</p> <p></p> <p>Vemos que tenemos la VM funcionando, y con una IP dentro del pool:</p> <p></p>"},{"location":"aso/ejercicios-de-modulos/","title":"Ejercicios de manejo de m\u00f3dulos","text":""},{"location":"aso/ejercicios-de-modulos/#ejercicio-1","title":"Ejercicio 1","text":"<p>Listar los m\u00f3dulos cargados</p> <p>Podemos hacer:</p> <pre><code>lsmod\n</code></pre> <p>Output</p> <p>O tambi\u00e9n:</p> <pre><code>cat /proc/modules\n</code></pre> <p>Output</p>"},{"location":"aso/ejercicios-de-modulos/#ejercicio-2","title":"Ejercicio 2","text":"<p>Contar el n\u00famero de m\u00f3dulos disponibles en el n\u00facleo</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 find /lib/modules/$(uname -r)/kernel -type f -iname '*.ko' | wc -l\n3900\n</code></pre>"},{"location":"aso/ejercicios-de-modulos/#ejercicio-3","title":"Ejercicio 3","text":"<p>Monitorizar con <code>sudo dmesg -wH</code> la conexi\u00f3n de un pendrive</p> <pre><code>sudo dmesg -wH\n</code></pre> <p>Muestro los cambios:</p> <p></p>"},{"location":"aso/ejercicios-de-modulos/#ejercicio-4","title":"Ejercicio 4","text":"<p>Elegir un m\u00f3dulo no esencial</p> <p>Elijo <code>kvm_intel</code></p> <p>Comprobar que est\u00e1 actualmente cargado</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 lsmod | grep -w 'kvm_intel'\nkvm_intel             331776  0\nkvm                   937984  1 kvm_intel\n</code></pre> <p>Descargar el m\u00f3dulo</p> <pre><code>sudo modprobe -r kvm_intel\n</code></pre> <p>Comprobar qu\u00e9 ocurre</p> <p>Ya no nos aparece en el listado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 lsmod | grep -w 'kvm_intel'\n\u2718 atlas@olympus \ue0b0 ~ \ue0b0\n</code></pre> <p>Adem\u00e1s, como es l\u00f3gico, KVM dejar\u00e1 de funcionar:</p> <p></p> <p>Volver a cargarlo</p> <pre><code>sudo modprobe kvm_intel\n</code></pre> <p>Compruebo que vuelve a aparecer en el listado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 lsmod | grep -w 'kvm_intel'\nkvm_intel             331776  0\nkvm                   937984  1 kvm_intel\n</code></pre> <p>KVM volver\u00e1 a funcionar:</p> <p></p>"},{"location":"aso/ejercicios-de-modulos/#ejercicio-5","title":"Ejercicio 5","text":"<p>Elegir un m\u00f3dulo que est\u00e9 en uso</p> <p>Elijo <code>kvm_intel</code> y compruebo que est\u00e1 cargado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 lsmod | grep -w 'kvm_intel'\nkvm_intel             331776  0\nkvm                   937984  1 kvm_intel\n</code></pre> <p>Configurar el arranque para que no se cargue autom\u00e1ticamente</p> <p>Creo el siguiente fichero:</p> <pre><code>sudo nano /etc/modprobe.d/kvm_intel.conf\n</code></pre> <p>Con los contenidos:</p> <pre><code>blacklist kvm_intel\n</code></pre> <p>Ejecuto:</p> <pre><code>sudo depmod -ae\nsudo update-initramfs -u\n</code></pre> <p>Tras reiniciar, por ejemplo, no puedo iniciar m\u00e1quinas de KVM:</p> <p></p>"},{"location":"aso/ejercicios-de-modulos/#ejercicio-6","title":"Ejercicio 6","text":"<p>Cargar el m\u00f3dulo loop</p> <pre><code>sudo modprobe loop\n</code></pre> <p>Compruebo que se ha cargado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 lsmod | grep loop\nloop                   40960  0\n</code></pre> <p>Obtener informaci\u00f3n</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo modinfo loop\nfilename:       /lib/modules/5.10.0-19-amd64/kernel/drivers/block/loop.ko\nalias:          devname:loop-control\nalias:          char-major-10-237\nalias:          block-major-7-*\nlicense:        GPL\ndepends:\nretpoline:      Y\nintree:         Y\nname:           loop\nvermagic:       5.10.0-19-amd64 SMP mod_unload modversions\nsig_id:         PKCS#7\nsigner:         Debian Secure Boot CA\nsig_key:        32:A0:28:7F:84:1A:03:6F:A3:93:C1:E0:65:C4:3A:E6:B2:42:26:43\nsig_hashalgo:   sha256\nsignature:      72:B9:28:99:6F:56:69:20:25:13:90:20:7B:3A:2B:77:AE:2B:44:14:\n            C1:3D:83:4B:8E:4D:85:30:32:82:D6:62:31:79:80:F3:F8:C7:65:1E:\n            26:BF:89:AA:F6:DF:E2:E5:45:55:35:D3:D6:CE:79:40:77:A2:BF:29:\n            53:C1:33:3E:80:2B:D6:F6:86:C4:78:D6:2B:27:7A:B6:65:62:66:B8:\n            9D:FE:A3:F5:FF:01:2E:20:E0:6A:65:C3:98:17:44:58:CA:F8:D7:1F:\n            D9:D4:59:C8:03:A1:25:2C:76:EE:5B:5C:C4:E4:36:3F:1E:06:AD:07:\n            76:F4:08:6A:B1:E1:37:32:5C:53:86:96:62:6F:D3:29:33:DE:26:C0:\n            9F:7D:95:2A:FB:AB:F8:C7:80:B9:7F:88:DA:3B:26:9F:FB:E7:D4:E5:\n            76:48:DE:66:B3:17:0F:C9:D5:EE:56:45:9F:CC:C7:A6:9F:9C:2E:F8:\n            41:01:83:A2:AD:20:E7:CD:31:B1:13:A7:12:E6:65:E0:B9:A7:B0:7A:\n            16:E5:34:1F:D6:FE:BF:76:6F:7E:95:12:00:45:8A:80:9A:13:EA:80:\n            CF:AB:5D:7D:E2:01:93:F8:9F:C2:8E:6C:6C:BD:ED:DF:86:FE:17:B0:\n            70:B2:66:E9:3E:E1:7A:ED:73:C8:5B:D6:7A:78:6D:3D\nparm:           max_loop:Maximum number of loop devices (int)\nparm:           max_part:Maximum number of partitions per loop device (int)\n</code></pre> <p>Explicar para qu\u00e9 sirve</p> <p>Es el m\u00f3dulo encargado de controlar los loop devices, que son pseudo-dispositivos que posibilitan el acceso a determinados ficheros como si fueran dispositivos de bloque.</p> <p>Los podemos listar de la siguiente manera:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 ls /dev/loop*\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop0\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop1\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop2\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop3\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop4\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop5\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop6\nbrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ufc29 /dev/loop7\ncrw-rw---- root disk 0 B Thu Nov  3 17:14:53 2022 \ue601 /dev/loop-control\n</code></pre> <p>Listar el contenido de /sys/module/loop/parameters</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 ls /sys/module/loop/parameters\n.r--r--r-- root root 4.0 KB Thu Nov  3 18:26:35 2022 \uf016 max_loop\n.r--r--r-- root root 4.0 KB Thu Nov  3 18:26:35 2022 \uf016 max_part\ndrwxr-xr-x root root   0 B  Thu Nov  3 18:26:34 2022 \uf115 .\ndrwxr-xr-x root root   0 B  Thu Nov  3 17:14:53 2022 \uf115 ..\n</code></pre> <p>Configurar el m\u00f3dulo para tener como m\u00e1ximo 12 dispositivos loop</p> <p>Creo el siguiente fichero:</p> <pre><code>sudo nano /etc/modprobe.d/loop.conf\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code>options loop max_loop=12\n</code></pre> <p>Si recargamos el m\u00f3dulo y volvemos a listar nuestros dispositivos loop, veremos que ahora tenemos 12:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo modprobe -r loop\n atlas@olympus \ue0b0 ~ \ue0b0 sudo modprobe loop\n atlas@olympus \ue0b0 ~ \ue0b0 ls /dev/loop*\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop0\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop1\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop10\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop11\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop2\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop3\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop4\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop5\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop6\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop7\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop8\nbrw-rw---- root disk 0 B Thu Nov  3 18:43:57 2022 \ufc29 /dev/loop9\ncrw-rw---- root disk 0 B Thu Nov  3 18:43:56 2022 \ue601 /dev/loop-control\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/","title":"Ejercicios gesti\u00f3n de paqueter\u00eda","text":""},{"location":"aso/ejercicios-paqueteria/#escenario","title":"Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\nconfig.vm.provider :libvirt do |libvirt|\nlibvirt.cpus = 1\nlibvirt.memory = 1024\nend\nconfig.vm.define :paqueteria do |paqueteria|\npaqueteria.vm.box = \"debian/bullseye64\"\npaqueteria.vm.hostname = \"paqueteria\"\nend\nend\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#trabajo-con-apt-aptitude-dpkg","title":"Trabajo con apt, aptitude, dpkg","text":""},{"location":"aso/ejercicios-paqueteria/#ejercicio-1-apt","title":"Ejercicio 1 apt","text":"<p>Explicar lo que sucede al hacer <code>sudo apt update</code></p> <p><code>man apt</code> nos dice lo siguiente:</p> <pre><code>       update (apt-get(8))\nupdate is used to download package information from all configured sources. Other commands operate on this data to e.g. perform package upgrades\n           or search in and display details about all packages available for installation.\n</code></pre> <p>Descarga informaci\u00f3n de los paquetes (package index) seg\u00fan nuestros sources configurados en el fichero <code>/etc/apt/sources.list</code> y en el directorio <code>/etc/apt/sources.list.d</code>.</p> <p>Ejemplo de output:</p> <pre><code>vagrant@paqueteria:~$ sudo apt update\nGet:1 https://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:2 https://security.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:3 https://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:4 https://deb.debian.org/debian bullseye-backports InRelease [49.0 kB]\nGet:5 https://deb.debian.org/debian bullseye/main Sources [8633 kB]\nGet:6 https://security.debian.org/debian-security bullseye-security/main Sources [167 kB]\nGet:7 https://security.debian.org/debian-security bullseye-security/main amd64 Packages [193 kB]\nGet:8 https://security.debian.org/debian-security bullseye-security/main Translation-en [122 kB]\nGet:9 https://deb.debian.org/debian bullseye/main amd64 Packages [8184 kB]\nGet:10 https://deb.debian.org/debian bullseye/main Translation-en [6239 kB]\nGet:11 https://deb.debian.org/debian bullseye-updates/main Sources [4812 B]\nGet:12 https://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]\nGet:13 https://deb.debian.org/debian bullseye-updates/main Translation-en [7929 B]\nGet:14 https://deb.debian.org/debian bullseye-backports/main Sources [346 kB]\nGet:15 https://deb.debian.org/debian bullseye-backports/main amd64 Packages [356 kB]\nGet:16 https://deb.debian.org/debian bullseye-backports/main Translation-en [292 kB]\nFetched 24.8 MB in 12s (2068 kB/s)\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\n18 packages can be upgraded. Run 'apt list --upgradable' to see them.\n</code></pre> <p>El resultado se almacena en <code>/var/lib/apt/lists/</code>.</p> <p>Explicar lo que sucede al hacer <code>sudo apt upgrade</code></p> <p><code>man apt</code> nos dice lo siguiente:</p> <pre><code>       upgrade (apt-get(8))\nupgrade is used to install available upgrades of all packages currently installed on the system from the sources configured via sources.list(5).\n           New packages will be installed if required to satisfy dependencies, but existing packages will never be removed. If an upgrade for a package\n           requires the removal of an installed package the upgrade for this package isn't performed.\n</code></pre> <p>Instala las actualizaciones disponibles sobre los paquetes actualmente instalados en el sistema seg\u00fan nuestras definiciones en <code>/etc/apt/sources.list</code> y <code>/etc/apt/sources.list.d</code>.</p> <p>Se instalar\u00e1n nuevos paquetes si son necesarios para satisfacer dependencias, pero los paquetes existentes nunca serr\u00e1n borrados.</p> <p>Ejemplo de output:</p> <pre><code>vagrant@paqueteria:~$ sudo apt upgrade\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nRun 'dpkg-reconfigure tzdata' if you wish to change it.\n\nSetting up grub-common (2.06-4) ...\nSetting up libdbus-1-3:amd64 (1.14.4-1) ...\nSetting up dbus-session-bus-common (1.14.4-1) ...\nSetting up isc-dhcp-common (4.4.3-P1-1) ...\nSetting up dbus-system-bus-common (1.14.4-1) ...\nSetting up dbus-bin (1.14.4-1) ...\nSetting up bind9-libs:amd64 (1:9.18.4-2~bpo11+1) ...\nSetting up grub2-common (2.06-4) ...\nSetting up dbus-daemon (1.14.4-1) ...\nSetting up grub-pc-bin (2.06-4) ...\nSetting up grub-pc (2.06-4) ...\nReplacing config file /etc/default/grub with new version\nInstalling for i386-pc platform.\nInstallation finished. No error reported.\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-5.19.0-0.deb11.2-amd64\nFound initrd image: /boot/initrd.img-5.19.0-0.deb11.2-amd64\nFound linux image: /boot/vmlinuz-5.10.0-19-amd64\nFound initrd image: /boot/initrd.img-5.10.0-19-amd64\nFound linux image: /boot/vmlinuz-5.10.0-18-amd64\nFound initrd image: /boot/initrd.img-5.10.0-18-amd64\nWarning: os-prober will not be executed to detect other bootable partitions.\nSystems on them will not be added to the GRUB boot configuration.\nCheck GRUB_DISABLE_OS_PROBER documentation entry.\ndone\nSetting up dbus (1.14.4-1) ...\nA reboot is required to replace the running dbus-daemon.\nPlease reboot the system when convenient.\ndbus.service is a disabled or a static unit, not starting it.\nSetting up bind9-host (1:9.18.4-2~bpo11+1) ...\nSetting up bind9-dnsutils (1:9.18.4-2~bpo11+1) ...\nProcessing triggers for man-db (2.9.4-2) ...\nProcessing triggers for libc-bin (2.35-4) ...\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-2-apt","title":"Ejercicio 2 apt","text":"<p>Listar los paquetes que pueden ser actualizados y explicar el output</p> <pre><code>vagrant@paqueteria:~$ sudo apt list --upgradable\nListing... Done\nbind9-dnsutils/stable-security 1:9.16.33-1~deb11u1 amd64 [upgradable from: 1:9.16.27-1~deb11u1]\nbind9-host/stable-security 1:9.16.33-1~deb11u1 amd64 [upgradable from: 1:9.16.27-1~deb11u1]\nbind9-libs/stable-security 1:9.16.33-1~deb11u1 amd64 [upgradable from: 1:9.16.27-1~deb11u1]\ndbus/stable-security 1.12.24-0+deb11u1 amd64 [upgradable from: 1.12.20-2]\ngrub-common/stable-updates 2.06-3~deb11u2 amd64 [upgradable from: 2.06-3~deb11u1]\ngrub-pc-bin/stable-updates 2.06-3~deb11u2 amd64 [upgradable from: 2.06-3~deb11u1]\ngrub-pc/stable-updates 2.06-3~deb11u2 amd64 [upgradable from: 2.06-3~deb11u1]\ngrub2-common/stable-updates 2.06-3~deb11u2 amd64 [upgradable from: 2.06-3~deb11u1]\nisc-dhcp-client/stable-security 4.4.1-2.3+deb11u1 amd64 [upgradable from: 4.4.1-2.3]\nisc-dhcp-common/stable-security 4.4.1-2.3+deb11u1 amd64 [upgradable from: 4.4.1-2.3]\nlibc-bin/stable-updates 2.31-13+deb11u5 amd64 [upgradable from: 2.31-13+deb11u4]\nlibc-l10n/stable-updates 2.31-13+deb11u5 all [upgradable from: 2.31-13+deb11u4]\nlibc6/stable-updates 2.31-13+deb11u5 amd64 [upgradable from: 2.31-13+deb11u4]\nlibdbus-1-3/stable-security 1.12.24-0+deb11u1 amd64 [upgradable from: 1.12.20-2]\nlibexpat1/stable-security 2.2.10-2+deb11u5 amd64 [upgradable from: 2.2.10-2+deb11u3]\nlinux-image-amd64/stable-security 5.10.149-2 amd64 [upgradable from: 5.10.140-1]\nlocales/stable-updates 2.31-13+deb11u5 all [upgradable from: 2.31-13+deb11u4]\ntzdata/stable-updates 2021a-1+deb11u7 all [upgradable from: 2021a-1+deb11u5]\n</code></pre> <p>Podemos discernir lo siguiente:</p> <ul> <li>Nombre de paquete</li> <li>Rama del repositorio</li> <li>Versi\u00f3n</li> <li>Arquitectura</li> <li>Versi\u00f3n actualmente instalada</li> </ul>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-3-apt","title":"Ejercicio 3 apt","text":"<p>Indicar sobre el paquete <code>openssh-client</code>:</p> <ul> <li>Versi\u00f3n instalada</li> <li>Versi\u00f3n candidata</li> <li>Prioridad</li> </ul> <p></p>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-4-apt","title":"Ejercicio 4 apt","text":"<p>Mostrar informaci\u00f3n de un paquete instalado o no</p> <pre><code>sudo apt show &lt;paquete&gt;\n</code></pre> <p>Ejemplo:</p> <pre><code>vagrant@paqueteria:~$ sudo apt show tree\nPackage: tree\nVersion: 1.8.0-1+b1\nPriority: optional\nSection: utils\nSource: tree (1.8.0-1)\nMaintainer: Florian Ernst &lt;florian@debian.org&gt;\nInstalled-Size: 118 kB\nDepends: libc6 (&gt;= 2.4)\nHomepage: http://mama.indstate.edu/users/ice/tree/\nTag: implemented-in::c, interface::commandline, role::program,\n scope::utility, use::browsing, works-with::file\nDownload-Size: 49.6 kB\nAPT-Sources: https://deb.debian.org/debian bullseye/main amd64 Packages\nDescription: displays an indented directory tree, in color\n Tree is a recursive directory listing command that produces a depth indented\n listing of files, which is colorized ala dircolors if the LS_COLORS environment\n variable is set and output is to tty.\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-5-apt","title":"Ejercicio 5 apt","text":"<p>Mostrar toda la informaci\u00f3n que se pueda del paquete <code>openssh-client</code></p> <p>Podemos hacer:</p> <pre><code>vagrant@paqueteria:~$ sudo apt show openssh-client\nPackage: openssh-client\nVersion: 1:8.4p1-5+deb11u1\nPriority: standard\nSection: net\nSource: openssh\nMaintainer: Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;\nInstalled-Size: 4401 kB\nProvides: rsh-client, ssh-client\nDepends: adduser (&gt;= 3.10), dpkg (&gt;= 1.7.0), passwd, libc6 (&gt;= 2.26), libedit2 (&gt;= 2.11-20080614-0), libfido2-1 (&gt;= 1.5.0), libgssapi-krb5-2 (&gt;= 1.17), libselinux1 (&gt;= 3.1~), libssl1.1 (&gt;= 1.1.1), zlib1g (&gt;= 1:1.1.4)\nRecommends: xauth\nSuggests: keychain, libpam-ssh, monkeysphere, ssh-askpass\nConflicts: sftp\nBreaks: openssh-sk-helper\nReplaces: openssh-sk-helper, ssh, ssh-krb5\nHomepage: http://www.openssh.com/\nTag: implemented-in::c, interface::commandline, interface::shell,\n network::client, protocol::sftp, protocol::ssh, role::program,\n security::authentication, security::cryptography, uitoolkit::ncurses,\n use::login, use::transmission, works-with::file\nDownload-Size: 929 kB\nAPT-Manual-Installed: yes\nAPT-Sources: https://deb.debian.org/debian bullseye/main amd64 Packages\nDescription: secure shell (SSH) client, for secure access to remote machines\n This is the portable version of OpenSSH, a free implementation of\n the Secure Shell protocol as specified by the IETF secsh working\n group.\n .\n Ssh (Secure Shell) is a program for logging into a remote machine\n and for executing commands on a remote machine.\n It provides secure encrypted communications between two untrusted\n hosts over an insecure network. X11 connections and arbitrary TCP/IP\n ports can also be forwarded over the secure channel.\n It can be used to provide applications with a secure communication\n channel.\n .\n This package provides the ssh, scp and sftp clients, the ssh-agent\n and ssh-add programs to make public key authentication more convenient,\n and the ssh-keygen, ssh-keyscan, ssh-copy-id and ssh-argv0 utilities.\n .\n In some countries it may be illegal to use any encryption at all\n without a special permit.\n .\n ssh replaces the insecure rsh, rcp and rlogin programs, which are\n obsolete for most purposes.\n</code></pre> <p>O tambi\u00e9n:</p> <pre><code>apt-cache showpkg openssh-client\n</code></pre> <p>El output es bastante largo, as\u00ed que entra en este gist para verlo.</p> <p>El \u00faltimo comando est\u00e1 muy bien, nos muestra informaci\u00f3n que no ver\u00edamos con <code>apt show</code>, pero a su vez carece de informaci\u00f3n que ver\u00edamos con <code>apt show</code> como el mantenedor/es del paquete.</p>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-6-apt","title":"Ejercicio 6 apt","text":"<p>Mostrar toda la informaci\u00f3n que se pueda del paquete candidato <code>openssh-client</code> a actualizar</p> <p>A\u00f1ado los repositorios de <code>unstable/main</code> para que <code>openssh-client</code> tenga un candidato m\u00e1s actualizado que el paquete actualmente instalado:</p> <pre><code>vagrant@paqueteria:~$ apt policy openssh-client\nopenssh-client:\n  Installed: 1:8.4p1-5+deb11u1\n  Candidate: 1:9.0p1-1+b2\n  Version table:\n     1:9.0p1-1+b2 500\n500 https://deb.debian.org/debian unstable/main amd64 Packages\n *** 1:8.4p1-5+deb11u1 500\n500 https://deb.debian.org/debian bullseye/main amd64 Packages\n        100 /var/lib/dpkg/status\n</code></pre> <p>No existe un comando directo para hacer esto, as\u00ed que podemos hacer:</p> <pre><code>sudo apt show openssh-client=$(apt-cache policy openssh-client | grep Candidate | awk '{print $2}')\n</code></pre> <p>Output:</p> <pre><code>vagrant@paqueteria:~$ sudo apt show openssh-client=$(apt-cache policy openssh-client | grep Candidate | awk '{print $2}')\nPackage: openssh-client\nVersion: 1:9.0p1-1+b2\nPriority: standard\nSection: net\nSource: openssh (1:9.0p1-1)\nMaintainer: Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;\nInstalled-Size: 5772 kB\nProvides: rsh-client, ssh-client\nDepends: adduser (&gt;= 3.10), dpkg (&gt;= 1.7.0), passwd, libc6 (&gt;= 2.34), libedit2 (&gt;= 2.11-20080614-0), libfido2-1 (&gt;= 1.8.0), libgssapi-krb5-2 (&gt;= 1.17), libselinux1 (&gt;= 3.1~), libssl3 (&gt;= 3.0.5), zlib1g (&gt;= 1:1.1.4)\nRecommends: xauth\nSuggests: keychain, libpam-ssh, monkeysphere, ssh-askpass\nConflicts: sftp\nBreaks: openssh-sk-helper\nReplaces: openssh-sk-helper, ssh, ssh-krb5\nHomepage: http://www.openssh.com/\nTag: implemented-in::c, interface::commandline, interface::shell,\n network::client, protocol::sftp, protocol::ssh, role::program,\n security::authentication, security::cryptography, uitoolkit::ncurses,\n use::login, use::transmission, works-with::file\nDownload-Size: 973 kB\nAPT-Sources: https://deb.debian.org/debian unstable/main amd64 Packages\nDescription: secure shell (SSH) client, for secure access to remote machines\n This is the portable version of OpenSSH, a free implementation of\n the Secure Shell protocol as specified by the IETF secsh working\n group.\n .\n Ssh (Secure Shell) is a program for logging into a remote machine\n and for executing commands on a remote machine.\n It provides secure encrypted communications between two untrusted\n hosts over an insecure network. X11 connections and arbitrary TCP/IP\n ports can also be forwarded over the secure channel.\n It can be used to provide applications with a secure communication\n channel.\n .\n This package provides the ssh, scp and sftp clients, the ssh-agent\n and ssh-add programs to make public key authentication more convenient,\n and the ssh-keygen, ssh-keyscan, ssh-copy-id and ssh-argv0 utilities.\n .\n In some countries it may be illegal to use any encryption at all\n without a special permit.\n .\n ssh replaces the insecure rsh, rcp and rlogin programs, which are\n obsolete for most purposes.\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-7-apt","title":"Ejercicio 7 apt","text":"<p>Listar tanto con apt como con dpkg los contenidos del paquete <code>openssh-client</code> actual</p> <p>Con <code>apt</code> ser\u00eda as\u00ed:</p> <pre><code>sudo apt install apt-file\nsudo apt-file update\napt-file list openssh-client\n</code></pre> <p>Output:</p> <pre><code>vagrant@paqueteria:~$ apt-file list openssh-client\nopenssh-client: /etc/ssh/ssh_config\nopenssh-client: /usr/bin/scp\nopenssh-client: /usr/bin/sftp\nopenssh-client: /usr/bin/slogin\nopenssh-client: /usr/bin/ssh\nopenssh-client: /usr/bin/ssh-add\nopenssh-client: /usr/bin/ssh-agent\nopenssh-client: /usr/bin/ssh-argv0\nopenssh-client: /usr/bin/ssh-copy-id\nopenssh-client: /usr/bin/ssh-keygen\nopenssh-client: /usr/bin/ssh-keyscan\nopenssh-client: /usr/lib/openssh/agent-launch\nopenssh-client: /usr/lib/openssh/ssh-keysign\nopenssh-client: /usr/lib/openssh/ssh-pkcs11-helper\nopenssh-client: /usr/lib/openssh/ssh-sk-helper\nopenssh-client: /usr/lib/systemd/user/graphical-session-pre.target.wants/ssh-agent.service\nopenssh-client: /usr/lib/systemd/user/ssh-agent.service\nopenssh-client: /usr/share/apport/package-hooks/openssh-client.py\nopenssh-client: /usr/share/doc/openssh-client/NEWS.Debian.gz\nopenssh-client: /usr/share/doc/openssh-client/OVERVIEW.gz\nopenssh-client: /usr/share/doc/openssh-client/README\nopenssh-client: /usr/share/doc/openssh-client/README.Debian.gz\nopenssh-client: /usr/share/doc/openssh-client/README.dns\nopenssh-client: /usr/share/doc/openssh-client/README.tun.gz\nopenssh-client: /usr/share/doc/openssh-client/changelog.Debian.amd64.gz\nopenssh-client: /usr/share/doc/openssh-client/changelog.Debian.gz\nopenssh-client: /usr/share/doc/openssh-client/changelog.gz\nopenssh-client: /usr/share/doc/openssh-client/copyright\nopenssh-client: /usr/share/doc/openssh-client/faq.html\nopenssh-client: /usr/share/lintian/overrides/openssh-client\nopenssh-client: /usr/share/man/man1/scp.1.gz\nopenssh-client: /usr/share/man/man1/sftp.1.gz\nopenssh-client: /usr/share/man/man1/slogin.1.gz\nopenssh-client: /usr/share/man/man1/ssh-add.1.gz\nopenssh-client: /usr/share/man/man1/ssh-agent.1.gz\nopenssh-client: /usr/share/man/man1/ssh-argv0.1.gz\nopenssh-client: /usr/share/man/man1/ssh-copy-id.1.gz\nopenssh-client: /usr/share/man/man1/ssh-keygen.1.gz\nopenssh-client: /usr/share/man/man1/ssh-keyscan.1.gz\nopenssh-client: /usr/share/man/man1/ssh.1.gz\nopenssh-client: /usr/share/man/man5/ssh_config.5.gz\nopenssh-client: /usr/share/man/man8/ssh-keysign.8.gz\nopenssh-client: /usr/share/man/man8/ssh-pkcs11-helper.8.gz\nopenssh-client: /usr/share/man/man8/ssh-sk-helper.8.gz\n</code></pre> <p>Con <code>dpkg</code> ser\u00eda as\u00ed:</p> <pre><code>vagrant@paqueteria:~$ dpkg -L openssh-client\n/.\n/etc\n/etc/ssh\n/etc/ssh/ssh_config\n/etc/ssh/ssh_config.d\n/usr\n/usr/bin\n/usr/bin/scp\n/usr/bin/sftp\n/usr/bin/ssh\n/usr/bin/ssh-add\n/usr/bin/ssh-agent\n/usr/bin/ssh-argv0\n/usr/bin/ssh-copy-id\n/usr/bin/ssh-keygen\n/usr/bin/ssh-keyscan\n/usr/lib\n/usr/lib/openssh\n/usr/lib/openssh/agent-launch\n/usr/lib/openssh/ssh-keysign\n/usr/lib/openssh/ssh-pkcs11-helper\n/usr/lib/openssh/ssh-sk-helper\n/usr/lib/systemd\n/usr/lib/systemd/user\n/usr/lib/systemd/user/graphical-session-pre.target.wants\n/usr/lib/systemd/user/ssh-agent.service\n/usr/share\n/usr/share/apport\n/usr/share/apport/package-hooks\n/usr/share/apport/package-hooks/openssh-client.py\n/usr/share/doc\n/usr/share/doc/openssh-client\n/usr/share/doc/openssh-client/NEWS.Debian.gz\n/usr/share/doc/openssh-client/OVERVIEW.gz\n/usr/share/doc/openssh-client/README\n/usr/share/doc/openssh-client/README.Debian.gz\n/usr/share/doc/openssh-client/README.dns\n/usr/share/doc/openssh-client/README.tun.gz\n/usr/share/doc/openssh-client/changelog.Debian.gz\n/usr/share/doc/openssh-client/changelog.gz\n/usr/share/doc/openssh-client/copyright\n/usr/share/doc/openssh-client/faq.html\n/usr/share/lintian\n/usr/share/lintian/overrides\n/usr/share/lintian/overrides/openssh-client\n/usr/share/man\n/usr/share/man/man1\n/usr/share/man/man1/scp.1.gz\n/usr/share/man/man1/sftp.1.gz\n/usr/share/man/man1/ssh-add.1.gz\n/usr/share/man/man1/ssh-agent.1.gz\n/usr/share/man/man1/ssh-argv0.1.gz\n/usr/share/man/man1/ssh-copy-id.1.gz\n/usr/share/man/man1/ssh-keygen.1.gz\n/usr/share/man/man1/ssh-keyscan.1.gz\n/usr/share/man/man1/ssh.1.gz\n/usr/share/man/man5\n/usr/share/man/man5/ssh_config.5.gz\n/usr/share/man/man8\n/usr/share/man/man8/ssh-keysign.8.gz\n/usr/share/man/man8/ssh-pkcs11-helper.8.gz\n/usr/share/man/man8/ssh-sk-helper.8.gz\n/usr/bin/slogin\n/usr/lib/systemd/user/graphical-session-pre.target.wants/ssh-agent.service\n/usr/share/man/man1/slogin.1.gz\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-8-apt","title":"Ejercicio 8 apt","text":"<p>Listar los contenidos de un paquete sin instalar ni descargar</p> <pre><code>apt-file list &lt;paquete&gt;\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-9-apt","title":"Ejercicio 9 apt","text":"<p>Simular la instalaci\u00f3n de <code>openssh-client</code></p> <p><code>man apt-get</code> nos dice:</p> <pre><code>       -s, --simulate, --just-print, --dry-run, --recon, --no-act\n           No action; perform a simulation of events that would occur based on the current system state but do not actually change the system. Locking will\n           be disabled (Debug::NoLocking) so the system state could change while apt-get is running. Simulations can also be executed by non-root users\n           which might not have read access to all apt configuration distorting the simulation. A notice expressing this warning is also shown by default\n           for non-root users (APT::Get::Show-User-Simulation-Note). Configuration Item: APT::Get::Simulate.\n\nSimulated runs print out a series of lines, each representing a dpkg operation: configure (Conf), remove (Remv) or unpack (Inst). Square\n           brackets indicate broken packages, and empty square brackets indicate breaks that are of no consequence (rare).\n</code></pre> <p>As\u00ed que hacemos:</p> <pre><code>vagrant@paqueteria:~$ sudo apt install -s openssh-client\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following packages were automatically installed and are no longer required:\n  libcbor0 libperl5.32\nUse 'sudo apt autoremove' to remove them.\nThe following additional packages will be installed:\n  libcbor0.8 libfido2-1 libssl3 openssh-server openssh-sftp-server runit-helper\nSuggested packages:\n  keychain libpam-ssh monkeysphere ssh-askpass molly-guard ufw\nRecommended packages:\n  xauth\nThe following NEW packages will be installed:\n  libcbor0.8 libssl3\nThe following packages will be upgraded:\n  libfido2-1 openssh-client openssh-server openssh-sftp-server runit-helper\n5 upgraded, 2 newly installed, 0 to remove and 251 not upgraded.\nInst libcbor0.8 (0.8.0-2+b1 Debian:unstable [amd64])\nInst libssl3 (3.0.5-4 Debian:unstable [amd64])\nInst libfido2-1 [1.6.0-2] (1.12.0-1 Debian:unstable [amd64])\nInst openssh-sftp-server [1:8.4p1-5+deb11u1] (1:9.0p1-1+b2 Debian:unstable [amd64]) []\nInst openssh-server [1:8.4p1-5+deb11u1] (1:9.0p1-1+b2 Debian:unstable [amd64]) []\nInst openssh-client [1:8.4p1-5+deb11u1] (1:9.0p1-1+b2 Debian:unstable [amd64]) []\nInst runit-helper [2.10.3] (2.15.0 Debian:unstable [all])\nConf libcbor0.8 (0.8.0-2+b1 Debian:unstable [amd64])\nConf libssl3 (3.0.5-4 Debian:unstable [amd64])\nConf libfido2-1 (1.12.0-1 Debian:unstable [amd64])\nConf openssh-sftp-server (1:9.0p1-1+b2 Debian:unstable [amd64])\nConf openssh-server (1:9.0p1-1+b2 Debian:unstable [amd64])\nConf openssh-client (1:9.0p1-1+b2 Debian:unstable [amd64])\nConf runit-helper (2.15.0 Debian:unstable [all])\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-10-apt","title":"Ejercicio 10 apt","text":"<p>Listar los bugs de un paquete</p> <pre><code>sudo apt install apt-listbugs\nsudo apt-listbugs -s all list &lt;paquete&gt;\n</code></pre> <p>Ejemplo:</p> <pre><code>vagrant@paqueteria:~$ sudo apt-listbugs -s all list tree\nRetrieving bug reports... Done\nParsing Found/Fixed information... Done\nnormal bugs of tree (\u2192 ) &lt;Forwarded&gt;\n b1 - #934520 - tree: --filefrom option doesn't recognize symbolic links\nminor bugs of tree (\u2192 ) &lt;Forwarded&gt;\n b2 - #1014621 - tree: --timefmt doesn't imply -D, manual says it should\nwishlist bugs of tree (\u2192 ) &lt;Forwarded&gt;\n b3 - #865867 - make tree -H \"mobile friendly\"\nb4 - #939644 - Viewport not set... need way to add HTML headers\nSummary:\n tree(4 bugs)\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-11-apt","title":"Ejercicio 11 apt","text":"<p>Realizar una actualizaci\u00f3n completa de la paqueter\u00eda</p> <pre><code>sudo apt update &amp;&amp; sudo apt upgrade\n</code></pre> <p>Actualizar los paquetes que contienen la cadena openssh</p> <pre><code>sudo apt upgrade *openssh*\n</code></pre> <p>El proceso es largo, as\u00ed que mostrar\u00e9 como ejemplo lo que aparece antes de confirmar.</p> <p>Hacer lo mismo pero con un for en bash</p> <p>Tenemos que ejecutar el siguiente script con sudo:</p> <pre><code>#!/bin/bash\npkgnames=$(apt-cache pkgnames openssh)\nfor i in $pkgnames\ndo\napt upgrade $i\ndone\n</code></pre> <p>Hacer lo mismo pero con xargs</p> <pre><code>apt-cache pkgnames openssh | xargs sudo apt upgrade -y\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-12-apt","title":"Ejercicio 12 apt","text":"<p>Mostrar las dependencias inversas de un paquete</p> <p><code>man apt-cache</code> nos dice:</p> <pre><code>       rdepends pkg...\n           rdepends shows a listing of each reverse dependency a package has.\n</code></pre> <p>As\u00ed que hacemos:</p> <pre><code>apt-cache rdepends &lt;paquete&gt;\n</code></pre> <p>Ejemplo:</p> <pre><code>vagrant@paqueteria:~$ apt-cache rdepends tree\ntree\nReverse Depends:\n  pass\n  sisu-complete\n  sisu\n  pypass\n  progress-linux-desktop\n  pass\n  mle\n  inxi\n  hollywood\n  gopass\n  creddump7\n  bfh-desktop\n  inxi\n  sisu-complete\n  sisu\n  pypass\n  progress-linux-desktop\n  gopass\n  mle\n  keyringer\n  inxi\n  hollywood\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-13-apt","title":"Ejercicio 13 apt","text":"<p>Mostrar el paquete al que pertenece un fichero</p> <p><code>man dpkg</code> nos dice:</p> <pre><code>           -S, --search filename-search-pattern...\n               Search for a filename from installed packages.\n</code></pre> <p>As\u00ed que hacemos:</p> <pre><code>dpkg -S &lt;ruta-al-binario&gt;\n</code></pre> <p>Ejemplo:</p> <pre><code>vagrant@paqueteria:~$ dpkg -S /bin/ls\ncoreutils: /bin/ls\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-14-apt","title":"Ejercicio 14 apt","text":"<p>Liberar la cach\u00e9 de la paqueter\u00eda</p> <p><code>man apt-get</code> nos dice:</p> <pre><code>       clean\n           clean clears out the local repository of retrieved package files. It removes everything but the lock file from /var/cache/apt/archives/ and\n           /var/cache/apt/archives/partial/.\n</code></pre> <p>As\u00ed que hacemos:</p> <pre><code>sudo apt clean\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-15-apt","title":"Ejercicio 15 apt","text":"<p>Instalar el paquete <code>keyboard-configuration</code> autom\u00e1ticamente pasando par\u00e1metros con debconf</p> <p>Instalo <code>debconf-utils</code>:</p> <pre><code>sudo apt install debconf-utils\n</code></pre> <p>Instalo una primera vez <code>keyboard-configuration</code> sin pasarle par\u00e1metros para poder obtener su configuraci\u00f3n:</p> <pre><code>sudo apt install keyboard-configuration\n</code></pre> <p>Exporto las \"selections\" a un fichero:</p> <pre><code>sudo debconf-get-selections | grep keyboard-configuration &gt; selections.conf\n</code></pre> <p>Desinstalo <code>keyboard-configuration</code>:</p> <pre><code>sudo apt purge keyboard-configuration\n</code></pre> <p>Paso los par\u00e1metros del fichero a debconf:</p> <pre><code>sudo debconf-set-selections &lt; selections.conf\n</code></pre> <p>Al volver a instalar el paquete, los par\u00e1metros evitar\u00e1n las preguntas de debconf:</p> <p></p>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-16-apt","title":"Ejercicio 16 apt","text":"<p>Mostrar la configuraci\u00f3n de locales actual</p> <pre><code>vagrant@paqueteria:~$ localectl\n   System Locale: LANG=C.UTF-8\n       VC Keymap: n/a\n      X11 Layout: es\n       X11 Model: pc105\n</code></pre> <p>Reconfigurar el paquete locales, a\u00f1adiendo una nueva locale</p> <pre><code>sudo dpkg-reconfigure locales\n</code></pre> <p></p> <p></p> <p>Compruebo que ha funcionado:</p> <pre><code>vagrant@paqueteria:~$ localectl\n   System Locale: LANG=es_ES.UTF-8\n       VC Keymap: n/a\n      X11 Layout: es\n       X11 Model: pc105\n</code></pre> <p>Existen algunas otras variables que podemos usar:</p> <pre><code>export LANGUAGE=es_ES.UTF-8\nexport LANG=es_ES.UTF-8\nexport LC_ALL=es_ES.UTF-8\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-17-apt","title":"Ejercicio 17 apt","text":"<p>Interrumpir la instalaci\u00f3n de un paquete y explicar los pasos para continuar la instalaci\u00f3n</p> <p>Para crear esta situaci\u00f3n puedo forzar el apagado de la m\u00e1quina vagrant durante la instalaci\u00f3n de <code>mariadb-server</code>:</p> <p></p> <p>Si volvemos a levantar la m\u00e1quina e intentamos seguir con la instalaci\u00f3n, nos encontramos con el siguiente error:</p> <pre><code>vagrant@paqueteria:~$ sudo apt install mariadb-server\nE: dpkg was interrupted, you must manually run 'sudo dpkg --configure -a' to correct the problem.\n</code></pre> <p>Hacemos lo que nos dice:</p> <pre><code>vagrant@paqueteria:~$ sudo dpkg --configure -a\nSetting up libconfig-inifiles-perl (3.000003-1) ...\nSetting up galera-4 (26.4.11-0+deb11u1) ...\nSetting up gawk (1:5.1.0-1) ...\nSetting up psmisc (23.4-2) ...\nSetting up libsnappy1v5:amd64 (1.1.8-1) ...\nSetting up socat (1.7.4.1-3) ...\nSetting up libmariadb3:amd64 (1:10.5.15-0+deb11u1) ...\nSetting up libdbi-perl:amd64 (1.643-3+b1) ...\nSetting up rsync (3.2.3-4+deb11u1) ...\nCreated symlink /etc/systemd/system/multi-user.target.wants/rsync.service \u2192 /lib/systemd/system/rsync.service.\nSetting up mariadb-server-core-10.5 (1:10.5.15-0+deb11u1) ...\nSetting up mariadb-client-core-10.5 (1:10.5.15-0+deb11u1) ...\nSetting up mariadb-client-10.5 (1:10.5.15-0+deb11u1) ...\nProcessing triggers for man-db (2.9.4-2) ...\nProcessing triggers for libc-bin (2.31-13+deb11u4) ...\n</code></pre> <p>Ya podr\u00edamos volver a instalar:</p> <pre><code>vagrant@paqueteria:~$ sudo apt install mariadb-server\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following additional packages will be installed:\n  galera-4 gawk libcgi-fast-perl libcgi-pm-perl libclone-perl libconfig-inifiles-perl libdbd-mariadb-perl libdbi-perl libencode-locale-perl libfcgi-bin\n  libfcgi-perl libfcgi0ldbl libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl\n  liblwp-mediatypes-perl libmariadb3 libmpfr6 libsigsegv2 libsnappy1v5 libterm-readkey-perl libtimedate-perl liburi-perl mariadb-client-10.5\n  mariadb-client-core-10.5 mariadb-common mariadb-server-10.5 mariadb-server-core-10.5 mysql-common psmisc rsync socat\nSuggested packages:\n  gawk-doc libmldbm-perl libnet-daemon-perl libsql-statement-perl libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx mariadb-test netcat-openbsd\nThe following NEW packages will be installed:\n  galera-4 gawk libcgi-fast-perl libcgi-pm-perl libclone-perl libconfig-inifiles-perl libdbd-mariadb-perl libdbi-perl libencode-locale-perl libfcgi-bin\n  libfcgi-perl libfcgi0ldbl libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl\n  liblwp-mediatypes-perl libmariadb3 libmpfr6 libsigsegv2 libsnappy1v5 libterm-readkey-perl libtimedate-perl liburi-perl mariadb-client-10.5\n  mariadb-client-core-10.5 mariadb-common mariadb-server mariadb-server-10.5 mariadb-server-core-10.5 mysql-common psmisc rsync socat\n0 upgraded, 36 newly installed, 0 to remove and 18 not upgraded.\nNeed to get 19.7 MB of archives.\nAfter this operation, 162 MB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 https://deb.debian.org/debian bullseye/main amd64 libmpfr6 amd64 4.1.0-3 [2012 kB]\nGet:2 https://deb.debian.org/debian bullseye/main amd64 libsigsegv2 amd64 2.13-1 [34.8 kB]\nGet:3 https://deb.debian.org/debian bullseye/main amd64 gawk amd64 1:5.1.0-1 [605 kB]\nGet:4 https://deb.debian.org/debian bullseye/main amd64 mysql-common all 5.8+1.0.7 [7464 B]\nGet:5 https://deb.debian.org/debian bullseye/main amd64 mariadb-common all 1:10.5.15-0+deb11u1 [36.7 kB]\nGet:6 https://deb.debian.org/debian bullseye/main amd64 galera-4 amd64 26.4.11-0+deb11u1 [804 kB]\nGet:7 https://deb.debian.org/debian bullseye/main amd64 libdbi-perl amd64 1.643-3+b1 [780 kB]\nGet:8 https://deb.debian.org/debian bullseye/main amd64 libconfig-inifiles-perl all 3.000003-1 [52.1 kB]\nGet:9 https://deb.debian.org/debian bullseye/main amd64 libmariadb3 amd64 1:10.5.15-0+deb11u1 [176 kB]\nGet:10 https://deb.debian.org/debian bullseye/main amd64 mariadb-client-core-10.5 amd64 1:10.5.15-0+deb11u1 [783 kB]\nGet:11 https://deb.debian.org/debian bullseye/main amd64 mariadb-client-10.5 amd64 1:10.5.15-0+deb11u1 [1509 kB]\nGet:12 https://deb.debian.org/debian bullseye/main amd64 libsnappy1v5 amd64 1.1.8-1 [17.9 kB]\nGet:13 https://deb.debian.org/debian bullseye/main amd64 mariadb-server-core-10.5 amd64 1:10.5.15-0+deb11u1 [6689 kB]\nGet:14 https://deb.debian.org/debian bullseye/main amd64 psmisc amd64 23.4-2 [198 kB]\nGet:15 https://deb.debian.org/debian bullseye/main amd64 rsync amd64 3.2.3-4+deb11u1 [396 kB]\nGet:16 https://deb.debian.org/debian bullseye/main amd64 socat amd64 1.7.4.1-3 [370 kB]\nGet:17 https://deb.debian.org/debian bullseye/main amd64 mariadb-server-10.5 amd64 1:10.5.15-0+deb11u1 [4260 kB]\nGet:18 https://deb.debian.org/debian bullseye/main amd64 libhtml-tagset-perl all 3.20-4 [13.0 kB]\nmariadb-server\nThe following packages will be upgraded:\n  mariadb-server-10.5\n1 upgraded, 1 newly installed, 0 to remove and 18 not upgraded.\n1 not fully installed or removed.\nNeed to get 0 B/4295 kB of archives.\nAfter this operation, 66.9 MB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nReading changelogs... Done\nPreconfiguring packages ...\n(Reading database ... 25893 files and directories currently installed.)\nPreparing to unpack .../mariadb-server-10.5_1%3a10.5.15-0+deb11u1_amd64.deb ...\nUnpacking mariadb-server-10.5 (1:10.5.15-0+deb11u1) over (1:10.5.15-0+deb11u1) ...\nSelecting previously unselected package mariadb-server.\nPreparing to unpack .../mariadb-server_1%3a10.5.15-0+deb11u1_all.deb ...\nUnpacking mariadb-server (1:10.5.15-0+deb11u1) ...\nSetting up mariadb-server-10.5 (1:10.5.15-0+deb11u1) ...\nCreated symlink /etc/systemd/system/multi-user.target.wants/mariadb.service \u2192 /lib/systemd/system/mariadb.service.\nSetting up mariadb-server (1:10.5.15-0+deb11u1) ...\nProcessing triggers for man-db (2.9.4-2) ...\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-18-apt","title":"Ejercicio 18 apt","text":"<p>Actualizar todos los paquetes de manera no interactiva</p> <p><code>man apt-get</code> nos dice:</p> <pre><code>       -y, --yes, --assume-yes\n           Automatic yes to prompts; assume \"yes\" as answer to all prompts and run non-interactively. If an undesirable situation, such as changing a held\n           package, trying to install an unauthenticated package or removing an essential package occurs then apt-get will abort. Configuration Item:\n           APT::Get::Assume-Yes.\n</code></pre> <p>As\u00ed que tenemos 2 maneras:</p> <pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\nsudo apt update &amp;&amp; sudo apt dist-upgrade -y\n</code></pre> <p>La primera manera conlleva menos riesgo que la segunda, y lo \u00fanico que podr\u00eda parar la \"no interactividad\" ser\u00eda un men\u00fa de debconf u otras situaciones excepcionales.</p> <p>Ejemplo de uso de la primera manera</p> <p>Ejemplo de uso de la segunda manera</p>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-19-apt","title":"Ejercicio 19 apt","text":"<p>Bloquear la actualizaci\u00f3n de ciertos paquetes</p> <p><code>man apt-mark</code> nos dice:</p> <pre><code>       hold\n           hold is used to mark a package as held back, which will prevent the package from being automatically installed, upgraded or removed.\n</code></pre> <p>As\u00ed que hacemos:</p> <pre><code>sudo apt-mark hold &lt;paquete&gt;\n</code></pre> <p>Ejemplo:</p> <pre><code>vagrant@paqueteria:~$ sudo apt-mark hold tree\ntree set on hold.\n</code></pre> <p>Podemos mostrar la lista de paquetes que tenemos en \"hold\":</p> <pre><code>vagrant@paqueteria:~$ apt-mark showhold\ntree\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#trabajo-con-ficheros-deb","title":"Trabajo con ficheros .deb","text":""},{"location":"aso/ejercicios-paqueteria/#ejercicio-1-deb","title":"Ejercicio 1 deb","text":"<p>Descargar un paquete sin instalarlo</p> <p><code>man apt-get</code> nos dice:</p> <pre><code>       -d, --download-only\n           Download only; package files are only retrieved, not unpacked or installed. Configuration Item: APT::Get::Download-Only.\n</code></pre> <p>As\u00ed que hacemos:</p> <pre><code>vagrant@paqueteria:~$ sudo apt -d install tree\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following NEW packages will be installed:\n  tree\n0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 49.6 kB of archives.\nAfter this operation, 118 kB of additional disk space will be used.\nGet:1 https://deb.debian.org/debian bullseye/main amd64 tree amd64 1.8.0-1+b1 [49.6 kB]\nFetched 49.6 kB in 0s (297 kB/s)\nDownload complete and in download only mode\n</code></pre> <p>El mensaje <code>Download complete and in download only mode</code> es claro.</p> <p>Podemos comprobar que efectivamente no se ha instalado:</p> <pre><code>vagrant@paqueteria:~$ apt policy tree\ntree:\n  Installed: (none)\nCandidate: 1.8.0-1+b1\n  Version table:\n     1.8.0-1+b1 500\n500 https://deb.debian.org/debian bullseye/main amd64 Packages\n</code></pre> <p>Podemos comprobar por \u00faltimo que tenemos el paquete descargado:</p> <pre><code>vagrant@paqueteria:~$ ls -la /var/cache/apt/archives\ntotal 64\ndrwxr-xr-x 3 root root  4096 Oct 30 09:58 .\ndrwxr-xr-x 3 root root  4096 Oct 30 09:51 ..\n-rw-r----- 1 root root     0 Oct 29 19:39 lock\ndrwx------ 2 _apt root  4096 Oct 30 09:58 partial\n-rw-r--r-- 1 root root 49636 Aug  6  2019 tree_1.8.0-1+b1_amd64.deb\n</code></pre> <p>Existe otra manera de hacer esto, y es con:</p> <pre><code>vagrant@paqueteria:~$ apt download tree\nGet:1 https://deb.debian.org/debian bullseye/main amd64 tree amd64 1.8.0-1+b1 [49.6 kB]\nFetched 49.6 kB in 0s (214 kB/s)\n</code></pre> <p>Pero hay notables diferencias:</p> <ul> <li>No necesitamos sudo</li> <li>Descarga los .deb en el directorio actual</li> </ul> <pre><code>vagrant@paqueteria:~$ ls -la\ntotal 84\ndrwxr-xr-x 4 vagrant vagrant  4096 Oct 30 10:16 .\ndrwxr-xr-x 3 root    root     4096 Sep 12 05:17 ..\n-rw-r--r-- 1 vagrant vagrant   220 Mar 27  2022 .bash_logout\n-rw-r--r-- 1 vagrant vagrant  3526 Mar 27  2022 .bashrc\n-rw------- 1 vagrant vagrant   125 Oct 30 10:11 .lesshst\ndrwxr-xr-x 3 vagrant vagrant  4096 Oct 29 19:34 .local\n-rw-r--r-- 1 vagrant vagrant   807 Mar 27  2022 .profile\ndrwx------ 2 vagrant vagrant  4096 Oct 29 15:19 .ssh\n-rw-r--r-- 1 vagrant vagrant 49636 Aug  6  2019 tree_1.8.0-1+b1_amd64.deb\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-2-deb","title":"Ejercicio 2 deb","text":"<p>Listar el contenido de un paquete deb</p> <p><code>man dpkg</code> nos dice:</p> <pre><code>           -c, --contents archive\n               List contents of a deb package.\n</code></pre> <p>As\u00ed que para trabajar directamente con paquetes .deb, podemos hacer:</p> <pre><code>vagrant@paqueteria:~$ dpkg -c tree_1.8.0-1+b1_amd64.deb\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/bin/\n-rwxr-xr-x root/root     81512 2019-08-06 19:31 ./usr/bin/tree\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/doc/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/doc/tree/\n-rw-r--r-- root/root      2723 2015-06-22 20:17 ./usr/share/doc/tree/README.gz\n-rw-r--r-- root/root      2403 2015-02-11 20:57 ./usr/share/doc/tree/TODO\n-rw-r--r-- root/root       210 2019-08-06 19:31 ./usr/share/doc/tree/changelog.Debian.amd64.gz\n-rw-r--r-- root/root      4294 2019-08-06 19:31 ./usr/share/doc/tree/changelog.Debian.gz\n-rw-r--r-- root/root      5276 2018-11-16 15:12 ./usr/share/doc/tree/changelog.gz\n-rw-r--r-- root/root      2441 2018-12-11 10:19 ./usr/share/doc/tree/copyright\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/man/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/man/man1/\n-rw-r--r-- root/root      4627 2019-08-06 19:31 ./usr/share/man/man1/tree.1.gz\n</code></pre> <p>Si queremos trabajar con nombres de paquetes en vez de con ficheros de paquetes, podemos hacer:</p> <pre><code>vagrant@paqueteria:~$ sudo apt-file update\nHit:1 https://deb.debian.org/debian bullseye InRelease\nGet:2 https://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:3 https://deb.debian.org/debian bullseye-backports InRelease [49.0 kB]\nGet:4 https://security.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:5 https://deb.debian.org/debian bullseye/main all Contents (deb) [31.0 MB]\nGet:6 https://security.debian.org/debian-security bullseye-security/main Sources [167 kB]\nGet:7 https://security.debian.org/debian-security bullseye-security/main amd64 Packages [193 kB]\nGet:8 https://security.debian.org/debian-security bullseye-security/main Translation-en [122 kB]\nGet:9 https://deb.debian.org/debian bullseye/main amd64 Contents (deb) [10.3 MB]\nGet:10 https://deb.debian.org/debian bullseye-updates/main amd64 Contents (deb) [68.7 kB]\nGet:11 https://deb.debian.org/debian bullseye-updates/main all Contents (deb) [25.0 kB]\nGet:12 https://deb.debian.org/debian bullseye-backports/main all Contents (deb) [4428 kB]\nGet:13 https://deb.debian.org/debian bullseye-backports/main amd64 Contents (deb) [1139 kB]\nFetched 47.6 MB in 13s (3732 kB/s)\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nAll packages are up to date.\nvagrant@paqueteria:~$ apt-file list tree\ntree: /usr/bin/tree\ntree: /usr/share/doc/tree/README.gz\ntree: /usr/share/doc/tree/TODO\ntree: /usr/share/doc/tree/changelog.Debian.amd64.gz\ntree: /usr/share/doc/tree/changelog.Debian.gz\ntree: /usr/share/doc/tree/changelog.gz\ntree: /usr/share/doc/tree/copyright\ntree: /usr/share/man/man1/tree.1.gz\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-3-deb","title":"Ejercicio 3 deb","text":""},{"location":"aso/ejercicios-paqueteria/#31","title":"3.1","text":"<p>Descargar el paquete que nos proveer\u00e1 el binario <code>ar</code></p> <pre><code>sudo apt install binutils\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#32","title":"3.2","text":"<p>Listar el contenido del paquete .deb descargado</p> <p><code>ar --help</code> nos dice:</p> <pre><code>  t[O][v]      - display contents of the archive\n</code></pre> <p>As\u00ed que hacemos:</p> <pre><code>vagrant@paqueteria:~$ ar tOv tree_1.8.0-1+b1_amd64.deb\nrw-r--r-- 0/0      4 Aug  6 19:31 2019 debian-binary 0x44\nrw-r--r-- 0/0    844 Aug  6 19:31 2019 control.tar.xz 0x84\nrw-r--r-- 0/0  48600 Aug  6 19:31 2019 data.tar.xz 0x40c\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#33","title":"3.3","text":"<p>Extraer el paquete</p> <p><code>ar --help</code> nos dice:</p> <pre><code>  x[o]         - extract file(s) from the archive\n</code></pre> <p>As\u00ed que primero creo un directorio para la extraci\u00f3n y muevo el .deb:</p> <pre><code>mkdir tree-extraction &amp;&amp; mv tree_1.8.0-1+b1_amd64.deb tree-extraction\ncd tree-extraction\n</code></pre> <p>Aqu\u00ed, extraigo:</p> <pre><code>ar x tree_1.8.0-1+b1_amd64.deb\n</code></pre> <p>Muestro lo extra\u00eddo:</p> <pre><code>vagrant@paqueteria:~/tree-extraction$ ls -la\ntotal 116\ndrwxr-xr-x 2 vagrant vagrant  4096 Oct 30 11:25 .\ndrwxr-xr-x 5 vagrant vagrant  4096 Oct 30 11:22 ..\n-rw-r--r-- 1 vagrant vagrant   844 Oct 30 11:25 control.tar.xz\n-rw-r--r-- 1 vagrant vagrant 48600 Oct 30 11:25 data.tar.xz\n-rw-r--r-- 1 vagrant vagrant     4 Oct 30 11:25 debian-binary\n-rw-r--r-- 1 vagrant vagrant 49636 Aug  6  2019 tree_1.8.0-1+b1_amd64.deb\n</code></pre> <p>Indicar la funci\u00f3n de cada fichero extra\u00eddo</p> <p>debian-binary</p> <p>Es un fichero que contiene una \u00fanica l\u00ednea con el n\u00famero de versi\u00f3n del formato del paquete:</p> <pre><code>vagrant@paqueteria:~/tree-extraction$ cat debian-binary\n2.0\n</code></pre> <p>control.tar.xz</p> <p>Es un archivo tar comprimido que puede contener:</p> <ul> <li>Scripts de los mantenedores: sirven para ayudar en la instalaci\u00f3n, actualizaci\u00f3n, o borrado de los paquetes</li> <li>Metadatos: como el nombre del paquete, su versi\u00f3n, dependencias y mantenedor</li> <li>Checksums</li> </ul> <pre><code>vagrant@paqueteria:~/tree-extraction$ tar -tvf control.tar.xz\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./\n-rw-r--r-- root/root       510 2019-08-06 19:31 ./control\n-rw-r--r-- root/root       512 2019-08-06 19:31 ./md5sums\n</code></pre> <p>Podemos extraerlo y mostrar sus contenidos para tenerlo todo m\u00e1s claro:</p> <pre><code>vagrant@paqueteria:~/tree-extraction$ tar -xvf control.tar.xz\n./\n./control\n./md5sums\nvagrant@paqueteria:~/tree-extraction$ cat control\nPackage: tree\nSource: tree (1.8.0-1)\nVersion: 1.8.0-1+b1\nArchitecture: amd64\nMaintainer: Florian Ernst &lt;florian@debian.org&gt;\nInstalled-Size: 115\nDepends: libc6 (&gt;= 2.4)\nSection: utils\nPriority: optional\nHomepage: http://mama.indstate.edu/users/ice/tree/\nDescription: displays an indented directory tree, in color\n Tree is a recursive directory listing command that produces a depth indented\n listing of files, which is colorized ala dircolors if the LS_COLORS environment\n variable is set and output is to tty.\nvagrant@paqueteria:~/tree-extraction$ cat md5sums\n8dab5530d608f37d948b8fd6271e2ecb  usr/bin/tree\nf49004c1057dfeaed3db1dceb050ac5d  usr/share/doc/tree/README.gz\n3eb175af3a5716275b668ce860c2bfad  usr/share/doc/tree/TODO\n79d76b44e3ea99e40e3800d02b02ac1b  usr/share/doc/tree/changelog.Debian.amd64.gz\n039344412ac0fc0d1528c9ff3803941e  usr/share/doc/tree/changelog.Debian.gz\n25d6d6da4b1e1bf2041c9b022367d07a  usr/share/doc/tree/changelog.gz\ne51a3c84c3b33325acc683347bfb4d3f  usr/share/doc/tree/copyright\ne0fceaec1e51e1da23fce6741a21e5a4  usr/share/man/man1/tree.1.gz\n</code></pre> <p>data.tar.xz</p> <p>Es un archivo tar comprimido que contiene los ficheros que se instalar\u00e1n:</p> <pre><code>vagrant@paqueteria:~/tree-extraction$ tar -tvf data.tar.xz\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/bin/\n-rwxr-xr-x root/root     81512 2019-08-06 19:31 ./usr/bin/tree\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/doc/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/doc/tree/\n-rw-r--r-- root/root      2723 2015-06-22 20:17 ./usr/share/doc/tree/README.gz\n-rw-r--r-- root/root      2403 2015-02-11 20:57 ./usr/share/doc/tree/TODO\n-rw-r--r-- root/root       210 2019-08-06 19:31 ./usr/share/doc/tree/changelog.Debian.amd64.gz\n-rw-r--r-- root/root      4294 2019-08-06 19:31 ./usr/share/doc/tree/changelog.Debian.gz\n-rw-r--r-- root/root      5276 2018-11-16 15:12 ./usr/share/doc/tree/changelog.gz\n-rw-r--r-- root/root      2441 2018-12-11 10:19 ./usr/share/doc/tree/copyright\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/man/\ndrwxr-xr-x root/root         0 2019-08-06 19:31 ./usr/share/man/man1/\n-rw-r--r-- root/root      4627 2019-08-06 19:31 ./usr/share/man/man1/tree.1.gz\n</code></pre> <p>Podemos extraerlo y mostrar sus contenidos para tenerlo todo m\u00e1s claro:</p> <pre><code>vagrant@paqueteria:~/tree-extraction$ mkdir data\nvagrant@paqueteria:~/tree-extraction$ tar -xvf data.tar.xz -C data\n./\n./usr/\n./usr/bin/\n./usr/bin/tree\n./usr/share/\n./usr/share/doc/\n./usr/share/doc/tree/\n./usr/share/doc/tree/README.gz\n./usr/share/doc/tree/TODO\n./usr/share/doc/tree/changelog.Debian.amd64.gz\n./usr/share/doc/tree/changelog.Debian.gz\n./usr/share/doc/tree/changelog.gz\n./usr/share/doc/tree/copyright\n./usr/share/man/\n./usr/share/man/man1/\n./usr/share/man/man1/tree.1.gz\nvagrant@paqueteria:~/tree-extraction$ tree data\ndata\n\u2514\u2500\u2500 usr\n    \u251c\u2500\u2500 bin\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 tree\n    \u2514\u2500\u2500 share\n        \u251c\u2500\u2500 doc\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 tree\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 README.gz\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 TODO\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 changelog.Debian.amd64.gz\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 changelog.Debian.gz\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 changelog.gz\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 copyright\n        \u2514\u2500\u2500 man\n            \u2514\u2500\u2500 man1\n                \u2514\u2500\u2500 tree.1.gz\n\n7 directories, 8 files\n</code></pre> <p>Vemos que tenemos el binario, las p\u00e1ginas man...etc.</p>"},{"location":"aso/ejercicios-paqueteria/#trabajo-con-repositorios","title":"Trabajo con repositorios","text":""},{"location":"aso/ejercicios-paqueteria/#ejercicio-1-repos","title":"Ejercicio 1 repos","text":"<p>A\u00f1adir a <code>sources.list</code> los repositorios bullseye-backports y sid</p> <p>Al estar usando una m\u00e1quina Vagrant los repositorios de <code>bullseye-backports</code> los tengo ya, y s\u00f3lo tendr\u00eda que a\u00f1adir los de sid.</p> <p>Dejo <code>/etc/apt/sources.list</code> de la siguiente manera:</p> <pre><code>vagrant@paqueteria:~$ cat /etc/apt/sources.list\ndeb https://deb.debian.org/debian bullseye main\ndeb-src https://deb.debian.org/debian bullseye main\n\ndeb https://security.debian.org/debian-security bullseye-security main\ndeb-src https://security.debian.org/debian-security bullseye-security main\n\ndeb https://deb.debian.org/debian bullseye-updates main\ndeb-src https://deb.debian.org/debian bullseye-updates main\n\n# Backports\ndeb https://deb.debian.org/debian bullseye-backports main\ndeb-src https://deb.debian.org/debian bullseye-backports main\n\n# Unstable\ndeb https://deb.debian.org/debian unstable main\ndeb-src https://deb.debian.org/debian unstable main\n</code></pre> <p>Si queremos que estos cambios se apliquen, tenemos que hacer:</p> <pre><code>sudo apt update\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-2-repos","title":"Ejercicio 2 repos","text":"<p>Configurar apt para que los paquetes de bullseye tengan mayor prioridad</p> <p>Creo el fichero <code>/etc/apt/preferences</code>, que no existe por defecto:</p> <pre><code>sudo nano /etc/apt/preferences\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code>Package: *\nPin: release n=bullseye\nPin-Priority: 600\n</code></pre> <p>Hago la prueba con un paquete para ver cu\u00e1l ser\u00eda el candidato y mostrar de paso las prioridades cambiadas:</p> <pre><code>vagrant@paqueteria:/etc/apt$ apt policy htop\nhtop:\n  Installed: (none)\nCandidate: 3.0.5-7\n  Version table:\n     3.2.1-1 500\n500 https://deb.debian.org/debian unstable/main amd64 Packages\n     3.0.5-7 600\n600 https://deb.debian.org/debian bullseye/main amd64 Packages\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-3-repos","title":"Ejercicio 3 repos","text":"<p>Configurar apt para que los paquetes de bullseye-backports tengan mayor prioridad que los de unstable</p> <p>Si no tocamos nada, vemos que por defecto unstable tiene mayor prioridad que bullseye-backports:</p> <pre><code>vagrant@paqueteria:~$ apt policy 7zip\n7zip:\n  Installed: (none)\nCandidate: 22.01+dfsg-4\n  Version table:\n     22.01+dfsg-4 500\n500 https://deb.debian.org/debian unstable/main amd64 Packages\n     22.01+dfsg-2~bpo11+1 100\n100 https://deb.debian.org/debian bullseye-backports/main amd64 Packages\n</code></pre> <p>As\u00ed que para modificarlo, dejo <code>/etc/apt/preferences</code> de la siguiente manera:</p> <pre><code>Package: *\nPin: release n=bullseye\nPin-Priority: 600\nPackage: *\nPin: release n=bullseye-backports\nPin-Priority: 550\n</code></pre> <p>Vemos los cambios:</p> <pre><code>vagrant@paqueteria:~$ apt policy 7zip\n7zip:\n  Installed: (none)\nCandidate: 22.01+dfsg-2~bpo11+1\n  Version table:\n     22.01+dfsg-4 500\n500 https://deb.debian.org/debian unstable/main amd64 Packages\n     22.01+dfsg-2~bpo11+1 550\n550 https://deb.debian.org/debian bullseye-backports/main amd64 Packages\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-4-repos","title":"Ejercicio 4 repos","text":"<p>A\u00f1adir la arquitectura i386</p> <pre><code>sudo dpkg --add-architecture i386\nsudo apt update\n</code></pre> <p>Listar arquitecturas no nativas</p> <pre><code>vagrant@paqueteria:~$ dpkg --print-foreign-architectures\ni386\n</code></pre> <p>Eliminar la arquitectura i386</p> <pre><code>sudo dpkg --remove-architecture i386\nsudo apt update\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-5-repos","title":"Ejercicio 5 repos","text":"<p>Mostrar todas las versiones disponibles de un paquete</p> <p>Existen varias maneras que ir\u00e9 mostrando.</p> <p>Con <code>apt policy</code>:</p> <pre><code>vagrant@paqueteria:~$ apt policy htop\nhtop:\n  Installed: (none)\nCandidate: 3.0.5-7\n  Version table:\n     3.2.1-1 500\n500 https://deb.debian.org/debian unstable/main amd64 Packages\n     3.0.5-7 600\n600 https://deb.debian.org/debian bullseye/main amd64 Packages\n</code></pre> <p>Con <code>apt-show-versions</code>:</p> <pre><code>vagrant@paqueteria:~$ apt-show-versions htop\nhtop:amd64 not installed\n</code></pre> <p>Esta manera tiene una gran desventaja y es que como vemos, s\u00f3lo muestra las versiones de lo que est\u00e1 instalado. Si lo instalamos, entonces s\u00ed ver\u00edamos la versi\u00f3n:</p> <pre><code>vagrant@paqueteria:~$ apt-show-versions htop\nhtop:amd64/bullseye 3.0.5-7 uptodate\n</code></pre> <p>Pero a\u00fan as\u00ed, no vemos las dem\u00e1s versiones que podamos tener disponibles a no ser que las instalemos, as\u00ed que esta manera me parece un poco incompleta.</p> <p>Con <code>apt-cache madison</code>:</p> <pre><code>vagrant@paqueteria:~$ apt-cache madison htop\n      htop |    3.2.1-1 | https://deb.debian.org/debian unstable/main amd64 Packages\n      htop |    3.0.5-7 | https://deb.debian.org/debian bullseye/main amd64 Packages\n      htop |    3.0.5-7 | https://deb.debian.org/debian bullseye/main Sources\n      htop |    3.2.1-1 | https://deb.debian.org/debian unstable/main Sources\n</code></pre> <p>Con <code>apt-cache showpkg</code>:</p> <pre><code>vagrant@paqueteria:~$ apt-cache showpkg htop\nPackage: htop\nVersions:\n3.2.1-1 (/var/lib/apt/lists/deb.debian.org_debian_dists_unstable_main_binary-amd64_Packages)\nDescription Language:\n                 File: /var/lib/apt/lists/deb.debian.org_debian_dists_bullseye_main_binary-amd64_Packages\n                  MD5: 8eb5aa19b3c92a975dc78e2165f6688d\n Description Language: en\n                 File: /var/lib/apt/lists/deb.debian.org_debian_dists_bullseye_main_i18n_Translation-en\n                  MD5: 8eb5aa19b3c92a975dc78e2165f6688d\n Description Language:\n                 File: /var/lib/apt/lists/deb.debian.org_debian_dists_unstable_main_binary-amd64_Packages\n                  MD5: 8eb5aa19b3c92a975dc78e2165f6688d\n\n3.0.5-7 (/var/lib/apt/lists/deb.debian.org_debian_dists_bullseye_main_binary-amd64_Packages)\nDescription Language:\n                 File: /var/lib/apt/lists/deb.debian.org_debian_dists_bullseye_main_binary-amd64_Packages\n                  MD5: 8eb5aa19b3c92a975dc78e2165f6688d\n Description Language: en\n                 File: /var/lib/apt/lists/deb.debian.org_debian_dists_bullseye_main_i18n_Translation-en\n                  MD5: 8eb5aa19b3c92a975dc78e2165f6688d\n Description Language:\n                 File: /var/lib/apt/lists/deb.debian.org_debian_dists_unstable_main_binary-amd64_Packages\n                  MD5: 8eb5aa19b3c92a975dc78e2165f6688d\n\nReverse Depends:\n  education-common,htop\n  progress-linux-base-system,htop\n  live-task-extra,htop\n  hollywood,htop\n  freedombox,htop\n  education-common,htop\n  bfh-base-system,htop\n  freedombox,htop\n  progress-linux-base-system,htop\n  live-task-extra,htop\n  hollywood,htop\n  freedombox,htop\nDependencies:\n3.2.1-1 - libc6 (2 2.33) libncursesw6 (2 6) libnl-3-200 (2 3.2.7) libnl-genl-3-200 (2 3.2.7) libtinfo6 (2 6) lm-sensors (0 (null)) lsof (0 (null)) strace (0 (null))\n3.0.5-7 - libc6 (2 2.29) libncursesw6 (2 6) libnl-3-200 (2 3.2.7) libnl-genl-3-200 (2 3.2.7) libtinfo6 (2 6) lm-sensors (0 (null)) lsof (0 (null)) strace (0 (null))\nProvides:\n3.2.1-1 -\n3.0.5-7 -\nReverse Provides:\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-6-repos","title":"Ejercicio 6 repos","text":"<p>Comandos para descargar un paquete de stable</p> <pre><code>sudo apt install -t stable &lt;paquete&gt;\nsudo apt install &lt;paquete&gt;/stable\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-7-repos","title":"Ejercicio 7 repos","text":"<p>Comandos para descargar un paquete de bullseye-backports</p> <pre><code>sudo apt install -t bullseye-backports &lt;paquete&gt;\nsudo apt install &lt;paquete&gt;/bullseye-backports\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-8-repos","title":"Ejercicio 8 repos","text":"<p>Comandos para descargar un paquete de sid</p> <pre><code>sudo apt install -t unstable &lt;paquete&gt;\nsudo apt install &lt;paquete&gt;/unstable\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#ejercicio-9-repos","title":"Ejercicio 9 repos","text":"<p>Comando para descargar un paquete de arquitectura i386</p> <pre><code>sudo apt install &lt;paquete&gt;:i386\n</code></pre>"},{"location":"aso/ejercicios-paqueteria/#trabajo-con-directorios","title":"Trabajo con directorios","text":""},{"location":"aso/ejercicios-paqueteria/#varlibaptlists","title":"/var/lib/apt/lists/","text":"<p>Con <code>man apt-get</code> nos encontramos lo siguiente:</p> <pre><code>       /var/lib/apt/lists/\n           Storage area for state information for each package resource specified in sources.list(5) Configuration Item: Dir::State::Lists.\n</code></pre> <p>Es decir, en este directorio se almacena informaci\u00f3n sobre el estado de los recursos mediante los cuales obtenemos paquetes que tengamos definidos en nuestro <code>sources.list</code> (repositorios).</p> <p>Al hacer <code>sudo apt update</code> este directorio se llena de datos:</p> <pre><code>vagrant@paqueteria:~$ ls -la /var/lib/apt/lists/\ntotal 128528\ndrwxr-xr-x 4 root root     4096 Oct 29 15:43 .\ndrwxr-xr-x 5 root root     4096 Sep 12 05:17 ..\ndrwxr-xr-x 2 _apt root     4096 Oct 29 15:43 auxfiles\n-rw-r--r-- 1 root root    48958 Oct 29 14:17 deb.debian.org_debian_dists_bullseye-backports_InRelease\n-rw-r--r-- 1 root root  2102914 Oct 29 13:59 deb.debian.org_debian_dists_bullseye-backports_main_binary-amd64_Packages\n-rw-r--r-- 1 root root  1641867 Oct 27 08:01 deb.debian.org_debian_dists_bullseye-backports_main_i18n_Translation-en\n-rw-r--r-- 1 root root  2423808 Oct 29 08:01 deb.debian.org_debian_dists_bullseye-backports_main_source_Sources\n-rw-r--r-- 1 root root    44066 Oct 29 14:17 deb.debian.org_debian_dists_bullseye-updates_InRelease\n-rw-r--r-- 1 root root    56940 Oct 21 20:12 deb.debian.org_debian_dists_bullseye-updates_main_binary-amd64_Packages\n-rw-r--r-- 1 root root    45666 Oct 21 20:12 deb.debian.org_debian_dists_bullseye-updates_main_i18n_Translation-en\n-rw-r--r-- 1 root root    20515 Oct 21 20:12 deb.debian.org_debian_dists_bullseye-updates_main_source_Sources\n-rw-r--r-- 1 root root   115947 Sep 10 10:27 deb.debian.org_debian_dists_bullseye_InRelease\n-rw-r--r-- 1 root root 45528711 Sep 10 09:45 deb.debian.org_debian_dists_bullseye_main_binary-amd64_Packages\n-rw-r--r-- 1 root root 30246167 Sep 10 09:45 deb.debian.org_debian_dists_bullseye_main_i18n_Translation-en\n-rw-r--r-- 1 root root 44649916 Sep 10 09:45 deb.debian.org_debian_dists_bullseye_main_source_Sources\n-rw-r----- 1 root root        0 Oct 29 15:43 lock\ndrwx------ 2 _apt root     4096 Oct 29 15:46 partial\n-rw-r--r-- 1 root root    48374 Oct 29 15:02 security.debian.org_debian-security_dists_bullseye-security_InRelease\n-rw-r--r-- 1 root root  1274634 Oct 27 20:43 security.debian.org_debian-security_dists_bullseye-security_main_binary-amd64_Packages\n-rw-r--r-- 1 root root   909862 Oct 23 18:35 security.debian.org_debian-security_dists_bullseye-security_main_i18n_Translation-en\n-rw-r--r-- 1 root root  2399825 Oct 27 20:43 security.debian.org_debian-security_dists_bullseye-security_main_source_Sources\n</code></pre> <p>Encontramos tanto ficheros con informaci\u00f3n sobre paquetes como ficheros de firmas gpg y hashes SHA256, entre otros.</p>"},{"location":"aso/ejercicios-paqueteria/#varlibdpkgavailable","title":"/var/lib/dpkg/available","text":"<p>Contiene una lista con informaci\u00f3n sobre los paquetes disponibles en sistemas basados en dpkg.</p> <p>Ejemplo de contenido:</p> <p></p>"},{"location":"aso/ejercicios-paqueteria/#varlibdpkgstatus","title":"/var/lib/dpkg/status","text":"<p>Es una base de datos local usada por <code>apt-cache</code> para obtener informaci\u00f3n r\u00e1pidamente y sin Internet sobre los paquetes instalados.</p> <p>Ejemplo de contenido:</p> <p></p>"},{"location":"aso/ejercicios-paqueteria/#varcacheaptarchives","title":"/var/cache/apt/archives/","text":"<p>Es el directorio usado para almacenar los paquetes .deb descargados. Tiene un subdirectorio <code>partial</code> que funciona como almacenamiento para los paquetes en tr\u00e1nsito.</p>"},{"location":"aso/ejercicios-parametros-kernel/","title":"Ejercicios de par\u00e1metros del kernel","text":""},{"location":"aso/ejercicios-parametros-kernel/#ejercicio-1","title":"Ejercicio 1","text":"<p>Deshabilitar apparmor</p> <p>Muestro el estado de apparmor:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 cat /sys/module/apparmor/parameters/enabled\nY\n</code></pre> <p>Y = habilitado</p> <p>Para deshabilitarlo:</p> <pre><code>echo 'GRUB_CMDLINE_LINUX_DEFAULT=\"$GRUB_CMDLINE_LINUX_DEFAULT apparmor=0\"' | sudo tee /etc/default/grub.d/apparmor.cfg\nsudo update-grub\nsudo reboot\n</code></pre> <p>Compruebo que se ha deshabilitado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 cat /sys/module/apparmor/parameters/enabled\nN\n</code></pre> <p>N = deshabilitado</p>"},{"location":"aso/ejercicios-parametros-kernel/#ejercicio-2","title":"Ejercicio 2","text":"<p>Deshabilitar el Kernel Mode Setting (KMS) de la tarjeta gr\u00e1fica</p> <p>Compruebo que tengo KMS activado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 lsmod | grep kms\ndrm_kms_helper        278528  2 i915,nouveau\ncec                    61440  2 drm_kms_helper,i915\ndrm                   626688  13 drm_kms_helper,i915,ttm,nouveau\n</code></pre> <p>Modifico la siguiente l\u00ednea de <code>/etc/default/grub</code>:</p> <pre><code>GRUB_CMDLINE_LINUX_DEFAULT=\"quiet nomodeset\" # (1)!\n</code></pre> <ol> <li>A\u00f1ado nomodeset al final</li> </ol> <p>Actualizo grub:</p> <pre><code>sudo update-grub\n</code></pre> <p>Reinicio:</p> <pre><code>sudo reboot\n</code></pre> <p>S\u00e9 que se ha deshabilitado correctamente porque al reiniciar tengo la resoluci\u00f3n mal:</p> <p></p> <p>Y adem\u00e1s tambi\u00e9n estaba mal la resoluci\u00f3n durante el arranque.</p>"},{"location":"aso/ejercicios-parametros-kernel/#ejercicio-3","title":"Ejercicio 3","text":"<p>Modificar temporalmente la swappiness para que la swap se active solamente cuando la carga de RAM supere el 90%</p> <p>Muestro el valor actual:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo sysctl vm.swappiness\nvm.swappiness = 60\n</code></pre> <p>Lo modifico:</p> <pre><code>sudo bash -c \"echo 10 &gt; /proc/sys/vm/swappiness\"\n</code></pre> <p>Compruebo que el valor ha cambiado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo sysctl vm.swappiness\nvm.swappiness = 10\n</code></pre> <p>Para testear el funcionamiento tengo que instalar el siguiente paquete:</p> <pre><code>sudo apt install stress-ng\n</code></pre> <p>Mi m\u00e1quina tiene 7.6 Gi de RAM as\u00ed que la SWAP se deber\u00eda de activar aproximadamente con 6.84 Gi de RAM en uso.</p> <p>Abro 2 terminales, en la primera ejecuto el siguiente comando para monitorizar la  memoria:</p> <pre><code>watch free -h\n</code></pre> <p>En la segunda ejecuto el siguiente comando para llenar la memoria:</p> <pre><code>stress-ng --vm 1 --vm-bytes 120%\n</code></pre> <p>Los porcentajes no son muy exactos, pero lo importante es que llenemos la RAM (casi toda) lo suficiente para que empiece a usar la SWAP.</p> <p>GIF de funcionamiento:</p> <p></p> <p>Si queremos reiniciar la prueba por alg\u00fan motivo, como cambiar las cargas de RAM, tendremos que recargar la SWAP:</p> <pre><code>sudo swapoff -a\nsudo swapon -a\n</code></pre>"},{"location":"aso/ejercicios-parametros-kernel/#ejercicio-4","title":"Ejercicio 4","text":"<p>Hacer permanente el cambio de la swappiness</p> <pre><code>sudo bash -c 'echo \"vm.swappiness=10\" &gt;&gt; /etc/sysctl.conf'\n</code></pre> <p>Recargo la configuraci\u00f3n:</p> <pre><code>sudo sysctl -p\n</code></pre> <p>Compruebo que el valor ha cambiado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo sysctl vm.swappiness\nvm.swappiness = 10\n</code></pre>"},{"location":"aso/ejercicios-parametros-kernel/#ejercicio-5","title":"Ejercicio 5","text":"<p>Mostrar el valor del bit de forward IPv6</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo sysctl net.ipv6.conf.all.forwarding\nnet.ipv6.conf.all.forwarding = 0\n</code></pre>"},{"location":"aso/ejercicios-parametros-kernel/#ejercicio-6","title":"Ejercicio 6","text":"<p>Deshabilitar completamente el Magic SysRq en el arranque y volver a habilitarlo despu\u00e9s de reiniciar</p> <p>Compruebo que por defecto est\u00e1 habilitado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 cat /proc/sys/kernel/sysrq\n438\n</code></pre> <p>Tambi\u00e9n puedo comprobar que funciona haciendo la siguiente secuencia de acciones:</p> <ol> <li>Pulsar Ctrl + Alt + Fn a la vez</li> <li>Pulsar la tecla SysRq (imp pant / pet sis) con la otra mano</li> <li>Soltar Ctrl + Alt + Fn mientras que se sigue pulsando la tecla SysRq</li> <li>Pulsar las teclas R, E, I, S, U, B consecutivamente</li> <li>Soltar todas las teclas</li> </ol> <p>Lo deshabilito permanentemente:</p> <pre><code>sudo bash -c 'echo \"kernel.sysrq=0\" &gt;&gt; /etc/sysctl.conf'\n</code></pre> <p>Recargo la configuraci\u00f3n:</p> <pre><code>sudo sysctl -p\n</code></pre> <p>Compruebo que el valor ha cambiado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo sysctl kernel.sysrq\nkernel.sysrq = 0\n</code></pre> <p>A partir de ahora ya no funcionar\u00e1 el Magic SysRq incluso tras reiniciar:</p> <pre><code>sudo reboot\n</code></pre> <p>Lo vuelvo a habilitar:</p> <pre><code>sudo sed -i 's/kernel.sysrq=0/kernel.sysrq=438/g' /etc/sysctl.conf\n</code></pre> <p>Recargo la configuraci\u00f3n:</p> <pre><code>sudo sysctl -p\n</code></pre> <p>Compruebo que el valor ha cambiado:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo sysctl kernel.sysrq\nkernel.sysrq = 438\n</code></pre> <p>Ya volver\u00eda a funcionar el Magic SysRq.</p>"},{"location":"aso/instalacion_debian11/","title":"Instalaci\u00f3n de Debian 11","text":""},{"location":"aso/instalacion_debian11/#problemas-durante-la-instalacion","title":"Problemas durante la instalaci\u00f3n","text":"<ul> <li>No detectaba el SSD: durante el paso de particionamiento, s\u00f3lo se reconoc\u00eda el HDD. Se soluciona cambiando el modo SATA de RST a AHCI en la BIOS.</li> <li>Error <code>Unable to install GRUB in dummy</code>: sucede durante el paso de instalaci\u00f3n de GRUB, y significa que el instalador de debian no puede acceder a EFI para instalar GRUB. El error ocurre cuando la partici\u00f3n EFI est\u00e1 dentro de LVM, ya que el instalador de debian parece no ser capaz de acceder a LVM para instalar GRUB. Se soluciona sacando la partici\u00f3n EFI como partici\u00f3n f\u00edsica fuera de LVM.</li> </ul>"},{"location":"aso/instalacion_debian11/#esquema-de-particionamiento","title":"Esquema de particionamiento","text":"<p>Tengo los siguientes discos f\u00edsicos, un SSD y un HDD:</p> <pre><code>atlas@olympus:~$ sudo hwinfo --disk --short\ndisk:\n  /dev/nvme0n1         Kingston Technology Company Disk\n  /dev/sda             ST500LT012-1DG14\n</code></pre> <p>El particionamiento est\u00e1 hecho con LVM, a excepci\u00f3n de la partici\u00f3n EFI, que es una partici\u00f3n f\u00edsica fuera de LVM por la raz\u00f3n ya explicada anteriormente.</p> <p>\u00bfPor qu\u00e9 utilizamos LVM en lugar de particiones f\u00edsicas? En LVM asignamos \"pools\" de espacio y a partir de ah\u00ed creamos vol\u00famenes, y \u00e9stos son totalmente din\u00e1micos. Podemos redimensionar, crear y borrar como queramos y cuando queramos sin problemas. Esto evidentemente es una gran ventaja en comparaci\u00f3n con particiones f\u00edsicas tradicionales, que no ofrecen demasiada flexibilidad sobre todo a la hora de redimensionar.</p> <p>Muestro mis vol\u00famenes f\u00edsicos de LVM:</p> <pre><code>atlas@olympus:~$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/nvme0n1p2\n  VG Name               SSD\n  PV Size               238.38 GiB / not usable 3.00 MiB\n  Allocatable           yes\n  PE Size               4.00 MiB\n  Total PE              61025\nFree PE               11197\nAllocated PE          49828\nPV UUID               RXPn3u-nkYK-uiN5-Qncv-AnAf-qZaB-M6ki78\n\n--- Physical volume ---\n  PV Name               /dev/sda1\n  VG Name               HDD\n  PV Size               &lt;465.76 GiB / not usable 2.00 MiB\n  Allocatable           yes\n  PE Size               4.00 MiB\n  Total PE              119234\nFree PE               47709\nAllocated PE          71525\nPV UUID               K0vDwq-sWWO-9BGf-qniy-pdjj-JmH3-73rk5a\n</code></pre> <p>Muestro mis grupos de vol\u00famenes de LVM:</p> <pre><code>atlas@olympus:~$ sudo vgdisplay\n  --- Volume group ---\n  VG Name               SSD\n  System ID\n  Format                lvm2\n  Metadata Areas        1\nMetadata Sequence No  5\nVG Access             read/write\n  VG Status             resizable\n  MAX LV                0\nCur LV                4\nOpen LV               4\nMax PV                0\nCur PV                1\nAct PV                1\nVG Size               &lt;238.38 GiB\n  PE Size               4.00 MiB\n  Total PE              61025\nAlloc PE / Size       49828 / 194.64 GiB\n  Free  PE / Size       11197 / &lt;43.74 GiB\n  VG UUID               Gd9Ehq-9T2H-N62g-5jl6-p4tt-KEIJ-53olaH\n\n--- Volume group ---\n  VG Name               HDD\n  System ID\n  Format                lvm2\n  Metadata Areas        1\nMetadata Sequence No  2\nVG Access             read/write\n  VG Status             resizable\n  MAX LV                0\nCur LV                1\nOpen LV               1\nMax PV                0\nCur PV                1\nAct PV                1\nVG Size               &lt;465.76 GiB\n  PE Size               4.00 MiB\n  Total PE              119234\nAlloc PE / Size       71525 / 279.39 GiB\n  Free  PE / Size       47709 / 186.36 GiB\n  VG UUID               vQpT3a-9uE7-ZL4x-Dlfq-uQkg-KDRd-hdjggm\n</code></pre> <p>Si nos damos cuenta, tengo 2 grupos de vol\u00famenes, SSD y HDD. Mi disco f\u00edsico SSD est\u00e1 en el grupo SSD y mi disco f\u00edsico HDD est\u00e1 en el grupo HDD.</p> <p>Aunque tenga s\u00f3lo 1 volumen f\u00edsico por grupo de vol\u00famenes, es muy importante hacer esta divisi\u00f3n para m\u00ed. As\u00ed tengo un control real sobre qu\u00e9 vol\u00famenes l\u00f3gicos necesitan velocidad, y por tanto van en el grupo SSD, y qu\u00e9 vol\u00famenes l\u00f3gicos no necesitan velocidad, y por tanto van en el grupo HDD.</p> <p>Muestro mis vol\u00famenes l\u00f3gicos de LVM:</p> <pre><code>atlas@olympus:~$ sudo lvdisplay\n  --- Logical volume ---\n  LV Path                /dev/SSD/root\n  LV Name                root\n  VG Name                SSD\n  LV UUID                1nsB1N-F7yF-p22v-7qXX-Cb9U-uQk0-g8kf7G\n  LV Write Access        read/write\n  LV Creation host, time olympus, 2022-09-18 18:10:38 +0200\n  LV Status              available\n  # open                 1\nLV Size                &lt;27.94 GiB\n  Current LE             7152\nSegments               1\nAllocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\nBlock device           254:0\n\n--- Logical volume ---\n  LV Path                /dev/SSD/boot\n  LV Name                boot\n  VG Name                SSD\n  LV UUID                LMdf6Z-Uc8s-B1Xf-dVVv-Ges0-VIVx-nBqv0X\n  LV Write Access        read/write\n  LV Creation host, time olympus, 2022-09-18 18:12:50 +0200\n  LV Status              available\n  # open                 1\nLV Size                952.00 MiB\n  Current LE             238\nSegments               1\nAllocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\nBlock device           254:1\n\n--- Logical volume ---\n  LV Path                /dev/SSD/swap\n  LV Name                swap\n  VG Name                SSD\n  LV UUID                PyIo9Y-UjDh-WGES-xPAO-SDuA-fpqm-P2GEVN\n  LV Write Access        read/write\n  LV Creation host, time olympus, 2022-09-18 18:13:23 +0200\n  LV Status              available\n  # open                 2\nLV Size                &lt;7.45 GiB\n  Current LE             1907\nSegments               1\nAllocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\nBlock device           254:2\n\n--- Logical volume ---\n  LV Path                /dev/SSD/var\n  LV Name                var\n  VG Name                SSD\n  LV UUID                AYy3Cv-GfJY-929d-bhhz-dugm-DWrb-UL2Qod\n  LV Write Access        read/write\n  LV Creation host, time olympus, 2022-09-18 18:13:36 +0200\n  LV Status              available\n  # open                 1\nLV Size                158.32 GiB\n  Current LE             40531\nSegments               1\nAllocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\nBlock device           254:3\n\n--- Logical volume ---\n  LV Path                /dev/HDD/home\n  LV Name                home\n  VG Name                HDD\n  LV UUID                BdQutw-r9An-lHVS-mntV-j5WM-cyBY-xqufHY\n  LV Write Access        read/write\n  LV Creation host, time olympus, 2022-09-18 17:55:42 +0200\n  LV Status              available\n  # open                 1\nLV Size                279.39 GiB\n  Current LE             71525\nSegments               1\nAllocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\nBlock device           254:4\n</code></pre> <p>Una vez mostrada toda la informaci\u00f3n relevante sobre LVM, puedo mostrar la situaci\u00f3n general resumida del particionado para que todo se entienda mejor de un vistazo:</p> <pre><code>atlas@olympus:~$ lsblk\nNAME         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT\nsda            8:0    0 465.8G  0 disk\n\u2514\u2500sda1         8:1    0 465.8G  0 part\n  \u2514\u2500HDD-home 254:4    0 279.4G  0 lvm  /home\nnvme0n1      259:0    0 238.5G  0 disk\n\u251c\u2500nvme0n1p1  259:1    0    94M  0 part /boot/efi\n\u2514\u2500nvme0n1p2  259:2    0 238.4G  0 part\n  \u251c\u2500SSD-root 254:0    0  27.9G  0 lvm  /\n  \u251c\u2500SSD-boot 254:1    0   952M  0 lvm  /boot\n  \u251c\u2500SSD-swap 254:2    0   7.4G  0 lvm  [SWAP]\n\u2514\u2500SSD-var  254:3    0 158.3G  0 lvm  /var\n</code></pre> <p>Razonamientos sobre particiones y tama\u00f1os:</p> <ul> <li>El LV Home es lo \u00fanico que se encuentra en el HDD porque es el \u00fanico vol\u00famen que no necesita velocidad de los que tengo. Le asign\u00e9 300 GB, aunque podr\u00eda haberle asignado la totalidad del PV HDD, pero siempre hay que dejar espacio libre por si se necesita.</li> <li>La partici\u00f3n EFI como vemos es f\u00edsica, por lo ya explicado, y tiene asignados 100 MB porque es el tama\u00f1o recomendado oficial.</li> <li>El LV root tiene asignados 30 GB, que est\u00e1 bien para empezar, aunque posiblemente necesite aumento a mitad/final de curso ya que el a\u00f1o pasado mi <code>/usr</code> lleg\u00f3 a ocupar unos 60-80 GB.</li> <li><code>/boot</code> se encuentra en LVM por razones simples: no daba problemas durante la instalaci\u00f3n por tenerlo dentro de LVM como s\u00ed dio EFI, y posiblemente necesite aumento de espacio a lo largo del curso cuando empecemos a compilar kernels.</li> <li>Con respecto a la swap hay muchos criterios diferentes sobre cu\u00e1nto deber\u00eda de ocupar en un sistema, y en mi caso como no suelo hibernar/suspender el port\u00e1til, le he asignado un tama\u00f1o igual al de mi RAM = 8 GB.</li> <li>El LV var es el volumen que con diferencia m\u00e1s espacio necesita para lo que hacemos, as\u00ed que este a\u00f1o le asign\u00e9 un tama\u00f1o inicial incluso mayor que el a\u00f1o pasado, 170 GB. Incluso con este tama\u00f1o, a mitad/final de curso habr\u00e1 que borrar escenarios de m\u00e1quinas virtuales para liberar espacio o aumentar el LV, ya que el a\u00f1o pasado llegu\u00e9 a ocupar +300 GB de m\u00e1quinas virtuales.</li> </ul> <p>Muestro ahora los sistemas de ficheros:</p> <pre><code>atlas@olympus:~$ lsblk -f\nNAME         FSTYPE      FSVER    LABEL UUID                                   FSAVAIL FSUSE% MOUNTPOINT\nsda\n\u2514\u2500sda1       LVM2_member LVM2 001       K0vDwq-sWWO-9BGf-qniy-pdjj-JmH3-73rk5a\n  \u2514\u2500HDD-home xfs                        32345149-c35e-4c4c-8ed7-41e87627c978    215.5G    23% /home\nnvme0n1\n\u251c\u2500nvme0n1p1  vfat        FAT32          2A00-295A                                89.1M     4% /boot/efi\n\u2514\u2500nvme0n1p2  LVM2_member LVM2 001       RXPn3u-nkYK-uiN5-Qncv-AnAf-qZaB-M6ki78\n  \u251c\u2500SSD-root xfs                        4ad9bf47-bcb8-476e-adc3-6c015765ca3e       23G    18% /\n  \u251c\u2500SSD-boot xfs                        814e8a96-bbde-466c-a2e3-73acf67b62fc    843.9M    11% /boot\n  \u251c\u2500SSD-swap swap        1              24e93954-d46f-45ff-b517-93ba486c1692                  [SWAP]\n\u2514\u2500SSD-var  xfs                        392c71c4-6ff6-4435-9931-197de2fdcd21    147.4G     7% /var\n</code></pre> <p>Como vemos casi todo est\u00e1 en XFS por el dinamismo que aporta este sistema de ficheros, quitando SWAP y EFI que tienen sus propios sistemas de ficheros espec\u00edficos que necesitan.</p>"},{"location":"aso/instalacion_debian11/#problemas-de-drivers","title":"Problemas de drivers","text":"<p>El \u00fanico problema de drivers que tiene mi port\u00e1til (ASUS TUF Gaming FX504GD) en Debian, es con el adaptador WiFi. El driver que trae por defecto la instalaci\u00f3n de Debian 11 parece no funcionar.</p> <p>Se soluciona haciendo lo siguiente:</p> <pre><code>sudo apt install bc module-assistant build-essential dkms\ngit clone https://github.com/tomaspinho/rtl8821ce\ncd rtl8821ce\nsudo m-a prepare\nsudo ./dkms-install.sh\n</code></pre> <p>Despu\u00e9s de hacer esto y reiniciar el port\u00e1til, la WiFi deber\u00eda de funcionar correctamente.</p> <p>Fuente: https://miloserdov.org/?p=5930</p> <p>\u00bfQu\u00e9 es lo que se ha hecho aqu\u00ed realmente?</p> <p>Simplemente me he descargado el c\u00f3digo fuente del driver espec\u00edfico que necesita mi port\u00e1til, y luego lo he compilado e instalado.</p>"},{"location":"aso/ldap-inicial/","title":"Pr\u00e1ctica inicial","text":""},{"location":"aso/ldap-inicial/#1-enunciado","title":"1. Enunciado","text":"<p>Realizar la instalaci\u00f3n y configuraci\u00f3n del servidor OpenLDAP en <code>server</code>, utilizando como base el nombre DNS asignado.  </p> <p>Crear el usuario <code>prueba</code> y configurar <code>clientedebian</code> para que pueda validarse en <code>server</code> con dicho usuario.</p> <p>El home de los usuarios deber\u00e1 estar centralizado en <code>server</code>.</p>"},{"location":"aso/ldap-inicial/#2-escenario","title":"2. Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\nconfig.vm.provider :libvirt do |libvirt|\nlibvirt.cpus = 2\nlibvirt.memory = 1024\nend\n\nconfig.vm.define :server do |server|\nserver.vm.box = \"debian/bullseye64\"\nserver.vm.hostname = \"server\"\nserver.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ldap-inicial\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :clientedebian do |clientedebian|\nclientedebian.vm.box = \"debian/bullseye64\"\nclientedebian.vm.hostname = \"clientedebian\"\nclientedebian.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ldap-inicial\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.3\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nend\n</code></pre>"},{"location":"aso/ldap-inicial/#3-en-server","title":"3. En <code>server</code>","text":""},{"location":"aso/ldap-inicial/#31-resoluciones","title":"3.1 Resoluciones","text":"<p>Dejo <code>/etc/hosts</code> as\u00ed:</p> <pre><code>sudo nano /etc/hosts\n</code></pre> <pre><code>127.0.0.1   localhost\n127.0.0.2   bullseye\n::1         localhost ip6-localhost ip6-loopback\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n\n127.0.1.1 server.adrianj.gonzalonazareno.org server\n10.0.0.3 clientedebian.adrianj.gonzalonazareno.org clientedebian\n</code></pre> <p>Pruebo el FQDN:</p> <pre><code>vagrant@server:~$ hostname -f\nserver.adrianj.gonzalonazareno.org\n</code></pre> <p>Pruebo las resoluciones:</p> <pre><code>vagrant@server:~$ ping server.adrianj.gonzalonazareno.org -c 1\nPING server.adrianj.gonzalonazareno.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from server.adrianj.gonzalonazareno.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.129 ms\n\n--- server.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.129/0.129/0.129/0.000 ms\nvagrant@server:~$ ping clientedebian.adrianj.gonzalonazareno.org -c 1\nPING clientedebian.adrianj.gonzalonazareno.org (10.0.0.3) 56(84) bytes of data.\n64 bytes from clientedebian.adrianj.gonzalonazareno.org (10.0.0.3): icmp_seq=1 ttl=64 time=0.467 ms\n\n--- clientedebian.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.467/0.467/0.467/0.000 ms\n</code></pre>"},{"location":"aso/ldap-inicial/#32-paqueteria","title":"3.2 Paqueter\u00eda","text":"<pre><code>sudo apt update\nsudo apt install slapd ldap-utils\n</code></pre> <p>Nos pide contrase\u00f1a para el usuario <code>admin</code> (1234):</p> <p></p> <p>Muestro el estado inicial del directorio:</p> <pre><code>vagrant@server:~$ sudo slapcat\ndn: dc=adrianj,dc=gonzalonazareno,dc=org\nobjectClass: top\nobjectClass: dcObject\nobjectClass: organization\no: adrianj.gonzalonazareno.org\ndc: adrianj\nstructuralObjectClass: organization\nentryUUID: 4b2a783c-3671-103d-94b3-f9f56aa6856a\ncreatorsName: cn=admin,dc=adrianj,dc=gonzalonazareno,dc=org\ncreateTimestamp: 20230201114247Z\nentryCSN: 20230201114247.462833Z#000000#000#000000\nmodifiersName: cn=admin,dc=adrianj,dc=gonzalonazareno,dc=org\nmodifyTimestamp: 20230201114247Z\n</code></pre>"},{"location":"aso/ldap-inicial/#33-usuario","title":"3.3 Usuario","text":"<p>Genero una contrase\u00f1a para el usuario <code>prueba</code> (1234):</p> <pre><code>vagrant@server:~$ sudo slappasswd\nNew password:\nRe-enter new password:\n{SSHA}n/YjGnAXWJ6gDEIsZvVz69OFfLyMWbXo\n</code></pre> <p>Creo el siguiente fichero:</p> <pre><code>nano ldapuser.ldif\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code>dn: uid=prueba,dc=adrianj,dc=gonzalonazareno,dc=org\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\ncn: prueba\nsn: surname\nuserPassword: {SSHA}n/YjGnAXWJ6gDEIsZvVz69OFfLyMWbXo\nloginShell: /bin/bash\nuidNumber: 2000\ngidNumber: 2000\nhomeDirectory: /srv/homes/prueba\n</code></pre> <p>Creo el usuario:</p> <pre><code>vagrant@server:~$ ldapadd -x -D cn=admin,dc=adrianj,dc=gonzalonazareno,dc=org -W -f ldapuser.ldif\nEnter LDAP Password:\nadding new entry \"uid=prueba,dc=adrianj,dc=gonzalonazareno,dc=org\"\n</code></pre> <p>Muestro que se ha creado:</p> <pre><code>vagrant@server:~$ ldapsearch -x -b \"dc=adrianj,dc=gonzalonazareno,dc=org\" -H ldap://server.adrianj.gonzalonazareno.org -D \"cn=admin,dc=adrianj,dc=gonzalonazareno,dc=org\" -W \"objectclass=posixAccount\"\nEnter LDAP Password:\n# extended LDIF\n#\n# LDAPv3\n# base &lt;dc=adrianj,dc=gonzalonazareno,dc=org&gt; with scope subtree\n# filter: objectclass=posixAccount\n# requesting: ALL\n#\n# prueba, adrianj.gonzalonazareno.org\ndn: uid=prueba,dc=adrianj,dc=gonzalonazareno,dc=org\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\ncn: prueba\nsn: surname\nuserPassword:: e1NTSEF9bi9ZakduQVhXSjZnREVJc1p2Vno2OU9GZkx5TVdiWG8=\nloginShell: /bin/bash\nuidNumber: 2000\ngidNumber: 2000\nhomeDirectory: /srv/homes/prueba\nuid: prueba\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 2\n# numEntries: 1\n</code></pre>"},{"location":"aso/ldap-inicial/#34-nfs-server","title":"3.4 NFS server","text":"<p>Creo el directorio que compartiremos donde se almacenar\u00e1n todos los homes:</p> <pre><code>sudo mkdir /srv/homes\n</code></pre> <p>Instalo el paquete:</p> <pre><code>sudo apt install nfs-kernel-server\n</code></pre> <p>Defino el directorio compartido en el siguiente fichero:</p> <pre><code>sudo nano /etc/exports\n</code></pre> <pre><code>/srv/homes 10.0.0.0/24(rw,sync,no_subtree_check,no_root_squash)\n</code></pre> <p>Reinicio nfs y actualizo la lista de directorios compartidos:</p> <pre><code>sudo systemctl restart nfs-kernel-server\nsudo exportfs\n</code></pre>"},{"location":"aso/ldap-inicial/#4-en-clientedebian","title":"4. En <code>clientedebian</code>","text":""},{"location":"aso/ldap-inicial/#41-resoluciones","title":"4.1 Resoluciones","text":"<p>Dejo <code>/etc/hosts</code> as\u00ed:</p> <pre><code>sudo nano /etc/hosts\n</code></pre> <pre><code>127.0.0.1   localhost\n127.0.0.2   bullseye\n::1         localhost ip6-localhost ip6-loopback\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n\n127.0.1.1 clientedebian.adrianj.gonzalonazareno.org clientedebian\n10.0.0.2 server.adrianj.gonzalonazareno.org server\n</code></pre> <p>Pruebo el FQDN:</p> <pre><code>vagrant@clientedebian:~$ hostname -f\nclientedebian.adrianj.gonzalonazareno.org\n</code></pre> <p>Pruebo las resoluciones:</p> <pre><code>vagrant@clientedebian:~$ ping clientedebian.adrianj.gonzalonazareno.org -c 1\nPING clientedebian.adrianj.gonzalonazareno.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from clientedebian.adrianj.gonzalonazareno.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.068 ms\n\n--- clientedebian.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.068/0.068/0.068/0.000 ms\nvagrant@clientedebian:~$ ping server.adrianj.gonzalonazareno.org -c 1\nPING server.adrianj.gonzalonazareno.org (10.0.0.2) 56(84) bytes of data.\n64 bytes from server.adrianj.gonzalonazareno.org (10.0.0.2): icmp_seq=1 ttl=64 time=0.244 ms\n\n--- server.adrianj.gonzalonazareno.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.244/0.244/0.244/0.000 ms\n</code></pre>"},{"location":"aso/ldap-inicial/#42-paqueteria","title":"4.2 Paqueter\u00eda","text":"<pre><code>sudo apt update\nsudo apt install libnss-ldapd libpam-ldapd ldap-utils\n</code></pre>"},{"location":"aso/ldap-inicial/#43-pam","title":"4.3 PAM","text":"<p>A\u00f1ado la siguiente l\u00ednea de configuraci\u00f3n al final del fichero:</p> <pre><code>sudo nano /etc/pam.d/common-session\n</code></pre> <pre><code>session required        pam_mkhomedir.so skel=/etc/skel umask=077\n</code></pre> <p>Reinicio los servicios</p> <pre><code>sudo systemctl restart nscd nslcd\n</code></pre>"},{"location":"aso/ldap-inicial/#44-nfs-client","title":"4.4 NFS client","text":"<p>Creo el directorio donde se montar\u00e1 el compartido por el servidor:</p> <pre><code>sudo mkdir /srv/homes\n</code></pre> <p>Instalo el paquete:</p> <pre><code>sudo apt install nfs-common\n</code></pre> <p>Monto el directorio compartido:</p> <pre><code>sudo mount server.adrianj.gonzalonazareno.org:/srv/homes /srv/homes\n</code></pre> <p>Compruebo que se ha montado:</p> <p></p> <p>Hago el montaje permanente a\u00f1adiendo la siguiente l\u00ednea al final del fichero:</p> <pre><code>sudo nano /etc/fstab\n</code></pre> <pre><code>server.adrianj.gonzalonazareno.org:/srv/homes   /srv/homes   nfs  defaults   0  0\n</code></pre>"},{"location":"aso/ldap-inicial/#45-pruebas","title":"4.5 Pruebas","text":"<p>Podemos logearnos con el usuario <code>prueba</code> remoto de LDAP de 2 maneras.</p> <p>As\u00ed:</p> <pre><code>vagrant@clientedebian:~$ su - prueba\nPassword:\nCreating directory '/srv/homes/prueba'.\nprueba@clientedebian:~$\n</code></pre> <p>O as\u00ed:</p> <pre><code>vagrant@clientedebian:~$ sudo login prueba\nPassword:\nLinux clientedebian 5.10.0-20-amd64 #1 SMP Debian 5.10.158-2 (2022-12-13) x86_64\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nprueba@clientedebian:~$\n</code></pre> <p>Pruebo que ese usuario no existe localmente, y era efectivamente un usuario remoto de LDAP:</p> <pre><code>vagrant@clientedebian:~$ cat /etc/passwd | grep prueba\nvagrant@clientedebian:~$\n</code></pre> <p>Estando logeado, muestro el directorio home creado y creo un fichero y compruebo que aparece en el servidor:</p> <p></p>"},{"location":"aso/ldaps/","title":"LDAPs","text":""},{"location":"aso/ldaps/#1-enunciado","title":"1. Enunciado","text":"<p>Configurar el servidor LDAP para que utilice tanto el protocolo <code>ldaps://</code> como <code>ldap://</code> con certificados x509.</p> <p>Configurar los clientes LDAP para que usen <code>ldaps://</code> por defecto.</p>"},{"location":"aso/ldaps/#2-server","title":"2. Server","text":""},{"location":"aso/ldaps/#21-requisitos","title":"2.1 Requisitos","text":"<pre><code>sudo apt install libldap-common\n</code></pre>"},{"location":"aso/ldaps/#22-certificados","title":"2.2 Certificados","text":"<p>Genero la clave privada:</p> <pre><code>sudo su -\ncd /etc/ssl/private\nopenssl genrsa -aes128 -out server.key 2048\n</code></pre> <p>Le quito la passphrase:</p> <pre><code>openssl rsa -in server.key -out server.key\n</code></pre> <p>Genero el csr:</p> <pre><code>root@server:/etc/ssl/private# openssl req -new -days 3650 -key server.key -out server.csr\nIgnoring -days; not generating a certificate\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:ES\nState or Province Name (full name) [Some-State]:Sevilla\nLocality Name (eg, city) []:Dos Hermanas\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:IES Gonzalo Nazareno\nOrganizational Unit Name (eg, section) []:ASIR\nCommon Name (e.g. server FQDN or YOUR name) []:server.adrianj.gonzalonazareno.org\nEmail Address []:adrjaro@gmail.com\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n</code></pre> <p>Genero el crt:</p> <pre><code>openssl x509 -in server.csr -out server.crt -req -signkey server.key -days 3650\n</code></pre> <p>Muestro los ficheros generados:</p> <pre><code>root@server:/etc/ssl/private# ls -la\ntotal 20\ndrwx------ 2 root root 4096 Mar  9 07:51 .\ndrwxr-xr-x 4 root root 4096 Dec 19 20:26 ..\n-rw-r--r-- 1 root root 1424 Mar  9 07:51 server.crt\n-rw-r--r-- 1 root root 1106 Mar  9 07:50 server.csr\n-rw------- 1 root root 1679 Mar  8 00:45 server.key\n</code></pre> <p>Copio los ficheros al directorio correspondiente:</p> <pre><code>cp /etc/ssl/private/server.key /etc/ssl/private/server.crt /etc/ssl/certs/ca-certificates.crt /etc/ldap/sasl2/\n</code></pre> <p>Modifico propietarios:</p> <pre><code>chown openldap:openldap /etc/ldap/sasl2/server.key /etc/ldap/sasl2/server.crt /etc/ldap/sasl2/ca-certificates.crt\n</code></pre>"},{"location":"aso/ldaps/#23-configuracion-certificados","title":"2.3 Configuraci\u00f3n certificados","text":"<pre><code>cd\nnano mod_ssl.ldif\n</code></pre> <pre><code>dn: cn=config\nchangetype: modify\nadd: olcTLSCACertificateFile\nolcTLSCACertificateFile: /etc/ldap/sasl2/ca-certificates.crt\n-\nreplace: olcTLSCertificateFile\nolcTLSCertificateFile: /etc/ldap/sasl2/server.crt\n-\nreplace: olcTLSCertificateKeyFile\nolcTLSCertificateKeyFile: /etc/ldap/sasl2/server.key\n</code></pre> <p>La aplico:</p> <pre><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f mod_ssl.ldif\n</code></pre> <p>Compruebo que se ha aplicado:</p> <pre><code>slapcat -b cn=config\n</code></pre> <p></p> <p>Salgo de root:</p> <pre><code>exit\n</code></pre>"},{"location":"aso/ldaps/#24-configuracion-ldap","title":"2.4 Configuraci\u00f3n LDAP","text":"<p>Dejo la secci\u00f3n de TLS as\u00ed:</p> <pre><code>sudo nano /etc/ldap/ldap.conf\n</code></pre> <pre><code># TLS certificates (needed for GnuTLS)\n#TLS_CACERT /etc/ssl/certs/ca-certificates.crt\nTLS_REQCERT never\n</code></pre> <p>Reemplazo la siguiente l\u00ednea:</p> <pre><code>sudo nano /etc/default/slapd\n</code></pre> <pre><code>SLAPD_SERVICES=\"ldap:/// ldapi:/// ldaps:///\"\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart slapd\n</code></pre>"},{"location":"aso/ldaps/#25-comprobaciones","title":"2.5 Comprobaciones","text":"<p>Puerto de LDAPs abierto:</p> <pre><code>sudo ss -tulpn | grep 636\n</code></pre> <p></p> <p>Pruebo que una consulta mediante <code>ldaps://</code> y sin root funciona:</p> <pre><code>ldapsearch -x -b \"dc=adrianj,dc=gonzalonazareno,dc=org\" -H ldaps://\n</code></pre> <p></p>"},{"location":"aso/ldaps/#3-clientedebian","title":"3. Clientedebian","text":""},{"location":"aso/ldaps/#31-requisitos","title":"3.1 Requisitos","text":"<pre><code>sudo apt install libldap-common\n</code></pre>"},{"location":"aso/ldaps/#32-configuracion","title":"3.2 Configuraci\u00f3n","text":"<p>Dejo <code>/etc/ldap/ldap.conf</code> as\u00ed:</p> <pre><code>sudo nano /etc/ldap/ldap.conf\n</code></pre> <pre><code>#\n# LDAP Defaults\n#\n# See ldap.conf(5) for details\n# This file should be world readable but not world writable.\nBASE    dc=adrianj,dc=gonzalonazareno,dc=org\nURI ldaps://server.adrianj.gonzalonazareno.org:636\n\n#SIZELIMIT  12\n#TIMELIMIT  15\n#DEREF          never\n# TLS certificates (needed for GnuTLS)\n#TLS_CACERT /etc/ssl/certs/ca-certificates.crt\nTLS_REQCERT never\n</code></pre> <p>En <code>/etc/nslcd.conf</code> dejo la URI as\u00ed:</p> <pre><code>sudo nano /etc/nslcd.conf\n</code></pre> <pre><code>uri ldaps://server.adrianj.gonzalonazareno.org/\n</code></pre> <p>Y la secci\u00f3n de SSL as\u00ed:</p> <pre><code># SSL options\n#ssl start_tls\ntls_reqcert never\n#tls_cacertfile /etc/ssl/certs/ca-certificates.crt\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart nslcd\n</code></pre>"},{"location":"aso/ldaps/#33-comprobaciones","title":"3.3 Comprobaciones","text":"<p>Pruebo que una consulta mediante <code>ldaps://</code> y sin root funciona:</p> <pre><code>ldapsearch -x -b \"dc=adrianj,dc=gonzalonazareno,dc=org\" \"objectclass=posixAccount\"\n</code></pre> <p></p> <p>Info</p> <p>Recordemos que no he escrito <code>ldaps://</code> en la consulta porque ya no es necesario. Las consultas se autocompletan con la informaci\u00f3n de <code>/etc/ldap/ldap.conf</code></p>"},{"location":"aso/migracion-centos/","title":"Migraci\u00f3n CentOS","text":""},{"location":"aso/migracion-centos/#ejercicio-1","title":"Ejercicio 1","text":""},{"location":"aso/migracion-centos/#11","title":"1.1","text":"<p>Analizar el desencadenante de la retirada de CentOS 8 del mercado</p> <p>CentOS era un rebuild de RHEL 100% open source, gratuito y de comunidad. Es decir, que por cada release de RHEL se lanzaba una versi\u00f3n de CentOS, que adem\u00e1s sol\u00eda tener en torno a 10 a\u00f1os de soporte. Se convirti\u00f3 en unas de las distribuciones m\u00e1s estables junto con Debian.</p> <p>En 2014 Red Hat compr\u00f3 CentOS pero prometi\u00f3 continuar con el proyecto. Este hecho empez\u00f3 generar sospechas en la comunidad, ya que es muy curioso que una empresa que vende RHEL compre una distribuci\u00f3n que es un rebuild de la misma.</p> <p>Todo se hizo aparente en 2020 cuando Red Hat anunci\u00f3 por el siguiente comunicado que reducir\u00eda el per\u00edodo de soporte de CentOS 8 de 10 a\u00f1os a 2, acabando el 31 de Diciembre de 2021. CentOS 8 llevaba ya 1 a\u00f1o de desarrollo, as\u00ed que s\u00f3lo dejaron otro a\u00f1o para que la gente pensara qu\u00e9 hacer. Esto cre\u00f3 una situaci\u00f3n peculiar donde los que hab\u00edan hecho lo correcto, actualizar a CentOS 8, se vieron obligados a plantear una migraci\u00f3n en muy poco tiempo, y los que segu\u00edan con CentOS 7 mantendr\u00edan su soporte completo hasta el 30 de Junio de 2024.</p> <p>\u00bfQu\u00e9 fue el desencadenante de esta decisi\u00f3n?</p> <p>Como siempre, las decisiones a gran escala como esta no parten de un solo motivo sino de muchos, y de muchas situaciones en conjunto. A\u00fan as\u00ed, podemos explicar qu\u00e9 ha pasado de manera resumida.</p> <p>CentOS siempre ha ofrecido una soluci\u00f3n a nivel empresarial gratuita y de comunidad. Esto permit\u00eda a las empresas que no ten\u00edan presupuesto para pagar por RHEL, o que no quer\u00edan pagar por RHEL, tener una alternativa de calidad y con soporte. Pod\u00edan haber muchos motivos por los que las empresas y desarrolladores no quisieran pagar por RHEL, como por ejemplo ser suficientemente competentes para no necesitar soporte, o simplemente ahorrar dinero.</p> <p>Tener a CentOS de esta manera para Red Hat no era de mucha utilidad, ya que objetivamente les hac\u00eda perder dinero. Al haber comprado CentOS en su momento, ahora mantenerlo claramente les generaba un gasto, gasto que adem\u00e1s no pod\u00edan recuperar ya que CentOS es totalmente gratuito. Otro dato es que obviamente esto generaba una fragmentaci\u00f3n de la comunidad, que adem\u00e1s no ten\u00eda ning\u00fan incentivo para migrar a RHEL, lo cual es el principal objetivo para Red Hat. Tambi\u00e9n se mencion\u00f3 en una entrevista que entre las comunidades de Red Hat y Fedora por ejemplo, hab\u00eda un involucramiento muy bidireccional, pero que desafortunadamente con CentOS no era as\u00ed.</p> <p>Para terminar y dar m\u00e1s perspectiva al asunto, hay que explicar que Red Hat tiene objetivos importantes a corto y largo plazo detr\u00e1s de esta decisi\u00f3n. Seg\u00fan se dijo en una entrevista, CentOS Stream ser\u00e1 el sucesor de CentOS Linux pero no un reemplazo, ya que la filosof\u00eda cambia completamente. El enfoque de CentOS Stream ser\u00e1 la innovaci\u00f3n en el linux empresarial, es decir, no ser\u00e1 una distribuci\u00f3n estable como lo llevaba siendo desde hace a\u00f1os, sino que ser\u00e1 una distribuci\u00f3n de r\u00e1pidas actualizaciones para empresas centradas en cloud y contenedores.</p> <p>Como hemos podido ver, no hay buenos ni malos en esta historia, puesto que Red Hat tiene sus motivos para hacer lo que ha hecho, y la comunidad de CentOS tambi\u00e9n tienen sus motivos para haber reaccionado de manera negativa.</p>"},{"location":"aso/migracion-centos/#12","title":"1.2","text":"<p>Decir tu opini\u00f3n</p> <p>Mi opini\u00f3n es bastante neutra, ya que puedo entender ambos puntos de vista.</p> <p>Red Hat ten\u00eda que mantener algo que no les devolv\u00eda beneficios, y encima no les era de utilidad. Ahora por lo menos le dar\u00e1n una nueva utilidad a CentOS que les servir\u00e1 para tener ideas que implementar en futuras versiones de RHEL, su produto principal. Es decir, CentOS Stream ahora nutrir\u00e1 directamente a RHEL, cosa que antes no pasaba, RHEL nutr\u00eda a CentOS. Adem\u00e1s ha sido una gran t\u00e1ctica comercial para obligar a las empresas a pasarse a RHEL.</p> <p>Por otro lado, la comunidad de CentOS ten\u00eda una buena distribuci\u00f3n que se les ha quitado de manera brusca, adem\u00e1s de haber sido un movimiento bastante sucio por parte de Red Hat. Ellos promet\u00edan en torno a 10 a\u00f1os de soporte para CentOS 8 como ven\u00eda siendo de costumbre en las releases de CentOS, pero lo redujeron a 2 a\u00f1os con solo 1 a\u00f1o de margen para que la gente se planteara la migraci\u00f3n. Hay que tener en cuenta que este problema ha sido m\u00e1s grande de lo que en principio parece, ya que CentOS era muy usado por grandes empresas como Amazon y Facebook. Al transformarlo en un proyecto de upstream, de desarrollo, han eliminado la principal raz\u00f3n por la que la gente usaba CentOS, y es la gran estabilidad que aportaba.</p> <p>La buena noticia es que estamos en el mundo del software libre, y algo no muere si la comunidad no quiere. Se han acabado haciendo forks del proyecto, como era de esperar, y se han creado nuevas distribuciones que mantienen la filosof\u00eda de CentOS, como Rocky Linux y AlmaLinux.</p>"},{"location":"aso/migracion-centos/#ejercicio-2","title":"Ejercicio 2","text":""},{"location":"aso/migracion-centos/#21","title":"2.1","text":"<p>Crear una cuenta en Red Hat y descargar la iso de RHEL</p> <p>https://developers.redhat.com/products/rhel/download</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p>"},{"location":"aso/migracion-centos/#22","title":"2.2","text":"<p>Evaluar el producto</p> <p>Para evaluarlo, vamos a instalarlo desde la imagen descargada.</p> <p>As\u00ed queda el resumen de caracter\u00edsticas que le voy a dar a la VM:</p> <p></p> <p>Despu\u00e9s de esto, empezamos la instalaci\u00f3n real:</p> <p></p> <p></p> <p>En el siguiente men\u00fa, los apartados marcados en rojo son los que he tenido que configurar/cambiar (ambas contrase\u00f1as son 1234 para root y para el usuario):</p> <p></p> <p></p> <p>Ya lo tenemos instalado, y muestro algunas pruebas:</p> <p></p> <p>Dejo por aqu\u00ed un buen art\u00edculo que compara RHEL con Debian. Est\u00e1 un poco desactualizado con respecto a las versiones pero por lo dem\u00e1s lo he encontrado interesante.</p>"},{"location":"aso/migracion-centos/#ejercicio-3","title":"Ejercicio 3","text":""},{"location":"aso/migracion-centos/#31","title":"3.1","text":"<p>Descargar la iso de CentOS Stream</p> <p></p>"},{"location":"aso/migracion-centos/#32","title":"3.2","text":"<p>Evaluar el producto</p> <p>Para evaluarlo, vamos a instalarlo desde la imagen descargada.</p> <p>As\u00ed queda el resumen de caracter\u00edsticas que le voy a dar a la VM:</p> <p></p> <p>Despu\u00e9s de esto, empezamos la instalaci\u00f3n real:</p> <p></p> <p></p> <p>En el siguiente men\u00fa, los apartados marcados en rojo son los que he tenido que configurar/cambiar (ambas contrase\u00f1as son 1234 para root y para el usuario):</p> <p></p> <p></p> <p>Ya lo tenemos instalado, y muestro algunas pruebas:</p> <p></p> <p>Como hemos podido ver, desde la adquisici\u00f3n de Centos por parte de Red Hat, lo han dejado muy copia de RHEL, incluso el fichero para comprobar la versi\u00f3n es el mismo.</p> <p>Red Hat en este enlace explica muy bien las ventajas de CentOS Stream.</p>"},{"location":"aso/migracion-centos/#ejercicio-4","title":"Ejercicio 4","text":""},{"location":"aso/migracion-centos/#41","title":"4.1","text":"<p>Las otras distribuciones alternativas son las siguientes:</p> <ul> <li>AlmaLinux</li> <li>Rocky Linux</li> <li>VzLinux</li> <li>EuroLinux</li> </ul> <p>Elegir una, indicar criterios para la elecci\u00f3n, y descargar la iso</p> <p>Elijo Rocky Linux ya que en mi opini\u00f3n es la evoluci\u00f3n l\u00f3gica despu\u00e9s del problema que ha habido con CentOS.</p> <p>Gregory Kurtzer, el fundador de CentOS, cre\u00f3 el proyecto \"Rocky Linux\" para continuar con los ideales originales de CentOS.</p> <p>Descargo la iso:</p> <p></p>"},{"location":"aso/migracion-centos/#42","title":"4.2","text":"<p>Evaluar el producto</p> <p>Para evaluarlo, vamos a instalarlo desde la imagen descargada.</p> <p>As\u00ed queda el resumen de caracter\u00edsticas que le voy a dar a la VM:</p> <p></p> <p>Como Rocky es un proyecto relativamente nuevo, he tenido que seleccionar RHEL 9 en virt manager ya que es lo que m\u00e1s se le asemeja, puesto que Rocky a\u00fan no aparece en la lista de SSOO.</p> <p>Despu\u00e9s de esto, empezamos la instalaci\u00f3n real:</p> <p></p> <p></p> <p>En el siguiente men\u00fa, los apartados marcados en rojo son los que he tenido que configurar/cambiar (ambas contrase\u00f1as son 1234 para root y para el usuario):</p> <p></p> <p></p> <p>Ya lo tenemos instalado, y muestro algunas pruebas:</p> <p></p> <p>Como hemos podido ver, ya que Rocky parte de RHEL, pasa un poco como con CentOS. Es una copia del RHEL actual pero siguiendo la filosof\u00eda de CentOS original.</p> <p>Rocky Linux 9 tendr\u00e1 soporte hasta 2032, manteniendo la promesa de 10 a\u00f1os de soporte que se ven\u00eda teniendo tradicionalmente.</p> <p>En este art\u00edculo describen muy bien Rocky Linux.</p> <p>A destacar positivamente, se usa LVM y XFS por defecto:</p> <p></p> <p>La \u00fanica desventaja que le veo a Rocky Linux es que por razones obvias, aunque parta de RHEL, las caracter\u00edsticas propietarias y de pago no estar\u00e1n disponibles.  </p> <p>Por ejemplo, el \"live kernel patching\" y \"Red Hat Sattelite\" no estar\u00e1n disponibles.</p>"},{"location":"aso/migracion-centos/#ejercicio-5","title":"Ejercicio 5","text":""},{"location":"aso/migracion-centos/#51","title":"5.1","text":"<p>Explicar el dilema que nos encontramos a la hora de la migraci\u00f3n</p> <p>Esta pr\u00e1ctica en su d\u00eda Alberto la plante\u00f3 justo cuando el problema de CentOS estaba candente, por lo que significa que por aquel a\u00f1o las isos de Centos 8 originales segu\u00edan existiendo y lo que es m\u00e1s importante, sus repositorios.</p> <p>A d\u00eda de hoy, si queremos simular la migraci\u00f3n, nos encontramos 2 problemas principales:</p> <ul> <li>Todos los mirrors con im\u00e1genes de CentOS 8 originales han sido tirados, por lo tanto no podemos simular una migraci\u00f3n desde el CentOS 8 original ya que no existe a d\u00eda de hoy.</li> <li>Si intentamos una migraci\u00f3n bajando una versi\u00f3n, desde el CentOS Linux 7 que s\u00ed sigue existiendo, nos encontramos otro problema. Parte de la migraci\u00f3n a Rocky Linux requiere que upgradeemos a CentOS 8, pero los repositorios ya no existen y algunos que existen dan problemas, as\u00ed que las maneras que a\u00fan hay por Internet documentadas ya no sirven.</li> </ul> <p>Este es el dilema con el que nos encontramos actualmente.</p> <p>Evidentemente, desde CentOS Linux 7 s\u00ed podr\u00edamos upgradear por ejemplo a CentOS Stream 8 (que es en lo que se ha convertido el antiguo CentOS 8), y desde ah\u00ed se podr\u00eda upgradear a Rocky Linux.</p> <p>La soluci\u00f3n m\u00e1s inteligente dentro del dilema que se nos plantea actualmente para la simulaci\u00f3n de esta migraci\u00f3n en mi opini\u00f3n, es instalarnos CentOS Stream 8 y de ah\u00ed hacer una migraci\u00f3n a Rocky Linux.</p> <p>As\u00ed es como evitar\u00edamos chocarnos con problemas de isos o repositorios que ya ni siquiera existen. Y si quedan remanentes poco tiempo de vida les queda.</p>"},{"location":"aso/migracion-centos/#52","title":"5.2","text":"<p>Descargar la iso de CentOS Stream 8</p> <p></p>"},{"location":"aso/migracion-centos/#53","title":"5.3","text":"<p>Evaluar el producto</p> <p>Para evaluarlo, vamos a instalarlo desde la imagen descargada.</p> <p>As\u00ed queda el resumen de caracter\u00edsticas que le voy a dar a la VM:</p> <p></p> <p>Despu\u00e9s de esto, empezamos la instalaci\u00f3n real:</p> <p></p> <p></p> <p>En el siguiente men\u00fa, los apartados marcados en rojo son los que he tenido que configurar/cambiar (ambas contrase\u00f1as son 1234 para root y para el usuario):</p> <p></p> <p></p> <p>Tenemos que aceptar la licencia:</p> <p></p> <p>Ya lo tenemos instalado, y muestro algunas pruebas:</p> <p></p>"},{"location":"aso/migracion-centos/#54","title":"5.4","text":"<p>Realizar la migraci\u00f3n a Rocky Linux</p> <p>https://docs.rockylinux.org/guides/migrate2rocky/ https://www.cyberciti.biz/howto/migrate-from-centos-8-to-rocky-linux-conversion/</p>"},{"location":"aso/migracion-centos/#actualizacion-de-paquetes","title":"Actualizaci\u00f3n de paquetes","text":"<pre><code>sudo dnf update\nsudo reboot\n</code></pre>"},{"location":"aso/migracion-centos/#descarga-de-script","title":"Descarga de script","text":"<pre><code>curl https://raw.githubusercontent.com/rocky-linux/rocky-tools/main/migrate2rocky/migrate2rocky.sh -o migrate2rocky.sh\n</code></pre>"},{"location":"aso/migracion-centos/#permisos","title":"Permisos","text":"<pre><code>chmod u+x migrate2rocky.sh\n</code></pre>"},{"location":"aso/migracion-centos/#ejecucion","title":"Ejecuci\u00f3n","text":"<pre><code>sudo ./migrate2rocky.sh -r\n</code></pre> <p>As\u00ed se ve el inicio del script:</p> <p></p> <p>Adem\u00e1s, nos fijamos que por ahora el icono de arriba a la izquierda es el de CentOS.</p> <p>Al terminar si ha funcionado correctamente, veremos esto:</p> <p></p> <p>Adem\u00e1s, nos fijamos que ahora el icono de arriba pasa a ser el de Rocky Linux.</p> <p>Reinicio:</p> <pre><code>sudo systemctl reboot\n</code></pre>"},{"location":"aso/migracion-centos/#comprobaciones","title":"Comprobaciones","text":""},{"location":"aso/recoleccion-logs-journald/","title":"Recolecci\u00f3n de logs centralizada mediante journald","text":""},{"location":"aso/recoleccion-logs-journald/#1-enunciado","title":"1. Enunciado","text":"<p>Implementar un sistema de recolecci\u00f3n de logs remoto mediante <code>systemd-journal-remote</code>.</p>"},{"location":"aso/recoleccion-logs-journald/#2-escenario","title":"2. Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\nconfig.vm.provider :libvirt do |libvirt|\nlibvirt.cpus = 2\nlibvirt.memory = 1024\nend\nconfig.vm.define :server do |server|\nserver.vm.box = \"debian/bullseye64\"\nserver.vm.hostname = \"server.adrianj.gonzalonazareno.org\"\nserver.vm.network :private_network,\n:libvirt__network_name =&gt; \"recoleccion-logs\",\n:libvirt__dhcp_enabled =&gt; false,\n:ip =&gt; \"10.0.0.2\",\n:libvirt__netmask =&gt; '255.255.255.0',\n:libvirt__forward_mode =&gt; \"veryisolated\"\nend\nconfig.vm.define :client do |client|\nclient.vm.box = \"debian/bullseye64\"\nclient.vm.hostname = \"client.adrianj.gonzalonazareno.org\"\nclient.vm.network :private_network,\n:libvirt__network_name =&gt; \"recoleccion-logs\",\n:libvirt__dhcp_enabled =&gt; false,\n:ip =&gt; \"10.0.0.3\",\n:libvirt__netmask =&gt; '255.255.255.0',\n:libvirt__forward_mode =&gt; \"veryisolated\"\nend\nend\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#3-server","title":"3. Server","text":""},{"location":"aso/recoleccion-logs-journald/#31-paqueteria","title":"3.1 Paqueter\u00eda","text":"<pre><code>sudo apt update\nsudo apt install systemd-journal-remote\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#32-unidades-systemd","title":"3.2 Unidades systemd","text":"<pre><code>sudo systemctl enable --now systemd-journal-remote.socket\nsudo systemctl enable systemd-journal-remote.service\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#33-configuracion-unidad","title":"3.3 Configuraci\u00f3n unidad","text":"<pre><code>sudo systemctl edit systemd-journal-remote.service\n</code></pre> <pre><code>[Service]\nExecStart=\nExecStart=/usr/lib/systemd/systemd-journal-remote --listen-http=-3 --output=/var/log/journal/remote/\n</code></pre> <pre><code>sudo systemctl daemon-reload\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#34-configuracion-servicio","title":"3.4 Configuraci\u00f3n servicio","text":"<pre><code>sudo nano /etc/systemd/journal-remote.conf\n</code></pre> <pre><code>#  This file is part of systemd.\n#\n#  systemd is free software; you can redistribute it and/or modify it\n#  under the terms of the GNU Lesser General Public License as published by\n#  the Free Software Foundation; either version 2.1 of the License, or\n#  (at your option) any later version.\n#\n# Entries in this file show the compile time defaults.\n# You can change settings by editing this file.\n# Defaults can be restored by simply deleting this file.\n#\n# See journal-remote.conf(5) for details\n[Remote]\nSeal=false\nSplitMode=host\n# ServerKeyFile=/etc/ssl/private/journal-remote.pem\n# ServerCertificateFile=/etc/ssl/certs/journal-remote.pem\n# TrustedCertificateFile=/etc/ssl/ca/trusted.pem\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#35-activacion","title":"3.5 Activaci\u00f3n","text":"<pre><code>sudo systemctl start systemd-journal-remote.service\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#36-comprobaciones","title":"3.6 Comprobaciones","text":"<p>Servicio funcionando:</p> <p></p> <p>Vemos que se ha abierto el puerto necesario:</p> <p></p>"},{"location":"aso/recoleccion-logs-journald/#4-client","title":"4. Client","text":""},{"location":"aso/recoleccion-logs-journald/#41-paqueteria","title":"4.1 Paqueter\u00eda","text":"<pre><code>sudo apt update\nsudo apt install systemd-journal-remote\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#42-unidad-systemd","title":"4.2 Unidad systemd","text":"<pre><code>sudo systemctl enable systemd-journal-upload.service\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#43-configuracion-servicio","title":"4.3 Configuraci\u00f3n servicio","text":"<pre><code>sudo nano /etc/systemd/journal-upload.conf\n</code></pre> <pre><code>#  This file is part of systemd.\n#\n#  systemd is free software; you can redistribute it and/or modify it\n#  under the terms of the GNU Lesser General Public License as published by\n#  the Free Software Foundation; either version 2.1 of the License, or\n#  (at your option) any later version.\n#\n# Entries in this file show the compile time defaults.\n# You can change settings by editing this file.\n# Defaults can be restored by simply deleting this file.\n#\n# See journal-upload.conf(5) for details\n[Upload]\nURL=http://10.0.0.2:19532\n# ServerKeyFile=/etc/ssl/private/journal-upload.pem\n# ServerCertificateFile=/etc/ssl/certs/journal-upload.pem\n# TrustedCertificateFile=/etc/ssl/ca/trusted.pem\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#44-activacion","title":"4.4 Activaci\u00f3n","text":"<pre><code>sudo systemctl restart systemd-journal-upload\n</code></pre>"},{"location":"aso/recoleccion-logs-journald/#5-comprobaciones-finales","title":"5. Comprobaciones finales","text":"<p>En el servidor podemos comprobar que se ha creado un fichero en <code>/var/log/journal/remote</code> para el cliente:</p> <pre><code>vagrant@server:~$ ls -la /var/log/journal/remote\ntotal 8200\ndrwxr-xr-x  2 systemd-journal-remote systemd-journal-remote    4096 Mar  7 04:13 .\ndrwxr-sr-x+ 4 root                   systemd-journal           4096 Mar  7 04:06 ..\n-rw-r-----  1 systemd-journal-remote systemd-journal-remote 8388608 Mar  7 04:13 remote-10.0.0.3.journal\n</code></pre> <p>Esto funciona as\u00ed por el modo <code>SplitMode=host</code>, y as\u00ed separamos los ficheros de log por cliente.</p> <p>Desde el cliente, para hacer pruebas de funcionamiento, podr\u00edamos mandar mensajes manualmente al log:</p> <pre><code>logger -p syslog.debug \"### MENSAJE TEST DE ADRIAN ###\"\n</code></pre> <p>Volviendo al servidor, podr\u00edamos leer el log del cliente y saltar al final para ver la prueba as\u00ed:</p> <pre><code>sudo journalctl -e --file=/var/log/journal/remote/remote-10.0.0.3.journal\n</code></pre> <p></p>"},{"location":"aso/systemd-montaje-nfs/","title":"Montaje NFS mediante systemd","text":""},{"location":"aso/systemd-montaje-nfs/#1-enunciado","title":"1. Enunciado","text":"<p>En un servidor Debian 11 del cloud conectar un volumen de 2GB. Luego:</p> <ul> <li>Hacer un montaje con una unidad de systemd del volumen</li> <li>Compartir el directorio con un servidor nfs</li> </ul> <p>En un cliente Debian 11 del cloud:</p> <ul> <li>Con un cliente nfs y una unidad de systemd montar el directorio compartido</li> </ul>"},{"location":"aso/systemd-montaje-nfs/#2-pasos-previos","title":"2. Pasos previos","text":"<p>Muestro que tengo el volumen correctamente enlazado:</p> <p></p> <p>Lo formateo:</p> <pre><code>sudo mkfs -t ext4 /dev/vdb\n</code></pre>"},{"location":"aso/systemd-montaje-nfs/#3-en-el-servidor","title":"3. En el servidor","text":""},{"location":"aso/systemd-montaje-nfs/#31-unidad-de-montaje","title":"3.1 Unidad de montaje","text":"<p>Creo la unidad de montaje:</p> <pre><code>sudo nano /etc/systemd/system/mnt.mount\n</code></pre> <pre><code>[Unit]\nDescription=vdb 2G volume\n\n[Mount]\nWhat=/dev/vdb\nWhere=/mnt\nType=ext4\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>La inicio y la habilito en el arranque:</p> <pre><code>sudo systemctl start mnt.mount\nsudo systemctl enable mnt.mount\n</code></pre>"},{"location":"aso/systemd-montaje-nfs/#32-nfs-server","title":"3.2 NFS server","text":"<p>Instalo el paquete:</p> <pre><code>sudo apt update\nsudo apt install nfs-kernel-server\n</code></pre> <p>Defino el directorio compartido en el siguiente fichero:</p> <pre><code>sudo nano /etc/exports\n</code></pre> <pre><code>/mnt 10.0.0.0/24(rw,sync,no_subtree_check,no_root_squash)\n</code></pre> <p>Reinicio nfs y actualizo la lista de directorios compartidos:</p> <pre><code>sudo systemctl restart nfs-kernel-server\nsudo exportfs\n</code></pre>"},{"location":"aso/systemd-montaje-nfs/#33-pruebas","title":"3.3 Pruebas","text":"<p>Unidad funcionando:</p> <pre><code>debian@systemd-nfs:~$ sudo systemctl status mnt.mount\n\u25cf mnt.mount - vdb 2G volume\n     Loaded: loaded (/proc/self/mountinfo; enabled; vendor preset: enabled)\nActive: active (mounted) since Fri 2023-02-03 16:18:11 UTC; 45min ago\n      Where: /mnt\n       What: /dev/vdb\n      Tasks: 0 (limit: 527)\nMemory: 28.0K\n        CPU: 5ms\n     CGroup: /system.slice/mnt.mount\n\nFeb 03 16:18:11 systemd-nfs systemd[1]: Mounting vdb 2G volume...\nFeb 03 16:18:11 systemd-nfs systemd[1]: Mounted vdb 2G volume.\n</code></pre> <p>Volumen montado:</p> <p></p>"},{"location":"aso/systemd-montaje-nfs/#4-en-el-cliente","title":"4. En el cliente","text":""},{"location":"aso/systemd-montaje-nfs/#41-nfs-client","title":"4.1 NFS client","text":"<pre><code>sudo apt update\nsudo apt install nfs-common\n</code></pre>"},{"location":"aso/systemd-montaje-nfs/#42-unidad-de-montaje","title":"4.2 Unidad de montaje","text":"<p>Creo la unidad de montaje:</p> <pre><code>sudo nano /etc/systemd/system/mnt.mount\n</code></pre> <pre><code>[Unit]\nDescription=NFS mount\nAfter=network-online.target\nWants=network-online.target\n\n[Mount]\nWhat=10.0.0.186:/mnt\nWhere=/mnt\nOptions=auto\nType=nfs\nTimeoutSec=60\n[Install]\nWantedBy=remote-fs.target\n</code></pre> <p>La inicio y la habilito en el arranque:</p> <pre><code>sudo systemctl start mnt.mount\nsudo systemctl enable mnt.mount\n</code></pre>"},{"location":"aso/systemd-montaje-nfs/#43-pruebas","title":"4.3 Pruebas","text":"<p>Unidad funcionando:</p> <pre><code>debian@systemd-nfs-client:~$ sudo systemctl status mnt.mount\n\u25cf mnt.mount - NFS mount\n     Loaded: loaded (/proc/self/mountinfo; enabled; vendor preset: enabled)\nActive: active (mounted) since Fri 2023-02-03 16:59:38 UTC; 12min ago\n      Where: /mnt\n       What: 10.0.0.186:/mnt\n      Tasks: 0 (limit: 527)\nMemory: 76.0K\n        CPU: 6ms\n     CGroup: /system.slice/mnt.mount\n\nFeb 03 16:59:37 systemd-nfs-client systemd[1]: Mounting NFS mount...\nFeb 03 16:59:38 systemd-nfs-client systemd[1]: Mounted NFS mount.\n</code></pre> <p>Directorio remoto montado:</p> <p></p> <p>Contenido:</p> <pre><code>debian@systemd-nfs-client:~$ ls -la /mnt/\ntotal 24\ndrwxr-xr-x  3 root root  4096 Feb  3 16:17 .\ndrwxr-xr-x 18 root root  4096 Feb  3 16:43 ..\ndrwx------  2 root root 16384 Feb  3 14:33 lost+found\n-rw-r--r--  1 root root     0 Feb  3 16:17 test\n</code></pre>"},{"location":"aso/teoria-kernel/","title":"Teor\u00eda","text":""},{"location":"aso/teoria-kernel/#configuracion-y-compilacion-del-nucleo-linux-1","title":"Configuraci\u00f3n y compilaci\u00f3n del n\u00facleo linux 1","text":"<pre><code>sudo apt update\nsudo apt search linux-source\n</code></pre> <p>En <code>bullseye-backports</code> tenemos la versi\u00f3n 6.0, a\u00f1adir los repos:</p> <pre><code>deb https://deb.debian.org/debian bullseye-backports main\ndeb-src https://deb.debian.org/debian bullseye-backports main\n</code></pre> <p>Kernel actual:</p> <pre><code>uname -r\n</code></pre> <p>Lista de c\u00f3digo fuente disponible para instalar:</p> <pre><code>sudo apt policy linux-source\n</code></pre> <p>Instalo los paquetes necesarios:</p> <pre><code>sudo apt install linux-source=6.0.3-1~bpo11+1 build-essential qtbase5-dev\n</code></pre> <p>Compruebo las fuentes instaladas:</p> <pre><code>dpkg -l | grep linux-source\n</code></pre> <p>Contenidos del paquete:</p> <pre><code>dpkg -L linux-source-6.0\n</code></pre> <p>Las fuentes se descargan en <code>/usr/src</code>:</p> <pre><code>vagrant@kernel:~$ ls -la /usr/src\ntotal 131004\ndrwxr-xr-x  3 root root      4096 Nov  7 22:56 .\ndrwxr-xr-x 14 root root      4096 Sep 12 05:16 ..\ndrwxr-xr-x  2 root root      4096 Nov  7 22:56 linux-config-6.0\n-rw-r--r--  1 root root     55312 Oct 29 15:59 linux-patch-6.0-rt.patch.xz\n-rw-r--r--  1 root root 134077800 Oct 29 15:59 linux-source-6.0.tar.xz\n</code></pre> <p>Descomprimo las fuentes en un directorio del home del usuario:</p> <pre><code>vagrant@kernel:~$ mkdir kernel\nvagrant@kernel:~$ cd kernel\nvagrant@kernel:~/kernel$ tar xf /usr/src/linux-source-6.0.tar.xz\nvagrant@kernel:~/kernel$ ls -la\ntotal 12\ndrwxr-xr-x  3 vagrant vagrant 4096 Nov  7 23:55 .\ndrwxr-xr-x  5 vagrant vagrant 4096 Nov  7 23:55 ..\ndrwxr-xr-x 25 vagrant vagrant 4096 Oct 29 15:59 linux-source-6.0\n</code></pre> <p>Borrar datos de una compilaci\u00f3n anterior:</p> <pre><code>make clean\n</code></pre> <p>Limpieza profunda:</p> <pre><code>make mrproper\n</code></pre> <p>Fichero config para la compilaci\u00f3n del que se parte:</p> <pre><code>/boot/config-5.10.0-18-amd64\n</code></pre> <p>=y est\u00e1tico</p> <p>=m din\u00e1mico</p> <p>not set</p> <p>Me copio ese fichero config como punto de partida a mi directorio de compilaci\u00f3n:</p> <pre><code>cp /boot/config-5.10.0-18-amd64 ~/kernel/linux-source-6.0/.config\n</code></pre> <p>Dejo el config en un estado similar a como est\u00e1 la m\u00e1quina actualmente:</p> <pre><code>make oldconfig\n</code></pre> <p>Esta opci\u00f3n seguramente no se usa y adem\u00e1s creo recordar que dejaba los m\u00f3dulos no cargados tambi\u00e9n. La mejor opci\u00f3n es:</p> <pre><code>make localmodconfig\n</code></pre> <p>Compilar generando un paquete deb con s\u00f3lo el binario:</p> <pre><code>make -j5 bindeb-pkg\n</code></pre> <p>Si no se especifica el n\u00famero con -j coge todos los recursos que puede, y puede ser problem\u00e1tico llevando a errores, siempre especificar cu\u00e1ntos cores.</p> <p>Al terminar la compilaci\u00f3n tenemos los siguientes mensajes de informaci\u00f3n:</p> <pre><code>dpkg-deb: building package 'linux-libc-dev' in '../linux-libc-dev_6.0.3-1_amd64.deb'.\ndpkg-deb: building package 'linux-image-6.0.3' in '../linux-image-6.0.3_6.0.3-1_amd64.deb'.\n dpkg-genbuildinfo --build=binary\n dpkg-genchanges --build=binary &gt;../linux-upstream_6.0.3-1_amd64.changes\ndpkg-genchanges: info: binary-only upload (no source code included)\ndpkg-source --after-build .\ndpkg-buildpackage: info: binary-only upload (no source included)\n</code></pre> <p>Nos est\u00e1n indicando que los paquetes deb que necesitemos se encuentran en el directorio padre:</p> <pre><code>vagrant@kernel:~/kernel$ ls -la\ntotal 18276\ndrwxr-xr-x  3 vagrant vagrant    4096 Nov  8 01:08 .\ndrwxr-xr-x  5 vagrant vagrant    4096 Nov  7 23:55 ..\n-rw-r--r--  1 vagrant vagrant 8486908 Nov  8 01:07 linux-headers-6.0.3_6.0.3-1_amd64.deb\n-rw-r--r--  1 vagrant vagrant 8930780 Nov  8 01:08 linux-image-6.0.3_6.0.3-1_amd64.deb\n-rw-r--r--  1 vagrant vagrant 1266908 Nov  8 01:08 linux-libc-dev_6.0.3-1_amd64.deb\ndrwxr-xr-x 29 vagrant vagrant    4096 Nov  8 01:07 linux-source-6.0\n-rw-r--r--  1 vagrant vagrant    5115 Nov  8 01:08 linux-upstream_6.0.3-1_amd64.buildinfo\n-rw-r--r--  1 vagrant vagrant    1761 Nov  8 01:08 linux-upstream_6.0.3-1_amd64.changes\n</code></pre>"},{"location":"aso/teoria-kernel/#configuracion-y-compilacion-del-nucleo-linux-2","title":"Configuraci\u00f3n y compilaci\u00f3n del n\u00facleo linux 2","text":"<p>Conteo de m\u00f3dulos:</p> <pre><code>cat .config | grep \"=y\" | wc -l\n\ncat .config | grep \"=m\" | wc -l\n</code></pre>"},{"location":"aso/teoria-kernel/#21122-modulos","title":"2/11/22 M\u00f3dulos","text":"<p>Enlazado din\u00e1mico</p> <p>/lib/modules/$(uname -r)/kernel</p> <p>/usr/lib/modules</p> <p>lsmod en la salida hay 0 o 3 o 4, quiere decir los m\u00f3dulos que dependen de tal m\u00f3dulo, son dependencias</p> <p>modprobe -r (quitar)</p> <p>modprobe nombre</p> <p>modinfo</p> <p>vmlinuz es el enlazado est\u00e1tico</p> <p>dkms</p>"},{"location":"aso/teoria-kernel/#misc","title":"Misc","text":"<p>http://kernel.org</p> <p>EOL (end of life no hay m\u00e1s soporte)</p> <p>apt policy linux-image-amd64</p> <p>vmlinuz son los kernel</p> <p>/boot est\u00e1n los kernel (fichero config y vmlinuz</p> <p>efitbootmgr (c\u00f3mo est\u00e1 el arranque en la bios\u200c</p> <p>Podemos compilar en una m\u00e1quina virtual para hacer pruebas, lo de verdad en la real</p> <p>\u200c</p> <p>sudo apt install linux-image-amd64</p> <p>\u200c</p> <p>Para seleccionar el kernel se hace en el grub</p> <p>\u200c</p> <p>uname -r para comprobar el kernel que tenemos</p> <p>\u200c</p> <p>sudo apt purge linux-image-amd64 (desinstalaci\u00f3n limpia)</p> <p>\u200c</p> <p>sudo rm -r /boot/vmlinuz-5.19.0.2-amd64 initrd y el config</p> <p>sudo update-grub (actualizar las entradas)\u200c</p>"},{"location":"bd/examen-practicas-1-2/","title":"Examen pr\u00e1cticas 1 y 2","text":""},{"location":"bd/examen-practicas-1-2/#parte-1-app-web-sobre-mongodb","title":"Parte 1: App Web sobre MongoDB","text":""},{"location":"bd/examen-practicas-1-2/#1a","title":"1A","text":"<p>Crear una bd llamada <code>GN</code></p> <p></p> <p>Crear el usuario <code>raul</code> con permisos sobre GN</p> <p></p>"},{"location":"bd/examen-practicas-1-2/#1b","title":"1B","text":"<p>Arrancar <code>MongoDB-PHP-GUI</code></p> <pre><code>sudo docker run --add-host localhost:0.0.0.0 --publish 5000:5000 --rm samueltallet/mongodb-php-gui\n</code></pre> <p>Login</p> <p></p> <p>Crear colecci\u00f3n <code>profesores</code></p> <p></p> <p>Insertar los documentos</p> <p></p>"},{"location":"bd/examen-practicas-1-2/#1c","title":"1C","text":"<p>Modificar la app web para loguear con el usuario <code>raul</code>, y ver los datos de la colecci\u00f3n <code>profesores</code></p> <p></p> <p></p> <p>Info</p> <p>Durante el examen se ha creado la rama <code>examen</code>, que es donde se alojan estos cambios. La app original sigue estando intacta en <code>main</code></p> <p>Warning</p> <p>La app internamente se sigue logueando con admin, los usuarios que escribimos no \"pertenecen a la base de datos\". Son usuarios ficticios digamos. Ser\u00eda interesante cambiar esto en un futuro</p>"},{"location":"bd/examen-practicas-1-2/#parte-2-interconexiones","title":"Parte 2: Interconexiones","text":""},{"location":"bd/examen-practicas-1-2/#2a","title":"2A","text":""},{"location":"bd/examen-practicas-1-2/#en-servidororacle1","title":"En <code>servidororacle1</code>","text":"<p>Conectar como <code>sys</code></p> <pre><code>sqlplus / as sysdba\n</code></pre> <p>Crear el usuario <code>raul</code> con privilegios</p> <pre><code>SQL&gt;\ncreate user raul identified by 1234;\nUser created.\ngrant all privileges to raul;\nGrant succeeded.\n</code></pre> <p>Cambiar a este usuario</p> <pre><code>connect raul/1234\n</code></pre> <p>Crear la tabla <code>profesores</code></p> <pre><code>CREATE TABLE profesores (\nDNI NUMBER(10) NOT NULL,\nNombre VARCHAR2(50) NOT NULL,\nCONSTRAINT profesores_pk PRIMARY KEY (DNI)\n);\nTable created.\n</code></pre> <p>Insertar registros</p> <pre><code>INSERT INTO profesores VALUES (28888888, 'Raul Ruiz Padilla');\n1 row created.\nINSERT INTO profesores VALUES (27777777, 'Rafael Luengo Sanz');\n1 row created.\n</code></pre> <p>Comprobar que se han insertado</p> <pre><code>SELECT * FROM profesores;\nDNI NOMBRE\n---------- --------------------------------------------------\n28888888 Raul Ruiz Padilla\n27777777 Rafael Luengo Sanz\n</code></pre> <p>Mostrar el <code>SERVICE_NAME</code> actual</p> <pre><code>show parameters service_name\nNAME                                     TYPE    VALUE\n------------------------------------ ----------- ------------------------------\nservice_names                            string  ORCLCDB\n</code></pre> <p>Cambiarlo a <code>GN</code></p> <pre><code>alter system set service_names = 'GN' scope = spfile;\nSystem altered.\n</code></pre> <p>Reiniciar la bd</p> <pre><code>SHUTDOWN IMMEDIATE\nDatabase closed.\nDatabase dismounted.\nORACLE instance shut down.\nSTARTUP\nORACLE instance started.\nTotal System Global Area 1258287544 bytes\nFixed Size              9134520 bytes\nVariable Size             788529152 bytes\nDatabase Buffers      452984832 bytes\nRedo Buffers                7639040 bytes\nDatabase mounted.\nDatabase opened.\n</code></pre> <p>Comprobar que el <code>SERVICE_NAME</code> ha cambiado</p> <pre><code>show parameters service_name\nNAME                                     TYPE    VALUE\n------------------------------------ ----------- ------------------------------\nservice_names                            string  GN\n</code></pre> <p>Modificar el fragmento correspondiente en <code>tnsnames.ora</code></p> <pre><code>nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora\n</code></pre> <pre><code>GN=\n(DESCRIPTION =\n(ADDRESS_LIST =\n(ADDRESS = (PROTOCOL = TCP)(HOST = servidororacle1)(PORT = 1521))\n)\n(CONNECT_DATA =\n(SERVICE_NAME = GN)\n)\n)\n</code></pre>"},{"location":"bd/examen-practicas-1-2/#en-servidorpostgresql1","title":"En <code>servidorpostgresql1</code>","text":"<p>Conectar como <code>postgres</code></p> <pre><code>vagrant@servidorpostgresql1:~$ su - postgres\nPassword:\npostgres@servidorpostgresql1:~$ psql\npsql (13.8 (Debian 13.8-0+deb11u1))\nType \"help\" for help.\n\npostgres=#\n</code></pre> <p>Crear una bd llamada <code>GN2</code></p> <pre><code>postgres=# CREATE DATABASE GN2;\nCREATE DATABASE\npostgres=# \\l\nList of databases\n    Name     |  Owner   | Encoding | Collate |  Ctype  |       Access privileges\n-------------+----------+----------+---------+---------+--------------------------------\n bibliofilos | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =Tc/postgres                  +\n             |          |          |         |         | postgres=CTc/postgres         +\n             |          |          |         |         | bibliofilos_admin=CTc/postgres\n gn2         | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\npepino      | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\npostgres    | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\ntemplate0   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n template1   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n(6 rows)\n</code></pre> <p>Cambiar a la bd creada</p> <pre><code>postgres=# \\connect gn2\nYou are now connected to database \"gn2\" as user \"postgres\".\ngn2=#\n</code></pre> <p>Crear la tabla <code>asignaturas</code></p> <pre><code>CREATE TABLE asignaturas (\nNombre VARCHAR(3) PRIMARY KEY,\nDNIprofesor integer NOT NULL\n);\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>gn2=# \\dt\nList of relations\n Schema |    Name     | Type  |  Owner\n--------+-------------+-------+----------\n public | asignaturas | table | postgres\n(1 row)\n</code></pre> <p>Insertar registros</p> <pre><code>gn2=# INSERT INTO asignaturas VALUES ('ASO', 28888888);\nINSERT 0 1\ngn2=# INSERT INTO asignaturas VALUES ('ABD', 27777777);\nINSERT 0 1\n</code></pre> <p>Comprobar que se han insertado</p> <pre><code>gn2=# SELECT * FROM asignaturas;\nnombre | dniprofesor\n--------+-------------\nASO    |    28888888\nABD    |    27777777\n(2 rows)\n</code></pre> <p>Crear el usuario <code>raul</code> y comprobar que se ha creado</p> <pre><code>vagrant@servidorpostgresql1:~$ sudo adduser raul\nAdding user `raul' ...\nAdding new group `raul' (1002) ...\nAdding new user `raul' (1002) with group `raul' ...\nCreating home directory `/home/raul' ...\nCopying files from `/etc/skel' ...\nNew password:\nRetype new password:\npasswd: password updated successfully\nChanging the user information for raul\nEnter the new value, or press ENTER for the default\n    Full Name []:\n    Room Number []:\n    Work Phone []:\n    Home Phone []:\n    Other []:\nIs the information correct? [Y/n] y\nvagrant@servidorpostgresql1:~$ su - postgres\nPassword:\npostgres@servidorpostgresql1:~$ psql\npsql (13.8 (Debian 13.8-0+deb11u1))\nType \"help\" for help.\n\npostgres=# create user raul with encrypted password '1234';\nCREATE ROLE\npostgres=# \\du\nList of roles\n     Role name     |                         Attributes                         | Member of\n-------------------+------------------------------------------------------------+-----------\n bibliofilos_admin |                                                            | {}\npostgres          | Superuser, Create role, Create DB, Replication, Bypass RLS | {}\nraul              |                                                            | {}\n</code></pre> <p>Darle los permisos necesarios</p> <pre><code>postgres=# GRANT all privileges ON DATABASE gn2 TO raul;\nGRANT\npostgres=# \\l\nList of databases\n    Name     |  Owner   | Encoding | Collate |  Ctype  |       Access privileges\n-------------+----------+----------+---------+---------+--------------------------------\n bibliofilos | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =Tc/postgres                  +\n             |          |          |         |         | postgres=CTc/postgres         +\n             |          |          |         |         | bibliofilos_admin=CTc/postgres\n gn2         | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =Tc/postgres                  +\n             |          |          |         |         | postgres=CTc/postgres         +\n             |          |          |         |         | raul=CTc/postgres\n pepino      | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\npostgres    | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\ntemplate0   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n template1   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n(6 rows)\npostgres=# \\connect gn2\nYou are now connected to database \"gn2\" as user \"postgres\".\ngn2=# GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO raul;\nGRANT\ngn2=# SELECT * from information_schema.table_privileges WHERE grantee = 'raul';\ngrantor  | grantee | table_catalog | table_schema | table_name  | privilege_type | is_grantable | with_hierarchy\n----------+---------+---------------+--------------+-------------+----------------+--------------+----------------\n postgres | raul    | gn2           | public       | asignaturas | INSERT         | NO           | NO\n postgres | raul    | gn2           | public       | asignaturas | SELECT         | NO           | YES\n postgres | raul    | gn2           | public       | asignaturas | UPDATE         | NO           | NO\n postgres | raul    | gn2           | public       | asignaturas | DELETE         | NO           | NO\n postgres | raul    | gn2           | public       | asignaturas | TRUNCATE       | NO           | NO\n postgres | raul    | gn2           | public       | asignaturas | REFERENCES     | NO           | NO\n postgres | raul    | gn2           | public       | asignaturas | TRIGGER        | NO           | NO\n(7 rows)\n</code></pre>"},{"location":"bd/examen-practicas-1-2/#2b-servidororacle1-servidorpostgresql1","title":"2B <code>servidororacle1</code> \u2192 <code>servidorpostgresql1</code>","text":"<p>Dejar <code>odbc.ini</code> de la siguiente manera:</p> <pre><code>sudo nano /etc/odbc.ini\n</code></pre> <pre><code>[postgresql]\nDescription = postgresql\nDriver = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so\nServerName = 192.168.121.222\nUsername = raul\nPassword = 1234\nPort = 5432\nDatabase = gn2\n</code></pre> <p>Conectar a la bd</p> <pre><code>sqlplus / as sysdba\n</code></pre> <p>Crear un nuevo enlace</p> <pre><code>CREATE PUBLIC DATABASE LINK postgresqlexamen\nCONNECT TO \"raul\" IDENTIFIED BY \"1234\"\nUSING 'postgresql';\n</code></pre> <p>Hacer una primera prueba mostrando la tabla remota <code>asignaturas</code> usando el enlace</p> <pre><code>SELECT * FROM \"asignaturas\"@postgresqlexamen;\nnombre                                   dniprofesor\n------------------------------------ -----------\nASO                                         28888888\nABD                                         27777777\n</code></pre> <p>Hacer la consulta final usando el enlace, mostrando el nombre de las asignaturas junto con el nombre del profesor que las imparte</p> <p>Consulta:</p> <pre><code>SELECT a.\"nombre\", p.nombre\nFROM \"asignaturas\"@postgresqlexamen a INNER JOIN profesores p\nON a.\"dniprofesor\" = p.dni;\n</code></pre> <p>Resultado:</p> <pre><code>nombre                                   NOMBRE\n------------------------------------ --------------------------------------------------\nASO                                  Raul Ruiz Padilla\nABD                                  Rafael Luengo Sanz\n</code></pre>"},{"location":"bd/examen-practicas-1-2/#2c-servidorpostgresql1-servidororacle1","title":"2C <code>servidorpostgresql1</code> \u2192 <code>servidororacle1</code>","text":"<p>Cambiar <code>ORCLCDB</code> por <code>GN</code> en <code>tnsnames.ora</code></p> <pre><code>sudo nano /opt/oracle/instantclient_21_8/network/admin/tnsnames.ora\n</code></pre> <pre><code>GN=\n(DESCRIPTION =\n(ADDRESS_LIST =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.121.211)(PORT = 1521))\n)\n(CONNECT_DATA =\n(SERVICE_NAME = GN)\n)\n)\n</code></pre> <p>Conectar como <code>postgres</code> a <code>gn2</code>:</p> <pre><code>vagrant@servidorpostgresql1:~$ su - postgres\nPassword:\npostgres@servidorpostgresql1:~$ psql gn2\npsql (13.8 (Debian 13.8-0+deb11u1))\nType \"help\" for help.\n\ngn2=#\n</code></pre> <p>A\u00f1adir la extensi\u00f3n <code>oracle_fdw</code></p> <pre><code>gn2=# CREATE EXTENSION oracle_fdw;\nCREATE EXTENSION\n</code></pre> <p>Compruebo que se ha a\u00f1adido:</p> <pre><code>gn2=# \\dx\nList of installed extensions\n    Name    | Version |   Schema   |              Description\n------------+---------+------------+----------------------------------------\n oracle_fdw | 1.2     | public     | foreign data wrapper for Oracle access\n plpgsql    | 1.0     | pg_catalog | PL/pgSQL procedural language\n(2 rows)\n</code></pre> <p>Crear el \"foreign server\" apuntando a <code>servidororacle1</code></p> <pre><code>gn2=# CREATE SERVER servidororacle1examen FOREIGN DATA WRAPPER oracle_fdw OPTIONS (dbserver '//192.168.121.211:1521/GN');\nCREATE SERVER\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>gn2=# \\des+\nList of foreign servers\n         Name          |  Owner   | Foreign-data wrapper | Access privileges | Type | Version |              FDW options               | Description\n-----------------------+----------+----------------------+-------------------+------+---------+----------------------------------------+-------------\n servidororacle1examen | postgres | oracle_fdw           |                   |      |         | (dbserver '//192.168.121.211:1521/GN') |\n(1 row)\n</code></pre> <p>Le doy permisos de uso a <code>raul</code>:</p> <pre><code>gn2=# GRANT USAGE ON FOREIGN SERVER servidororacle1examen TO raul;\nGRANT\n</code></pre> <p>Crear los \"USER MAPPING\"</p> <pre><code>gn2=# CREATE USER MAPPING FOR postgres SERVER servidororacle1examen OPTIONS (user 'raul', password '1234');\nCREATE USER MAPPING\ngn2=# CREATE USER MAPPING FOR raul SERVER servidororacle1examen OPTIONS (user 'raul', password '1234');\nCREATE USER MAPPING\n</code></pre> <p>Compruebo que se han creado:</p> <pre><code>gn2=# \\deu+\nList of user mappings\n        Server         | User name |           FDW options\n-----------------------+-----------+----------------------------------\n servidororacle1examen | postgres  | (\"user\" 'raul', password '1234')\nservidororacle1examen | raul      | (\"user\" 'raul', password '1234')\n(2 rows)\n</code></pre> <p>Crear la \"foreign table\" <code>profesores</code></p> <pre><code>CREATE FOREIGN TABLE PROFESORES (\nDNI         integer OPTIONS (key 'true') NOT NULL,\nNOMBRE      varchar(50) NOT NULL\n)\nSERVER servidororacle1examen OPTIONS (schema 'RAUL', table 'PROFESORES');\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>gn2=# select * from information_schema.foreign_tables;\nforeign_table_catalog | foreign_table_schema | foreign_table_name | foreign_server_catalog |  foreign_server_name\n-----------------------+----------------------+--------------------+------------------------+-----------------------\ngn2                   | public               | profesores         | gn2                    | servidororacle1examen\n(1 row)\n</code></pre> <p>Le doy permisos a <code>raul</code> sobre la tabla:</p> <pre><code>gn2=# grant all on table profesores to raul;\nGRANT\n</code></pre> <p>Cambiar al usuario <code>raul</code></p> <pre><code>gn2=# set role raul;\nSET\n</code></pre> <p>Comprobar el cambio de usuario:</p> <pre><code>gn2=&gt; select current_user, session_user;\ncurrent_user | session_user\n--------------+--------------\n raul         | postgres\n(1 row)\n</code></pre> <p>Mostrar la tabla <code>profesores</code> remota para hacer una primera prueba</p> <pre><code>gn2=&gt; SELECT * FROM profesores;\ndni    |       nombre\n----------+--------------------\n28888888 | Raul Ruiz Padilla\n27777777 | Rafael Luengo Sanz\n(2 rows)\n</code></pre> <p>Hacer la consulta final usando la \"foreign table\", mostrando el nombre de las asignaturas junto con el nombre del profesor que las imparte</p> <p>Consulta:</p> <pre><code>SELECT a.nombre, p.nombre\nFROM asignaturas a INNER JOIN profesores p\nON a.dniprofesor = p.dni;\n</code></pre> <p>Resultado:</p> <pre><code> nombre |       nombre\n--------+--------------------\nASO    | Raul Ruiz Padilla\nABD    | Rafael Luengo Sanz\n(2 rows)\n</code></pre>"},{"location":"bd/examen-practicas-3-4/","title":"Examen pr\u00e1cticas 3 y 4","text":""},{"location":"bd/examen-practicas-3-4/#pasos-previos","title":"Pasos previos","text":"<p>Me conecto como sys y creo el usuario:</p> <pre><code>sqlplus / as sysdba\nCREATE USER examenbd34 IDENTIFIED BY 1234;\nGRANT ALL PRIVILEGES TO examenbd34;\nexit\n</code></pre> <p>Descargo el script:</p> <pre><code>wget https://gist.githubusercontent.com/adriasir123/7115290af0d999c35f9315b788adb3d9/raw/359c4853508068d731302540323d569ac05654da/script-examen-bd-3-4.sql\n</code></pre> <p>Me conecto como dicho usuario:</p> <pre><code>sqlplus examenbd34/1234\n</code></pre> <p>Ejecuto el script:</p> <pre><code>@script-examen-bd-3-4.sql\n</code></pre> <p>El esquema relacional es el siguiente...</p> ALUMNOS DNI VARCHAR2, tama\u00f1o 10 Apenom VARCHAR2, tama\u00f1o 36 Direc VARCHAR2, tama\u00f1o 30 Poblaci\u00f3n VARCHAR2, tama\u00f1o 15 Telefono VARCHAR2, tama\u00f1o 10 ASIGNATURAS Cod NUMBER Nombre VARCHAR2, tama\u00f1o 26 Curso NUMBER NOTAS DNI VARCHAR2, tama\u00f1o 10 Cod NUMBER Nota NUMBER"},{"location":"bd/examen-practicas-3-4/#ejercicio-1","title":"Ejercicio 1","text":""},{"location":"bd/examen-practicas-3-4/#1-enunciado","title":"1. Enunciado","text":"<p>Realiza un procedimiento llamado <code>imprimir_boletines</code> que reciba dos par\u00e1metros.</p> <p>El primer par\u00e1metro ser\u00e1 num\u00e9rico y podr\u00e1 tener los siguientes valores:</p> <ul> <li> <p>Un 1 si se desea imprimir todos los boletines de un curso concreto</p> </li> <li> <p>Un 2 si queremos imprimir el bolet\u00edn de un alumno concreto</p> </li> </ul> <p>El segundo par\u00e1metro ser\u00e1 el curso del que se desean imprimir los boletines (en el primer caso) o el nombre del alumno del que se desea imprimir el bolet\u00edn (en el segundo caso).</p> <p>En cada bolet\u00edn debe aparecer el nombre y apellidos del alumno, su direcci\u00f3n completa, la fecha y hora de impresi\u00f3n y una lista con los nombres de las asignaturas y la nota conseguida en cada una de ellas por el alumno.</p> <p>Deben gestionarse las siguientes excepciones: Curso Inexistente (en los informes  tipo 1), Alumno inexistente (en los informes tipo 2) y No existen notas (en ambos tipos)</p>"},{"location":"bd/examen-practicas-3-4/#1-codigo","title":"1. C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE comprobar_excepciones_tipo1 (\np_cursoalumno VARCHAR2\n) IS\nv_curso_recs NUMBER;\nv_notas_curso NUMBER;\ne_curso_inexistente exception;\ne_curso_sin_notas exception;\nBEGIN\nSELECT COUNT(*) INTO v_curso_recs\nFROM asignaturas\nWHERE curso = to_number(p_cursoalumno, '9');\nIF v_curso_recs = 0 THEN\nraise e_curso_inexistente;\nEND IF;\nSELECT COUNT(*) INTO v_notas_curso\nFROM notas n\nINNER JOIN asignaturas a\nON n.cod = a.cod\nWHERE a.curso = to_number(p_cursoalumno, '9');\nIF v_notas_curso = 0 THEN\nraise e_curso_sin_notas;\nEND IF;\nEXCEPTION\nWHEN e_curso_inexistente THEN\nRAISE_APPLICATION_ERROR(-20001, 'No existe el curso ' || p_cursoalumno);\nWHEN e_curso_sin_notas THEN\nRAISE_APPLICATION_ERROR(-20002, 'El curso ' || p_cursoalumno || ' existe, pero no tiene notas');\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li> <p>Este procedimiento maneja las excepciones de <code>boletintipo1</code>:</p> <ul> <li>Curso inexistente</li> <li>Curso sin notas</li> </ul> </li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_excepciones_tipo2 (\np_cursoalumno VARCHAR2\n) IS\nv_alumno_recs NUMBER;\nv_notas_alumno NUMBER;\ne_alumno_inexistente exception;\ne_alumno_sin_notas exception;\nBEGIN\nSELECT COUNT(*) INTO v_alumno_recs\nFROM alumnos\nWHERE apenom = p_cursoalumno;\nIF v_alumno_recs = 0 THEN\nraise e_alumno_inexistente;\nEND IF;\nSELECT COUNT(*) INTO v_notas_alumno\nFROM notas n\nINNER JOIN alumnos a\nON n.dni = a.dni\nWHERE a.apenom = p_cursoalumno;\nIF v_notas_alumno = 0 THEN\nraise e_alumno_sin_notas;\nEND IF;\nEXCEPTION\nWHEN e_alumno_inexistente THEN\nRAISE_APPLICATION_ERROR(-20001, 'No existe el alumno ' || p_cursoalumno);\nWHEN e_alumno_sin_notas THEN\nRAISE_APPLICATION_ERROR(-20002, 'El alumno ' || p_cursoalumno || ' existe, pero no tiene notas');\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li> <p>Este procedimiento maneja las excepciones de <code>boletintipo2</code>:</p> <ul> <li>Alumno inexistente</li> <li>Alumno sin notas</li> </ul> </li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE boletintipo1 (\np_cursoalumno VARCHAR2\n) IS\nCURSOR c_notas_por_curso IS\nSELECT al.apenom, al.direc, al.pobla, n.nota, a.nombre\nFROM alumnos al\nINNER JOIN notas n\nON al.dni = n.dni\nINNER JOIN asignaturas a\nON n.cod = a.cod\nWHERE a.curso = to_number(p_cursoalumno, '9');\nBEGIN\ncomprobar_excepciones_tipo1(p_cursoalumno);\nDBMS_OUTPUT.PUT_LINE('Curso: ' || p_cursoalumno);\nDBMS_OUTPUT.PUT_LINE('Fecha y hora de impresion: ' || to_char(sysdate, 'DD-MON-YYYY HH24:MI'));\nDBMS_OUTPUT.PUT_LINE(chr(9));\nFOR i IN c_notas_por_curso LOOP\nDBMS_OUTPUT.PUT_LINE(chr(9) || 'Alumno: ' || i.apenom);\nDBMS_OUTPUT.PUT_LINE(chr(9) || 'Direccion: ' || i.direc || ' (' || i.pobla || ')');\nDBMS_OUTPUT.PUT_LINE(chr(9) || 'Asignatura: ' || i.nombre);\nDBMS_OUTPUT.PUT_LINE(chr(9) || 'Nota: ' || i.nota);\nDBMS_OUTPUT.PUT_LINE(chr(9));\nEND LOOP;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento saca un informe de notas seg\u00fan el curso que recibe como par\u00e1metro</li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE boletintipo2 (\np_cursoalumno VARCHAR2\n) IS\nvv_direc alumnos.direc%type;\nvv_pobla alumnos.pobla%type;\nCURSOR c_notas_por_alumno IS\nSELECT n.nota, a.nombre\nFROM alumnos al\nINNER JOIN notas n\nON al.dni = n.dni\nINNER JOIN asignaturas a\nON n.cod = a.cod\nWHERE al.apenom = p_cursoalumno;\nBEGIN\ncomprobar_excepciones_tipo2(p_cursoalumno);\nSELECT direc INTO vv_direc\nFROM alumnos\nWHERE apenom = p_cursoalumno;\nSELECT pobla INTO vv_pobla\nFROM alumnos\nWHERE apenom = p_cursoalumno;\nDBMS_OUTPUT.PUT_LINE('Alumno: ' || p_cursoalumno);\nDBMS_OUTPUT.PUT_LINE('Direccion: ' || vv_direc || ' (' || vv_pobla || ')');\nDBMS_OUTPUT.PUT_LINE('Fecha y hora de impresion: ' || to_char(sysdate, 'DD-MON-YYYY HH24:MI'));\nDBMS_OUTPUT.PUT_LINE(chr(9));\nFOR i IN c_notas_por_alumno LOOP\nDBMS_OUTPUT.PUT_LINE(chr(9) || 'Asignatura: ' || i.nombre);\nDBMS_OUTPUT.PUT_LINE(chr(9) || 'Nota: ' || i.nota);\nDBMS_OUTPUT.PUT_LINE(chr(9));\nEND LOOP;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento saca un informe de notas seg\u00fan el alumno que recibe como par\u00e1metro</li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE imprimir_boletines(\np_tipo NUMBER,\np_cursoalumno VARCHAR2\n) IS\nBEGIN\nIF p_tipo = 1 THEN\nboletintipo1(p_cursoalumno);\nELSE\nboletintipo2(p_cursoalumno);\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este es el procedimiento principal, y desde aqu\u00ed se llama a cada bolet\u00edn seg\u00fan el tipo que recibe por par\u00e1metro. Tiene un segundo par\u00e1metro, que recibir\u00e1 un curso o un alumno, seg\u00fan el tipo de bolet\u00edn que se quiera imprimir</li> </ol>"},{"location":"bd/examen-practicas-3-4/#1-comprobaciones","title":"1. Comprobaciones","text":"<p>Compilaciones:</p> comprobar_excepciones_tipo1 comprobar_excepciones_tipo2 boletintipo1 boletintipo2 imprimir_boletines <p>Informe sin errores de tipo 1:</p> <pre><code>EXEC imprimir_boletines(1,'1');\n</code></pre> <p></p> <p>Informe sin errores de tipo 2:</p> <pre><code>EXEC imprimir_boletines(2,'Alcalde Garcia, Elena');\n</code></pre> <p></p> <p>Informe de tipo 1 cuando el curso no existe:</p> <pre><code>EXEC imprimir_boletines(1,'9');\n</code></pre> <p></p> <p>Informe de tipo 1 cuando el curso existe, pero no tiene notas:</p> <pre><code>EXEC imprimir_boletines(1,'3');\n</code></pre> <p></p> <p>Para que esta prueba haya funcionado, he tenido que a\u00f1adir una nueva asignatura en el nuevo curso 3:</p> <pre><code>INSERT INTO ASIGNATURAS VALUES (8,'Nueva',3);\n</code></pre> <p>Informe de tipo 2 cuando el alumno no existe:</p> <pre><code>EXEC imprimir_boletines(2,'Jim Carrey');\n</code></pre> <p></p> <p>Informe de tipo 2 cuando el alumno existe, pero no tiene notas:</p> <pre><code>EXEC imprimir_boletines(2,'Robin Williams');\n</code></pre> <p></p> <p>Para que esta prueba haya funcionado, he tenido que a\u00f1adir un nuevo alumno:</p> <pre><code>INSERT INTO ALUMNOS VALUES ('12344346','Robin Williams', 'C/Adams Boulevard, 33','California','817766545');\n</code></pre>"},{"location":"bd/examen-practicas-3-4/#ejercicio-2","title":"Ejercicio 2","text":""},{"location":"bd/examen-practicas-3-4/#2-enunciado","title":"2. Enunciado","text":"<p>Dise\u00f1a los m\u00f3dulos necesarios para que un mismo alumno no pueda tener notas de asignaturas de cursos distintos. Es decir, el alumno o es de primero o es de segundo. Si ya tiene notas de uno de los dos cursos, no puede tener notas del otro.</p> <p>Debe funcionar sin dar problema de tablas mutantes en consultas de datos anexados y en consultas de modificaci\u00f3n que afecten a m\u00faltiples registros</p>"},{"location":"bd/examen-practicas-3-4/#2-codigo","title":"2. C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE comprobar_curso_alumno(\np_dni VARCHAR2,\np_control_curso OUT NUMBER\n) IS\nPRAGMA AUTONOMOUS_TRANSACTION;\nBEGIN\nSELECT AVG(a.curso) INTO p_control_curso\nFROM notas n\nINNER JOIN asignaturas a\nON n.cod = a.cod\nWHERE n.dni = p_dni;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento recibe un DNI y devuelve el curso al que pertenece el alummno</li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_curso_asignatura(\np_cod NUMBER,\np_control_curso_asignatura OUT NUMBER\n) IS\nBEGIN\nSELECT curso INTO p_control_curso_asignatura\nFROM asignaturas\nWHERE cod = p_cod;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento recibe un c\u00f3digo de asignatura, y devuelve su curso</li> </ol> <pre><code>CREATE OR REPLACE TRIGGER monitorizar_notas\nBEFORE INSERT OR UPDATE ON notas\nFOR EACH ROW\nDECLARE\nvn_control_curso_alumno NUMBER;\nvn_control_curso_asignatura NUMBER;\nBEGIN\ncomprobar_curso_alumno(:NEW.dni,vn_control_curso_alumno);\ncomprobar_curso_asignatura(:NEW.cod,vn_control_curso_asignatura);\nIF vn_control_curso_alumno != vn_control_curso_asignatura THEN\nRAISE_APPLICATION_ERROR(-20001, 'El alumno con DNI ' || :NEW.dni || ' esta en el curso ' || vn_control_curso_alumno || ' y la asignatura con codigo ' || :NEW.cod || ' es del curso ' || vn_control_curso_asignatura);\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este es el bloque padre, el trigger que controla que no se inserte o modifique una nota si el alumno y la asignatura no pertenecen al mismo curso</li> </ol>"},{"location":"bd/examen-practicas-3-4/#2-comprobaciones","title":"2. Comprobaciones","text":"<p>Compilaciones:</p> comprobar_curso_alumno comprobar_curso_asignatura monitorizar_notas <p>Para que todo sea m\u00e1s simple, las pruebas las voy a realizar sobre un alumno espec\u00edfico, el de DNI <code>12344345</code>, que es de primero.</p> <p>Pruebo que no deja insertar una nota si es de una asignatura de segundo:</p> <pre><code>INSERT INTO NOTAS VALUES('12344345',4,7);\n</code></pre> <p></p> <p>Pruebo que no deja modificar una nota si es con una asignatura de segundo:</p> <pre><code>UPDATE NOTAS\nSET dni = '12344345', cod = 5, nota = 6\nWHERE dni = 12344345 AND cod = 1 AND nota = 6;\n</code></pre> <p></p> <p>Pruebo que no deja modificar varias notas si es con una asignatura de segundo:</p> <pre><code>UPDATE NOTAS\nSET dni = '12344345', cod = 4, nota = 6\nWHERE dni = 12344345;\n</code></pre> <p></p> <p>Pruebo que no deja modificar una nota si es con una asignatura de segundo, pero con datos anexados:</p> <pre><code>UPDATE NOTAS\nSET dni = (SELECT dni\nFROM alumnos\nWHERE apenom = 'Alcalde Garcia, Elena'),\ncod = (SELECT cod\nFROM asignaturas\nWHERE nombre = 'FOL'),\nnota = 6\nWHERE dni = 12344345 AND cod = 1 AND nota = 6;\n</code></pre> <p></p> <p>Finalmente, pruebo que si la nota es de una asignatura de primero, deja insertarla:</p> <pre><code>INSERT INTO NOTAS VALUES('12344345',8,7);\n</code></pre> <p></p>"},{"location":"bd/examen-practicas-5-6/","title":"Examen pr\u00e1cticas 5 y 6","text":""},{"location":"bd/examen-practicas-5-6/#ejercicio-1","title":"Ejercicio 1","text":""},{"location":"bd/examen-practicas-5-6/#11-enunciado","title":"1.1 Enunciado","text":"<p>Realiza un procedimiento para ORACLE que reciba el nombre de un rol y devuelva exclusivamente los privilegios provenientes de los otros roles que contenga, teniendo en cuenta todos los posibles niveles de anidamiento. El formato ser\u00e1 el indicado a continuaci\u00f3n:</p> <p>Rol analizado: xxxxxxxxxxxxx</p> <p>Privilegios sobre objetos:</p> <pre><code>Rol 1: xxxxxxxxxx\n    Priv1   Objeto1\n    \u2026\n    PrivN   ObjetoN\n    Rol 1.1: xxxxxxxxxxxxx\n        Priv1   Objeto1\n        \u2026\n        PrivN   ObjetoN\n    Rol 1.N: xxxxxxxxxxxxx\n        Priv1   Objeto1\n        \u2026\n        PrivN   ObjetoN\n        Rol 1.N.1: xxxxxxxxxxxx\n            \u2026.\n\u2026\nRol N: xxxxxxxxxx\n    Priv1   Objeto1\n    \u2026\n    PrivN   ObjetoN\n</code></pre> <p>Privilegios de Sistema: </p> <pre><code>Rol 1: xxxxxxxxxx\n    Priv1\n    \u2026\n    PrivN\nRol 1.1: xxxxxxxxxxxxx\n        Priv1   Objeto1\n        \u2026\n        PrivN   ObjetoN\n    Rol 1.N: xxxxxxxxxxxxx\n        Priv1   Objeto1\n        \u2026\n        PrivN   ObjetoN\n        Rol 1.N.1: xxxxxxxxxxxx\n            \u2026.\n\u2026\nRol N: xxxxxxxxxx\n    Priv1\n    \u2026\n    PrivN\n</code></pre>"},{"location":"bd/examen-practicas-5-6/#ejercicio-2","title":"Ejercicio 2","text":""},{"location":"bd/examen-practicas-5-6/#21-enunciado","title":"2.1 Enunciado","text":"<p>Realiza un procedimiento para ORACLE que reciba el nombre de un usuario y muestre la cantidad de bloques de datos de la que dispone en cada uno de los tablespaces teniendo en cuenta la cuota asignada en cada uno de los mismos. En caso de tener cuota ilimitada en alguno de ellos se mostrar\u00e1 el n\u00famero de bloques de datos en el espacio disponible en el tablespace</p>"},{"location":"bd/examen-practicas-5-6/#ejercicio-3","title":"Ejercicio 3","text":""},{"location":"bd/examen-practicas-5-6/#31-enunciado","title":"3.1 Enunciado","text":"<p>Crear tres usuarios en MongoDB. Crear dos colecciones <code>examen1</code> y <code>examen2</code> con dos documentos cada una con los atributos que desees.</p> <ul> <li>El primer usuario no podr\u00e1 acceder a ninguna de las dos colecciones.</li> <li>El segundo podr\u00e1 acceder solo a una de ellas y solo para leer los documentos.</li> <li>El tercer usuario tendr\u00e1 acceso total a las dos colecciones.</li> </ul> <p>Demuestra al profesor in situ el correcto funcionamiento de los permisos</p>"},{"location":"bd/examen-practicas-5-6/#32-realizacion","title":"3.2 Realizaci\u00f3n","text":"<p>Creo la base de datos:</p> <pre><code>test&gt; use examen56\nswitched to db examen56\nexamen56&gt; </code></pre> <p>Creo las colecciones:</p> <pre><code>examen56&gt; db.createCollection(\"examen1\")\n{ ok: 1 }\nexamen56&gt; db.createCollection(\"examen2\")\n{ ok: 1 }\n</code></pre> <p>Inserto los documentos:</p> <pre><code>db.examen1.insertMany( [\n{ gato: \"Garfield\", raza: \"Abinisio\" },\n{ gato: \"Kitty\", raza: \"Bengala\" }\n] )\ndb.examen2.insertMany( [\n{ perro: \"Toby\", raza: \"Leonberger\" },\n{ perro: \"Rocky\", raza: \"Chihuahua\" }\n] )\n</code></pre> <p>Creo el primer usuario, que no podr\u00e1 acceder a ninguna de las dos colecciones.</p> <p>Para ello primero creo <code>role1</code>:</p> <pre><code>db.createRole({\nrole: \"role1\",\nprivileges: [\n{ resource: { db: \"examen56\", collection: \"\" }, actions: [\"remove\"] }\n],\nroles: []\n})\n</code></pre> <p>Y creo <code>usuario1</code> asign\u00e1ndoselo:</p> <pre><code>db.createUser(\n{\nuser: \"usuario1\",\npwd: \"1234\",\nroles: [\"role1\"]\n}\n)\n</code></pre> <p>Me conecto como <code>usuario1</code> y hago las comprobaciones:</p> <pre><code>vagrant@servidormongodb:~$ mongosh -u usuario1 -p 1234 10.0.3.2/examen56\nCurrent Mongosh Log ID: 63ec9f509bba6d0cab76fd60\nConnecting to:          mongodb://&lt;credentials&gt;@10.0.3.2:27017/examen56?directConnection=true&amp;appName=mongosh+1.6.0\nUsing MongoDB:          5.0.13\nUsing Mongosh:          1.6.0\nFor mongosh info see: https://docs.mongodb.com/mongodb-shell/\nexamen56&gt; db.examen1.find()\nMongoServerError: not authorized on examen56 to execute command { find: \"examen1\", filter: {}, lsid: { id: UUID(\"be22e913-4435-4b5d-9a23-0593bcc659e0\") }, $db: \"examen56\" }\nexamen56&gt; db.examen2.find()\nMongoServerError: not authorized on examen56 to execute command { find: \"examen2\", filter: {}, lsid: { id: UUID(\"be22e913-4435-4b5d-9a23-0593bcc659e0\") }, $db: \"examen56\" }\n</code></pre> <p>Creo el segundo usuario, que podr\u00e1 acceder solo a una de las colecciones y solo para leer los documentos.</p> <p>Para ello primero creo <code>role2</code>:</p> <pre><code>db.createRole({\nrole: \"role2\",\nprivileges: [\n{\nresource: { db: \"examen56\", collection: \"examen1\" },\nactions: [ \"find\" ]\n}\n],\nroles: []\n})\n</code></pre> <p>Y creo <code>usuario2</code> asign\u00e1ndoselo:</p> <pre><code>db.createUser(\n{\nuser: \"usuario2\",\npwd: \"1234\",\nroles: [\"role2\"]\n}\n)\n</code></pre> <p>Me conecto como <code>usuario2</code> y hago las comprobaciones:</p> <pre><code>vagrant@servidormongodb:~$ mongosh -u usuario2 -p 1234 10.0.3.2/examen56\nCurrent Mongosh Log ID: 63eca1d7ecb63d1addbe39ac\nConnecting to:          mongodb://&lt;credentials&gt;@10.0.3.2:27017/examen56?directConnection=true&amp;appName=mongosh+1.6.0\nUsing MongoDB:          5.0.13\nUsing Mongosh:          1.6.0\nFor mongosh info see: https://docs.mongodb.com/mongodb-shell/\nexamen56&gt; db.examen1.find()\n[\n{\n_id: ObjectId(\"63ec922d8d5f87224376c6e7\"),\ngato: 'Garfield',\nraza: 'Abinisio'\n},\n{\n_id: ObjectId(\"63ec922d8d5f87224376c6e8\"),\ngato: 'Kitty',\nraza: 'Bengala'\n}\n]\nexamen56&gt; db.examen2.find()\nMongoServerError: not authorized on examen56 to execute command { find: \"examen2\", filter: {}, lsid: { id: UUID(\"e5171e94-e8b0-4904-9c19-966ff8aa54ed\") }, $db: \"examen56\" }\n</code></pre> <p>Creo <code>usuario3</code>, que tendr\u00e1 acceso total a las dos colecciones:</p> <pre><code>db.createUser(\n{\nuser: \"usuario3\",\npwd: \"1234\",\nroles: [ \"dbOwner\" ]\n}\n)\n</code></pre> <p>Me conecto como <code>usuario3</code> y hago las comprobaciones:</p> <pre><code>vagrant@servidormongodb:~$ mongosh -u usuario3 -p 1234 10.0.3.2/examen56\nCurrent Mongosh Log ID: 63eca238c508efcfa3ff9652\nConnecting to:          mongodb://&lt;credentials&gt;@10.0.3.2:27017/examen56?directConnection=true&amp;appName=mongosh+1.6.0\nUsing MongoDB:          5.0.13\nUsing Mongosh:          1.6.0\nFor mongosh info see: https://docs.mongodb.com/mongodb-shell/\nexamen56&gt; db.examen1.find()\n[\n{\n_id: ObjectId(\"63ec922d8d5f87224376c6e7\"),\ngato: 'Garfield',\nraza: 'Abinisio'\n},\n{\n_id: ObjectId(\"63ec922d8d5f87224376c6e8\"),\ngato: 'Kitty',\nraza: 'Bengala'\n}\n]\nexamen56&gt; db.examen2.find()\n[\n{\n_id: ObjectId(\"63ec923e8d5f87224376c6e9\"),\nperro: 'Toby',\nraza: 'Leonberger'\n},\n{\n_id: ObjectId(\"63ec923e8d5f87224376c6ea\"),\nperro: 'Rocky',\nraza: 'Chihuahua'\n}\n]\n</code></pre>"},{"location":"bd/examen-practicas-5-6/#ejercicio-4","title":"Ejercicio 4","text":""},{"location":"bd/examen-practicas-5-6/#41-enunciado","title":"4.1 Enunciado","text":"<p>Queremos cambiar de ubicaci\u00f3n un tablespace de Postgres, pero antes debemos avisar a los usuarios que tienen acceso de lectura o escritura a cualquiera de los objetos almacenados en el mismo. Escribe una consulta que obtenga un listado con los nombres de dichos usuarios</p>"},{"location":"bd/examen-practicas-5-6/#42-realizacion","title":"4.2 Realizaci\u00f3n","text":"<p>usuarios que tienen privilegios de lectura o escritura a cualquiera de los objetos almacenados en el mismo. Escribe una consulta que obtenga un listado con los nombres de dichos usuarios (sacar solamente el listado de usuarios)</p> <p>pg_tables <pre><code>CREATE OR REPLACE PROCEDURE listado_usuarios_en_tablespace(nombre_del_tablespace text)\nLANGUAGE plpgsql\nAS $$\nDECLARE\nresultado text;\nBEGIN\nSELECT DISTINCT grantee\nINTO resultado\nFROM information_schema.table_privileges\nWHERE table_catalog = current_database()\nAND table_schema = 'public'\nAND tablespace_name = nombre_del_tablespace\nAND (privilege_type = 'SELECT' OR privilege_type = 'INSERT' OR privilege_type = 'UPDATE' OR privilege_type = 'DELETE');\nRAISE NOTICE 'Usuarios con permisos en el tablespace %: %', nombre_del_tablespace, resultado;\nEND;\n$$;\n</code></pre></p> <pre><code>CALL listado_usuarios_en_tablespace('pg_default');\n</code></pre> <p>SELECT * FROM pg_tables;</p>"},{"location":"bd/p2-interconexion-bd/","title":"Pr\u00e1ctica 2: Interconexi\u00f3n de servidores","text":""},{"location":"bd/p2-interconexion-bd/#pasos-previos","title":"Pasos previos","text":"<p>En esta pr\u00e1ctica voy a reutilizar el escenario de la pr\u00e1ctica 1.</p> <p>Modifico el <code>Vagrantfile</code> para a\u00f1adir un segundo servidor Oracle:</p> <p></p> <p>Instalar\u00e9 Oracle en el segundo servidor a\u00f1adido siguiendo mi propia documentaci\u00f3n de la pr\u00e1ctica anterior.</p> <p>Modifico el <code>Vagrantfile</code> para a\u00f1adir un segundo servidor PostgreSQL:</p> <p></p> <p>Instalar\u00e9 PostgreSQL en el segundo servidor a\u00f1adido siguiendo mi propia documentaci\u00f3n de la pr\u00e1ctica anterior.</p>"},{"location":"bd/p2-interconexion-bd/#oracle-oracle","title":"Oracle \u21c6 Oracle","text":""},{"location":"bd/p2-interconexion-bd/#en-servidororacle1","title":"En <code>servidororacle1</code>","text":"<p>A\u00f1ado lo siguiente a <code>/opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</code>:</p> <pre><code>ORACLE2=\n(DESCRIPTION =\n(ADDRESS_LIST =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 10.0.0.3)(PORT = 1521))\n)\n(CONNECT_DATA =\n(SERVICE_NAME = ORCLCDB)\n)\n)\n</code></pre> <p>Creo el enlace:</p> <pre><code>CREATE DATABASE LINK oracle2\nCONNECT TO SCOTT IDENTIFIED BY tiger\nUSING 'ORACLE2';\n</code></pre> <p>Muestro la tabla <code>dept</code> remota usando el enlace:</p> <p></p> <p>Compruebo que sin usar el enlace estoy en <code>servidororacle1</code>:</p> <p></p> <p>Compruebo que usando el enlace estoy en <code>servidororacle2</code>:</p> <p></p>"},{"location":"bd/p2-interconexion-bd/#en-servidororacle2","title":"En <code>servidororacle2</code>","text":"<p>A\u00f1ado lo siguiente a <code>/opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</code>:</p> <pre><code>ORACLE1=\n(DESCRIPTION =\n(ADDRESS_LIST =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 10.0.0.2)(PORT = 1521))\n)\n(CONNECT_DATA =\n(SERVICE_NAME = ORCLCDB)\n)\n)\n</code></pre> <p>Creo el enlace:</p> <pre><code>CREATE DATABASE LINK oracle1\nCONNECT TO SCOTT IDENTIFIED BY tiger\nUSING 'ORACLE1';\n</code></pre> <p>Muestro la tabla <code>dept</code> remota usando el enlace:</p> <p></p> <p>Compruebo que sin usar el enlace estoy en <code>servidororacle2</code>:</p> <p></p> <p>Compruebo que usando el enlace estoy en <code>servidororacle1</code>:</p> <p></p>"},{"location":"bd/p2-interconexion-bd/#postgresql-postgresql","title":"PostgreSQL \u21c6 PostgreSQL","text":""},{"location":"bd/p2-interconexion-bd/#en-servidorpostgresql1","title":"En <code>servidorpostgresql1</code>","text":"<p>A\u00f1ado la extensi\u00f3n necesaria:</p> <pre><code>postgres=# create extension dblink;\nCREATE EXTENSION\n</code></pre> <p>Compruebo que se ha a\u00f1adido:</p> <pre><code>postgres=# \\dx\nList of installed extensions\n  Name   | Version |   Schema   |                         Description\n---------+---------+------------+--------------------------------------------------------------\n dblink  | 1.2     | public     | connect to other PostgreSQL databases from within a database\n plpgsql | 1.0     | pg_catalog | PL/pgSQL procedural language\n(2 rows)\n</code></pre> <p>Creo el \"Foreign server\" apuntando a <code>servidorpostgresql2</code>:</p> <pre><code>postgres=# CREATE SERVER servidorpostgresql2 FOREIGN DATA WRAPPER dblink_fdw OPTIONS ( host '10.0.1.3' , dbname 'bibliofilos' , port '5432');\nCREATE SERVER\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>\\des+\n</code></pre> <pre><code>                                                                     List of foreign servers\n        Name         |  Owner   | Foreign-data wrapper | Access privileges | Type | Version |                     FDW options                      | Description\n---------------------+----------+----------------------+-------------------+------+---------+------------------------------------------------------+-------------\n servidorpostgresql2 | postgres | dblink_fdw           |                   |      |         | (host '10.0.1.3', dbname 'bibliofilos', port '5432') |\n(1 row)\n(END)\n</code></pre> <p>Creo el \"USER MAPPING\":</p> <pre><code>postgres=# CREATE USER MAPPING FOR postgres SERVER servidorpostgresql2 OPTIONS ( user 'bibliofilos_admin' , password '1234');\nCREATE USER MAPPING\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>postgres=# \\deu+\nList of user mappings\nServer        | User name |                  FDW options\n---------------------+-----------+-----------------------------------------------\nservidorpostgresql2 | postgres  | (\"user\" 'bibliofilos_admin', password '1234')\n(1 row)\n</code></pre> <p>Pruebo la conexi\u00f3n:</p> <pre><code>postgres=# SELECT dblink_connect('my_new_conn1', 'servidorpostgresql2');\ndblink_connect\n----------------\nOK\n(1 row)\n</code></pre> <p>Muestro la tabla <code>bibliotecas</code> remota usando el enlace:</p> <pre><code>select * from dblink('servidorpostgresql2','select * from bibliotecas') as object_list(id integer, ciudad varchar, calle varchar);\n</code></pre> <p></p> <p>Compruebo que sin usar el enlace estoy en <code>servidorpostgresql1</code>:</p> <p></p> <p>No obtengo IP y esto es correcto, ya que estoy conectado localmente usando un socket Unix, y no se usan IPs.</p> <p>Compruebo que usando el enlace estoy en <code>servidorpostgresql2</code>:</p> <pre><code>select * from dblink('servidorpostgresql2','select inet_server_addr();') as object_list(ip varchar);\n</code></pre> <p></p> <p>Muestro que efectivamente esa es la IP de <code>servidorpostgresql2</code>:</p> <p></p>"},{"location":"bd/p2-interconexion-bd/#en-servidorpostgresql2","title":"En <code>servidorpostgresql2</code>","text":"<p>A\u00f1ado la extensi\u00f3n necesaria:</p> <pre><code>postgres=# create extension dblink;\nCREATE EXTENSION\n</code></pre> <p>Compruebo que se ha a\u00f1adido:</p> <pre><code>postgres=# \\dx\nList of installed extensions\n  Name   | Version |   Schema   |                         Description\n---------+---------+------------+--------------------------------------------------------------\n dblink  | 1.2     | public     | connect to other PostgreSQL databases from within a database\n plpgsql | 1.0     | pg_catalog | PL/pgSQL procedural language\n(2 rows)\n</code></pre> <p>Creo el \"Foreign server\" apuntando a <code>servidorpostgresql1</code>:</p> <pre><code>postgres=# CREATE SERVER servidorpostgresql1 FOREIGN DATA WRAPPER dblink_fdw OPTIONS ( host '10.0.1.2' , dbname 'bibliofilos' , port '5432');\nCREATE SERVER\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>\\des+\n</code></pre> <pre><code>                                                                     List of foreign servers\n        Name         |  Owner   | Foreign-data wrapper | Access privileges | Type | Version |                     FDW options                      | Description\n---------------------+----------+----------------------+-------------------+------+---------+------------------------------------------------------+-------------\n servidorpostgresql1 | postgres | dblink_fdw           |                   |      |         | (host '10.0.1.2', dbname 'bibliofilos', port '5432') |\n(1 row)\n(END)\n</code></pre> <p>Creo el \"USER MAPPING\":</p> <pre><code>postgres=# CREATE USER MAPPING FOR postgres SERVER servidorpostgresql1 OPTIONS ( user 'bibliofilos_admin' , password '1234');\nCREATE USER MAPPING\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>postgres=# \\deu+\nList of user mappings\nServer        | User name |                  FDW options\n---------------------+-----------+-----------------------------------------------\nservidorpostgresql1 | postgres  | (\"user\" 'bibliofilos_admin', password '1234')\n(1 row)\n</code></pre> <p>Pruebo la conexi\u00f3n:</p> <pre><code>postgres=# SELECT dblink_connect('my_new_conn1', 'servidorpostgresql1');\ndblink_connect\n----------------\nOK\n(1 row)\n</code></pre> <p>Muestro la tabla <code>bibliotecas</code> remota usando el enlace:</p> <pre><code>select * from dblink('servidorpostgresql1','select * from bibliotecas') as object_list(id integer, ciudad varchar, calle varchar);\n</code></pre> <p></p> <p>Compruebo que sin usar el enlace estoy en <code>servidorpostgresql2</code>:</p> <p></p> <p>No obtengo IP y esto es correcto, ya que estoy conectado localmente usando un socket Unix, y no se usan IPs.</p> <p>Compruebo que usando el enlace estoy en <code>servidorpostgresql1</code>:</p> <pre><code>select * from dblink('servidorpostgresql1','select inet_server_addr();') as object_list(ip varchar);\n</code></pre> <p></p> <p>Muestro que efectivamente esa es la IP de <code>servidorpostgresql1</code>:</p> <p></p>"},{"location":"bd/p2-interconexion-bd/#oracle-postgresql","title":"Oracle \u21c6 PostgreSQL","text":""},{"location":"bd/p2-interconexion-bd/#servidororacle1-servidorpostgresql1","title":"<code>servidororacle1</code> \u2192 <code>servidorpostgresql1</code>","text":"<p>Instalo el driver para la conexi\u00f3n con PostgreSQL:</p> <pre><code>sudo apt install odbc-postgresql\n</code></pre> <p>Muestro el fichero que se me ha generado:</p> <pre><code>vagrant@servidororacle1:~$ cat /etc/odbcinst.ini\n[PostgreSQL ANSI]\nDescription=PostgreSQL ODBC driver (ANSI version)\nDriver=psqlodbca.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n[PostgreSQL Unicode]\nDescription=PostgreSQL ODBC driver (Unicode version)\nDriver=psqlodbcw.so\nSetup=libodbcpsqlS.so\nDebug=0\nCommLog=1\nUsageCount=1\n</code></pre> <p>Dejo <code>odbc.ini</code> de la siguiente manera:</p> <pre><code>sudo nano /etc/odbc.ini\n</code></pre> <pre><code>[postgresql]\nDescription = postgresql\nDriver = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so\nServerName = 192.168.121.222\nUsername = bibliofilos_admin\nPassword = 1234\nPort = 5432\nDatabase = bibliofilos\n</code></pre> <p>Hago una prueba de conexi\u00f3n:</p> <pre><code>isql -v postgresql\n</code></pre> <p></p> <p>Creo el fichero <code>initpostgresql.ora</code>:</p> <pre><code>sudo nano /opt/oracle/product/19c/dbhome_1/hs/admin/initpostgresql.ora\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code># This is a sample agent init file that contains the HS parameters that are\n# needed for the Database Gateway for ODBC\n#\n# HS init parameters\n#\nHS_FDS_CONNECT_INFO = postgresql\nHS_FDS_TRACE_LEVEL = 4\nHS_FDS_SHAREABLE_NAME = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so\nHS_LANGUAGE = AMERICAN_AMERICA.WE8ISO8859P9\n\n#\n# ODBC specific environment variables\n#\nset ODBCINI=/etc/odbc.ini\n\n#\n# Environment variables required for the non-Oracle system\n#\n</code></pre> <p>A\u00f1ado la siguiente entrada a <code>tnsnames.ora</code>:</p> <pre><code>sudo nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora\n</code></pre> <pre><code>postgresql =\n(DESCRIPTION =\n(ADDRESS_LIST =\n(ADDRESS = (PROTOCOL = TCP)(HOST = servidororacle1)(PORT = 1521))\n)\n(CONNECT_DATA =\n(SID = postgresql)\n)\n(HS = OK)\n)\n</code></pre> <p>Dejo <code>listener.ora</code> de la siguiente manera:</p> <pre><code>sudo nano /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora\n</code></pre> <pre><code># listener.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora\n# Generated by Oracle configuration tools.\nLISTENER =\n(DESCRIPTION_LIST =\n(DESCRIPTION =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))\n(ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))\n)\n)\nSID_LIST_LISTENER =\n(SID_LIST =\n(SID_DESC =\n(GLOBAL_DBNAME = ORCLCDB)\n(ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n(SID_NAME = ORCLCDB)\n)\n(SID_DESC =\n(SID_NAME = postgresql)\n(ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n(PROGRAM = dg4odbc)\n)\n)\n</code></pre> <p>Info</p> <p>He a\u00f1adido un nuevo <code>SID</code></p> <p>Reinicio el listener:</p> <pre><code>oracle@servidororacle1:~$ lsnrctl reload\n\nLSNRCTL for Linux: Version 19.0.0.0.0 - Production on 27-NOV-2022 23:38:45\n\nCopyright (c) 1991, 2019, Oracle.  All rights reserved.\n\nConnecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=0.0.0.0)(PORT=1521)))\nThe command completed successfully\n</code></pre> <p>Pruebo que funciona el nuevo registro de tns:</p> <pre><code>oracle@servidororacle1:~$ tnsping postgresql\n\nTNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 27-NOV-2022 23:56:17\n\nCopyright (c) 1997, 2019, Oracle.  All rights reserved.\n\nUsed parameter files:\n/opt/oracle/product/19c/dbhome_1/network/admin/sqlnet.ora\n\nUsed TNSNAMES adapter to resolve the alias\nAttempting to contact (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = servidororacle1)(PORT = 1521))) (CONNECT_DATA = (SID = postgresql)) (HS = OK))\nOK (0 msec)\n</code></pre> <p>Creo el enlace:</p> <pre><code>CREATE DATABASE LINK postgresql\nCONNECT TO \"bibliofilos_admin\" IDENTIFIED BY \"1234\"\nUSING 'postgresql';\n</code></pre> <p>Muestro la tabla <code>libros</code> remota usando el enlace:</p> <p></p>"},{"location":"bd/p2-interconexion-bd/#servidorpostgresql1-servidororacle1","title":"<code>servidorpostgresql1</code> \u2192 <code>servidororacle1</code>","text":"<p>Instalo el cliente de Oracle siguiendo mi propia documentaci\u00f3n de la pr\u00e1ctica 1.</p> <p>Descargo el paquete SDK del cliente de Oracle:</p> <pre><code>wget https://download.oracle.com/otn_software/linux/instantclient/218000/instantclient-sdk-linux.x64-21.8.0.0.0dbru.zip\n</code></pre> <p>Descomprimo:</p> <pre><code>sudo unzip -d /opt/oracle instantclient-sdk-linux.x64-21.8.0.0.0dbru.zip\n</code></pre> <p>A\u00f1ado la siguiente variable a <code>.bashrc</code>:</p> <pre><code>sudo nano ~/.bashrc\n</code></pre> <pre><code>export ORACLE_HOME=/opt/oracle/instantclient_21_8\n</code></pre> <p>Recargo el fichero:</p> <pre><code>source ~/.bashrc\n</code></pre> <p>Instalo los requerimientos de compilaci\u00f3n:</p> <pre><code>sudo apt install build-essential postgresql-server-dev-13\n</code></pre> <p>Descargo el c\u00f3digo fuente de la extensi\u00f3n <code>oracle_fdw</code>, descomprimo, y entro al directorio:</p> <pre><code>wget https://github.com/laurenz/oracle_fdw/archive/refs/tags/ORACLE_FDW_2_4_0.tar.gz\ntar -xvzf ORACLE_FDW_2_4_0.tar.gz\ncd oracle_fdw-ORACLE_FDW_2_4_0\n</code></pre> <p>Compilo e instalo:</p> <pre><code>make\nsudo make install\n</code></pre> <p>Dejo <code>ld.so.conf</code> de la siguiente manera:</p> <pre><code>sudo nano /etc/ld.so.conf\n</code></pre> <pre><code>include /etc/ld.so.conf.d/*.conf\n\n/opt/oracle/instantclient_21_8\n/usr/share/postgresql/13/extension\n</code></pre> <p>Aplico los cambios y reinicio PostgreSQL:</p> <pre><code>sudo ldconfig\nsudo systemctl restart postgresql\n</code></pre> <p>A\u00f1ado la extensi\u00f3n necesaria:</p> <pre><code>postgres=# CREATE EXTENSION oracle_fdw;\nCREATE EXTENSION\n</code></pre> <p>Compruebo que se ha a\u00f1adido:</p> <pre><code>postgres=# \\dx\nList of installed extensions\n    Name    | Version |   Schema   |                         Description\n------------+---------+------------+--------------------------------------------------------------\n dblink     | 1.2     | public     | connect to other PostgreSQL databases from within a database\n oracle_fdw | 1.2     | public     | foreign data wrapper for Oracle access\n plpgsql    | 1.0     | pg_catalog | PL/pgSQL procedural language\n(3 rows)\n</code></pre> <p>Creo el \"Foreign server\" apuntando a <code>servidororacle1</code>:</p> <pre><code>postgres=# CREATE SERVER servidororacle1 FOREIGN DATA WRAPPER oracle_fdw OPTIONS (dbserver '//192.168.121.211:1521/ORCLCDB');\nCREATE SERVER\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>\\des+\n</code></pre> <pre><code>                                                                     List of foreign servers\n        Name         |  Owner   | Foreign-data wrapper | Access privileges | Type | Version |                     FDW options                      | Description\n---------------------+----------+----------------------+-------------------+------+---------+------------------------------------------------------+-------------\n servidororacle1     | postgres | oracle_fdw           |                   |      |         | (dbserver '//192.168.121.211:1521/ORCLCDB')          |\nservidorpostgresql2 | postgres | dblink_fdw           |                   |      |         | (host '10.0.1.3', dbname 'bibliofilos', port '5432') |\n(2 rows)\n(END)\n</code></pre> <p>Creo el \"USER MAPPING\":</p> <pre><code>postgres=# CREATE USER MAPPING FOR postgres SERVER servidororacle1 OPTIONS (user 'SCOTT', password 'tiger');\nCREATE USER MAPPING\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>postgres=# \\deu+\nList of user mappings\nServer        | User name |                  FDW options\n---------------------+-----------+-----------------------------------------------\nservidororacle1     | postgres  | (\"user\" 'SCOTT', password 'tiger')\nservidorpostgresql2 | postgres  | (\"user\" 'bibliofilos_admin', password '1234')\n(2 rows)\n</code></pre> <p>Creo una foreign table para probar el funcionamiento:</p> <pre><code>CREATE FOREIGN TABLE DEPT (\nDEPTNO      integer OPTIONS (key 'true') NOT NULL,\nDNAME       varchar(14),\nLOC         varchar(13)\n)\nSERVER servidororacle1 OPTIONS (schema 'SCOTT', table 'DEPT');\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>postgres=# select * from information_schema.foreign_tables;\nforeign_table_catalog | foreign_table_schema | foreign_table_name | foreign_server_catalog | foreign_server_name\n-----------------------+----------------------+--------------------+------------------------+---------------------\npostgres              | public               | dept               | postgres               | servidororacle1\n(1 row)\n</code></pre> <p>Info</p> <p>Una FOREIGN TABLE existe localmente en PostgreSQL pero muestra datos remotos usando un FDW. En este caso, <code>oracle_fdw</code>.</p> <p>Muestro la tabla <code>DEPT</code> remota:</p> <pre><code>select * from DEPT;\n</code></pre> <p></p>"},{"location":"bd/p3-peque%C3%B1a-plsql/","title":"Pr\u00e1ctica 3: peque\u00f1a PL/SQL","text":""},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-1","title":"Ejercicio 1","text":"<p>Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo c\u00f3digo es 7782</p> <pre><code>CREATE OR REPLACE PROCEDURE mostrar_emp_7782\nIS\nv_nombre emp.ename%TYPE;\nv_salario emp.sal%TYPE;\nBEGIN\nSELECT ename, sal\nINTO v_nombre, v_salario\nFROM emp\nWHERE empno = 7782;\ndbms_output.put_line('El nombre del empleado con codigo 7782 es ' || v_nombre || ' y su salario es ' || v_salario);\nEND;\n/\n</code></pre> <pre><code>EXEC mostrar_emp_7782;\n</code></pre> <pre><code>El nombre del empleado con codigo 7782 es CLARK y su salario es 2450\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-2","title":"Ejercicio 2","text":"<p>Hacer un procedimiento que reciba como par\u00e1metro un c\u00f3digo de empleado y devuelva su nombre</p> <pre><code>CREATE OR REPLACE PROCEDURE nombre_empleado(p_empno emp.empno%TYPE)\nIS\nv_nombre emp.ename%TYPE;\nBEGIN\nSELECT ename\nINTO v_nombre\nFROM emp\nWHERE empno = p_empno;\ndbms_output.put_line('El nombre del empleado con codigo ' || p_empno || ' es ' || v_nombre);\nEND;\n/\n</code></pre> <pre><code>EXEC nombre_empleado(7876);\n</code></pre> <pre><code>El nombre del empleado con codigo 7876 es ADAMS\n\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-3","title":"Ejercicio 3","text":"<p>Hacer un procedimiento que devuelva los nombres de los tres empleados m\u00e1s antiguos</p> <pre><code>CREATE OR REPLACE PROCEDURE empleados_antiguos\nIS\nCURSOR c_empleados\nIS\nSELECT ename\nFROM emp\nORDER BY hiredate ASC\nFETCH FIRST 3 ROWS ONLY;\nBEGIN\ndbms_output.put_line('Los tres empleados mas antiguos son:');\nFOR i in c_empleados\nLOOP\ndbms_output.put_line(i.ename);\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>EXEC empleados_antiguos;\n</code></pre> <pre><code>Los tres empleados mas antiguos son:\nSMITH\nALLEN\nWARD\n\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-4","title":"Ejercicio 4","text":"<p>Hacer un procedimiento que reciba el nombre de un tablespace y muestre los nombres de los usuarios que lo tienen como tablespace por defecto</p> <pre><code>CREATE OR REPLACE PROCEDURE tablespace_usuarios(p_tablespace DBA_USERS.DEFAULT_TABLESPACE%TYPE)\nIS\nCURSOR c_usuarios\nIS\nSELECT username\nFROM dba_users\nWHERE default_tablespace = p_tablespace;\nBEGIN\ndbms_output.put_line('El nombre del tablespace que has escrito es ' || p_tablespace || ' y los usuarios que tienen este tablespace por defecto son:');\ndbms_output.put_line(chr(5));\nFOR i in c_usuarios\nLOOP\ndbms_output.put_line(i.username);\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>EXEC tablespace_usuarios('USERS');\n</code></pre> <pre><code>El nombre del tablespace que has escrito es USERS y los usuarios que tienen este tablespace por defecto son:\n\nGSMCATUSER\nMDDATA\nSYSBACKUP\nREMOTE_SCHEDULER_AGENT\nGSMUSER\nSYSRAC\nGSMROOTUSER\nSI_INFORMTN_SCHEMA\nAUDSYS\nDIP\nORDPLUGINS\nSYSKM\nORDDATA\nORACLE_OCM\nSCOTT\nSYSDG\nORDSYS\n\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-5","title":"Ejercicio 5","text":"<p>Modificar el procedimiento anterior para que haga lo mismo pero devolviendo el n\u00famero de usuarios que tienen ese tablespace como tablespace por defecto</p> <pre><code>CREATE OR REPLACE FUNCTION num_usuarios_tablespace(p_tablespace DBA_USERS.DEFAULT_TABLESPACE%TYPE)\nRETURN NUMBER\nIS\nv_num_usuarios NUMBER;\nBEGIN\nSELECT COUNT(*)\nINTO v_num_usuarios\nFROM dba_users\nWHERE default_tablespace = p_tablespace;\nRETURN v_num_usuarios;\nEND;\n/\n</code></pre> <pre><code>SELECT num_usuarios_tablespace('USERS') FROM dual;\n</code></pre> <pre><code>NUM_USUARIOS_TABLESPACE('USERS')\n--------------------------------\n                              17\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-6","title":"Ejercicio 6","text":"<p>Hacer un procedimiento llamado mostrar_usuarios_por_tablespace que muestre por pantalla un listado de los tablespaces existentes con la lista de usuarios de cada uno y el n\u00famero de los mismos</p> <pre><code>CREATE OR REPLACE PROCEDURE proc_listar_usuarios_tablespace(p_tablespace DBA_USERS.DEFAULT_TABLESPACE%TYPE)\nIS\nCURSOR c_usuarios\nIS\nSELECT username\nFROM dba_users\nWHERE default_tablespace = p_tablespace;\nBEGIN\nFOR i in c_usuarios\nLOOP\ndbms_output.put_line(i.username);\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE FUNCTION total_usuarios_bd\nRETURN NUMBER\nIS\nv_total_usuarios NUMBER;\nBEGIN\nSELECT COUNT(*)\nINTO v_total_usuarios\nFROM dba_users;\nRETURN v_total_usuarios;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE mostrar_usuarios_por_tablespace\nIS\nCURSOR c_tablespaces\nIS\nSELECT tablespace_name\nFROM dba_tablespaces;\nBEGIN\nFOR i IN c_tablespaces\nLOOP\ndbms_output.put_line('Tablespace ' || i.tablespace_name || ':');\ndbms_output.put_line(chr(9));\nproc_listar_usuarios_tablespace(i.tablespace_name);\ndbms_output.put_line(chr(9));\ndbms_output.put_line('Total Usuarios Tablespace ' || i.tablespace_name || ': ' || num_usuarios_tablespace(i.tablespace_name));\ndbms_output.put_line(chr(9));\nEND LOOP;\ndbms_output.put_line('Total Usuarios BD: ' || total_usuarios_bd());\nEND;\n/\n</code></pre> <pre><code>EXEC mostrar_usuarios_por_tablespace;\n</code></pre> <pre><code>Tablespace SYSTEM:\n\nSYS\nSYSTEM\nXS$NULL\nOJVMSYS\nLBACSYS\nOUTLN\nSYS$UMF\nTotal Usuarios Tablespace SYSTEM: 7\nTablespace SYSAUX:\n\nDBSNMP\nAPPQOSSYS\nDBSFWUSER\nGGSYS\nANONYMOUS\nCTXSYS\nDVSYS\nDVF\nGSMADMIN_INTERNAL\nMDSYS\nOLAPSYS\nXDB\nWMSYS\n\nTotal Usuarios Tablespace SYSAUX: 13\nTablespace UNDOTBS1:\n\nTotal Usuarios Tablespace UNDOTBS1: 0\nTablespace TEMP:\n\nTotal Usuarios Tablespace TEMP: 0\nTablespace USERS:\n\nGSMCATUSER\nMDDATA\nSYSBACKUP\nREMOTE_SCHEDULER_AGENT\nGSMUSER\nSYSRAC\nGSMROOTUSER\nSI_INFORMTN_SCHEMA\nAUDSYS\nDIP\nORDPLUGINS\nSYSKM\nORDDATA\nORACLE_OCM\nSCOTT\nSYSDG\nORDSYS\n\nTotal Usuarios Tablespace USERS: 17\nTotal Usuarios BD: 37\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-7","title":"Ejercicio 7","text":"<p>Hacer un procedimiento llamado mostrar_codigo_fuente que reciba el nombre de otro procedimiento y muestre su c\u00f3digo fuente</p> <pre><code>CREATE OR REPLACE PROCEDURE mostrar_codigo_fuente(p_procedimiento VARCHAR2)\nIS\nCURSOR c_codigo_fuente\nIS\nSELECT text\nFROM dba_source\nWHERE name = p_procedimiento;\nBEGIN\nFOR i IN c_codigo_fuente\nLOOP\ndbms_output.put_line(i.text);\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>EXEC mostrar_codigo_fuente('TOTAL_USUARIOS_BD');\n</code></pre> <pre><code>FUNCTION total_usuarios_bd\n\nRETURN NUMBER\n\nIS\n\nv_total_usuarios NUMBER;\nBEGIN\n\nSELECT COUNT(*)\nINTO v_total_usuarios\n\nFROM dba_users;\nRETURN v_total_usuarios;\nEND;\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-8","title":"Ejercicio 8","text":"<p>Hacer un procedimiento llamado mostrar_privilegios_usuario que reciba el nombre de un usuario y muestre sus privilegios de sistema y sus privilegios sobre objetos</p> <pre><code>CREATE OR REPLACE PROCEDURE mostrar_privilegios_usuario(p_usuario VARCHAR2)\nIS\nCURSOR c_privilegios_sistema\nIS\nSELECT privilege\nFROM dba_sys_privs\nWHERE grantee = p_usuario;\nCURSOR c_privilegios_objetos\nIS\nSELECT privilege, table_name\nFROM dba_tab_privs\nWHERE grantee = p_usuario;\nBEGIN\ndbms_output.put_line('El usuario recibido ha sido: ' || p_usuario);\ndbms_output.put_line(chr(9));\ndbms_output.put_line('Sus privilegios de sistema son:');\nFOR i IN c_privilegios_sistema\nLOOP\ndbms_output.put_line(i.privilege);\nEND LOOP;\ndbms_output.put_line('Sus privilegios sobre objetos son:');\nFOR i IN c_privilegios_objetos\nLOOP\ndbms_output.put_line(i.privilege || ' sobre ' || i.table_name);\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>EXEC mostrar_privilegios_usuario('SYS');\n</code></pre> <p>Output</p>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-9","title":"Ejercicio 9","text":"<p>Realiza un procedimiento PLSQL llamado listar_comisiones que nos muestre por pantalla un listado de las comisiones de los empleados agrupados seg\u00fan la localidad donde est\u00e1 ubicado su departamento.</p> <p>Hay que seguir las siguientes directrices:</p> <ul> <li>Los nombres de localidades, departamentos y empleados deben aparecer por orden alfab\u00e9tico</li> <li>Si alguno de los departamentos no tiene ning\u00fan empleado con comisiones, aparecer\u00e1 un mensaje informando de ello en lugar de la lista de empleados</li> <li>El procedimiento debe gestionar adecuadamente las siguientes excepciones:<ul> <li>La tabla Empleados est\u00e1 vac\u00eda</li> <li>Alguna comisi\u00f3n es mayor que 10000</li> </ul> </li> </ul> <pre><code>CREATE OR REPLACE PROCEDURE listar_empleados(p_deptno dept.deptno%TYPE)\nIS\nCURSOR c_empleados\nIS\nSELECT ename, comm\nFROM emp\nWHERE deptno = p_deptno\nORDER BY ename ASC;\nBEGIN\nFOR i in c_empleados\nLOOP\ndbms_output.put_line(chr(9) || chr(9) || i.ename || ' ..... ' || i.comm);\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE FUNCTION total_comms_dep(p_deptno dept.deptno%TYPE)\nRETURN NUMBER\nIS\nv_total_comms NUMBER;\nBEGIN\nSELECT NVL( SUM( NVL(comm,0) ),0 )\nINTO v_total_comms\nFROM emp\nWHERE deptno = p_deptno;\nRETURN v_total_comms;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE listar_departamentos(p_localidad dept.loc%TYPE)\nIS\nCURSOR c_departamentos\nIS\nSELECT deptno, dname\nFROM dept\nWHERE loc = p_localidad\nORDER BY dname ASC;\nBEGIN\nFOR i in c_departamentos\nLOOP\ndbms_output.put_line(chr(9) || 'Departamento: ' || i.dname);\ndbms_output.put_line(chr(9));\nIF total_comms_dep(i.deptno) = 0 THEN\ndbms_output.put_line(chr(9) || chr(9) || 'No hay ningun empleado con comisiones');\nELSE\nlistar_empleados(i.deptno);\nEND IF;\ndbms_output.put_line(chr(9));\ndbms_output.put_line(chr(9) || 'Total Comisiones en el Departamento ' || i.dname || ': ' || total_comms_dep(i.deptno));\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE FUNCTION total_comms_loc(p_loc dept.loc%TYPE)\nRETURN NUMBER\nIS\nv_total_comms NUMBER;\nBEGIN\nSELECT NVL( SUM( NVL(e.comm,0) ),0 )\nINTO v_total_comms\nFROM emp e\nINNER JOIN dept d\nON e.deptno = d.deptno\nWHERE d.loc = p_loc;\nRETURN v_total_comms;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE FUNCTION total_comms_empresa\nRETURN NUMBER\nIS\nv_total_comms NUMBER;\nBEGIN\nSELECT SUM(comm)\nINTO v_total_comms\nFROM emp;\nRETURN v_total_comms;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_excepciones\nIS\nv_emp_recs NUMBER;\nv_emp_comms NUMBER;\ne_comm_alta exception;\ne_tabla_vacia_emp exception;\nBEGIN\nSELECT COUNT(*) INTO v_emp_recs\nFROM emp;\nIF v_emp_recs = 0 THEN\nraise e_tabla_vacia_emp;\nEND IF;\nSELECT COUNT(*) INTO v_emp_comms\nFROM emp\nWHERE comm &gt; 10000;\nIF v_emp_comms &gt; 0 THEN\nraise e_comm_alta;\nEND IF;\nEXCEPTION\nWHEN e_tabla_vacia_emp THEN\nraise_application_error(-20001, 'La tabla empleados esta vacia');\nWHEN e_comm_alta THEN\nraise_application_error(-20002, 'Alguna comision es mayor que 10000');\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE listar_comisiones\nIS\nCURSOR c_localidades\nIS\nSELECT loc\nFROM dept\nORDER BY loc ASC;\nBEGIN\ncomprobar_excepciones();\nFOR i IN c_localidades\nLOOP\ndbms_output.put_line('Localidad ' || i.loc);\ndbms_output.put_line(chr(9));\nlistar_departamentos(i.loc);\ndbms_output.put_line(chr(9));\ndbms_output.put_line('Total Comisiones en la Localidad ' || i.loc || ': ' || total_comms_loc(i.loc));\ndbms_output.put_line(chr(9));\nEND LOOP;\ndbms_output.put_line('Total Comisiones en la Empresa: ' || total_comms_empresa());\nEND;\n/\n</code></pre> <pre><code>EXEC listar_comisiones;\n</code></pre> <p>Output sin excepciones:</p> <pre><code>Localidad BOSTON\n\nDepartamento: OPERATIONS\n\nNo hay ningun empleado con comisiones\n\nTotal Comisiones en el Departamento OPERATIONS: 0\nTotal Comisiones en la Localidad BOSTON: 0\nLocalidad CHICAGO\n\nDepartamento: SALES\n\nALLEN ..... 300\nBLAKE .....\n            JAMES .....\n            MARTIN ..... 1400\nTURNER ..... 0\nWARD ..... 500\nTotal Comisiones en el Departamento SALES: 2200\nTotal Comisiones en la Localidad CHICAGO: 2200\nLocalidad DALLAS\n\nDepartamento: RESEARCH\n\nNo hay ningun empleado con comisiones\n\nTotal Comisiones en el Departamento RESEARCH: 0\nTotal Comisiones en la Localidad DALLAS: 0\nLocalidad NEW YORK\n\nDepartamento: ACCOUNTING\n\nNo hay ningun empleado con comisiones\n\nTotal Comisiones en el Departamento ACCOUNTING: 0\nTotal Comisiones en la Localidad NEW YORK: 0\nTotal Comisiones en la Empresa: 2200\nPL/SQL procedure successfully completed.\n</code></pre> <p>Output con la tabla <code>emp</code> vac\u00eda:</p> <pre><code>BEGIN listar_comisiones; END;\n*\nERROR at line 1:\nORA-20001: La tabla empleados esta vacia\nORA-06512: at \"SCOTT.COMPROBAR_EXCEPCIONES\", line 21\nORA-06512: at \"SCOTT.LISTAR_COMISIONES\", line 9\nORA-06512: at line 1\n</code></pre> <p>Output con la tabla <code>emp</code> llena, pero alguna comisi\u00f3n mayor que 10000:</p> <pre><code>BEGIN listar_comisiones; END;\n*\nERROR at line 1:\nORA-20002: Alguna comision es mayor que 10000\nORA-06512: at \"SCOTT.COMPROBAR_EXCEPCIONES\", line 23\nORA-06512: at \"SCOTT.LISTAR_COMISIONES\", line 9\nORA-06512: at line 1\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-10","title":"Ejercicio 10","text":"<p>Realiza un procedimiento que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qu\u00e9 columna afectan, y en qu\u00e9 consisten exactamente</p> <pre><code>CREATE OR REPLACE FUNCTION tipo_constraint(p_tabla VARCHAR2, p_constraint VARCHAR2)\nRETURN VARCHAR2\nIS\nv_tipo_constraint VARCHAR2(20);\nBEGIN\nSELECT constraint_type\nINTO v_tipo_constraint\nFROM dba_constraints\nWHERE table_name = p_tabla AND constraint_name = p_constraint;\nRETURN v_tipo_constraint;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE mostrar_restricciones_tabla(p_tabla VARCHAR2)\nIS\nCURSOR c_restricciones\nIS\nSELECT constraint_name, column_name\nFROM dba_cons_columns\nWHERE table_name = p_tabla;\nBEGIN\ndbms_output.put_line('Las restricciones de la tabla ' || p_tabla || ' son:');\ndbms_output.put_line(chr(9));\nFOR i IN c_restricciones\nLOOP\ndbms_output.put_line('Nombre: ' || i.constraint_name || ' Tipo: ' || tipo_constraint(p_tabla,i.constraint_name) || ' Columna: ' || i.column_name);\nEND LOOP;\nEND;\n/\n</code></pre> <pre><code>EXEC mostrar_restricciones_tabla('EMP');\n</code></pre> <pre><code>Las restricciones de la tabla EMP son:\n\nNombre: PK_EMP Tipo: P Columna: EMPNO\nNombre: FK_DEPTNO Tipo: R Columna: DEPTNO\n\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-11","title":"Ejercicio 11","text":"<p>Realiza al menos dos de los ejercicios anteriores en Postgres usando PL/pgSQL.</p>"},{"location":"bd/p3-peque%C3%B1a-plsql/#pasos-previos","title":"Pasos previos","text":"<p>Descargo el script y lo renombro:</p> <pre><code>wget https://gist.githubusercontent.com/julianhyde/13b55f716060649da96d8dcad1316546/raw/1cca186e341ff58784ca37c95a2970f39a95622c/scott-sql-fiddle-postgresql.sql\nmv scott-sql-fiddle-postgresql.sql scott-postgres.sql\n</code></pre> <p>Creo la bd:</p> <pre><code>CREATE DATABASE scott;\n</code></pre> <p>Me conecto:</p> <pre><code>\\connect scott\n</code></pre> <p>Ejecuto el script para poblar la bd:</p> <pre><code>\\i /home/vagrant/scott-postgres.sql\n</code></pre> <p>Creo el usuario <code>scott</code> con contrase\u00f1a <code>tiger</code> en Debian y en PostgreSQL:</p> <pre><code>sudo adduser scott\ncreate user scott with encrypted password 'tiger';\n</code></pre> <p>Le doy los privilegios necesarios:</p> <pre><code>GRANT all privileges ON DATABASE scott TO scott;\n\\connect scott\nGRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO scott;\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-1-version-postgresql","title":"Ejercicio 1 versi\u00f3n PostgreSQL","text":"<pre><code>CREATE OR REPLACE PROCEDURE mostrar_emp_7782()\nAS $$\nDECLARE\nv_nombre emp.ename%TYPE;\nv_salario emp.sal%TYPE;\nBEGIN\nSELECT ename, sal\nINTO v_nombre, v_salario\nFROM emp\nWHERE empno = 7782;\nRAISE NOTICE 'El nombre del empleado con codigo 7782 es % y su salario es %', v_nombre, v_salario;\nEND;\n$$ LANGUAGE plpgsql;\n</code></pre> <pre><code>call mostrar_emp_7782();\n</code></pre> <pre><code>NOTICE:  El nombre del empleado con codigo 7782 es CLARK y su salario es 2450.00\nCALL\n</code></pre>"},{"location":"bd/p3-peque%C3%B1a-plsql/#ejercicio-2-version-postgresql","title":"Ejercicio 2 versi\u00f3n PostgreSQL","text":"<pre><code>CREATE OR REPLACE PROCEDURE nombre_empleado(p_empno emp.empno%TYPE)\nAS $$\nDECLARE\nv_nombre emp.ename%TYPE;\nBEGIN\nSELECT ename\nINTO v_nombre\nFROM emp\nWHERE empno = p_empno;\nRAISE NOTICE 'El nombre del empleado con codigo % es %', p_empno, v_nombre;\nEND;\n$$ LANGUAGE plpgsql;\n</code></pre> <pre><code>call nombre_empleado(7876);\n</code></pre> <pre><code>NOTICE:  El nombre del empleado con codigo 7876 es ADAMS\nCALL\n</code></pre>"},{"location":"bd/plsql/","title":"PLSQL Apuntes","text":""},{"location":"bd/plsql/#ejercicio-5","title":"Ejercicio 5","text":"<p>Recibe un nombre de usuario y devuelve su tablespace por defecto (DBA_USERS):</p> <pre><code>CREATE OR REPLACE PROCEDURE mostrar_defts(p_usuario DBA_USERS.USERNAME%TYPE)\nIS\nv_nombrets  DBA_USERS.DEFAULT_TABLESPACE%TYPE;\nBEGIN\nSELECT default_tablespace into v_nombrets\nFROM dba_users\nWHERE username = p_usuario;\ndbms_output.put_line('El usuario '||p_usuario||' usa por defecto '||vnombrets);\nEXCEPTION\nWHEN NO_DATA_FOUND THEN\ndbms_output.put_line('El usuario '||p_usuario||' no existe');\nEND mostrar_defts;\nCREATE OR REPLACE PROCEDURE principal\nIS\nBEGIN\nmostrar_defts('RAUL');\nEXCEPTION\nWHEN NO_DATA_FOUND THEN\ndbms_output.put_line('El usuario RAUL no existe');\nEND;\nLo errores se propagan para arriba\nCREATE OR REPLACE PROCEDURE mostrar_defts(p_usuario DBA_USERS.USERNAME%TYPE)\nIS\nv_nombrets  DBA_USERS.DEFAULT_TABLESPACE%TYPE;\nBEGIN\nSELECT dname, loc into v_nombrets\nFROM dba_users\nWHERE username = p_usuario;\ndbms_output.put_line('El usuario '||p_usuario||' usa por defecto '||vnombrets);\nEXCEPTION\nWHEN NO_DATA_FOUND THEN\ndbms_output.put_line('El usuario '||p_usuario||' no existe');\nEND mostrar_defts;\nCREATE OR REPLACE FUNCTION devolver_sal (p_empno emp.empno%TYPE)\nRETURN NUMBER\nIS\nv_salario emp.sal%type;\nBEGIN\nselect sal into v_salario\nFROM emp\nWHERE empno=p_empno;\nreturn v_salario;\n-- AQUI YA NO SE EJECUTA NADA\nEXCEPTION\nwhen no_data_found then\ndbms_output...\nreturn -1;\nEND devolver_sal;\nEl return es la \u00faltima sentencia que se debe ejecutar, y debe tener 1 solo return\n-- Sin FOR de cursor\nCREATE OR REPLACE PROCEDURE mostrar_empleados (p_deptno emp.empno%TYPE)\nIS\ncursor c_empleados is\nselect ename\nfrom emp\nwhere deptno=p_deptno;\nv_nomemp emp.ename%type;\ne_deptsinempleados exception;\nBEGIN\ncomprobar_excepciones(p_deptno);\nopen c_empleados;\nfetch c_empleados into v_nomemp;\nwhile c_empleados%FOUND AND c_empleados%ROWCOUNT&gt;=3 loop\nprocesar_empleado(v_nomemp);\nfetch c_empleados into v_nomemp;\nend loop;\nif c_empleados%ROWCOUNT=0 then\nraise e_deptsinempleados;\nend if;\nclose c_empleados;\nEXCEPTION\nwhen e_deptsinempleados then\ndbms_output.put_line('El departamento '||p_deptno||' no tiene empleados');\nEND;\nEstructura para leer cualquier conjunto de informaci\u00f3n:\nAbrir la fuente de informaci\u00f3n\nLeer primer dato\nMientras la lectura sea correcta\nProcesar dato\nLeer siguiente dato\nFin Mientras\nMostrar resultados o seguir con otra cosa\nfor y while para recorrer un cursor\nCREATE OR REPLACE PROCEDURE comprobar_excepciones (p_deptno dept.deptno%TYPE)\nIS\nv_hayempleados NUMBER;\nBEGIN\nselect count(*) into v_hayempleados\nfrom emp\nwhere deptno=p_deptno;\nif v_hayempleados=0 then\nraise_application_error(-20001, 'El departamento '||p_deptno||' no tiene empleados');\nend if;\nend;\nraise_application_error se considera que el programa falla, y la ejecuci\u00f3n se parar\u00e1\nraise en el bloque de excepciones se trata como un error pero la ejecuci\u00f3n sigue\ndebajo del close del cursor no se puede escribir\nfor c_empleados into v_nomemp loop\nprocesar_empleado(v_nomemp);\nend loop;\n%ROWCOUNT NO dice las l\u00edneas en total, es el n\u00famero de filas le\u00eddas hasta ese momento\n(si quieres mostrar los 3 primeros o algo as\u00ed)\nCREATE OR REPLACE PROCEDURE recorrer_empleados (p_deptno emp.empno%TYPE)\nIS\ncursor c_empleados is\nselect ename, sal, comm, deptno\nfrom emp\nwhere deptno=p_deptno;\nv_empleado c_empleados%ROWTYPE;\ne_deptsinempleados exception;\nBEGIN\ncomprobar_excepciones(p_deptno);\nfor v_empleados in c_empleados loop\nprocesar_empleado(v_empleado.ename, v_empleado.comm, v_empleado.deptno);\nend loop;\nEND;\nCREATE OR REPLACE PROCEDURE procesar_empleados (p_emp varchar2)\ncon el for no hay fetch\ncapturar la excepci\u00f3n es ponerle un when\nTipos de excepciones, con nombre o sin nombre ora-12560\nexception\nwhen others then\ncase sqlcode\nwhen -2292 then\n...\nwhen -12768 then\nasds\nlo \u00faltimo que va a haber en el bloque de exception\nupdate y tal no levanta excepciones tengo que hacer sql not found\n</code></pre>"},{"location":"bd/plsql/#triggers","title":"Triggers","text":"<p>Before: alg\u00fan tipo de comprobaci\u00f3n sobre inserci\u00f3n de datos...etc</p> <p>Vista actualizable: si contiene todos los campos obligatorios de las tablas con las que se cre\u00f3 la vista</p> <p>Eventos que hacen ejecutar un trigger: Insert, update, delete, combinaci\u00f3n</p> <p>Tipos de dispario:</p> <ul> <li>Por sentencia: impedir que alguien meta cosa a partir de las 15:00 (los datos a insertar no son importantes)</li> <li>Por fila: </li> </ul> <p>No pueden haber commits y rollback en los triggers</p> <pre><code>select 'HOLA '||ename\nfrom emp;\nselect 'CREATE USER '||ename||'IDENTIFIED BY '||ename||';'\nfrom emp\n</code></pre> <p>Triggers de sistema: after logon, before logoff, insert...</p>"},{"location":"bd/plsql/#21112022","title":"21/11/2022","text":"<p>Si quiero que un usuario s\u00f3lo pueda ver determinadas filas de una tabla, tengo que crear una vista con las filas que quiero que vea. Sobre esa tabla le doy permisos de select a ese usuario.</p>"},{"location":"bd/plsql/#07122022","title":"07/12/2022","text":"<pre><code>TYPE TipoRegEmples IS RECORD (\nempno emp.empno%TYPE,\nename emp.ename%TYPE,\nsal emp.sal%TYPE,\ncomm emp.comm%TYPE,\ndeptno emp.deptno%TYPE\n);\nregistroempleado TipoRegEmpleado;\n</code></pre> <p>Es lo mismo que %ROWTYPE pero sin hacerlo. Declaras el tipo de dato con todos los campos. Lo que pasa es que es menos autom\u00e1tico</p> <p>Una lista enlazada quiere decir que no se guardan todos los elementos a la vez, en memoria se guarda el sitio para lo que se usa, y cuando se usa otro elemento se guarda en otro lugar no contiguo de memoria. Como no son contiguos, es din\u00e1mico en tiempo de ejecuci\u00f3n, se enlazan con punteros.</p> <pre><code>TYPE TipoTablaNombresEmpleados IS TABLE OF emp.ename%TYPE\nINDEX BY BINARY_INTEGER;\nTYPE TipoTabCadenas IS TABLE OF VARCHAR2\nINDEX BY BINARY_INTEGER;\nv_Tab1 TipoTabCadenas;\nv_Tab2 TipoTablaNombresEmpleados;\nv_Tab1(8):='PEPE';\nIf v_tab1.EXISTS(7)\n</code></pre> <p>Si se intenta ver un elemento del array que no existe levanta %NO_DATA_FOUND</p> <p>Un paquete es un conjunto de librer\u00edas, que contiene funciones</p> <p>Las variables en los paquetes son globales digamos, se pueden usar por ejemplo con triggers porque no pueden recibir par\u00e1metros</p> <p>Ejemplos de paquetes de f\u00e1brica de Oracle:</p> <ul> <li>DBMS_STANDARD</li> <li>DBMS_OUTPUT</li> <li>DBMS_MAIL</li> <li>DBMS_SQL</li> <li>DBMS_JOB</li> <li>DBMS_SESSION</li> <li>DBMS_HTML</li> </ul> <p>PROBLEMA DE LAS TABLAS MUTANTES</p> <p>Para probar triggers de tablas mutantes hay que hacer INSERT de m\u00e1s de una fila (insert into select y que esa select haga saltar la restricci\u00f3n)</p>"},{"location":"bd/prueba-inicial/","title":"Prueba inicial","text":""},{"location":"bd/prueba-inicial/#sobre-oracle","title":"Sobre Oracle","text":""},{"location":"bd/prueba-inicial/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear la tabla Alumnos de la siguiente manera:</p> <ul> <li>DNI: formato 99.999.999-X</li> <li>Nombre: inicial may\u00fasculas</li> <li>Apellido: inicial may\u00fasculas</li> <li>Correo: formato xxxx@xxxx.com o xxxx@xxxx.es</li> </ul> <p>A\u00f1adir registros</p> <pre><code>CREATE TABLE Alumnos (\nDNI char(12),\nNombre varchar2(50),\nApellido varchar2(50),\nCorreo varchar2(50),\nCHECK (REGEXP_LIKE(DNI,'^[0-9][0-9].[0-9][0-9][0-9].[0-9][0-9][0-9]-[A-Z]$')),\nCHECK (REGEXP_LIKE(Nombre,'^[A-Z][a-z]*$')),\nCHECK (REGEXP_LIKE(Apellido,'^[A-Z][a-z]*$')),\nCHECK (REGEXP_LIKE(Correo,'*@*.com') OR REGEXP_LIKE(Correo,'*@*.es')),\nPRIMARY KEY(DNI)\n);\n</code></pre> <p></p> <pre><code>INSERT INTO Alumnos (DNI, Nombre, Apellido, Correo)\nVALUES ('12.345.678-A', 'Paco', 'Ramos', 'paco@paco.es');\nINSERT INTO Alumnos (DNI, Nombre, Apellido, Correo)\nVALUES ('12.345.678-B', 'Jose', 'Josefez', 'jose@jose.com');\n</code></pre> <p></p>"},{"location":"bd/prueba-inicial/#ejercicio-2","title":"Ejercicio 2","text":"<p>Mostrar los alumnos cuyo apellido empieza por R y su correo est\u00e1 en un dominio .es</p> <pre><code>SELECT *\nFROM Alumnos\nWHERE Apellido LIKE 'R%' AND Correo LIKE '%.es';\n</code></pre> <p></p>"},{"location":"bd/prueba-inicial/#ejercicio-3","title":"Ejercicio 3","text":"<p>Crear la tabla Notas de la siguiente manera:</p> <ul> <li>DNI: clave ajena de Alumnos</li> <li>M\u00f3dulo: ABD, SAD, Servicios o Sistemas</li> <li>Nota: 0 al 10</li> </ul> <p>A\u00f1adir registros</p> <pre><code>CREATE TABLE Notas (\nDNI char(12),\nModulo varchar2(50),\nNota NUMBER(2),\nCONSTRAINT fk_DNI\nFOREIGN KEY (DNI)\nREFERENCES Alumnos(DNI),\nCHECK (Modulo IN ('ABD','SAD','Servicios','Sistemas')),\nCHECK (Nota BETWEEN 0 AND 10)\n);\n</code></pre> <p></p> <pre><code>INSERT INTO Notas (DNI, Modulo, Nota)\nVALUES ('12.345.678-A', 'ABD', '8');\nINSERT INTO Notas (DNI, Modulo, Nota)\nVALUES ('12.345.678-A', 'SAD', '9');\nINSERT INTO Notas (DNI, Modulo, Nota)\nVALUES ('12.345.678-A', 'Servicios', '10');\nINSERT INTO Notas (DNI, Modulo, Nota)\nVALUES ('12.345.678-A', 'Sistemas', '10');\nINSERT INTO Notas (DNI, Modulo, Nota)\nVALUES ('12.345.678-B', 'Servicios', '5');\n</code></pre> <p></p>"},{"location":"bd/prueba-inicial/#ejercicio-4","title":"Ejercicio 4","text":"<p>Mostrar los alumnos con m\u00e1s de 3 notas superiores a 7</p> <pre><code>SELECT DNI, COUNT(*) \"Notas &gt; 7\"\nFROM Notas\nWHERE Nota &gt; 7\nGROUP BY DNI\nHAVING COUNT(*) &gt; 3;\n</code></pre>"},{"location":"bd/prueba-inicial/#ejercicio-5","title":"Ejercicio 5","text":"<p>Hacer un procedimiento PL/SQL que:</p> <ul> <li>Reciba un DNI y muestre por pantalla todas sus notas</li> <li>Tenga las excepciones: Alumno Inexistente, Alumno sin Notas</li> </ul> <p>A\u00f1ado el procedimiento:</p> <pre><code>CREATE OR REPLACE PROCEDURE NOTAS_POR_DNI\n(\nv_dni IN char\n) AS\nCURSOR c_notas IS\nSELECT * FROM Notas\nWHERE DNI = v_dni;\nv_reg_cursor c_notas%ROWTYPE;\nv_contador1 number(1);\nv_contador2 number(1);\nBEGIN\nSELECT count(*)\nINTO v_contador1\nFROM Alumnos\nWHERE DNI = v_dni;\nSELECT count(*)\nINTO v_contador2\nFROM Notas\nWHERE DNI = v_dni;\nIF v_contador1 = 0 THEN\nRAISE_APPLICATION_ERROR(-20000, 'No existe un alumno con DNI ' || v_dni);\nELSIF v_contador2 = 0 THEN\nRAISE_APPLICATION_ERROR(-20001, 'No existen notas para el alumno con DNI ' || v_dni);\nELSE\nOPEN c_notas;\nFETCH c_notas INTO v_reg_cursor;\nWHILE c_notas%FOUND LOOP\nDBMS_OUTPUT.PUT_LINE( 'El alumno con DNI ' || v_reg_cursor.DNI || ' ha sacado una nota de ' || v_reg_cursor.Nota || ' en el m\u00f3dulo ' || v_reg_cursor.Modulo);\nFETCH c_notas INTO v_reg_cursor;\nEND LOOP;\nCLOSE c_notas;\nEND IF;\nEND NOTAS_POR_DNI;\n/\n</code></pre> <p></p> <p>Activo las salidas de mensajes:</p> <pre><code>SET SERVEROUTPUT ON\n</code></pre> <p>Para ejecutar el procedimiento pidiendo el DNI tengo que ejecutar lo siguiente:</p> <pre><code>BEGIN\nNOTAS_POR_DNI('&amp;dni');\nEND;\n/\n</code></pre> <p>Notas de un alumno existente:</p> <p></p> <p>Notas de un alumno inexistente:</p> <p></p> <p>Alumno sin notas:</p> <p></p>"},{"location":"bd/prueba-inicial/#sobre-mongodb","title":"Sobre MongoDB","text":""},{"location":"bd/prueba-inicial/#ejercicio-6","title":"Ejercicio 6","text":"<p>Crear la colecci\u00f3n <code>productos</code> con varios documentos que contengan:</p> <ul> <li>Nombre</li> <li>Precio</li> </ul> <p>Creo la colecci\u00f3n:</p> <pre><code>db.createCollection(\"productos\")\n</code></pre> <p></p> <p>La muestro:</p> <p></p> <p>Inserto los documentos:</p> <pre><code>db.productos.insertMany( [\n{ nombre: \"Tomate\", precio: 5 },\n{ nombre: \"Yogurt\", precio: 21 }\n] )\n</code></pre> <p></p> <p>Los muestro:</p> <p></p>"},{"location":"bd/prueba-inicial/#ejercicio-7","title":"Ejercicio 7","text":"<p>Muestra los documentos correspondientes a productos cuyo precio sea superior a 20</p> <pre><code>db.productos.find(\n{ precio: {$gt:20} }\n)\n</code></pre> <p></p>"},{"location":"c1/describing-place-essay/","title":"Rotterdam City Center","text":"<p>Would you be able to recover after a complete destruction of your city? Well, I am going to write about Rotterdam, the city that was renovated after the German bombardment. Instead of just moving to another place, the people took this as an opportunity to become a better version of what they were.</p> <p></p> <p>Firstly, I will write about Het Park. This place is usually tranquil, despite being set in the centre of Rotterdam. Of course you can find people in there, but Dutch people tend to be quiet. For me, the best place in the park is the tulip garden, which is very spacious and has magnificent flowers.</p> <p></p> <p>Secondly, we are going to easily find the Euromast tower by Het Park. It is made of concrete, and it's in the ranking of 100-200 meters tall towers worldwide. If we get to the top, we are able to see the most part of the city centre. No need to say that the views on the top are quite picturesque.</p> <p></p> <p>Thirdly, just by walking a few minutes we can get to the Maastunnel. It was constructed in 1942, and its main function is to connect the banks of the Nieuwe Maas river, which is one of the most important rivers in Rotterdam.</p> <p></p> <p>To sump up, I'd say for sure that Rotterdam is a great city for visiting. In addition, if you are a city dweller, you are going to fall in love with it because it's all about industries and technology. And if you want to get even more out of this city, you should learn its history, full of twists and turns.</p> <p></p>"},{"location":"c1/injustice-case-outline/","title":"Richard Phillips (born in Michigan)","text":"<ul> <li> <p>Former autoworker</p> </li> <li> <p>He was 27 years old when he was imprisoned for a fatal shooting in Detroit in 1971 </p> </li> <li> <p>He spent 45 years behind bars for a crime he didn\u2019t commit</p> </li> <li> <p>He was sentenced to life without parole</p> </li> <li> <p>Longest wrongfully convicted person has ever served in America</p> </li> <li> <p>He is now 73  </p> </li> </ul>"},{"location":"c1/injustice-case-outline/#life-in-prison","title":"Life in prison","text":"<ul> <li> <p>Phillips maintained his innocence during more than four decades in prison</p> </li> <li> <p>Philips quote: \u201cI would rather die in prison than to admit to something that I didn\u2019t do\"</p> </li> <li> <p>Philips painted pictures, and then sold them In order to support himself as he waited for officials to determine his restitution</p> </li> </ul>"},{"location":"c1/injustice-case-outline/#about-money","title":"About money","text":"<p>In Michigan, exonerees can receive $50,000/year spent in prison \u2014 meaning Phillips stood to collect more than $2 million.</p> <p>BUT He is only received 30 years\u2019 worth of restitution ($1.5 million payout) because he was serving a concurrent sentence for a separate armed robbery conviction.</p> <p>BUT His lawyers claim he was wrongfully convicted in that case, too, but prosecutors haven\u2019t acquitted him.</p>"},{"location":"c1/injustice-case-outline/#the-truth","title":"The truth","text":"<ul> <li> <p>University of Michigan\u2019s Innocence Clinic took up his case</p> </li> <li> <p>They found that a co-defendant told the parole board in 2010 that Phillips had no role in the slaying</p> </li> <li> <p>They declared him the longest-imprisoned innocent man in America</p> </li> <li> <p>He was exonerated in 2018</p> </li> <li> <p>The case prosecutors now say was \u201cbased almost entirely\u201d on false testimony from one witness.</p> </li> </ul>"},{"location":"c1/injustice-case-outline/#conclusion","title":"Conclusion","text":"<p>Law experts say that:</p> <p>\u201cRe-entering society is profoundly difficult for wrongfully convicted individuals, so we have an obligation to provide compassionate compensation to these men for the harm they suffered\u201d</p>"},{"location":"c1/injustice-case-outline/#relevant-vocabulary-and-expressions","title":"Relevant vocabulary and expressions","text":"<ul> <li>Former = ex, antiguo</li> <li>Autoworker = trabajador de la industria automotriz, vehicle manufacturing worker</li> <li>Imprisoned = encarcelado, imprison [sb], put in prison</li> <li>Fatal = something that causes death or that leads to failure or disaster, letal, causing deaths</li> <li>Shooting = tiroteo, gun crime (offences involving firearms)</li> <li>Behind bars = in prison, tras las rejas</li> <li>Life without parole = this term is defined as a person spending the rest of his/her life in prison. This means that the criminal sentence does not include an option for parole. A Parole allows an individual to leave prison or jail after serving only a portion of their total sentence.</li> <li>Serve = cumplir (condena), spend time in prison </li> <li>Admit to = admitir, confess to a crime </li> <li>Support = financiar</li> <li>Restitution = indemnizaci\u00f3n, compensaci\u00f3n</li> <li>Official = government employee, funcionario</li> <li>Exonerees = a person who is shown to be not guilty of a crime for which he or she was formerly found guilty</li> <li>Payout = paga, amount paid as compensation</li> <li>Armed robbery = robo a mano armada, crime: theft with a weapon</li> <li>Claim = asegurar</li> <li>Prosecutor = fiscal, abogado de la acusaci\u00f3n</li> <li>Acquit = absolver a, exonerar a, pronounce not guilty</li> <li>Take up = aceptar una oferta, un reto</li> <li>Co-defendant = codemandado</li> <li>Parole board = a panel (committee, group with task) of people who decide whether an offender should be released from prison on parole after serving at least a minimum portion of their sentence as prescribed by the sentencing judge</li> <li>Have no role = no intervino</li> <li>Exonerate = exonerar, liberar, absolver, clear from blame, free from responsibility</li> <li>Compassionate = compasivo, por compasi\u00f3n</li> <li>Compensation = same as payout</li> <li>Obligation = obligaci\u00f3n, responsabilidad, moral requirement</li> </ul>"},{"location":"c1/leisure-time-meaningless-activities/","title":"Essay: Most people fill their leisure time with meaningless activities. Do you agree?","text":"<p>Indeed, I agree with the statement that nowadays a lot of people fill their leisure time with activities that will lead them to nowhere.</p> <p>One of the main reasons why we as humans do activities, is because we need to feel useful doing something and we need to get a reward from doing it. This reward is the satisfaction of having achieved something, and this satisfaction will lead us to feel happy, which is our main reason for staying alive.</p> <p>That's right, we live for improving and being happy.</p> <p>So with that being said, I think that it's understandable what is happening nowadays, because we have a lot of to do in the Internet to get distracted with. Yes, I am referring to social media websites, apps, video games and so on.</p> <p>This little things will give us continuous little bursts of satisfaction, and this is the main reason why average people currently surf the internet and play online games, and in the future they'll keep doing it.</p> <p>You could say that just like the criminal and drug underworld, it also exists a virtual one in the Internet, where simply, all is different than in real life, and a lot of people live inside bubbles. Actually there's a term in japanese, \"hikikomori\", which refers to people who live inside these bubbles, just playing games, watching anime, and having no social interactions.</p> <p>As a conclusion, I have to say that the Internet is an important double-edged sword. If you get carried along by it for too much time, it can be bad for you. Most of the things we can do will make us feel satisfied, but they won't give us any real benefits in the long term.</p> <p>For all these reasons, it's in our hands how we use the Internet.</p> <p></p>"},{"location":"hlc/ejercicio1-minikube-kubectl/","title":"Ejercicio 1: Instalaci\u00f3n y configuraci\u00f3n de minikube y kubectl","text":"<p>Documentaci\u00f3n del curso</p>"},{"location":"hlc/ejercicio1-minikube-kubectl/#parte-1","title":"Parte 1","text":"<p>Descargo el binario:</p> <pre><code>sudo apt update\nsudo apt install curl\ncurl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64\n</code></pre> <p>Instalo el binario en una ruta disponible en el PATH:</p> <pre><code>sudo install minikube-linux-amd64 /usr/local/bin/minikube\n</code></pre> <p>Compruebo que funciona:</p> <pre><code>vagrant@k1:~$ minikube version\nminikube version: v1.29.0\ncommit: ddac20b4b34a9c8c857fc602203b6ba2679794d3\n</code></pre>"},{"location":"hlc/ejercicio1-minikube-kubectl/#parte-2","title":"Parte 2","text":"<p>Necesito KVM para usar minikube y que se pueda crear y controlar la VM con Kubernetes:</p> <pre><code>sudo apt install qemu-kvm libvirt-clients libvirt-daemon-system bridge-utils virtinst libvirt-daemon\nsudo usermod -a -G libvirt $(whoami)\nnewgrp libvirt\n</code></pre>"},{"location":"hlc/ejercicio1-minikube-kubectl/#parte-3","title":"Parte 3","text":"<p>Lanzo minikube usando KVM:</p> <pre><code>minikube start --driver=kvm2\n</code></pre> <p>Puedo ver el estado:</p> <pre><code>vagrant@k1:~$ minikube status\nminikube\ntype: Control Plane\nhost: Running\nkubelet: Running\napiserver: Running\nkubeconfig: Configured\n</code></pre>"},{"location":"hlc/ejercicio1-minikube-kubectl/#parte-4","title":"Parte 4","text":"<p>Instalo el cliente de Kubernetes con snap, para tener la versi\u00f3n m\u00e1s actualizada:</p> <pre><code>sudo apt install snapd\nsudo snap install kubectl --classic\n</code></pre> <p>Compruebo que funciona, pero a\u00fan no est\u00e1 conectado con minikube:</p> <pre><code>vagrant@k1:~$ kubectl version\nWARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output=yaml|json to get the full version.\nClient Version: version.Info{Major:\"1\", Minor:\"26\", GitVersion:\"v1.26.1\", GitCommit:\"8f94681cd294aa8cfd3407b8191f6c70214973a4\", GitTreeState:\"clean\", BuildDate:\"2023-01-19T02:26:55Z\", GoVersion:\"go1.19.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\nKustomize Version: v4.5.7\nUnable to connect to the server: dial tcp 192.168.39.129:8443: connect: no route to host\n</code></pre> <p>Reinicio minikube para que reconfigure kubectl:</p> <pre><code>vagrant@k1:~$ minikube stop\n\u270b  Stopping node \"minikube\"  ...\n\ud83d\uded1  1 node stopped.\nvagrant@k1:~$ minikube start\n\ud83d\ude04  minikube v1.29.0 on Debian 11.6 (kvm/amd64)\n\u2728  Using the kvm2 driver based on existing profile\n\ud83d\udc4d  Starting control plane node minikube in cluster minikube\n\ud83d\udd04  Restarting existing kvm2 VM for \"minikube\" ...\n\ud83d\udc33  Preparing Kubernetes v1.26.1 on Docker 20.10.23 ...\n\ud83d\udd17  Configuring bridge CNI (Container Networking Interface) ...\n\ud83d\udd0e  Verifying Kubernetes components...\n    \u25aa Using image gcr.io/k8s-minikube/storage-provisioner:v5\n\ud83c\udf1f  Enabled addons: default-storageclass, storage-provisioner\n\ud83c\udfc4  Done! kubectl is now configured to use \"minikube\" cluster and \"default\" namespace by default\n</code></pre> <p>Compruebo que ya s\u00ed funciona el cliente completamente, y que est\u00e1 conectado con minikube:</p> <pre><code>vagrant@k1:~$ kubectl version\nWARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output=yaml|json to get the full version.\nClient Version: version.Info{Major:\"1\", Minor:\"26\", GitVersion:\"v1.26.1\", GitCommit:\"8f94681cd294aa8cfd3407b8191f6c70214973a4\", GitTreeState:\"clean\", BuildDate:\"2023-01-19T02:26:55Z\", GoVersion:\"go1.19.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\nKustomize Version: v4.5.7\nServer Version: version.Info{Major:\"1\", Minor:\"26\", GitVersion:\"v1.26.1\", GitCommit:\"8f94681cd294aa8cfd3407b8191f6c70214973a4\", GitTreeState:\"clean\", BuildDate:\"2023-01-18T15:51:25Z\", GoVersion:\"go1.19.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n</code></pre> <p>Podemos ver los nodos de Kubernetes:</p> <pre><code>vagrant@k1:~$ kubectl get nodes\nNAME       STATUS   ROLES           AGE   VERSION\nminikube   Ready    control-plane   57m   v1.26.1\n</code></pre> <p>Para activar el autocompletado:</p> <pre><code>echo 'source &lt;(kubectl completion bash)' &gt;&gt;~/.bashrc\nsource ~/.bashrc\n</code></pre>"},{"location":"hlc/ejercicio1-minikube-kubectl/#comprobaciones-finales","title":"Comprobaciones finales","text":"<pre><code>vagrant@k1:~$ minikube status\nminikube\ntype: Control Plane\nhost: Running\nkubelet: Running\napiserver: Running\nkubeconfig: Configured\n</code></pre> <pre><code>vagrant@k1:~$ kubectl get nodes -o wide\nNAME       STATUS   ROLES           AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE               KERNEL-VERSION   CONTAINER-RUNTIME\nminikube   Ready    control-plane   13h   v1.26.1   192.168.39.129   &lt;none&gt;        Buildroot 2021.02.12   5.10.57          docker://20.10.23\n</code></pre>"},{"location":"hlc/practica-virtualizacion/","title":"Pr\u00e1ctica: Virtualizaci\u00f3n en Linux","text":""},{"location":"hlc/practica-virtualizacion/#entrega","title":"Entrega","text":""},{"location":"hlc/practica-virtualizacion/#parte-1","title":"Parte 1","text":"<p>URL del repositorio GitHub</p> <p>https://github.com/adriasir123/script-virtualizacion</p>"},{"location":"hlc/practica-virtualizacion/#parte-2","title":"Parte 2","text":"<p>Indicar los pasos para crear la imagen base</p> <p>En el siguiente apartado se explica.</p>"},{"location":"hlc/practica-virtualizacion/#parte-3","title":"Parte 3","text":"<p>Entregar la clave privada y un enlace para descargar la imagen base</p> <p>Todo se encuentra en el repositorio.</p>"},{"location":"hlc/practica-virtualizacion/#parte-4","title":"Parte 4","text":"<p>Ejecutar el script y cuando se pause mostrar captura accediendo al servidor web de maquina1</p> <p></p>"},{"location":"hlc/practica-virtualizacion/#parte-5","title":"Parte 5","text":"<p>Mostrar captura accediendo al servidor web con la IP p\u00fablica al terminar el script</p> <p></p>"},{"location":"hlc/practica-virtualizacion/#parte-6","title":"Parte 6","text":"<p>Mostrar captura del disco montado en /var/www/html</p> <p></p> <p>Mostrar captura de los 2G de RAM que tiene la m\u00e1quina</p> <p></p> <p>Mostrar captura accediendo al contenedor</p> <p></p> <p>Mostrar captura de la snapshot creada</p> <p></p>"},{"location":"hlc/practica-virtualizacion/#creacion-de-imagen-base","title":"Creaci\u00f3n de imagen base","text":""},{"location":"hlc/practica-virtualizacion/#redes","title":"Redes","text":"<p>Creo el fichero:</p> <pre><code>nano red-script-1.xml\n</code></pre> <p>Con el contenido:</p> <pre><code>&lt;network&gt;\n  &lt;name&gt;red-script-1&lt;/name&gt;\n  &lt;bridge name='virbr-script-1'/&gt;\n  &lt;forward/&gt;\n  &lt;ip address='192.168.123.1' netmask='255.255.255.0'&gt;\n    &lt;dhcp&gt;\n      &lt;range start='192.168.123.2' end='192.168.123.254'/&gt;\n    &lt;/dhcp&gt;\n  &lt;/ip&gt;\n&lt;/network&gt;\n</code></pre> <p>Creo la red <code>red-script-1</code>:</p> <pre><code>virsh -c qemu:///system net-define red-script-1.xml\n</code></pre> <p>Creo el fichero:</p> <pre><code>nano red-script-2.xml\n</code></pre> <p>Con el contenido:</p> <pre><code>&lt;network&gt;\n  &lt;name&gt;red-script-2&lt;/name&gt;\n  &lt;bridge name='virbr-script-2'/&gt;\n  &lt;forward/&gt;\n  &lt;ip address='192.168.124.1' netmask='255.255.255.0'&gt;\n    &lt;dhcp&gt;\n      &lt;range start='192.168.124.2' end='192.168.124.254'/&gt;\n    &lt;/dhcp&gt;\n  &lt;/ip&gt;\n&lt;/network&gt;\n</code></pre> <p>Creo la red <code>red-script-2</code>:</p> <pre><code>virsh -c qemu:///system net-define red-script-2.xml\n</code></pre> <p>Las inicio:</p> <pre><code>virsh -c qemu:///system net-start red-script-1\nvirsh -c qemu:///system net-start red-script-2\n</code></pre>"},{"location":"hlc/practica-virtualizacion/#vm","title":"VM","text":"<pre><code>virt-install --connect qemu:///system \\\n--virt-type kvm \\\n--name bullseye-base \\\n--cdrom ~/isos/debian-11.5.0-amd64-netinst.iso \\\n--os-variant debian10 \\\n--network network=red-script-1 \\\n--network network=red-script-2 \\\n--disk size=3 \\\n--memory 2048 \\\n--vcpus 2\n</code></pre>"},{"location":"hlc/practica-virtualizacion/#sistema-de-ficheros","title":"Sistema de ficheros","text":""},{"location":"hlc/practica-virtualizacion/#interfaces","title":"Interfaces","text":"<p>A\u00f1ado las siguientes l\u00edneas a <code>/etc/network/interfaces</code>:</p> <pre><code>nano /etc/network/interfaces\n</code></pre> <pre><code># The secondary network interface\nallow-hotplug enp2s0\niface enp2s0 inet dhcp\n</code></pre>"},{"location":"hlc/practica-virtualizacion/#usuario","title":"Usuario","text":"<p>Hacer que el usuario <code>debian</code> con contrase\u00f1a debian utilice sudo sin contrase\u00f1a</p> <p>Sigo estas \u00f3rdenes:</p> <pre><code>su -\napt install sudo\nusermod -aG sudo debian\nvisudo\n</code></pre> <p>Al final del fichero a\u00f1ado:</p> <pre><code>debian ALL=(ALL) NOPASSWD:ALL\n</code></pre>"},{"location":"hlc/practica-virtualizacion/#ssh","title":"SSH","text":"<p>Crear un keypair ssh de formato ecdsa sin passphrase</p> <pre><code>ssh-keygen -t ecdsa\n</code></pre> <p>Insertar la clave p\u00fablica al usuario debian</p> <pre><code>ssh-copy-id -i script.pub debian@192.168.123.49\n</code></pre> <p>Probar el acceso</p> <pre><code>ssh -i script debian@192.168.123.49\n</code></pre>"},{"location":"hlc/practica-virtualizacion/#reinicio","title":"Reinicio","text":"<pre><code>reboot\n</code></pre>"},{"location":"hlc/practica-virtualizacion/#reduccion-de-imagen-base","title":"Reducci\u00f3n de imagen base","text":"<p>Utilizar <code>virt-sparsify</code> para reducir el tama\u00f1o de la imagen</p> <p>Tengo que tener la m\u00e1quina parada:</p> <pre><code>virsh -c qemu:///system destroy bullseye-base\n</code></pre> <p>Muevo el fichero de disco al directorio necesario:</p> <pre><code>sudo mv /var/lib/libvirt/images/bullseye-base.qcow2  ~/script-virtualizacion\n</code></pre> <p>Modifico propietarios:</p> <pre><code>sudo chown atlas:atlas bullseye-base.qcow2\n</code></pre> <p>Reduzco la imagen:</p> <pre><code>virt-sparsify bullseye-base.qcow2 bullseye-base-sparse.qcow2\n</code></pre> <p>Ya puedo borrar la m\u00e1quina:</p> <pre><code>virsh -c qemu:///system undefine bullseye-base\n</code></pre> <p>Y la imagen original:</p> <pre><code>rm bullseye-base.qcow2\n</code></pre>"},{"location":"hlc/practica-virtualizacion/#script","title":"Script","text":"<p>Se encuentra en este repositorio, y all\u00ed encontrar\u00e1s tambi\u00e9n el enlace para descargar la imagen base sparse.</p> <p>Aqu\u00ed puedes ver el output completo del script cuando no hay nada creado.</p> <p>Aqu\u00ed puedes ver el output completo del script cuando todo est\u00e1 creado.</p>"},{"location":"hlc/taller1-cliente-vpn/","title":"Taller 1: Configuraci\u00f3n del cliente VPN","text":""},{"location":"hlc/taller1-cliente-vpn/#entregas","title":"Entregas","text":""},{"location":"hlc/taller1-cliente-vpn/#parte-1","title":"Parte 1","text":"<p>IP de <code>tun0</code>:</p> <p></p> <p>Ruta a 172.22.0.0/16:</p> <p></p> <p>Ping a la puerta de enlace:</p> <p></p>"},{"location":"hlc/taller1-cliente-vpn/#parte-2","title":"Parte 2","text":"<p><code>/etc/hosts</code>:</p> <p></p> <p>Acceso a <code>openstack.gonzalonazareno.org</code> desde casa:</p> <p></p>"},{"location":"hlc/taller1-cliente-vpn/#realizacion","title":"Realizaci\u00f3n","text":""},{"location":"hlc/taller1-cliente-vpn/#generacion-de-clave-privada","title":"Generaci\u00f3n de clave privada","text":"<pre><code>sudo sh -c 'openssl genrsa 4096 &gt; /etc/ssl/private/olympus.key'\n</code></pre> <p>Modifico permisos:</p> <pre><code>sudo chmod 600 /etc/ssl/private/olympus.key\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#creacion-de-csr","title":"Creaci\u00f3n de csr","text":"<pre><code>sudo openssl req -new -key /etc/ssl/private/olympus.key -out /root/olympus.csr\n</code></pre> <p>Introduzco los siguientes valores exactos en el certificado:</p> <p></p> <p>Lo copio en mi home:</p> <pre><code>sudo cp /root/olympus.csr ~\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#paso-de-csr","title":"Paso de csr","text":"<p>Lo subo aqu\u00ed: https://dit.gonzalonazareno.org/gestiona/cert/</p> <p></p>"},{"location":"hlc/taller1-cliente-vpn/#descarga-de-mi-crt","title":"Descarga de mi crt","text":"<p>Lo muevo al directorio correcto:</p> <pre><code>sudo mv ~/Downloads/olympus.crt /etc/openvpn\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#descarga-del-crt-de-la-ca","title":"Descarga del crt de la CA","text":"<p>Lo descargo aqu\u00ed: https://dit.gonzalonazareno.org/gestiona/info/documentacion/ca</p> <p>Lo muevo al directorio correcto:</p> <pre><code>sudo mv ~/Downloads/gonzalonazareno.crt /etc/ssl/certs\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#instalacion-de-openvpn","title":"Instalaci\u00f3n de OpenVPN","text":"<pre><code>sudo apt install openvpn\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#configuracion-de-openvpn","title":"Configuraci\u00f3n de OpenVPN","text":"<p>Creo el siguiente fichero:</p> <pre><code>sudo nano /etc/openvpn/client.conf </code></pre> <p>Con contenido:</p> <pre><code>dev tun\nremote sputnik.gonzalonazareno.org\nifconfig 172.23.0.0 255.255.255.0\npull\nproto tcp-client\ntls-client\n# remote-cert-tls server\nca /etc/ssl/certs/gonzalonazareno.crt\ncert /etc/openvpn/olympus.crt\nkey /etc/ssl/private/olympus.key\ncomp-lzo\nkeepalive 10 60\nlog /var/log/openvpn-sputnik.log\nverb 1\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#reinicio-de-openvpn","title":"Reinicio de OpenVPN","text":"<pre><code>sudo systemctl restart openvpn\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#comprobaciones","title":"Comprobaciones","text":"<p>T\u00fanel creado:</p> <p></p> <p>Ruta a\u00f1adida:</p> <p></p> <p>Log:</p> <pre><code> atlas@olympus \ue0b0 ~ \ue0b0 sudo cat /var/log/openvpn-sputnik.log\n2022-11-17 16:35:55 --cipher is not set. Previous OpenVPN version defaulted to BF-CBC as fallback when cipher negotiation failed in this case. If you need this fallback please add '--data-ciphers-fallback BF-CBC' to your configuration and/or add BF-CBC to --data-ciphers.\n2022-11-17 16:35:55 OpenVPN 2.5.1 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on May 14 2021\n2022-11-17 16:35:55 library versions: OpenSSL 1.1.1n  15 Mar 2022, LZO 2.10\n2022-11-17 16:35:55 WARNING: using --pull/--client and --ifconfig together is probably not what you want\n2022-11-17 16:35:55 WARNING: No server certificate verification method has been enabled.  See http://openvpn.net/howto.html#mitm for more info.\n2022-11-17 16:35:55 TCP/UDP: Preserving recently used remote address: [AF_INET]5.39.73.79:1194\n2022-11-17 16:35:55 Attempting to establish TCP connection with [AF_INET]5.39.73.79:1194 [nonblock]\n2022-11-17 16:35:55 TCP connection established with [AF_INET]5.39.73.79:1194\n2022-11-17 16:35:55 TCP_CLIENT link local: (not bound)\n2022-11-17 16:35:55 TCP_CLIENT link remote: [AF_INET]5.39.73.79:1194\n2022-11-17 16:35:55 [sputnik.gonzalonazareno.org] Peer Connection Initiated with [AF_INET]5.39.73.79:1194\n2022-11-17 16:35:56 TUN/TAP device tun0 opened\n2022-11-17 16:35:56 net_iface_mtu_set: mtu 1500 for tun0\n2022-11-17 16:35:56 net_iface_up: set tun0 up\n2022-11-17 16:35:56 net_addr_ptp_v4_add: 172.29.0.50 peer 172.29.0.49 dev tun0\n2022-11-17 16:35:56 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this\n2022-11-17 16:35:56 Initialization Sequence Completed\n</code></pre>"},{"location":"hlc/taller1-cliente-vpn/#ajustes-finales","title":"Ajustes finales","text":"<p>Deshabilito el autoarranque de OpenVPN:</p> <pre><code>sudo systemctl disable openvpn\n</code></pre> <p>Cada vez que lo queramos arrancar:</p> <pre><code>sudo systemctl start openvpn\n</code></pre> <p>A\u00f1ado las siguientes entradas en<code>/etc/hosts</code>:</p> <pre><code>sudo nano /etc/hosts\n</code></pre> <pre><code>172.22.123.100 openstack.gonzalonazareno.org\n172.22.123.1 proxmox.gonzalonazareno.org\n</code></pre>"},{"location":"hlc/taller1-pods/","title":"Taller 1: Trabajando con Pods","text":""},{"location":"hlc/taller1-pods/#entregas","title":"Entregas","text":""},{"location":"hlc/taller1-pods/#parte-1","title":"Parte 1","text":"<p>Pantallazo del fichero yaml que has creado con la definici\u00f3n del Pod</p> <p></p>"},{"location":"hlc/taller1-pods/#parte-2","title":"Parte 2","text":"<p>Pantallazo donde se comprueba que el Pod ha sido creado</p> <p></p>"},{"location":"hlc/taller1-pods/#parte-3","title":"Parte 3","text":"<p>Pantallazo donde se ve la informaci\u00f3n detallada del Pod</p> <p></p> <p></p>"},{"location":"hlc/taller1-pods/#parte-4","title":"Parte 4","text":"<p>Pantallazo donde se ve el fichero <code>index.html</code> del DocumentRoot</p> <p></p>"},{"location":"hlc/taller1-pods/#parte-5","title":"Parte 5","text":"<p>Pantallazo del navegador accediendo a la aplicaci\u00f3n con el <code>port-forward</code></p> <p></p>"},{"location":"hlc/taller1-pods/#parte-6","title":"Parte 6","text":"<p>Pantallazo donde se vean los logs de acceso del Pod</p> <p></p>"},{"location":"hlc/taller1-pods/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller1-pods/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear un yaml con la descripci\u00f3n del recurso Pod, teniendo en cuenta los siguientes aspectos:</p> <ul> <li>Indica nombres distintos para el pod y para el contenedor</li> <li>La imagen que debes desplegar es <code>iesgn/test_web:latest</code></li> <li>Indica una etiqueta en la descripci\u00f3n del pod</li> </ul> <pre><code>nano pod.yaml\n</code></pre> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: pod-test-web\nlabels:\napp: web\nspec:\ncontainers:\n- image: iesgn/test_web:latest\nname: contenedor-test-web\nimagePullPolicy: Always\n</code></pre>"},{"location":"hlc/taller1-pods/#ejercicio-2","title":"Ejercicio 2","text":"<p>Crear el pod</p> <pre><code>vagrant@k1:~$ kubectl create -f pod.yaml\npod/pod-test-web created\n</code></pre>"},{"location":"hlc/taller1-pods/#ejercicio-3","title":"Ejercicio 3","text":"<p>Comprobar que el Pod se ha creado y est\u00e1 corriendo</p> <pre><code>vagrant@k1:~$ kubectl get pods\nNAME           READY   STATUS    RESTARTS   AGE\npod-test-web   1/1     Running   0          30m\n</code></pre>"},{"location":"hlc/taller1-pods/#ejercicio-4","title":"Ejercicio 4","text":"<p>Obtener informaci\u00f3n detallada del Pod creado</p> <pre><code>vagrant@k1:~$ kubectl describe pod pod-test-web\nName:             pod-test-web\nNamespace:        default\nPriority:         0\nService Account:  default\nNode:             minikube/192.168.39.154\nStart Time:       Tue, 07 Feb 2023 17:56:23 +0000\nLabels:           app=web\nAnnotations:      &lt;none&gt;\nStatus:           Running\nIP:               10.244.0.4\nIPs:\n  IP:  10.244.0.4\nContainers:\n  contenedor-test-web:\n    Container ID:   docker://5278c71d92157f07deb321d9bd93148015cf72c4745640a80095d681c6679be3\n    Image:          iesgn/test_web:latest\n    Image ID:       docker-pullable://iesgn/test_web@sha256:001e1f4d8ab5d7ddf406e481392052769d1e87bdcce672fc6b91cdf3ec136886\n    Port:           &lt;none&gt;\n    Host Port:      &lt;none&gt;\n    State:          Running\n      Started:      Tue, 07 Feb 2023 17:56:37 +0000\n    Ready:          True\n    Restart Count:  0\nEnvironment:    &lt;none&gt;\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-xndd2 (ro)\nConditions:\n  Type              Status\n  Initialized       True Ready             True ContainersReady   True PodScheduled      True Volumes:\n  kube-api-access-xndd2:\n    Type:                    Projected (a volume that contains injected data from multiple sources)\nTokenExpirationSeconds:  3607\nConfigMapName:           kube-root-ca.crt\n    ConfigMapOptional:       &lt;nil&gt;\n    DownwardAPI:             true\nQoS Class:                   BestEffort\nNode-Selectors:              &lt;none&gt;\nTolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\nEvents:\n  Type    Reason     Age        From               Message\n  ----    ------     ----       ----               -------\n  Normal  Scheduled  &lt;invalid&gt;  default-scheduler  Successfully assigned default/pod-test-web to minikube\n  Normal  Pulling    &lt;invalid&gt;  kubelet            Pulling image \"iesgn/test_web:latest\"\nNormal  Pulled     &lt;invalid&gt;  kubelet            Successfully pulled image \"iesgn/test_web:latest\" in 11.894282463s (11.894299468s including waiting)\nNormal  Created    &lt;invalid&gt;  kubelet            Created container contenedor-test-web\n  Normal  Started    &lt;invalid&gt;  kubelet            Started container contenedor-test-web\n</code></pre>"},{"location":"hlc/taller1-pods/#ejercicio-5","title":"Ejercicio 5","text":"<p>Acceder de forma interactiva al Pod y comprobar los ficheros que est\u00e1n en el DocumentRoot (<code>/usr/local/apache2/htdocs</code>)</p> <pre><code>vagrant@k1:~$ kubectl exec -it pod-test-web -- /bin/bash\nroot@pod-test-web:/usr/local/apache2# cd htdocs/\nroot@pod-test-web:/usr/local/apache2/htdocs# ls -la\ntotal 16\ndrwxr-xr-x 1 root     root     4096 Feb 26  2021 .\ndrwxr-xr-x 1 www-data www-data 4096 Feb  9  2021 ..\n-rw-r--r-- 1 root     root     2884 Feb 26  2021 index.html\n</code></pre>"},{"location":"hlc/taller1-pods/#ejercicio-6","title":"Ejercicio 6","text":"<p>Crear una redirecci\u00f3n con kubectl port-forward utilizando el puerto de localhost 8888 y sabiendo que el Pod ofrece el servicio en el puerto 80. Accede a la aplicaci\u00f3n desde un navegador.</p> <pre><code>vagrant@k1:~$ kubectl port-forward pod-test-web 8888:80\nForwarding from 127.0.0.1:8888 -&gt; 80\nForwarding from [::1]:8888 -&gt; 80\n</code></pre> <p></p>"},{"location":"hlc/taller1-pods/#ejercicio-7","title":"Ejercicio 7","text":"<p>Mostrar los logs del Pod y comprobar que se visualizan los logs de los accesos que hemos realizado en el punto anterior</p> <pre><code>vagrant@k1:~$ kubectl logs pod-test-web\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.244.0.6. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.244.0.6. Set the 'ServerName' directive globally to suppress this message\n[Tue Feb 07 19:32:17.378493 2023] [mpm_event:notice] [pid 1:tid 140046039004288] AH00489: Apache/2.4.46 (Unix) configured -- resuming normal operations\n[Tue Feb 07 19:32:17.379568 2023] [core:notice] [pid 1:tid 140046039004288] AH00094: Command line: 'httpd -D FOREGROUND'\n127.0.0.1 - - [07/Feb/2023:19:35:20 +0000] \"GET / HTTP/1.1\" 200 2884\n127.0.0.1 - - [07/Feb/2023:19:35:21 +0000] \"GET /favicon.ico HTTP/1.1\" 404 196\n127.0.0.1 - - [07/Feb/2023:19:36:23 +0000] \"GET / HTTP/1.1\" 200 2884\n</code></pre>"},{"location":"hlc/taller1-pods/#ejercicio-8","title":"Ejercicio 8","text":"<p>Eliminar el Pod y comprobar que ha sido eliminado</p> <pre><code>vagrant@k1:~$ kubectl delete pod pod-test-web\npod \"pod-test-web\" deleted\nvagrant@k1:~$ kubectl get pod\nNo resources found in default namespace.\n</code></pre>"},{"location":"hlc/taller1-virtualizacion/","title":"Taller 1: Instalaci\u00f3n de QEMU/libvirt. Conexi\u00f3n local y remota","text":"<p>La teor\u00eda para completar este taller se encuentra en el cap\u00edtulo 2 del curso de virtualizaci\u00f3n.</p>"},{"location":"hlc/taller1-virtualizacion/#entrega","title":"Entrega","text":""},{"location":"hlc/taller1-virtualizacion/#parte-1","title":"Parte 1","text":"<p>Entregar la salida de <code>virsh version</code> en tu m\u00e1quina</p> <pre><code>atlas@olympus:~$ virsh version\nCompiled against library: libvirt 7.0.0\nUsing library: libvirt 7.0.0\nUsing API: QEMU 7.0.0\nRunning hypervisor: QEMU 5.2.0\n</code></pre>"},{"location":"hlc/taller1-virtualizacion/#parte-2","title":"Parte 2","text":"<p>Ejecutar <code>virsh list</code> usando <code>qemu:///system</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list\n Id   Name      State\n-------------------------\n 4    preseed   running\n</code></pre>"},{"location":"hlc/taller1-virtualizacion/#parte-3","title":"Parte 3","text":"<p>\u00bfPor qu\u00e9 al ejecutar <code>virsh -c qemu:///system list --all</code> no aparece la m\u00e1quina creada por gnome-boxes?</p> <p>Muestro mi salida del comando:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list --all\n Id   Name              State\n----------------------------------\n 4    preseed           running\n -    pruebas_pruebas   shut off\n</code></pre> <p>No aparece porque gnome-boxes usa <code>qemu:///session</code> en vez de <code>qemu:///system</code>, y son 2 sesiones totalmente diferenciadas.</p> <p>Para curiosos, m\u00e1s info aqu\u00ed.</p>"},{"location":"hlc/taller1-virtualizacion/#parte-4","title":"Parte 4","text":"<p>Mostrar la salida del comando virsh que muestra la m\u00e1quina de gnome-boxes</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///session list\n Id   Name          State\n-----------------------------\n 1    ubuntu20.10   running\n</code></pre>"},{"location":"hlc/taller1-virtualizacion/#parte-5","title":"Parte 5","text":"<p>Explicar c\u00f3mo configurar tu equipo para realizar conexiones remotas de libvirt</p> <p>Si queremos hacer una conexi\u00f3n remota, por ejemplo, al libvirt de Roberto, \u00e9l tendr\u00e1 que insertar mi clave p\u00fablica SSH en su <code>.ssh/authorized_keys</code>:</p> <pre><code>roberto@portatil:~/.ssh$ cat authorized_keys\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDqPHr0Q41RPMvMXDEYoevcCp+DPtzHLefK35Azea7iH/okOv4IlD3Yf1c/HEJNX/eTP/QxJwl8rQtoJ78Oe69FKKrLujaBl1RmmTXJMAg30zLay2mTiiANikyeu2W+dcuZAycDxTb8vUpAJheF16cH446+ZgYLPh5XafsH00ALtX6Abu8GQhJgoRMYuyHvM6BBjQxRdqmSBHZdpds+raCRrfHf7vFg4umGOPHAKmd5WIn7EULVEMX67R+t/pPfLMkAM7OX8/NLSlMADsqmI7TjoJiFuELwY/usWRodXCxq8iS4pDgldM7zx1gfIe+C5Upz7CtSpJaNNnr2gTTCCQg/Oz230Lh5DEWN0zxtz8iBMwV6uOj9baWkOTxxu9Lk95g6QIH1oFRsJDEmAvcfPIvUcvz2i0P8X5wglbzDQFSdH3UR0ndqsImXk8FtNWO/iHw0LThGh0t+RKUV+Y6h/nQdFIzkiKXqOsVRARx66zT8VgCBy3p6O6NpnxtyZ6VD6sc= atlas@olympus\n</code></pre> <p>De la misma manera, si alguien quisiera hacer conexiones remotas a mi libvirt, yo tendr\u00eda que a\u00f1adir su clave p\u00fablica SSH a mi <code>.ssh/authorized_keys</code>.</p> <p>Entregar la salida de <code>virsh</code> haciendo una conexi\u00f3n remota a Roberto</p> <p>Pruebo a listar sus redes remotas:</p> <pre><code>atlas@olympus:~$ virsh -c qemu+ssh://roberto@192.168.121.74/system net-list --all\n Name      State      Autostart   Persistent\n----------------------------------------------\n default   inactive   no          yes\n</code></pre>"},{"location":"hlc/taller1-virtualizacion/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller1-virtualizacion/#ejercicio-1","title":"Ejercicio 1","text":"<p>Instalar QEMU/KVM + libvirt</p> <pre><code>sudo apt install qemu-system libvirt-clients libvirt-daemon-system\n</code></pre> <p>Compruebo que se ha instalado:</p> <pre><code>vagrant@pruebas:~$ virsh version\nCompiled against library: libvirt 7.0.0\nUsing library: libvirt 7.0.0\nUsing API: QEMU 7.0.0\nRunning hypervisor: QEMU 5.2.0\n</code></pre>"},{"location":"hlc/taller1-virtualizacion/#ejercicio-2","title":"Ejercicio 2","text":"<p>Configurar el usuario sin privilegios para que utilice <code>qemu:///system</code> sin root</p> <p>A\u00f1ado el usuario <code>vagrant</code> al grupo <code>libvirt</code>:</p> <pre><code>sudo usermod -a -G libvirt vagrant\n</code></pre> <p>Pruebo que funciona:</p> <pre><code>vagrant@pruebas:~$ virsh -c qemu:///system net-list --all\n Name      State      Autostart   Persistent\n----------------------------------------------\n default   inactive   no          yes\n</code></pre>"},{"location":"hlc/taller1-virtualizacion/#ejercicio-3","title":"Ejercicio 3","text":"<p>Instalar <code>gnome-boxes</code> con una m\u00e1quina virtual</p> <pre><code>sudo apt install gnome-boxes\n</code></pre> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p>"},{"location":"hlc/taller1-virtualizacion/#ejercicio-4","title":"Ejercicio 4","text":"<p>Conectar remotamente al libvirt de Roberto</p> <p>Roberto tiene que insertar mi clave p\u00fablica SSH en su <code>.ssh/authorized_keys</code>:</p> <pre><code>roberto@portatil:~/.ssh$ cat authorized_keys\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDqPHr0Q41RPMvMXDEYoevcCp+DPtzHLefK35Azea7iH/okOv4IlD3Yf1c/HEJNX/eTP/QxJwl8rQtoJ78Oe69FKKrLujaBl1RmmTXJMAg30zLay2mTiiANikyeu2W+dcuZAycDxTb8vUpAJheF16cH446+ZgYLPh5XafsH00ALtX6Abu8GQhJgoRMYuyHvM6BBjQxRdqmSBHZdpds+raCRrfHf7vFg4umGOPHAKmd5WIn7EULVEMX67R+t/pPfLMkAM7OX8/NLSlMADsqmI7TjoJiFuELwY/usWRodXCxq8iS4pDgldM7zx1gfIe+C5Upz7CtSpJaNNnr2gTTCCQg/Oz230Lh5DEWN0zxtz8iBMwV6uOj9baWkOTxxu9Lk95g6QIH1oFRsJDEmAvcfPIvUcvz2i0P8X5wglbzDQFSdH3UR0ndqsImXk8FtNWO/iHw0LThGh0t+RKUV+Y6h/nQdFIzkiKXqOsVRARx66zT8VgCBy3p6O6NpnxtyZ6VD6sc= atlas@olympus\n</code></pre> <p>Pruebo a listar las redes remotas de Roberto:</p> <pre><code>atlas@olympus:~$ virsh -c qemu+ssh://roberto@192.168.121.74/system net-list --all\n Name      State      Autostart   Persistent\n----------------------------------------------\n default   inactive   no          yes\n</code></pre> <p>Configurar tu m\u00e1quina para que Roberto pueda acceder remotamente a tu libvirt</p> <p>Simplemente tendr\u00edamos que a\u00f1adir su clave p\u00fablica SSH a mi <code>.ssh/authorized_keys</code>:</p> <pre><code>atlas@olympus:~/.ssh$ cat authorized_keys\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDdXLqFJcBCixl8EAWwNoVgN5qKKGaFN5g0iMg6im+Tlbc31hvtBkbkXWYg5YvB981RCmfBjO2ZS2j95wqRTKBEJijdqYg4oiezwLMN1VWtHhXtggUXSKPa8HGIetz9R2rYAmsrRaFWTcyxX5xsXGESMWbesxZm3A/WFVneDmN+dcLd09sEGW2HB/wFgT6/kmzT0Vd5IkfwKhvcFNhu2QlHNY9eoZ02l7eYkCrIokd1ZzA2AHLwFXPfJLrKQ7feRF5EETL/dFdcV1tuZZZmRm8AYZIiZRyBaqMu/UqR6l+VSx3XONlVG1Ug2xo/2RuDyDQ2i+QGFo6ZjjbmnKVXg/Vil+bVUQGa/g3sOnbAgC2N0hmZ5T4Pi7iAAtMGltrWf2VpmzsZUFd3SJ6IET3SLd5R9l4PknNuzDY5ROIhNLarmkbplfzqT5+V14dOFiFXmLAFimCtI3Jd+tllQhH5P0n7Whg9QonUh5OgwchsLtniovC4R1ccoB7jzWxpvl1BT78= roberto@portatil\n</code></pre>"},{"location":"hlc/taller2-replicaset/","title":"Taller 2: Trabajando con ReplicaSet","text":""},{"location":"hlc/taller2-replicaset/#entregas","title":"Entregas","text":""},{"location":"hlc/taller2-replicaset/#parte-1","title":"Parte 1","text":""},{"location":"hlc/taller2-replicaset/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller2-replicaset/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear un yaml con la descripci\u00f3n del recurso Pod, teniendo en cuenta los siguientes aspectos:</p> <ul> <li>Indica nombres distintos para el pod y para el contenedor</li> <li>La imagen que debes desplegar es <code>iesgn/test_web:latest</code></li> <li>Indica una etiqueta en la descripci\u00f3n del pod</li> </ul> <pre><code>nano pod.yaml\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/","title":"Taller 2: Creaci\u00f3n de m\u00e1quinas virtuales desde la l\u00ednea de comandos","text":"<p>La teor\u00eda para completar este taller se encuentra en el cap\u00edtulo 3 del curso de virtualizaci\u00f3n.</p>"},{"location":"hlc/taller2-virtualizacion/#entrega","title":"Entrega","text":""},{"location":"hlc/taller2-virtualizacion/#parte-1","title":"Parte 1","text":"<p>Entregar el comando usado para crear la VM</p> <pre><code>virt-install --connect qemu:///system \\\n--virt-type kvm \\\n--name linux_adrian_j \\\n--cdrom ~/isos/debian-11.5.0-amd64-netinst.iso \\\n--os-variant debian10 \\\n--disk size=15 \\\n--memory 2048 \\\n--vcpus 2\n</code></pre> <p>Si no queremos GUI, dejamos este paso de la instalaci\u00f3n de la siguiente manera:</p> <p></p>"},{"location":"hlc/taller2-virtualizacion/#parte-2","title":"Parte 2","text":"<p>Entregar una captura del acceso a la VM con virt-viewer</p> <pre><code>virt-viewer -c qemu:///system linux_adrian_j\n</code></pre> <p></p>"},{"location":"hlc/taller2-virtualizacion/#parte-3","title":"Parte 3","text":"<p>Entregar la lista de VMs creadas</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list --all\n Id   Name                        State\n--------------------------------------------\n 3    linux_adrian_j              running\n -    prueba2                     shut off\n -    pruebas_pruebas             shut off\n -    t1-virtualizacion_pruebas   shut off\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#parte-4","title":"Parte 4","text":"<p>Mostrar el volumen creado en el pool default</p> <p></p> <p>Mostrar que en <code>/var/lib/libvirt/images</code> se ha creado un qcow2</p> <p></p>"},{"location":"hlc/taller2-virtualizacion/#parte-5","title":"Parte 5","text":"<p>Mostrar la informaci\u00f3n de la VM</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo linux_adrian_j\nId:             -\nName:           linux_adrian_j\nUUID:           29cc9a23-f712-4649-a61f-eea1cb11599e\nOS Type:        hvm\nState:          shut off\nCPU(s):         2\nMax memory:     2097152 KiB\nUsed memory:    2097152 KiB\nPersistent:     yes\nAutostart:      disable\nManaged save:   no\nSecurity model: apparmor\nSecurity DOI:   0\n</code></pre> <p>Mostrar la IP</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system domifaddr linux_adrian_j\n Name       MAC address          Protocol     Address\n-------------------------------------------------------------------------------\n vnet5      52:54:00:42:b7:c6    ipv4         192.168.122.47/24\n</code></pre> <p>Mostrar los discos</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system domblklist linux_adrian_j\n Target   Source\n--------------------------------------------------------\n vda      /var/lib/libvirt/images/linux_adrian_j.qcow2\n sda      -\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#parte-6","title":"Parte 6","text":""},{"location":"hlc/taller2-virtualizacion/#cambio-de-nombre","title":"Cambio de nombre","text":"<p>Apago la m\u00e1quina:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system destroy linux_adrian_j\nDomain 'linux_adrian_j' destroyed\n</code></pre> <p>Cambio el nombre:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system domrename linux_adrian_j debian_adrian_j\nDomain successfully renamed\n</code></pre> <p>Muestro que se ha aplicado:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list --all\n Id   Name                        State\n--------------------------------------------\n -    debian_adrian_j             shut off\n -    prueba2                     shut off\n -    pruebas_pruebas             shut off\n -    t1-virtualizacion_pruebas   shut off\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#cambio-de-cpus","title":"Cambio de CPUs","text":"<p>Muestro la cantidad actual:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep CPU\nCPU(s):         2\n</code></pre> <p>Edito el XML para que cambie el valor:</p> <pre><code>virsh -c qemu:///system edit debian_adrian_j\n</code></pre> <p></p> <p>Muestro que se ha aplicado:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep CPU\nCPU(s):         1\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#cambio-de-ram","title":"Cambio de RAM","text":"<p>Muestro la cantidad actual:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep memory\nMax memory:     2097152 KiB\nUsed memory:    2097152 KiB\n</code></pre> <p>Edito el XML para que cambie el valor:</p> <pre><code>virsh -c qemu:///system edit debian_adrian_j\n</code></pre> <p></p> <p>Muestro que se ha aplicado:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep memory\nMax memory:     1048576 KiB\nUsed memory:    1048576 KiB\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller2-virtualizacion/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear una VM con caracter\u00edsticas:</p> <ul> <li>Nombre: linux_adrian_j</li> <li>Disco: 15 GB</li> <li>RAM: 2 GB</li> <li>CPUs: 2</li> <li>Sin GUI</li> </ul> <pre><code>virt-install --connect qemu:///system \\\n--virt-type kvm \\\n--name linux_adrian_j \\\n--cdrom ~/isos/debian-11.5.0-amd64-netinst.iso \\\n--os-variant debian10 \\\n--disk size=15 \\\n--memory 2048 \\\n--vcpus 2\n</code></pre> <p>Si no queremos GUI, dejamos este paso de la instalaci\u00f3n de la siguiente manera:</p> <p></p>"},{"location":"hlc/taller2-virtualizacion/#ejercicio-2","title":"Ejercicio 2","text":"<p>Acceder usando virt-viewer</p> <pre><code>virt-viewer -c qemu:///system linux_adrian_j\n</code></pre> <p></p>"},{"location":"hlc/taller2-virtualizacion/#ejercicio-3","title":"Ejercicio 3","text":"<p>Comprobar la IP, disco y RAM</p> <p></p>"},{"location":"hlc/taller2-virtualizacion/#ejercicio-4","title":"Ejercicio 4","text":"<p>Listar las m\u00e1quinas</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list --all\n Id   Name                        State\n--------------------------------------------\n 3    linux_adrian_j              running\n -    prueba2                     shut off\n -    pruebas_pruebas             shut off\n -    t1-virtualizacion_pruebas   shut off\n</code></pre> <p>Apagar <code>linux_adrian_j</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system shutdown linux_adrian_j\nDomain 'linux_adrian_j' is being shutdown\n</code></pre> <p>Volver a encenderla</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system start linux_adrian_j\nDomain 'linux_adrian_j' started\n</code></pre> <p>Reiniciarla</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system reboot linux_adrian_j\nDomain 'linux_adrian_j' is being rebooted\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#ejercicio-5","title":"Ejercicio 5","text":"<p>Mostrar el XML de <code>linux_adrian_j</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dumpxml linux_adrian_j\n&lt;domain type='kvm' id='4'&gt;\n  &lt;name&gt;linux_adrian_j&lt;/name&gt;\n  &lt;uuid&gt;29cc9a23-f712-4649-a61f-eea1cb11599e&lt;/uuid&gt;\n  &lt;metadata&gt;\n    &lt;libosinfo:libosinfo xmlns:libosinfo=\"http://libosinfo.org/xmlns/libvirt/domain/1.0\"&gt;\n      &lt;libosinfo:os id=\"http://debian.org/debian/10\"/&gt;\n    &lt;/libosinfo:libosinfo&gt;\n  &lt;/metadata&gt;\n  &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;\n  &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;\n  &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;\n  &lt;resource&gt;\n    &lt;partition&gt;/machine&lt;/partition&gt;\n  &lt;/resource&gt;\n  &lt;os&gt;\n    &lt;type arch='x86_64' machine='pc-q35-5.2'&gt;hvm&lt;/type&gt;\n    &lt;boot dev='hd'/&gt;\n  &lt;/os&gt;\n  &lt;features&gt;\n    &lt;acpi/&gt;\n    &lt;apic/&gt;\n    &lt;vmport state='off'/&gt;\n  &lt;/features&gt;\n  &lt;cpu mode='custom' match='exact' check='full'&gt;\n    &lt;model fallback='forbid'&gt;Skylake-Client-IBRS&lt;/model&gt;\n    &lt;vendor&gt;Intel&lt;/vendor&gt;\n    &lt;feature policy='require' name='ss'/&gt;\n    &lt;feature policy='require' name='vmx'/&gt;\n    &lt;feature policy='require' name='pdcm'/&gt;\n    &lt;feature policy='require' name='hypervisor'/&gt;\n    &lt;feature policy='require' name='tsc_adjust'/&gt;\n    &lt;feature policy='require' name='clflushopt'/&gt;\n    &lt;feature policy='require' name='umip'/&gt;\n    &lt;feature policy='require' name='stibp'/&gt;\n    &lt;feature policy='require' name='arch-capabilities'/&gt;\n    &lt;feature policy='require' name='ssbd'/&gt;\n    &lt;feature policy='require' name='xsaves'/&gt;\n    &lt;feature policy='require' name='pdpe1gb'/&gt;\n    &lt;feature policy='require' name='ibpb'/&gt;\n    &lt;feature policy='require' name='amd-stibp'/&gt;\n    &lt;feature policy='require' name='amd-ssbd'/&gt;\n    &lt;feature policy='require' name='skip-l1dfl-vmentry'/&gt;\n    &lt;feature policy='require' name='pschange-mc-no'/&gt;\n    &lt;feature policy='disable' name='hle'/&gt;\n    &lt;feature policy='disable' name='rtm'/&gt;\n    &lt;feature policy='disable' name='mpx'/&gt;\n  &lt;/cpu&gt;\n  &lt;clock offset='utc'&gt;\n    &lt;timer name='rtc' tickpolicy='catchup'/&gt;\n    &lt;timer name='pit' tickpolicy='delay'/&gt;\n    &lt;timer name='hpet' present='no'/&gt;\n  &lt;/clock&gt;\n  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;\n  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;\n  &lt;on_crash&gt;destroy&lt;/on_crash&gt;\n  &lt;pm&gt;\n    &lt;suspend-to-mem enabled='no'/&gt;\n    &lt;suspend-to-disk enabled='no'/&gt;\n  &lt;/pm&gt;\n  &lt;devices&gt;\n    &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt;\n    &lt;disk type='file' device='disk'&gt;\n      &lt;driver name='qemu' type='qcow2'/&gt;\n      &lt;source file='/var/lib/libvirt/images/linux_adrian_j.qcow2' index='2'/&gt;\n      &lt;backingStore/&gt;\n      &lt;target dev='vda' bus='virtio'/&gt;\n      &lt;alias name='virtio-disk0'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x04' slot='0x00' function='0x0'/&gt;\n    &lt;/disk&gt;\n    &lt;disk type='file' device='cdrom'&gt;\n      &lt;driver name='qemu'/&gt;\n      &lt;target dev='sda' bus='sata'/&gt;\n      &lt;readonly/&gt;\n      &lt;alias name='sata0-0-0'/&gt;\n      &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;\n    &lt;/disk&gt;\n    &lt;controller type='usb' index='0' model='qemu-xhci' ports='15'&gt;\n      &lt;alias name='usb'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x00' function='0x0'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='sata' index='0'&gt;\n      &lt;alias name='ide'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x1f' function='0x2'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='0' model='pcie-root'&gt;\n      &lt;alias name='pcie.0'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='1' model='pcie-root-port'&gt;\n      &lt;model name='pcie-root-port'/&gt;\n      &lt;target chassis='1' port='0x10'/&gt;\n      &lt;alias name='pci.1'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0' multifunction='on'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='2' model='pcie-root-port'&gt;\n      &lt;model name='pcie-root-port'/&gt;\n      &lt;target chassis='2' port='0x11'/&gt;\n      &lt;alias name='pci.2'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x1'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='3' model='pcie-root-port'&gt;\n      &lt;model name='pcie-root-port'/&gt;\n      &lt;target chassis='3' port='0x12'/&gt;\n      &lt;alias name='pci.3'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x2'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='4' model='pcie-root-port'&gt;\n      &lt;model name='pcie-root-port'/&gt;\n      &lt;target chassis='4' port='0x13'/&gt;\n      &lt;alias name='pci.4'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x3'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='5' model='pcie-root-port'&gt;\n      &lt;model name='pcie-root-port'/&gt;\n      &lt;target chassis='5' port='0x14'/&gt;\n      &lt;alias name='pci.5'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x4'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='6' model='pcie-root-port'&gt;\n      &lt;model name='pcie-root-port'/&gt;\n      &lt;target chassis='6' port='0x15'/&gt;\n      &lt;alias name='pci.6'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x5'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='pci' index='7' model='pcie-root-port'&gt;\n      &lt;model name='pcie-root-port'/&gt;\n      &lt;target chassis='7' port='0x16'/&gt;\n      &lt;alias name='pci.7'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x6'/&gt;\n    &lt;/controller&gt;\n    &lt;controller type='virtio-serial' index='0'&gt;\n      &lt;alias name='virtio-serial0'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x03' slot='0x00' function='0x0'/&gt;\n    &lt;/controller&gt;\n    &lt;interface type='network'&gt;\n      &lt;mac address='52:54:00:42:b7:c6'/&gt;\n      &lt;source network='default' portid='4abfa2b2-cfc7-4d67-9afa-134f82f939b0' bridge='virbr0'/&gt;\n      &lt;target dev='vnet3'/&gt;\n      &lt;model type='virtio'/&gt;\n      &lt;alias name='net0'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x01' slot='0x00' function='0x0'/&gt;\n    &lt;/interface&gt;\n    &lt;serial type='pty'&gt;\n      &lt;source path='/dev/pts/1'/&gt;\n      &lt;target type='isa-serial' port='0'&gt;\n        &lt;model name='isa-serial'/&gt;\n      &lt;/target&gt;\n      &lt;alias name='serial0'/&gt;\n    &lt;/serial&gt;\n    &lt;console type='pty' tty='/dev/pts/1'&gt;\n      &lt;source path='/dev/pts/1'/&gt;\n      &lt;target type='serial' port='0'/&gt;\n      &lt;alias name='serial0'/&gt;\n    &lt;/console&gt;\n    &lt;channel type='unix'&gt;\n      &lt;source mode='bind' path='/var/lib/libvirt/qemu/channel/target/domain-4-linux_adrian_j/org.qemu.guest_agent.0'/&gt;\n      &lt;target type='virtio' name='org.qemu.guest_agent.0' state='connected'/&gt;\n      &lt;alias name='channel0'/&gt;\n      &lt;address type='virtio-serial' controller='0' bus='0' port='1'/&gt;\n    &lt;/channel&gt;\n    &lt;channel type='spicevmc'&gt;\n      &lt;target type='virtio' name='com.redhat.spice.0' state='disconnected'/&gt;\n      &lt;alias name='channel1'/&gt;\n      &lt;address type='virtio-serial' controller='0' bus='0' port='2'/&gt;\n    &lt;/channel&gt;\n    &lt;input type='tablet' bus='usb'&gt;\n      &lt;alias name='input0'/&gt;\n      &lt;address type='usb' bus='0' port='1'/&gt;\n    &lt;/input&gt;\n    &lt;input type='mouse' bus='ps2'&gt;\n      &lt;alias name='input1'/&gt;\n    &lt;/input&gt;\n    &lt;input type='keyboard' bus='ps2'&gt;\n      &lt;alias name='input2'/&gt;\n    &lt;/input&gt;\n    &lt;graphics type='spice' port='5900' autoport='yes' listen='127.0.0.1'&gt;\n      &lt;listen type='address' address='127.0.0.1'/&gt;\n      &lt;image compression='off'/&gt;\n    &lt;/graphics&gt;\n    &lt;sound model='ich9'&gt;\n      &lt;alias name='sound0'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x1b' function='0x0'/&gt;\n    &lt;/sound&gt;\n    &lt;video&gt;\n      &lt;model type='qxl' ram='65536' vram='65536' vgamem='16384' heads='1' primary='yes'/&gt;\n      &lt;alias name='video0'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x0'/&gt;\n    &lt;/video&gt;\n    &lt;redirdev bus='usb' type='spicevmc'&gt;\n      &lt;alias name='redir0'/&gt;\n      &lt;address type='usb' bus='0' port='2'/&gt;\n    &lt;/redirdev&gt;\n    &lt;redirdev bus='usb' type='spicevmc'&gt;\n      &lt;alias name='redir1'/&gt;\n      &lt;address type='usb' bus='0' port='3'/&gt;\n    &lt;/redirdev&gt;\n    &lt;memballoon model='virtio'&gt;\n      &lt;alias name='balloon0'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x05' slot='0x00' function='0x0'/&gt;\n    &lt;/memballoon&gt;\n    &lt;rng model='virtio'&gt;\n      &lt;backend model='random'&gt;/dev/urandom&lt;/backend&gt;\n      &lt;alias name='rng0'/&gt;\n      &lt;address type='pci' domain='0x0000' bus='0x06' slot='0x00' function='0x0'/&gt;\n    &lt;/rng&gt;\n  &lt;/devices&gt;\n  &lt;seclabel type='dynamic' model='apparmor' relabel='yes'&gt;\n    &lt;label&gt;libvirt-29cc9a23-f712-4649-a61f-eea1cb11599e&lt;/label&gt;\n    &lt;imagelabel&gt;libvirt-29cc9a23-f712-4649-a61f-eea1cb11599e&lt;/imagelabel&gt;\n  &lt;/seclabel&gt;\n  &lt;seclabel type='dynamic' model='dac' relabel='yes'&gt;\n    &lt;label&gt;+64055:+64055&lt;/label&gt;\n    &lt;imagelabel&gt;+64055:+64055&lt;/imagelabel&gt;\n  &lt;/seclabel&gt;\n&lt;/domain&gt;\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#ejercicio-6","title":"Ejercicio 6","text":""},{"location":"hlc/taller2-virtualizacion/#61","title":"6.1","text":"<p>Modificar el nombre de la m\u00e1quina <code>linux_adrian_j</code></p> <p>Apago la m\u00e1quina:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system destroy linux_adrian_j\nDomain 'linux_adrian_j' destroyed\n</code></pre> <p>Cambio el nombre:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system domrename linux_adrian_j debian_adrian_j\nDomain successfully renamed\n</code></pre> <p>Muestro que se ha aplicado:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list --all\n Id   Name                        State\n--------------------------------------------\n -    debian_adrian_j             shut off\n -    prueba2                     shut off\n -    pruebas_pruebas             shut off\n -    t1-virtualizacion_pruebas   shut off\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#62","title":"6.2","text":"<p>Modificar el n\u00famero de CPUs</p> <p>Muestro la cantidad actual:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep CPU\nCPU(s):         2\n</code></pre> <p>Edito el XML para que cambie el valor:</p> <pre><code>virsh -c qemu:///system edit debian_adrian_j\n</code></pre> <p></p> <p>Muestro que se ha aplicado:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep CPU\nCPU(s):         1\n</code></pre>"},{"location":"hlc/taller2-virtualizacion/#63","title":"6.3","text":"<p>Modificar la RAM</p> <p>Muestro la cantidad actual:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep memory\nMax memory:     2097152 KiB\nUsed memory:    2097152 KiB\n</code></pre> <p>Edito el XML para que cambie el valor:</p> <pre><code>virsh -c qemu:///system edit debian_adrian_j\n</code></pre> <p></p> <p>Muestro que se ha aplicado:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system dominfo debian_adrian_j | grep memory\nMax memory:     1048576 KiB\nUsed memory:    1048576 KiB\n</code></pre>"},{"location":"hlc/taller3-virtualizacion/","title":"Taller 3: Creaci\u00f3n de m\u00e1quinas virtuales con virt-manager","text":"<p>La teor\u00eda para completar este taller se encuentra en el cap\u00edtulo 4 del curso de virtualizaci\u00f3n.</p>"},{"location":"hlc/taller3-virtualizacion/#entrega","title":"Entrega","text":""},{"location":"hlc/taller3-virtualizacion/#parte-1","title":"Parte 1","text":"<p>Mostrar el acceso a <code>debian_adrian_j</code></p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#parte-2","title":"Parte 2","text":"<p>Mostrar el acceso a <code>debian_adrian_j</code> por ssh</p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#parte-3","title":"Parte 3","text":"<p>Mostrar el XML de <code>debian_adrian_j</code></p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#parte-4","title":"Parte 4","text":"<p>Sobre <code>debian_adrian_j</code>, mostrar:</p> <ul> <li>RAM</li> <li>CPUs</li> <li>Disco</li> <li>Interfaz de red</li> </ul> <p></p> <p></p> <p></p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#parte-5","title":"Parte 5","text":"<p>Muestro un ping al exterior en la VM Windows</p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#parte-6","title":"Parte 6","text":"<p>Muestro la vista general XML, el disco y la NIC VirtIO de la VM Windows</p> <p></p> <p></p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller3-virtualizacion/#ejercicio-1","title":"Ejercicio 1","text":"<p>Instalar <code>virt-manager</code></p> <pre><code>sudo apt install virt-manager\n</code></pre>"},{"location":"hlc/taller3-virtualizacion/#ejercicio-2","title":"Ejercicio 2","text":"<p>Acceder a <code>debian_adrian_j</code> del taller 2</p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#ejercicio-3","title":"Ejercicio 3","text":"<p>Instalar un servidor ssh en <code>debian_adrian_j</code> y acceder</p> <pre><code>sudo apt install openssh-server\n</code></pre> <pre><code>atlas@olympus:~$ ssh debian@192.168.122.47\nThe authenticity of host '192.168.122.47 (192.168.122.47)' can't be established.\nECDSA key fingerprint is SHA256:u1XoocfVaaUcYJ85av22BbCiS7hZ73mFSGHNUbcev0M.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '192.168.122.47' (ECDSA) to the list of known hosts.\ndebian@192.168.122.47's password:\nLinux debian 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Mon Oct 10 14:04:52 2022\ndebian@debian:~$\n</code></pre>"},{"location":"hlc/taller3-virtualizacion/#ejercicio-4","title":"Ejercicio 4","text":"<p>Mostrar el XML de <code>debian_adrian_j</code></p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#ejercicio-5","title":"Ejercicio 5","text":"<p>Sobre <code>debian_adrian_j</code>, mostrar:</p> <ul> <li>RAM</li> <li>CPUs</li> <li>Disco</li> <li>Interfaz de red</li> </ul> <p></p> <p></p> <p></p> <p></p>"},{"location":"hlc/taller3-virtualizacion/#ejercicio-6","title":"Ejercicio 6","text":"<p>Crear una VM con Windows, disco y NIC VirtIO</p> <p>Muestro que tengo las isos necesarias:</p> <p></p> <p>Creo la m\u00e1quina:</p> <p></p> <p></p> <p></p> <p></p> <p>En el paso final, personalizo la configuraci\u00f3n de la m\u00e1quina antes de instalar:</p> <p></p> <p>Cambio el disco a VirtIO:</p> <p></p> <p>Cambio la NIC a VirtIO:</p> <p></p> <p>A\u00f1ado un CDROM con la ISO de drivers VirtIO:</p> <p></p> <p>Cambio el orden de arranque y lanzo la instalaci\u00f3n:</p> <p></p> <p>Cargo los drivers para que se reconozca el disco:</p> <p></p> <p></p> <p></p> <p></p> <p>Ya podemos ver el disco y terminar la instalaci\u00f3n:</p> <p></p> <p>Instalo los drivers VirtIO para que funcione la NIC:</p> <p></p> <p></p> <p></p> <p>Hago un ping a Internet para probar que funciona:</p> <p></p>"},{"location":"hlc/taller4-virtualizacion/","title":"Taller 4: Gesti\u00f3n del almacenamiento en QEMU/KVM + libvirt","text":"<p>La teor\u00eda para completar este taller se encuentra en el cap\u00edtulo 5 del curso de virtualizaci\u00f3n.</p>"},{"location":"hlc/taller4-virtualizacion/#entrega","title":"Entrega","text":""},{"location":"hlc/taller4-virtualizacion/#parte-1","title":"Parte 1","text":"<p>Mostrar los pools con <code>virsh</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-list\n Name      State    Autostart\n-------------------------------\n default   active   yes\n isos      active   yes\n</code></pre> <p>\u00bfDe qu\u00e9 tipo son?</p> <p><code>dir</code>, y lo demuestro as\u00ed:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-list --type dir\n Name      State    Autostart\n-------------------------------\n default   active   yes\n isos      active   yes\n</code></pre> <p>\u00bfQu\u00e9 se guarda en ellos?</p> <p>Vol\u00famenes, que ser\u00e1n ficheros <code>qcow2</code> o <code>iso</code> dependiendo del pool.</p> <p>En el pool <code>default</code>:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list default\n Name                                                                 Path\n------------------------------------------------------------------------------------------------------------------------------------------------------------------\n debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img   /var/lib/libvirt/images/debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img\n delete.qcow2                                                         /var/lib/libvirt/images/delete.qcow2\n linux_adrian_j.qcow2                                                 /var/lib/libvirt/images/linux_adrian_j.qcow2\n prueba1.qcow2                                                        /var/lib/libvirt/images/prueba1.qcow2\n pruebas_pruebas.img                                                  /var/lib/libvirt/images/pruebas_pruebas.img\n t1-virtualizacion_pruebas.img                                        /var/lib/libvirt/images/t1-virtualizacion_pruebas.img\n vol1.qcow2                                                           /var/lib/libvirt/images/vol1.qcow2\n win10.qcow2                                                          /var/lib/libvirt/images/win10.qcow2\n</code></pre> <p>En el pool <code>isos</code>:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list isos\n Name                                      Path\n-----------------------------------------------------------------------------------------------------\n debian-11.5.0-amd64-netinst.iso           /home/atlas/isos/debian-11.5.0-amd64-netinst.iso\n OracleLinux-R9-U0-x86_64-dvd.iso          /home/atlas/isos/OracleLinux-R9-U0-x86_64-dvd.iso\n preseed-debian-11.5.0-amd64-netinst.iso   /home/atlas/isos/preseed-debian-11.5.0-amd64-netinst.iso\n virtio-win-0.1.221.iso                    /home/atlas/isos/virtio-win-0.1.221.iso\n Win10_21H2_EnglishInternational_x64.iso   /home/atlas/isos/Win10_21H2_EnglishInternational_x64.iso\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#parte-2","title":"Parte 2","text":"<p>Mostrar informaci\u00f3n sobre el pool discos</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-info discos\nName:           discos\nUUID:           f621e4c3-5e47-4da3-bfc0-7d398cec927e\nState:          running\nPersistent:     yes\nAutostart:      no\nCapacity:       27.92 GiB\nAllocation:     5.98 GiB\nAvailable:      21.94 GiB\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#parte-3","title":"Parte 3","text":"<p>Mostrar con virsh los vol\u00famenes del pool default</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list default\n Name                                                                 Path\n------------------------------------------------------------------------------------------------------------------------------------------------------------------\n debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img   /var/lib/libvirt/images/debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img\n delete.qcow2                                                         /var/lib/libvirt/images/delete.qcow2\n linux_adrian_j.qcow2                                                 /var/lib/libvirt/images/linux_adrian_j.qcow2\n prueba1.qcow2                                                        /var/lib/libvirt/images/prueba1.qcow2\n pruebas_pruebas.img                                                  /var/lib/libvirt/images/pruebas_pruebas.img\n t1-virtualizacion_pruebas.img                                        /var/lib/libvirt/images/t1-virtualizacion_pruebas.img\n vol1.qcow2                                                           /var/lib/libvirt/images/vol1.qcow2\n win10.qcow2                                                          /var/lib/libvirt/images/win10.qcow2\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#parte-4","title":"Parte 4","text":"<p>Mostrar los comandos usados para crear los dos vol\u00famenes</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-create-as discos disco1.qcow2 --format qcow2 1G\nVol disco1.qcow2 created\n</code></pre> <pre><code>atlas@olympus:/srv/discos$ sudo qemu-img create -f qcow2 disco2.qcow2 2G\nFormatting 'disco2.qcow2', fmt=qcow2 cluster_size=65536 extended_l2=off compression_type=zlib size=2147483648 lazy_refcounts=off refcount_bits=16\n</code></pre> <p>Listar los vol\u00famenes del pool discos mostrando el aprovisionamiento ligero</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list discos --details\n Name           Path                       Type   Capacity   Allocation\n-------------------------------------------------------------------------\n disco1.qcow2   /srv/discos/disco1.qcow2   file   1.00 GiB   196.00 KiB\n disco2.qcow2   /srv/discos/disco2.qcow2   file   2.00 GiB   196.00 KiB\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#parte-5","title":"Parte 5","text":"<p>Antes de redimensionar, mostrar un <code>df -h</code></p> <p></p>"},{"location":"hlc/taller4-virtualizacion/#parte-6","title":"Parte 6","text":"<p>Tras redimensionar, mostrar un <code>df -h</code></p> <p></p>"},{"location":"hlc/taller4-virtualizacion/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller4-virtualizacion/#ejercicio-1","title":"Ejercicio 1","text":"<p>Mostrar los pools con <code>virsh</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-list\n Name      State    Autostart\n-------------------------------\n default   active   yes\n isos      active   yes\n</code></pre> <p>\u00bfDe qu\u00e9 tipo son?</p> <p><code>dir</code>, y lo demuestro as\u00ed:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-list --type dir\n Name      State    Autostart\n-------------------------------\n default   active   yes\n isos      active   yes\n</code></pre> <p>\u00bfQu\u00e9 se guarda en ellos?</p> <p>Vol\u00famenes, que ser\u00e1n ficheros <code>qcow2</code> o <code>iso</code> dependiendo del pool.</p> <p>En el pool <code>default</code>:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list default\n Name                                                                 Path\n------------------------------------------------------------------------------------------------------------------------------------------------------------------\n debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img   /var/lib/libvirt/images/debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img\n delete.qcow2                                                         /var/lib/libvirt/images/delete.qcow2\n linux_adrian_j.qcow2                                                 /var/lib/libvirt/images/linux_adrian_j.qcow2\n prueba1.qcow2                                                        /var/lib/libvirt/images/prueba1.qcow2\n pruebas_pruebas.img                                                  /var/lib/libvirt/images/pruebas_pruebas.img\n t1-virtualizacion_pruebas.img                                        /var/lib/libvirt/images/t1-virtualizacion_pruebas.img\n vol1.qcow2                                                           /var/lib/libvirt/images/vol1.qcow2\n win10.qcow2                                                          /var/lib/libvirt/images/win10.qcow2\n</code></pre> <p>En el pool <code>isos</code>:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list isos\n Name                                      Path\n-----------------------------------------------------------------------------------------------------\n debian-11.5.0-amd64-netinst.iso           /home/atlas/isos/debian-11.5.0-amd64-netinst.iso\n OracleLinux-R9-U0-x86_64-dvd.iso          /home/atlas/isos/OracleLinux-R9-U0-x86_64-dvd.iso\n preseed-debian-11.5.0-amd64-netinst.iso   /home/atlas/isos/preseed-debian-11.5.0-amd64-netinst.iso\n virtio-win-0.1.221.iso                    /home/atlas/isos/virtio-win-0.1.221.iso\n Win10_21H2_EnglishInternational_x64.iso   /home/atlas/isos/Win10_21H2_EnglishInternational_x64.iso\n</code></pre> <p>Mostrar los pools con <code>virt-manager</code></p> <p></p> <p></p>"},{"location":"hlc/taller4-virtualizacion/#ejercicio-2","title":"Ejercicio 2","text":"<p>Crear un pool con virsh de caracter\u00edsticas:</p> <ul> <li>Nombre: discos</li> <li>Tipo: dir</li> <li>Directorio: /srv/discos</li> </ul> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-define-as discos dir --target /srv/discos\nPool discos defined\n</code></pre> <p>Crear el directorio</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-build discos\nPool discos built\n</code></pre> <p>Iniciar el pool</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-start discos\nPool discos started\n</code></pre> <p>Mostrar que se ha creado el pool</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system pool-list\n Name      State    Autostart\n-------------------------------\n default   active   yes\n discos    active   no\n isos      active   yes\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#ejercicio-3","title":"Ejercicio 3","text":"<p>Mostrar los vol\u00famenes del pool default con virsh</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list default\n Name                                                                 Path\n------------------------------------------------------------------------------------------------------------------------------------------------------------------\n debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img   /var/lib/libvirt/images/debian-VAGRANTSLASH-bullseye64_vagrant_box_image_11.20220912.1.img\n delete.qcow2                                                         /var/lib/libvirt/images/delete.qcow2\n linux_adrian_j.qcow2                                                 /var/lib/libvirt/images/linux_adrian_j.qcow2\n prueba1.qcow2                                                        /var/lib/libvirt/images/prueba1.qcow2\n pruebas_pruebas.img                                                  /var/lib/libvirt/images/pruebas_pruebas.img\n t1-virtualizacion_pruebas.img                                        /var/lib/libvirt/images/t1-virtualizacion_pruebas.img\n vol1.qcow2                                                           /var/lib/libvirt/images/vol1.qcow2\n win10.qcow2                                                          /var/lib/libvirt/images/win10.qcow2\n</code></pre> <p>Mostrar lo mismo pero con virt-manager</p> <p></p>"},{"location":"hlc/taller4-virtualizacion/#ejercicio-4","title":"Ejercicio 4","text":"<p>Crear un volumen con virsh de caracter\u00edsticas:</p> <ul> <li>Pool: discos</li> <li>Nombre: disco1.qcow2</li> <li>Tama\u00f1o: 1G</li> </ul> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-create-as discos disco1.qcow2 --format qcow2 1G\nVol disco1.qcow2 created\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#ejercicio-5","title":"Ejercicio 5","text":"<p>Cambiar al directorio <code>/srv/discos</code></p> <pre><code>atlas@olympus:~$ cd /srv/discos\natlas@olympus:/srv/discos$\n</code></pre> <p>Crear una imagen con <code>qemu-img</code> de caracter\u00edsticas:</p> <ul> <li>Nombre: disco2.qcow2</li> <li>Tama\u00f1o: 2G</li> </ul> <pre><code>atlas@olympus:/srv/discos$ sudo qemu-img create -f qcow2 disco2.qcow2 2G\nFormatting 'disco2.qcow2', fmt=qcow2 cluster_size=65536 extended_l2=off compression_type=zlib size=2147483648 lazy_refcounts=off refcount_bits=16\n</code></pre> <p>Refrescar el pool para que se reconozca como volumen</p> <pre><code>atlas@olympus:/srv/discos$ virsh -c qemu:///system pool-refresh discos\nPool discos refreshed\n</code></pre> <p>Mostrar los vol\u00famenes del pool discos para comprobar que todo es correcto</p> <pre><code>atlas@olympus:/srv/discos$ virsh -c qemu:///system vol-list discos\n Name           Path\n------------------------------------------\n disco1.qcow2   /srv/discos/disco1.qcow2\n disco2.qcow2   /srv/discos/disco2.qcow2\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#ejercicio-6","title":"Ejercicio 6","text":"<p>\u00bfQu\u00e9 caracter\u00edstica especial tienen los qcow2?</p> <p>Aprovisionamiento ligero, es decir, el espacio real ocupado en disco ir\u00e1 creciendo progresivamente.</p> <p>La VM ver\u00e1 un tama\u00f1o virtual del fichero, que ser\u00e1 el m\u00e1ximo que \u00e9ste podr\u00e1 alcanzar.</p> <p>Listar los vol\u00famenes del pool discos mostrando el aprovisionamiento ligero</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-list discos --details\n Name           Path                       Type   Capacity   Allocation\n-------------------------------------------------------------------------\n disco1.qcow2   /srv/discos/disco1.qcow2   file   1.00 GiB   196.00 KiB\n disco2.qcow2   /srv/discos/disco2.qcow2   file   2.00 GiB   196.00 KiB\n</code></pre>"},{"location":"hlc/taller4-virtualizacion/#ejercicio-7","title":"Ejercicio 7","text":"<p>A\u00f1adir <code>disco1.qcow2</code> a <code>debian_adrian_j</code> con virsh</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system attach-disk debian_adrian_j /srv/discos/disco1.qcow2 vdb --driver=qemu --type disk --subdriver qcow2 --persistent\nDisk attached successfully\n</code></pre> <p>A\u00f1adir <code>disco2.qcow2</code> con virt-manager</p> <p></p> <p>Mostrar que est\u00e1n los 2 discos a\u00f1adidos:</p> <p></p> <p>Formatear ambos discos</p> <p></p> <p>Montarlos persistentemente</p> <p>Obtener los UUID de ambos discos:</p> <p></p> <p>A\u00f1adir las siguientes l\u00edneas al final de <code>/etc/fstab</code>:</p> <p></p> <p>Hacer los cambios efectivos:</p> <p></p> <p>Al reiniciar, ver\u00edamos que los montajes se mantienen</p>"},{"location":"hlc/taller4-virtualizacion/#ejercicio-8","title":"Ejercicio 8","text":"<p>Parar <code>debian_adrian_j</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system destroy debian_adrian_j\nDomain 'debian_adrian_j' destroyed\n</code></pre> <p>Redimensionar con virsh <code>disco1.qcow2</code> a 2G</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-resize disco1.qcow2 2G --pool discos\nSize of volume 'disco1.qcow2' successfully changed to 2G\n</code></pre> <p>Redimensionar con qemu-img <code>disco2.qcow2</code> a 3G</p> <pre><code>atlas@olympus:~$ sudo qemu-img resize /srv/discos/disco2.qcow2 3G\nImage resized.\n</code></pre> <p>Mostrar que los discos se han redimensionado correctamente pero los sistemas de ficheros no</p> <p></p> <p>Desmontar, redimensionar los sistemas de ficheros de ambos discos, y volver a montar</p> <p></p> <p>Mostrar que los sistemas de ficheros se han redimensionado correctamente</p> <p></p>"},{"location":"hlc/taller5-virtualizacion/","title":"Taller 5: Clonaci\u00f3n e instant\u00e1neas de m\u00e1quinas virtuales","text":"<p>La teor\u00eda para completar este taller se encuentra en el cap\u00edtulo 6 del curso de virtualizaci\u00f3n.</p>"},{"location":"hlc/taller5-virtualizacion/#entrega","title":"Entrega","text":""},{"location":"hlc/taller5-virtualizacion/#parte-1","title":"Parte 1","text":"<p>Mostrar el comando usado para clonar <code>debian11</code></p> <pre><code>virt-clone --connect=qemu:///system --original debian11 --name maquina-clonada --file /var/lib/libvirt/images/maquina-clonada.qcow2\n</code></pre> <p>\u00bfQu\u00e9 cambios has hecho en la nueva m\u00e1quina para que no sea igual a la original?</p> <p>He cambiado el hostname.</p> <p>Muestro que no cambi\u00f3 en la clonaci\u00f3n, y que lo cambiamos:</p> <p></p> <p>Tras un reinicio, el cambio ser\u00e1 efectivo:</p> <p></p>"},{"location":"hlc/taller5-virtualizacion/#parte-2","title":"Parte 2","text":"<p>Listar las VMs para que se vea <code>plantilla-linux</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list --all\n Id   Name                        State\n--------------------------------------------\n -    debian11                    shut off\n -    debian_adrian_j             shut off\n -    plantilla-linux             shut off\n -    pruebas_pruebas             shut off\n -    t1-virtualizacion_pruebas   shut off\n -    win10                       shut off\n</code></pre> <p>Captura donde se vea que da un error al iniciar <code>plantilla-linux</code></p> <p></p>"},{"location":"hlc/taller5-virtualizacion/#parte-3","title":"Parte 3","text":"<p>Captura de <code>clone-full</code> mostrando su IP</p> <p></p> <p>Captura accediendo por SSH</p> <p></p>"},{"location":"hlc/taller5-virtualizacion/#parte-4","title":"Parte 4","text":"<p>Listar las VMs para que se vea <code>clone-link</code></p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system list --all\n Id   Name                        State\n--------------------------------------------\n -    clone-full                  shut off\n -    clone-link                  shut off\n -    debian11                    shut off\n -    debian_adrian_j             shut off\n -    plantilla-linux             shut off\n -    pruebas_pruebas             shut off\n -    t1-virtualizacion_pruebas   shut off\n -    win10                       shut off\n</code></pre> <p>Mostrar informaci\u00f3n sobre el volumen <code>clone-link.qcow2</code>, para comprobar que tiene un backing store</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-info clone-link.qcow2 default\nName:           clone-link.qcow2\nType:           file\nCapacity:       20.00 GiB\nAllocation:     196.00 KiB\n</code></pre> <p>De forma directa con la salida de este comando no podemos saber si tiene un backing store, aunque lo podemos intuir por su m\u00ednimo espacio real en disco, pero si mostramos su XML directamente se ve claro:</p> <p></p> <p>\u00bfPor qu\u00e9 ocupa tan poco en disco?</p> <p>Si comparamos el espacio real ocupado por <code>clone-full</code> y <code>clone-link</code> vemos que hay una clara diferencia:</p> <p></p> <p>La raz\u00f3n es que el volumen <code>clone-link.qcow2</code> est\u00e1 usando como imagen base (backing store) el volumen de la VM <code>plantilla-linux</code>. En <code>clone-link.qcow2</code> s\u00f3lo se ir\u00e1n guardando los cambios.</p>"},{"location":"hlc/taller5-virtualizacion/#parte-5","title":"Parte 5","text":"<p>Crear un directorio en <code>clone-full</code></p> <p></p> <p>Hacer una snapshot</p> <p></p> <p>Borrar el directorio</p> <p></p> <p>Revertir el estado usando la snapshot</p> <p></p> <p>Comprobar que ha funcionado</p> <p></p> <p>Mostrar la lista de snapshots de clone-full</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system snapshot-list clone-full\n Name        Creation Time               State\n--------------------------------------------------\n snapshot1   2022-10-15 02:22:26 +0200   running\n</code></pre>"},{"location":"hlc/taller5-virtualizacion/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller5-virtualizacion/#ejercicio-1","title":"Ejercicio 1","text":"<p>Clonar la VM <code>debian11</code> con <code>virt-clone</code> y nombre <code>maquina-clonada</code></p> <pre><code>atlas@olympus:~$ virt-clone --connect=qemu:///system --original debian11 --name maquina-clonada --file /var/lib/libvirt/images/maquina-clonada.qcow2\nAllocating 'maquina-clonada.qcow2'                                                                                                                     |  20 GB  00:00:09\n\nClone 'maquina-clonada' created successfully.\n</code></pre> <p>Cambiar el hostname antiguo en <code>maquina-clonada</code></p> <p>Muestro que el hostname no cambi\u00f3 en la clonaci\u00f3n, y que lo cambiamos:</p> <p></p> <p>Tras un reinicio, el cambio ser\u00e1 efectivo:</p> <p></p>"},{"location":"hlc/taller5-virtualizacion/#ejercicio-2","title":"Ejercicio 2","text":"<p>Crear una plantilla a partir de <code>maquina-clonada</code> con nombre <code>plantilla-linux</code></p> <p>Teniendo <code>maquina-clonada</code> apagada, hago la generalizaci\u00f3n:</p> <pre><code>atlas@olympus:~$ sudo virt-sysprep -d maquina-clonada --hostname plantilla-linux\n[sudo] password for atlas:\n[   0.0] Examining the guest ...\n[   7.3] Performing \"abrt-data\" ...\n[   7.3] Performing \"backup-files\" ...\n[   7.5] Performing \"bash-history\" ...\n[   7.5] Performing \"blkid-tab\" ...\n[   7.5] Performing \"crash-data\" ...\n[   7.6] Performing \"cron-spool\" ...\n[   7.6] Performing \"dhcp-client-state\" ...\n[   7.6] Performing \"dhcp-server-state\" ...\n[   7.6] Performing \"dovecot-data\" ...\n[   7.6] Performing \"ipa-client\" ...\n[   7.6] Performing \"kerberos-hostkeytab\" ...\n[   7.6] Performing \"logfiles\" ...\n[   7.8] Performing \"machine-id\" ...\n[   7.8] Performing \"mail-spool\" ...\n[   7.8] Performing \"net-hostname\" ...\n[   7.8] Performing \"net-hwaddr\" ...\n[   7.9] Performing \"pacct-log\" ...\n[   7.9] Performing \"package-manager-cache\" ...\n[   7.9] Performing \"pam-data\" ...\n[   8.0] Performing \"passwd-backups\" ...\n[   8.0] Performing \"puppet-data-log\" ...\n[   8.0] Performing \"rh-subscription-manager\" ...\n[   8.0] Performing \"rhn-systemid\" ...\n[   8.1] Performing \"rpm-db\" ...\n[   8.1] Performing \"samba-db-log\" ...\n[   8.1] Performing \"script\" ...\n[   8.1] Performing \"smolt-uuid\" ...\n[   8.2] Performing \"ssh-hostkeys\" ...\n[   8.2] Performing \"ssh-userdir\" ...\n[   8.2] Performing \"sssd-db-log\" ...\n[   8.2] Performing \"tmp-files\" ...\n[   8.3] Performing \"udev-persistent-net\" ...\n[   8.3] Performing \"utmp\" ...\n[   8.3] Performing \"yum-uuid\" ...\n[   8.3] Performing \"customize\" ...\n[   8.4] Setting a random seed\n[   8.4] Setting the machine ID in /etc/machine-id\n[   8.4] Setting the hostname: plantilla-linux\n[   9.2] Performing \"lvm-uuids\" ...\n</code></pre> <p>Cambio tambi\u00e9n su nombre con virsh para que sea explicativo:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system domrename maquina-clonada plantilla-linux\nDomain successfully renamed\n</code></pre> <p>Pongo su disco en modo lectura:</p> <pre><code>sudo chmod -w /var/lib/libvirt/images/maquina-clonada.qcow2\n</code></pre> <p>Da un error si intentamos iniciarla:</p> <p></p>"},{"location":"hlc/taller5-virtualizacion/#ejercicio-3","title":"Ejercicio 3","text":"<p>Con <code>virt-manager</code> hacer una clonaci\u00f3n completa de <code>plantilla-linux</code> de nombre <code>clone-full</code></p> <p></p> <p>Acceder por ssh a <code>clone-full</code></p> <p>Averiguo su IP:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system domifaddr clone-full\n Name       MAC address          Protocol     Address\n-------------------------------------------------------------------------------\n vnet3      52:54:00:ed:7a:2a    ipv4         192.168.122.68/24\n</code></pre> <p>Muestro que falla el acceso:</p> <pre><code>atlas@olympus:~$ ssh debian@192.168.122.68\nssh: connect to host 192.168.122.68 port 22: Connection refused\n</code></pre> <p>Regenero las claves SSH de host en <code>clone-full</code>, y de paso le cambio el hostname:</p> <p></p> <p>Tras un reinicio, ya podr\u00edamos acceder:</p> <pre><code>atlas@olympus:~$ ssh debian@192.168.122.68\nThe authenticity of host '192.168.122.68 (192.168.122.68)' can't be established.\nECDSA key fingerprint is SHA256:W8Hf46WFG8uHS2ToxowuTgoVom7eLMVABL6BG20FZyQ.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '192.168.122.68' (ECDSA) to the list of known hosts.\ndebian@192.168.122.68's password:\nLinux clone-full 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Fri Oct 14 12:58:52 2022\ndebian@clone-full:~$\n</code></pre>"},{"location":"hlc/taller5-virtualizacion/#ejercicio-4","title":"Ejercicio 4","text":"<p>Hacer una clonaci\u00f3n enlazada de <code>plantilla-linux</code> con nombre <code>clone-link</code></p> <p>Comprobar el tama\u00f1o del volumen del que partiremos:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system domblkinfo plantilla-linux vda --human\nCapacity:       20.000 GiB\nAllocation:     1.812 GiB\nPhysical:       1.811 GiB\n</code></pre> <p>Creo el nuevo volumen usando como backing store el de <code>plantilla-linux</code>:</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system vol-create-as default clone-link.qcow2 20G --format qcow2 --backing-vol maquina-clonada.qcow2 --backing-vol-format qcow2\nVol clone-link.qcow2 created\n</code></pre> <p>Hago la clonaci\u00f3n enlazada:</p> <pre><code>atlas@olympus:~$ virt-clone --connect=qemu:///system --original plantilla-linux --name clone-link --file /var/lib/libvirt/images/clone-link.qcow2 --preserve-data\n\nClone 'clone-link' created successfully.\n</code></pre>"},{"location":"hlc/taller5-virtualizacion/#ejercicio-5","title":"Ejercicio 5","text":"<p>Crear un directorio en <code>clone-full</code></p> <p></p> <p>Hacer una snapshot</p> <pre><code>atlas@olympus:~$ virsh -c qemu:///system snapshot-create-as clone-full --name snapshot1 --description \"Critical directory created\" --atomic\nDomain snapshot snapshot1 created\n</code></pre> <p>Borrar el directorio</p> <p></p> <p>Revertir el estado usando la snapshot</p> <pre><code>virsh -c qemu:///system snapshot-revert clone-full snapshot1\n</code></pre> <p>Comprobar que ha funcionado</p> <p></p>"},{"location":"hlc/taller6-virtualizacion/","title":"Taller 6: Gesti\u00f3n de redes en QEMU/KVM + libvirt","text":"<p>La teor\u00eda para completar este taller se encuentra en el cap\u00edtulo 7 del curso de virtualizaci\u00f3n.</p> <p>test github pages</p> <p>test github pages 2</p> <p>test github pages 3</p> <p>test github pages 4</p> <p>prueba dominio .ga</p>"},{"location":"hlc/taller6-virtualizacion/#entrega","title":"Entrega","text":""},{"location":"hlc/taller6-virtualizacion/#parte-1","title":"Parte 1","text":"<p>Mostrar el comando usado para clonar <code>debian11</code></p> <pre><code>virt-clone --connect=qemu:///system --original debian11 --name maquina-clonada --file /var/lib/libvirt/images/maquina-clonada.qcow2\n</code></pre> <p>\u00bfQu\u00e9 cambios has hecho en la nueva m\u00e1quina para que no sea igual a la original?</p> <p>He cambiado el hostname.</p> <p>Muestro que no cambi\u00f3 en la clonaci\u00f3n, y que lo cambiamos:</p> <p></p> <p>Tras un reinicio, el cambio ser\u00e1 efectivo:</p> <p></p>"},{"location":"hlc/taller6-virtualizacion/#desarrollo","title":"Desarrollo","text":""},{"location":"hlc/taller6-virtualizacion/#ejercicio-1","title":"Ejercicio 1","text":"<p>Clonar la VM <code>debian11</code> con <code>virt-clone</code> y nombre <code>maquina-clonada</code></p> <pre><code>atlas@olympus:~$ virt-clone --connect=qemu:///system --original debian11 --name maquina-clonada --file /var/lib/libvirt/images/maquina-clonada.qcow2\nAllocating 'maquina-clonada.qcow2'                                                                                                                     |  20 GB  00:00:09\n\nClone 'maquina-clonada' created successfully.\n</code></pre> <p>Cambiar el hostname antiguo en <code>maquina-clonada</code></p> <p>Muestro que el hostname no cambi\u00f3 en la clonaci\u00f3n, y que lo cambiamos:</p> <p></p> <p>Tras un reinicio, el cambio ser\u00e1 efectivo:</p> <p></p>"},{"location":"iaw/2021-09-22-ej1-pull-request/","title":"Paso 1","text":"<p>Hacemos fork del repositorio https://github.com/josedom24/prueba-pr-asir para tenerlo en nuestra cuenta de Github.</p>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-2","title":"Paso 2","text":"<p>Clonamos este repositorio (el repo de nuestra cuenta, no el original) a nuestra m\u00e1quina</p> <pre><code>git clone git@github.com:adriasir123/prueba-pr-asir.git\n</code></pre>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-3","title":"Paso 3","text":"<p>Creamos una nueva branch para los cambios</p> <pre><code>git checkout -b adrian_jaramillo\n</code></pre> <p>Github al aceptar Pull Requests fusiona branches, de ah\u00ed que tengamos que crear una</p>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-4","title":"Paso 4","text":"<p>A\u00f1adimos un nuevo remote, apuntando al repositorio original. Hacemos esto para poder hacer pull desde la versi\u00f3n original del repositorio, y traernos siempre los \u00faltimos cambios.</p> <pre><code>git remote add upstream https://github.com/josedom24/prueba-pr-asir.git\n</code></pre> <p>Como curiosidad, <code>git remote show</code> muestra la lista de remotes. Ahora tengo origin y upstream.</p> <p>Ahora tenemos que hacer lo siguiente para enlazar la branch main de upstream, a mi branch personalizada.</p> <pre><code>git branch --set-upstream-to=upstream/main adrian_jaramillo\n</code></pre> <p>Despu\u00e9s de haber hecho esto, AHORA S\u00cd puedo hacer pull desde upstream, aunque me aparece el siguiente warning:</p> <pre><code>hint: Pulling without specifying how to reconcile divergent branches is\nhint: discouraged. You can squelch this message by running one of the following\nhint: commands sometime before your next pull:\nhint:\nhint:   git config pull.rebase false  # merge (the default strategy)\nhint:   git config pull.rebase true   # rebase\nhint:   git config pull.ff only       # fast-forward only\nhint:\nhint: You can replace \"git config\" with \"git config --global\" to set a default\nhint: preference for all repositories. You can also pass --rebase, --no-rebase,\nhint: or --ff-only on the command line to override the configured default per\nhint: invocation.\n</code></pre> <p>A pesar de ser tan intimidante, podemos hacer pull sin problemas.</p>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-5","title":"Paso 5","text":"<p>Antes de modificar el repositorio, tenemos que asegurarnos de que estamos en la \u00faltima versi\u00f3n del repositorio original, para no quedarnos atr\u00e1s en commits y crear conflictos.</p> <p>Para ello, hacemos</p> <pre><code>atlas@olympus:~/Desktop/iaw/ud1-intro/prueba-pr-asir$ git status\nOn branch adrian_jaramillo\nYour branch is up to date with 'upstream/main'.\n</code></pre> <p>En el caso de habernos quedado atr\u00e1s en commits, har\u00edamos</p> <pre><code>git pull\n</code></pre>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-6","title":"Paso 6","text":"<p>En el paso anterior, nos hemos asegurado de estar en la \u00faltima versi\u00f3n del repositorio.</p> <p>Procedemos a hacer los siguientes cambios...</p>"},{"location":"iaw/2021-09-22-ej1-pull-request/#cambio-1","title":"Cambio 1","text":"<p>Modifico README.md para a\u00f1adir un enlace a la lista, con mis iniciales \"ajr\" y apuntando al fichero que crear\u00e9 en el directorio files</p> <pre><code>**\u00bfQu\u00e9 asignatura te gusta m\u00e1s? Y \u00bfpor qu\u00e9?**\n\n* [jdmr](files/jdmr.md)\n* [ada](files/ada.md)\n* [lpt](files/lpt.md)\n* [cmgpdg](files/cmgpdg.md)\n* [dpg](files/dpg.md)\n* [dpg2](files/dpg2.md)\n* [oeb](files/oeb.md)\n* [ajr](files/ajr.md)\n</code></pre> <p>Al final de esa lista, vemos mi l\u00ednea a\u00f1adida.</p>"},{"location":"iaw/2021-09-22-ej1-pull-request/#cambio-2","title":"Cambio 2","text":"<p>Creo el fichero files/ajr.md</p> <pre><code>atlas@olympus:~/Desktop/iaw/ud1-intro/prueba-pr-asir/files$ ls -la\ntotal 40\ndrwxr-xr-x 2 atlas atlas 4096 Sep 23 06:50 .\ndrwxr-xr-x 4 atlas atlas 4096 Sep 23 06:41 ..\n-rw-r--r-- 1 atlas atlas  418 Sep 22 13:44 ada.md\n-rw-r--r-- 1 atlas atlas  400 Sep 23 06:50 ajr.md\n-rw-r--r-- 1 atlas atlas  119 Sep 22 14:16 cmgpdg.md\n-rw-r--r-- 1 atlas atlas  313 Sep 22 14:16 dpg.md\n-rw-r--r-- 1 atlas atlas  166 Sep 22 13:44 jdmr.md\n-rw-r--r-- 1 atlas atlas 1024 Sep 22 14:16 .jdmr.md.swp\n-rw-r--r-- 1 atlas atlas  265 Sep 22 14:16 lpt.md\n-rw-r--r-- 1 atlas atlas  115 Sep 22 14:28 oeb.md\n</code></pre> <p>Lo vemos en la segunda fila, y su contenido es el siguiente</p> <pre><code># \u00bfQu\u00e9 asignatura te gusta m\u00e1s?\n\nSinceramente nunca tuve una asignatura preferida, me gusta aprender en general.  \nPero si tengo que elegir, siempre me inclino m\u00e1s por cualquier tema relacionado con sysadmin:\n- **Sistemas operativos**\n- **Redes**\n- **\u00a1\u00a1VIRTUALIZACI\u00d3N!!**\n\n## \u00bfPor qu\u00e9?\n\n*\u00bfNecesitamos un por qu\u00e9 para dar una explicaci\u00f3n l\u00f3gica a nuestros gustos? ;)*\n\n&gt; Quote de ejemplo\n</code></pre>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-7","title":"Paso 7","text":"<p>A\u00f1adimos nuestros cambios para el siguiente commit</p> <pre><code>git add .\n</code></pre> <p>Este comando a\u00f1ade TODOS los cambios del repositorio al siguiente commit</p> <p>Hacemos el commit, con un mensaje significativo</p> <pre><code>git commit -m \"Modificaciones de AJR\"\n</code></pre> <p>Hacemos push a nuestro repo</p> <pre><code>git push origin\n</code></pre>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-8","title":"Paso 8","text":"<p>Despu\u00e9s del push, tendremos en github el bot\u00f3n \"Compare &amp; Pull Request\"</p> <p></p> <p>Aqu\u00ed muestro el pull request</p> <p></p> <p>\u00bfLo siguiente? Esperar a que el due\u00f1o del repositorio acepte los cambios.</p>"},{"location":"iaw/2021-09-22-ej1-pull-request/#paso-9","title":"Paso 9","text":"<p>Para finalizar este ejercicio, mi repositorio se debe actualizar con todos los cambios posteriores que mis compa\u00f1eros hagan</p> <pre><code>git pull\ngit push origin\n</code></pre> <p>URL a mi repositorio: https://github.com/adriasir123/prueba-pr-asir/tree/adrian_jaramillo</p>"},{"location":"iaw/2021-10-14-ej2-pr-pag-compa%C3%B1ero/","title":"Ejercicio 2: Pull Request sobre p\u00e1gina de compa\u00f1ero","text":""},{"location":"iaw/2021-10-14-ej2-pr-pag-compa%C3%B1ero/#parte-1","title":"Parte 1","text":"<p>Un pantallazo donde se vea el PR que has propuesto al repositorio de un compa\u00f1ero.</p> <p></p>"},{"location":"iaw/2021-10-14-ej2-pr-pag-compa%C3%B1ero/#parte-2","title":"Parte 2","text":"<p>Un pantallazo donde se vea el PR de un compa\u00f1ero en tu repositorio.</p> <p></p>"},{"location":"iaw/2021-10-14-ej2-pr-pag-compa%C3%B1ero/#parte-3","title":"Parte 3","text":"<p>Un pantallazo donde se vea tu p\u00e1gina con el cambio propuesto.</p> <p></p>"},{"location":"iaw/2021-10-14-ej2-pr-pag-compa%C3%B1ero/#parte-4","title":"Parte 4","text":"<p>Vuelve a mandar la URL de tu repositorio.</p> <p>https://github.com/adriasir123/practica-app-web-estatica-iaw-21-22</p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/","title":"Parte 1","text":"<p>Elije generador de p\u00e1ginas est\u00e1ticas y servicio donde desplegar la p\u00e1gina web</p> <ul> <li>MkDocs</li> <li>Neocities</li> </ul>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#parte-2","title":"Parte 2","text":"<p>Documentar la instalaci\u00f3n de MkDocs en el entorno de desarrollo.  </p> <pre><code>sudo apt install pip\npip install mkdocs\n</code></pre> <p>Generamos la estructura inicial <pre><code>mkdocs new sysadmin-docs\n</code></pre> <pre><code>INFO     -  Creating project directory: sysadmin-docs\nINFO     -  Writing config file: sysadmin-docs/mkdocs.yml\nINFO     -  Writing initial docs: sysadmin-docs/docs/index.md\n</code></pre></p> <p>Entramos <pre><code>cd sysadmin-docs\n</code></pre></p> <p>Esta es la estructura generada <pre><code>vagrant@webestatica:~/sysadmin-docs$ tree\n.\n\u251c\u2500\u2500 docs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.md\n\u2514\u2500\u2500 mkdocs.yml\n\n1 directory, 2 files\n</code></pre></p> <p>Estando en la ra\u00edz de nuestro proyecto, ejecutamos <pre><code>mkdocs serve -a 0.0.0.0:8000\n</code></pre> Lo ejecutamos de esta manera porque mi entorno de desarrollo es una VM, y necesito acceso externo.</p> <pre><code>INFO     -  Building documentation...\nWARNING  -  Config value: 'dev_addr'. Warning: The use of the IP address '0.0.0.0' suggests a production environment or the use of a proxy to connect to the MkDocs server. However, the\n            MkDocs' server is intended for local development purposes only. Please use a third party production-ready server instead.\nINFO     -  Cleaning site directory\nINFO     -  Documentation built in 0.05 seconds\nINFO     -  [08:43:27] Serving on http://0.0.0.0:8000/\n</code></pre> <p>Nos aparece ese warning, pero en nuestro caso no es relevante y lo ignoramos.</p> <p>Como vemos, <code>mkdocs serve</code> genera todo el c\u00f3digo necesario para que la web funcione, e inicia un servidor web para que podamos acceder a ella.</p> <p>Entramos a nuestra web: </p> <p>\u00a1\u00a1Dato importante! El servidor web que lanza MkDocs soporta auto-reloading.</p> <p>Esto significa que ante cualquier cambio de configuraci\u00f3n, ficheros, tema... etc:</p> <ul> <li>El servidor volver\u00e1 a generar todo el c\u00f3digo necesario</li> <li>Nuestro navegador se autorecargar\u00e1 (\u00a1no hace falta hacer f5!) y veremos los cambios autom\u00e1ticamente</li> </ul> <p>\u00bfEn qu\u00e9 lenguaje est\u00e1 desarrollado MkDocs?</p> <p>Python</p> <p>\u00bfQu\u00e9 sistema de plantillas utiliza?</p> <p>Jinja2</p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#parte-3","title":"Parte 3","text":"<p>Cambiar el nombre de la p\u00e1gina</p> <p>El fichero a modificar es <code>mkdocs.yml</code>, con el siguiente contenido: <pre><code>site_name: Sysadmin Docs\n</code></pre></p> <p>Nuestra p\u00e1gina ahora se ver\u00eda as\u00ed:  </p> <p>Cambiar el tema de la p\u00e1gina</p> <p>Instalamos el tema: <pre><code>pip install mkdocs-windmill\n</code></pre></p> <p>Modificamos <code>mkdocs.yml</code> <pre><code>site_name: Sysadmin Docs\ntheme: windmill\n</code></pre></p> <p>As\u00ed se ver\u00eda nuestra p\u00e1gina tras modificar el tema: </p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#parte-4","title":"Parte 4","text":"<p>A\u00f1ade 3 p\u00e1ginas a la web con: - Encabezado - P\u00e1rrafos - Enlace - Lista - Imagen</p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#pagina-about","title":"P\u00e1gina about","text":"<ol> <li>A\u00f1adimos <code>docs/about.md</code></li> <li>Modificamos <code>mkdocs.yml</code> para definir la nav bar, y que la p\u00e1gina sea accesible:</li> </ol> <pre><code>site_name: Sysadmin Docs\ntheme: windmill\nnav:\n    - Home: index.md\n    - About: about.md\n</code></pre> <ol> <li>As\u00ed se ver\u00eda: </li> </ol>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#pagina-seccion-1","title":"P\u00e1gina \"Secci\u00f3n 1\"","text":"<ol> <li>A\u00f1adimos <code>docs/seccion1.md</code></li> <li>Modificamos <code>mkdocs.yml</code> para que la p\u00e1gina sea accesible:</li> </ol> <pre><code>site_name: Sysadmin Docs\ntheme: windmill\nnav:\n    - Home: index.md\n    - Secci\u00f3n 1: seccion1.md\n    - About: about.md\n</code></pre> <ol> <li>As\u00ed se ver\u00eda: </li> </ol>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#pagina-seccion-2","title":"P\u00e1gina \"Secci\u00f3n 2\"","text":"<ol> <li>A\u00f1adimos <code>docs/seccion2.md</code></li> <li>Modificamos <code>mkdocs.yml</code> para que la p\u00e1gina sea accesible:</li> </ol> <pre><code>site_name: Sysadmin Docs\ntheme: windmill\nnav:\n    - Home: index.md\n    - Secci\u00f3n 1: seccion1.md\n    - Secci\u00f3n 2: seccion2.md\n    - About: about.md\n</code></pre> <ol> <li>As\u00ed se ver\u00eda: </li> </ol> <p>El c\u00f3digo que estas desarrollando, configuraci\u00f3n del generado, p\u00e1ginas en markdown... todo debe estar en un repositorio Git (no es necesario que el c\u00f3digo generado se guarde en el repositorio, ev\u00edtalo usando el fichero .gitignore)</p> <p>Repositorio: https://github.com/adriasir123/practica-app-web-estatica-iaw-21-22</p> <p>En el fichero <code>.gitignore</code> se excluye: <pre><code>site/\n</code></pre></p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#parte-5","title":"Parte 5","text":"<p>Explicar el proceso de despliegue en Neocities</p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#generar-ficheros","title":"Generar ficheros","text":"<p>Si no tenemos HTML, \u00bfno tenemos web que desplegar verdad? Por ello, antes de nada, generamos el c\u00f3digo: <pre><code>mkdocs build\n</code></pre> <pre><code>INFO     -  Cleaning site directory\nINFO     -  Building documentation to directory: /home/vagrant/sysadmin-docs/site\nINFO     -  Documentation built in 0.04 seconds\n</code></pre></p> <p>Vemos que nos ha generado un directorio <code>site</code> con todo lo necesario. Esto nos encontramos: <pre><code>vagrant@webestatica:~/sysadmin-docs$ ls -la site/\ntotal 64\ndrwxr-xr-x 10 vagrant vagrant 4096 Oct 10 21:28 .\ndrwxr-xr-x  5 vagrant vagrant 4096 Oct 10 21:28 ..\n-rw-r--r--  1 vagrant vagrant 1858 Oct 10 21:28 404.html\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 about\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 css\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 fonts\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 img\n-rw-r--r--  1 vagrant vagrant 5899 Oct 10 21:28 index.html\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 js\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 search\n-rw-r--r--  1 vagrant vagrant 2054 Oct 10 21:28 search.html\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 seccion1\ndrwxr-xr-x  2 vagrant vagrant 4096 Oct 10 21:28 seccion2\n-rw-r--r--  1 vagrant vagrant  609 Oct 10 21:28 sitemap.xml\n-rw-r--r--  1 vagrant vagrant  197 Oct 10 21:28 sitemap.xml.gz\n</code></pre></p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#despliegue-en-neocities","title":"Despliegue en Neocities","text":""},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#crear-cuenta","title":"Crear cuenta","text":"<p>https://neocities.org/</p> <p>Nuestra web ser\u00e1 accesible en: https://sysadmin-docs.neocities.org/</p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#instalar-neocities-cli","title":"Instalar Neocities CLI","text":"<p>https://neocities.org/cli</p> <pre><code>sudo apt update\nsudo apt install rubygems\nsudo gem install neocities\n</code></pre> <p>Una vez instalada la herramienta, \u00a1no estamos logeados!</p> <p>Para conseguir esto no existe un comando concreto... al ejecutar cualquier orden que necesite comunicarse con el hosting nos pedir\u00e1 logearnos.</p> <p>Por ejemplo: <pre><code>neocities list /\n</code></pre></p> <p>Con este comando mostramos ficheros remotos, y por lo tanto nos pide autenticaci\u00f3n: <pre><code>Please login to get your API key:\nsitename: sysadmin-docs\npassword: \u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\nThe api key for sysadmin-docs has been stored in /home/vagrant/.config/neocities/config.\nindex.html\n</code></pre></p> <p>\u00a1Cuidado! En el sitename escribimos s\u00f3lo la primera parte de nuestro nombre web.</p> <p>Neocities genera una estructura web de prueba, que tendremos que borrar. En mi caso borr\u00e9 todo menos <code>index.html</code>... ni siquiera desde la CLI nos permite borrarlo.</p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#subir-ficheros","title":"Subir ficheros","text":"<p>El siguiente comando subir\u00e1 recursivamente todo el contenido del directorio que le indiquemos (\u00a1su contenido, el directorio indicado no lo sube!) <pre><code>neocities push site/\n</code></pre> <pre><code>Uploading search.html ... SUCCESS\nUploading sitemap.xml ... SUCCESS\nUploading js/elasticlunr.js ... SUCCESS\nUploading js/elasticlunr.min.js ... SUCCESS\nUploading js/bootstrap-3.3.7.js ... SUCCESS\nUploading js/highlight.pack.js ... SUCCESS\nUploading js/jquery-3.2.1.js ... SUCCESS\nUploading js/base.js ... SUCCESS\nUploading js/bootstrap-3.3.7.min.js ... SUCCESS\nUploading js/jquery-3.2.1.min.js ... SUCCESS\nUploading sitemap.xml.gz ...\nERROR: sitemap.xml.gz is not a valid file type (or contains not allowed content) for this site, files have not been uploaded (invalid_file_type)\nUploading seccion1/index.html ... SUCCESS\nUploading about/index.html ... SUCCESS\nUploading 404.html ... SUCCESS\nUploading css/base.css ... SUCCESS\nUploading css/font-awesome-4.7.0.css ... SUCCESS\nUploading css/highlight.css ... SUCCESS\nUploading css/bootstrap-3.3.7.min.css ... SUCCESS\nUploading css/font-awesome-4.7.0.min.css ... SUCCESS\nUploading css/bootstrap-3.3.7.css ... SUCCESS\nUploading seccion2/index.html ... SUCCESS\nUploading img/favicon.ico ... SUCCESS\nUploading search/search_index.json ... SUCCESS\nUploading fonts/glyphicons-halflings-regular.svg ... SUCCESS\nUploading fonts/fontawesome-webfont.ttf ... SUCCESS\nUploading fonts/fontawesome-webfont.woff2 ... SUCCESS\nUploading fonts/fontawesome-webfont.eot ... SUCCESS\nUploading fonts/fontawesome-webfont.svg ... SUCCESS\nUploading fonts/glyphicons-halflings-regular.woff ... SUCCESS\nUploading fonts/glyphicons-halflings-regular.woff2 ... SUCCESS\nUploading fonts/glyphicons-halflings-regular.ttf ... SUCCESS\nUploading fonts/fontawesome-webfont.woff ... SUCCESS\nUploading fonts/glyphicons-halflings-regular.eot ... SUCCESS\nUploading index.html ... SUCCESS\n</code></pre> Vemos que hay un error, pero no es relevante. Es un fichero <code>.gz</code> que MkDocs crea, pero no tiene funci\u00f3n en que la web funcione o no.</p> <p><code>neocities push</code> sobreescribe, por lo tanto el antiguo <code>index.html</code> que no pod\u00edamos borrar, ya est\u00e1 reemplazado.</p> <p>Si queremos hacer una prueba de push, sin que suba nada, podemos hacer: <pre><code>neocities push --dry-run site/\n</code></pre></p> <p>Teniendo el c\u00f3digo subido, ya tendremos nuestra web: </p>"},{"location":"iaw/2021-10-5-implantacion-despliegue-aplicacion-web-estatica/#parte-6","title":"Parte 6","text":"<p>Usar Git Hook para automatizar: generaci\u00f3n de la p\u00e1gina + despliegue en Neocities. Mostrar al profesor un ejemplo de como al modificar la p\u00e1gina se realiza la puesta en producci\u00f3n de forma autom\u00e1tica.</p> <p>Creamos el fichero de Git Hook: <pre><code>touch .git/hooks/pre-push\n</code></pre></p> <p>Su contenido ser\u00e1: <pre><code>#!/bin/sh\n\nmkdocs build\nneocities push site/\n</code></pre></p> <p>Lo hacemos ejecutable: <pre><code>chmod u+x .git/hooks/pre-push\n</code></pre></p> <p>Un Git Hook de \"pre-push\" es un script que se ejecuta antes de que la acci\u00f3n de push tome efecto. Por lo tanto, al hacer <code>git push</code>, esto pasar\u00eda: <pre><code>INFO     -  Cleaning site directory\nINFO     -  Building documentation to directory: /home/vagrant/sysadmin-docs/site\nINFO     -  Documentation built in 0.11 seconds\nUploading search.html ... EXISTS\nUploading sitemap.xml ... EXISTS\nUploading js/elasticlunr.js ... EXISTS\nUploading js/elasticlunr.min.js ... EXISTS\nUploading js/bootstrap-3.3.7.js ... EXISTS\nUploading js/highlight.pack.js ... EXISTS\nUploading js/jquery-3.2.1.js ... EXISTS\nUploading js/base.js ... EXISTS\nUploading js/bootstrap-3.3.7.min.js ... EXISTS\nUploading js/jquery-3.2.1.min.js ... EXISTS\nUploading sitemap.xml.gz ...\nERROR: sitemap.xml.gz is not a valid file type (or contains not allowed content) for this site, files have not been uploaded (invalid_file_type)\nUploading seccion1/index.html ... EXISTS\nUploading about/index.html ... SUCCESS\nUploading 404.html ... EXISTS\nUploading css/base.css ... EXISTS\nUploading css/font-awesome-4.7.0.css ... EXISTS\nUploading css/highlight.css ... EXISTS\nUploading css/bootstrap-3.3.7.min.css ... EXISTS\nUploading css/font-awesome-4.7.0.min.css ... EXISTS\nUploading css/bootstrap-3.3.7.css ... EXISTS\nUploading seccion2/index.html ... EXISTS\nUploading img/favicon.ico ... EXISTS\nUploading search/search_index.json ... SUCCESS\nUploading fonts/glyphicons-halflings-regular.svg ... EXISTS\nUploading fonts/fontawesome-webfont.ttf ... EXISTS\nUploading fonts/fontawesome-webfont.woff2 ... EXISTS\nUploading fonts/fontawesome-webfont.eot ... EXISTS\nUploading fonts/fontawesome-webfont.svg ... EXISTS\nUploading fonts/glyphicons-halflings-regular.woff ... EXISTS\nUploading fonts/glyphicons-halflings-regular.woff2 ... EXISTS\nUploading fonts/glyphicons-halflings-regular.ttf ... EXISTS\nUploading fonts/fontawesome-webfont.woff ... EXISTS\nUploading fonts/glyphicons-halflings-regular.eot ... EXISTS\nUploading index.html ... SUCCESS\nEnumerating objects: 7, done.\nCounting objects: 100% (7/7), done.\nCompressing objects: 100% (4/4), done.\nWriting objects: 100% (4/4), 529 bytes | 529.00 KiB/s, done.\nTotal 4 (delta 1), reused 0 (delta 0), pack-reused 0\nremote: Resolving deltas: 100% (1/1), completed with 1 local object.\nTo github.com:adriasir123/practica-app-web-estatica-iaw-21-22.git\n   e0be61b..ecf9afe  main -&gt; main\n</code></pre></p> <p>He a\u00f1adido una l\u00ednea a la p\u00e1gina \"About\" para hacer esta prueba: </p> <p>Esa l\u00ednea se ha a\u00f1adido autom\u00e1ticamente al hacer push, porque el hook generaba la p\u00e1gina y luego hac\u00eda push a Neocities.</p>"},{"location":"iaw/ej1-apps-flask-apache2-mod_wsgi/","title":"Ejercicio 1: Desplegando aplicaciones flask con Apache + mod_wsgi","text":"<p>En esta tarea se usa la aplicaci\u00f3n Guestbook.</p>"},{"location":"iaw/ej1-apps-flask-apache2-mod_wsgi/#crear-venv","title":"Crear venv","text":"<pre><code>mkdir venv\ncd venv\nsudo apt update\nsudo apt install python3-venv\npython3 -m venv .\nsource bin/activate\n</code></pre>"},{"location":"iaw/ej1-apps-flask-apache2-mod_wsgi/#descargar-guestbook","title":"Descargar Guestbook","text":"<pre><code>sudo apt install git\ngit clone https://github.com/josedom24/guestbook.git\npip install -r requirements.txt\nsudo apt install redis\n</code></pre>"},{"location":"iaw/ej1-apps-flask-apache2-mod_wsgi/#probar-funcionamiento","title":"Probar funcionamiento","text":"<p>Por ahora, usando el servidor de desarrollo: <pre><code>python3 app.py\n</code></pre></p> <p></p>"},{"location":"iaw/ej1-apps-flask-apache2-mod_wsgi/#fichero-wsgi","title":"Fichero wsgi","text":"<p><code>/home/vagrant/guestbook/app/wsgi.py</code> <pre><code>from app import prog as application\n</code></pre></p>"},{"location":"iaw/ej1-apps-flask-apache2-mod_wsgi/#hacer-que-apache-sirva-guestbook","title":"Hacer que Apache sirva Guestbook","text":"<pre><code>sudo apt install apache2\nsudo apt install libapache2-mod-wsgi-py3\n</code></pre> <p>Creo <code>/etc/apache2/sites-available/guestbook.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n\n        ServerName www.guestbook.com\n        DocumentRoot /home/vagrant/guestbook/app\n\n        &lt;Directory /home/vagrant/guestbook/app&gt;\n            Require all granted\n        &lt;/Directory&gt;\n\n        WSGIDaemonProcess guestbook python-path=/home/vagrant/guestbook/app:/home/vagrant/venv/lib/python3.9/site-packages\n        WSGIProcessGroup guestbook\n        WSGIScriptAlias / /home/vagrant/guestbook/app/wsgi.py process-group=guestbook\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Lo habilito: <pre><code>sudo a2ensite guestbook.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># ej1-apps-flask-apache2-mod_wsgi resolutions\n192.168.121.136 www.guestbook.com\n</code></pre></p>"},{"location":"iaw/ej1-apps-flask-apache2-mod_wsgi/#probar-funcionamiento-apache","title":"Probar funcionamiento Apache","text":""},{"location":"iaw/ej1-phpmyadmin/","title":"Ejercicio 1: Instalaci\u00f3n de phpmyadmin","text":""},{"location":"iaw/ej1-phpmyadmin/#entrega","title":"ENTREGA","text":""},{"location":"iaw/ej1-phpmyadmin/#parte-1","title":"Parte 1","text":"<p>Captura donde se vea la base de datos creada en el punto 1</p> <p></p>"},{"location":"iaw/ej1-phpmyadmin/#parte-2","title":"Parte 2","text":"<p>\u00bfC\u00f3mo has quitado la configuraci\u00f3n de acceso a phpmyadmin en el punto 5?</p> <pre><code>sudo a2disconf phpmyadmin\nsudo systemctl restart apache2\n</code></pre>"},{"location":"iaw/ej1-phpmyadmin/#parte-3","title":"Parte 3","text":"<p>Captura del VirtualHost</p> <p></p>"},{"location":"iaw/ej1-phpmyadmin/#parte-4","title":"Parte 4","text":"<p>Captura accediendo a phpmyadmin con el usuario del punto 1</p> <p></p> <p>A la derecha en rojo muestro el campo donde se indica con qu\u00e9 usuario hemos iniciado sesi\u00f3n.</p>"},{"location":"iaw/ej1-phpmyadmin/#realizacion","title":"REALIZACI\u00d3N","text":""},{"location":"iaw/ej1-phpmyadmin/#paso-0","title":"Paso 0","text":"<p>Instalar <code>mariadb-server</code></p> <pre><code>sudo apt update\nsudo apt install mariadb-server\n</code></pre> <p>Hacer que el usuario root acceda con contrase\u00f1a</p> <p>Por defecto el usuario root puede hacer login sin contrase\u00f1a, porque internamente mariadb lo almacena con una password inv\u00e1lida: <pre><code>MariaDB [(none)]&gt; SELECT host, user, password FROM mysql.user;\n+-----------+-------------+----------+\n| Host      | User        | Password |\n+-----------+-------------+----------+\n| localhost | mariadb.sys |          |\n| localhost | root        | invalid  |\n| localhost | mysql       | invalid  |\n+-----------+-------------+----------+\n</code></pre></p> <p>Este funcionamiento es intencional, para que luego nosotros manualmente cambiemos a la contrase\u00f1a que queramos.</p> <p>Cambio la contrase\u00f1a con: <pre><code>ALTER USER 'root'@'localhost' IDENTIFIED BY 'vagrant';\n</code></pre></p> <p>Despu\u00e9s de esto, la contrase\u00f1a se almacena: <pre><code>MariaDB [(none)]&gt; SELECT host, user, password FROM mysql.user;\n+-----------+-------------+-------------------------------------------+\n| Host      | User        | Password                                  |\n+-----------+-------------+-------------------------------------------+\n| localhost | mariadb.sys |                                           |\n| localhost | root        | *04E6E1273D1783DF7D57DC5479FE01CFFDFD0058 |\n| localhost | mysql       | invalid                                   |\n+-----------+-------------+-------------------------------------------+\n</code></pre></p> <p>Ya podr\u00edamos hacer login normalmente con: <pre><code>mysql -u root -p\n</code></pre></p> <p>A partir de ahora, de cualquier manera que intentemos entrar con root (con sudo o sin sudo por ejemplo), nos obligar\u00e1 a escribir la contrase\u00f1a.</p>"},{"location":"iaw/ej1-phpmyadmin/#paso-1","title":"Paso 1","text":"<p>Acceder a mariadb con root y contrase\u00f1a</p> <pre><code>mysql -u root -p\n</code></pre> <p>Crear base de datos</p> <pre><code>CREATE DATABASE `phpmyadmin_db`;\n</code></pre> <p>Crear usuario con permisos sobre <code>phpmyadmin_db</code></p> <pre><code>CREATE USER 'phpmyadmin_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'phpmyadmin_user'@localhost IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `phpmyadmin_db`.* TO 'phpmyadmin_user'@localhost;\n\nFLUSH PRIVILEGES;\n</code></pre> <p>Muestro que los cambios se han hecho: <pre><code>MariaDB [(none)]&gt; SHOW GRANTS FOR 'phpmyadmin_user'@localhost;   \n+------------------------------------------------------------------------------------------------------------------------+\n| Grants for phpmyadmin_user@localhost                                                                                   |\n+------------------------------------------------------------------------------------------------------------------------+\n| GRANT USAGE ON *.* TO `phpmyadmin_user`@`localhost` IDENTIFIED BY PASSWORD '*A4B6157319038724E3560894F7F932C8886EBFCF' |\n| GRANT ALL PRIVILEGES ON `phpmyadmin_db`.* TO `phpmyadmin_user`@`localhost`                                             |\n+------------------------------------------------------------------------------------------------------------------------+\n</code></pre></p>"},{"location":"iaw/ej1-phpmyadmin/#paso-2","title":"Paso 2","text":"<p>Instalar <code>phpmyadmin</code> desde repositorios</p> <pre><code>sudo apt install phpmyadmin\n</code></pre> <p>Nos pregunta qu\u00e9 servidor web queremos dejar configurado para <code>phpmyadmin</code>, y eligimos <code>apache2</code>: </p> <p>Decimos que s\u00ed para que configure la base de datos <code>phpmyadmin_db</code> que usar\u00e1 <code>phpmyadmin</code>: </p> <p>Especificamos m\u00e9todo de conexi\u00f3n a MariaDB por Unix socket: </p> <p>Dejamos por defecto el m\u00e9todo de autenticaci\u00f3n con MariaDB: </p> <p>Base de datos a utilizar por <code>phpmyadmin</code>: </p> <p>Usuario para la conexi\u00f3n con esa base de datos: </p> <p>Escribimos <code>1234</code>, la contrase\u00f1a del usuario <code>phpmyadmin_user</code>. La necesitar\u00e1 para poder acceder y configurar su base de datos:</p> <p></p> <p>Confirmamos la contrase\u00f1a:</p> <p></p> <p>Termina la instalaci\u00f3n</p> <p>Comprobar el acceso en /phpmyadmin</p> <p>Por defecto, tenemos este \"error\": </p> <p>Lo escribo entre comillas porque no es un error en s\u00ed, sino que apache no tiene funcionando la ejecuci\u00f3n de c\u00f3digo php. Nos est\u00e1 mostrando el <code>index.php</code> en crudo.</p> <p>Para solucionarlo: <pre><code>sudo apt install php\nsudo a2enmod php7.4\n</code></pre></p> <p>Hacemos Ctrl F5 para recargar ignorando la cach\u00e9, y ya funciona: </p>"},{"location":"iaw/ej1-phpmyadmin/#paso-3","title":"Paso 3","text":"<p>\u00bfSe ha creado en el DocumentRoot un directorio que se llama phpmyadmin?</p> <p>No.</p> <p>\u00bfC\u00f3mo es que podemos acceder?</p> <p>El paquete <code>phpmyadmin</code> nos gener\u00f3 el enlace simb\u00f3lico <code>phpmyadmin.conf</code> en <code>/etc/apache2/conf-available</code>, que por defecto se habilita en <code>conf-enabled</code>.</p> <p>El fichero original <code>/etc/phpmyadmin/apache.conf</code> contiene 2 directivas que hacen que funcione el acceso: <pre><code>Alias /phpmyadmin /usr/share/phpmyadmin\n\n&lt;Directory /usr/share/phpmyadmin&gt;\n</code></pre> (he mostrado s\u00f3lo lo necesario, en el fichero original hay mucho m\u00e1s)</p> <p>Lo que exista en <code>conf-enabled</code> es configuraci\u00f3n global, por lo tanto este Alias y Directory se tendr\u00edan en cuenta desde cualquier VirtualHost.</p>"},{"location":"iaw/ej1-phpmyadmin/#paso-5","title":"Paso 5","text":"<p>Deshabilitar acceso a phpmyadmin</p> <pre><code>sudo a2disconf phpmyadmin\nsudo systemctl restart apache2\n</code></pre> <p>Comprobar que no se puede acceder</p> <p></p> <p>Crear VirtualHost con <code>ServerName</code> <code>basededatos.adrianjaramillo.org</code> y que muestre phpmyadmin</p> <p>Creo <code>/etc/apache2/sites-available/phpmyadmin.conf</code> con el siguiente contenido: <pre><code>&lt;VirtualHost *:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n\n    ServerName basededatos.adrianjaramillo.org\n    DocumentRoot /usr/share/phpmyadmin\n\n        &lt;Directory /usr/share/phpmyadmin&gt;\n            Options SymLinksIfOwnerMatch\n            DirectoryIndex index.php\n\n            # limit libapache2-mod-php to files and directories necessary by pma\n            &lt;IfModule mod_php7.c&gt;\n                php_admin_value upload_tmp_dir /var/lib/phpmyadmin/tmp\n                php_admin_value open_basedir /usr/share/phpmyadmin/:/usr/share/doc/phpmyadmin/:/etc/phpmyadmin/:/var/lib/phpmyadmin/:/usr/share/php/:/usr/share/javascript/\n            &lt;/IfModule&gt;\n\n        &lt;/Directory&gt;\n\n        # Disallow web access to directories that don't need it\n        &lt;Directory /usr/share/phpmyadmin/templates&gt;\n            Require all denied\n        &lt;/Directory&gt;\n        &lt;Directory /usr/share/phpmyadmin/libraries&gt;\n            Require all denied\n        &lt;/Directory&gt;\n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre></p> <p>Lo habilito: <pre><code>sudo a2ensite phpmyadmin.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># ej1-phpmyadmin resolutions\n192.168.121.96 basededatos.adrianjaramillo.org\n</code></pre></p> <p>Muestro que accedo a phpmyadmin desde nombre y funciona: </p>"},{"location":"iaw/ej1-phpmyadmin/#paso-6","title":"Paso 6","text":"<p>Acceder a phpmyadmin con el usuario del punto 1 <code>phpmyadmin_user</code></p> <p>A la derecha vemos que estamos conectados con el usuario requerido: </p> <p>Comprobar que podemos gestionar su base de datos</p> <p>Muestro que puedo crear una tabla: </p> <p>Muestro que puedo borrar una tabla: </p>"},{"location":"iaw/ej2-apache2-gunicorn/","title":"Ejercicio 2: Desplegando aplicaciones flask con Apache + gunicorn","text":"<p>En esta tarea se usa la aplicaci\u00f3n Guestbook.</p>"},{"location":"iaw/ej2-apache2-gunicorn/#crear-venv","title":"Crear venv","text":"<pre><code>mkdir venv\ncd venv\nsudo apt update\nsudo apt install python3-venv\npython3 -m venv .\nsource bin/activate\n</code></pre>"},{"location":"iaw/ej2-apache2-gunicorn/#descargar-guestbook","title":"Descargar Guestbook","text":"<pre><code>sudo apt install git\ngit clone https://github.com/josedom24/guestbook.git\npip install -r requirements.txt\nsudo apt install redis\n</code></pre>"},{"location":"iaw/ej2-apache2-gunicorn/#fichero-wsgi","title":"Fichero wsgi","text":"<p><code>/home/vagrant/guestbook/app/wsgi.py</code> <pre><code>from app import prog as application\n</code></pre></p>"},{"location":"iaw/ej2-apache2-gunicorn/#instalar-gunicorn","title":"Instalar Gunicorn","text":"<pre><code>pip install gunicorn\n</code></pre>"},{"location":"iaw/ej2-apache2-gunicorn/#probar-funcionamiento","title":"Probar funcionamiento","text":"<pre><code>gunicorn -w 2 -b :8080 wsgi\n</code></pre>"},{"location":"iaw/ej2-apache2-gunicorn/#crear-unidad-systemd","title":"Crear unidad systemd","text":"<p><code>/etc/systemd/system/gunicorn-guestbook.service</code>: <pre><code>[Unit]\nDescription=gunicorn-guestbook\nAfter=network.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=www-data\nGroup=www-data\nRestart=always\n\nExecStart=/home/vagrant/venv/bin/gunicorn -w 2 -b :8080 wsgi\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s TERM $MAINPID\n\nWorkingDirectory=/home/vagrant/guestbook/app\nEnvironment=PYTHONPATH='/home/vagrant/guestbook/app:/home/vagrant/venv/lib/python3.9/site-packages'\n\nPrivateTmp=true\n</code></pre></p> <p>La activo e inicio: <pre><code>sudo systemctl enable gunicorn-guestbook.service\nsudo systemctl start gunicorn-guestbook.service\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ej2-apache2-gunicorn/#apache-gunicorn","title":"Apache + Gunicorn","text":"<pre><code>sudo apt install apache2\nsudo a2enmod proxy_http\n</code></pre> <p>Creo <code>/etc/apache2/sites-available/guestbook.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n\n        ServerName www.guestbook-gunicorn.com\n        DocumentRoot /home/vagrant/guestbook/app\n\n        &lt;Directory /home/vagrant/guestbook/app&gt;\n            Require all granted\n        &lt;/Directory&gt;\n\n        ProxyPass / http://127.0.0.1:8080/\n        ProxyPassReverse / http://127.0.0.1:8080/\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Lo habilito: <pre><code>sudo a2ensite guestbook.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># ej2-guestbook-gunicorn resolutions\n192.168.121.2 www.guestbook-gunicorn.com\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ej2-apache2-gunicorn/#nginx-gunicorn","title":"Nginx + Gunicorn","text":"<pre><code>sudo apt install nginx\n</code></pre> <p>Creo <code>/etc/nginx/sites-available/guestbook.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name www.guestbook-gunicorn.com;\n    root /home/vagrant/guestbook/app;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        include proxy_params;\n    }\n\n}\n</code></pre></p> <p>Lo habilito: <pre><code>sudo ln -s /etc/nginx/sites-available/guestbook.conf /etc/nginx/sites-enabled/\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ej2-bookmedik/","title":"Ejercicio 2: Instalaci\u00f3n de BookMedik","text":""},{"location":"iaw/ej2-bookmedik/#entrega","title":"ENTREGA","text":""},{"location":"iaw/ej2-bookmedik/#parte-1","title":"Parte 1","text":"<p>Captura del VirtualHost</p> <p></p>"},{"location":"iaw/ej2-bookmedik/#parte-2","title":"Parte 2","text":"<p>Contenido del fichero <code>core/controller/Database.php</code></p> <pre><code>&lt;?php\nclass Database {\n    public static $db;\n    public static $con;\n    function Database(){\n        $this-&gt;user=\"bookmedik_user\";$this-&gt;pass=\"1234\";$this-&gt;host=\"localhost\";$this-&gt;ddbb=\"bookmedik\";\n    }\n\n    function connect(){\n        $con = new mysqli($this-&gt;host,$this-&gt;user,$this-&gt;pass,$this-&gt;ddbb);\n        $con-&gt;query(\"set sql_mode=''\");\n        return $con;\n    }\n\n    public static function getCon(){\n        if(self::$con==null &amp;&amp; self::$db==null){\n            self::$db = new Database();\n            self::$con = self::$db-&gt;connect();\n        }\n        return self::$con;\n    }\n\n}\n?&gt;\n</code></pre>"},{"location":"iaw/ej2-bookmedik/#parte-3","title":"Parte 3","text":"<p>Captura de bookmedik, despu\u00e9s de login</p> <p></p>"},{"location":"iaw/ej2-bookmedik/#parte-4","title":"Parte 4","text":"<p>Indicar ruta completa al fichero donde se modifica <code>memory_limit</code></p> <p><code>/etc/php/7.4/apache2/php.ini</code></p> <p>Captura de <code>info.php</code> donde se vea el cambio</p> <p></p>"},{"location":"iaw/ej2-bookmedik/#realizacion","title":"REALIZACI\u00d3N","text":""},{"location":"iaw/ej2-bookmedik/#paso-0","title":"Paso 0","text":"<p>Instalar <code>mariadb-server</code></p> <pre><code>sudo apt update\nsudo apt install mariadb-server\n</code></pre>"},{"location":"iaw/ej2-bookmedik/#paso-1","title":"Paso 1","text":"<p>Descargar <code>schema.sql</code> (copia de seguridad de la BD) del repositorio https://github.com/evilnapsis/bookmedik</p> <p>En el repositorio, abrir la versi\u00f3n \"raw\" de <code>schema.sql</code>.  </p> <p>Despu\u00e9s, descargar este fichero usando la URL en modo raw: <pre><code>wget https://raw.githubusercontent.com/evilnapsis/bookmedik/master/schema.sql\n</code></pre></p> <p>Importar la copia de seguridad <code>schema.sql</code></p> <pre><code>sudo mysql -u root &lt; schema.sql\n</code></pre> <p>Vemos que se ha creado la base de datos <code>bookmedik</code>: <pre><code>MariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| bookmedik          |\n| information_schema |\n| mysql              |\n| performance_schema |\n+--------------------+\n</code></pre></p> <p>Crear usuario con privilegios sobre <code>bookmedik</code></p> <pre><code>CREATE USER 'bookmedik_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'bookmedik_user'@localhost IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `bookmedik`.* TO 'bookmedik_user'@localhost;\n\nFLUSH PRIVILEGES;\n</code></pre>"},{"location":"iaw/ej2-bookmedik/#paso-2","title":"Paso 2","text":"<p>Instalar apache2 y php</p> <pre><code>sudo apt install apache2\nsudo apt install php php-mysql\n</code></pre> <p>Crear VirtualHost con <code>ServerName</code> <code>bookmedik.adrianjaramillo.org</code></p> <pre><code>&lt;VirtualHost *:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n\n    ServerName bookmedik.adrianjaramillo.org\n    DocumentRoot /var/www/bookmedik\n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre> <p>Lo habilito: <pre><code>sudo a2ensite bookmedik.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># ej2-bookmedik resolutions\n192.168.121.67 bookmedik.adrianjaramillo.org\n</code></pre></p> <p>Clonar https://github.com/evilnapsis/bookmedik en el DocumentRoot <code>/var/www/bookmedik</code></p> <pre><code>git clone https://github.com/evilnapsis/bookmedik .\n</code></pre> <p>Este clonado no nos crea un directorio donde mete el repositorio, sino que directamente clona los contenidos al directorio actual.</p> <p>La \u00fanica condici\u00f3n para que este clonado funcione, es que el directorio destino est\u00e9 vac\u00edo.</p>"},{"location":"iaw/ej2-bookmedik/#paso-3","title":"Paso 3","text":"<p>Modifica <code>core/controller/Database.php</code> con los datos de acceso a la BD creada en el paso 1</p> <p>Este es el fragmento modificado: <pre><code>function Database(){\n    $this-&gt;user=\"bookmedik_user\";$this-&gt;pass=\"1234\";$this-&gt;host=\"localhost\";$this-&gt;ddbb=\"bookmedik\";\n}\n</code></pre></p>"},{"location":"iaw/ej2-bookmedik/#paso-4","title":"Paso 4","text":"<p>Acceder a <code>bookmedik.adrianjaramillo.org</code> con usuario admin y contrase\u00f1a admin</p> <p></p>"},{"location":"iaw/ej2-bookmedik/#paso-5","title":"Paso 5","text":"<p>Cambia el <code>memory_limit</code> a 256M en <code>php.ini</code></p> <p>Antes de nada, tenemos que averiguar d\u00f3nde se encuentra nuestro fichero <code>php.ini</code>.  </p> <p>\u00a1OJO! Hay 2 ficheros <code>php.ini</code>, as\u00ed que tenemos que encontrar el usado por apache, EL DE CLI NO.</p> <p>Me descargo un fichero <code>info.php</code> de prueba en <code>/var/www/bookmedik</code> para encontrar la ruta al <code>php.ini</code> que se est\u00e1 usando: <pre><code>sudo wget https://gist.githubusercontent.com/SyntaxC4/5648247/raw/94277156638f9c309f2e36e19bff378ba7364907/info.php\n</code></pre></p> <p>Aqu\u00ed muestro la ruta: </p> <p>En <code>/etc/php/7.4/apache2/php.ini</code> modificamos tal que as\u00ed: <pre><code>; Maximum amount of memory a script may consume\n; http://php.net/memory-limit\nmemory_limit = 256M\n</code></pre></p> <p>Reiniciamos apache <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Muestro que el valor <code>memory_limit</code> es ahora el correcto: </p>"},{"location":"iaw/ej3-apache-uwsgi/","title":"Ejercicio 3: Desplegando aplicaciones flask con Apache/Nginx + uwsgi","text":"<p>En esta tarea se usa la aplicaci\u00f3n Guestbook.</p>"},{"location":"iaw/ej3-apache-uwsgi/#crear-venv","title":"Crear venv","text":"<pre><code>mkdir venv\ncd venv\nsudo apt update\nsudo apt install python3-venv\npython3 -m venv .\nsource bin/activate\n</code></pre>"},{"location":"iaw/ej3-apache-uwsgi/#descargar-guestbook","title":"Descargar Guestbook","text":"<pre><code>sudo apt install git\ngit clone https://github.com/josedom24/guestbook.git\npip install -r requirements.txt\nsudo apt install redis\n</code></pre>"},{"location":"iaw/ej3-apache-uwsgi/#fichero-wsgi","title":"Fichero wsgi","text":"<p><code>/home/vagrant/guestbook/app/wsgi.py</code> <pre><code>from app import prog as application\n</code></pre></p>"},{"location":"iaw/ej3-apache-uwsgi/#instalar-uwsgi","title":"Instalar uwsgi","text":"<pre><code>sudo apt install libpython3.9-dev build-essential\npip install uwsgi\n</code></pre>"},{"location":"iaw/ej3-apache-uwsgi/#probar-funcionamiento","title":"Probar funcionamiento","text":"<pre><code>uwsgi --http :8080 --chdir /home/vagrant/guestbook/app --wsgi-file wsgi.py --process 4 --threads 2 --master\n</code></pre> <p>Creo <code>/home/vagrant/guestbook/app/guestbook.ini</code>: <pre><code>[uwsgi]\nhttp = :8080\nchdir = /home/vagrant/guestbook/app\nwsgi-file = wsgi.py\nprocesses = 4\nthreads = 2\n</code></pre></p> <p>Ejecuto: <pre><code>uwsgi guestbook.ini\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ej3-apache-uwsgi/#crear-unidad-systemd","title":"Crear unidad systemd","text":"<p><code>/etc/systemd/system/uwsgi-guestbook.service</code>: <pre><code>[Unit]\nDescription=uwsgi-guestbook\nAfter=network.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=www-data\nGroup=www-data\nRestart=always\n\nExecStart=/home/vagrant/venv/bin/uwsgi /home/vagrant/guestbook/app/guestbook.ini\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s TERM $MAINPID\n\nWorkingDirectory=/home/vagrant/guestbook/app\nEnvironment=PYTHONPATH='/home/vagrant/guestbook/app:/home/vagrant/venv/lib/python3.9/site-packages'\n\nPrivateTmp=true\n</code></pre></p> <p>La activo e inicio: <pre><code>sudo systemctl enable uwsgi-guestbook.service\nsudo systemctl start uwsgi-guestbook.service\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ej3-apache-uwsgi/#apache-uwsgi","title":"Apache + uWSGI","text":"<pre><code>sudo apt install apache2\nsudo a2enmod proxy_http\n</code></pre> <p>Creo <code>/etc/apache2/sites-available/guestbook.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n\n        ServerName www.guestbook-uwsgi.com\n        DocumentRoot /home/vagrant/guestbook/app\n\n        &lt;Directory /home/vagrant/guestbook/app&gt;\n            Require all granted\n        &lt;/Directory&gt;\n\n        ProxyPass / http://127.0.0.1:8080/\n        ProxyPassReverse / http://127.0.0.1:8080/\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Lo habilito: <pre><code>sudo a2ensite guestbook.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># ej3-apache-nginx-uwsgi resolutions\n192.168.121.93 www.guestbook-uwsgi.com\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ej3-apache-uwsgi/#nginx-uwsgi","title":"Nginx + uWSGI","text":"<pre><code>sudo apt install nginx\n</code></pre> <p>Creo <code>/etc/nginx/sites-available/guestbook.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name www.guestbook-uwsgi.com;\n    root /home/vagrant/guestbook/app;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        include proxy_params;\n    }\n\n}\n</code></pre></p> <p>Lo habilito: <pre><code>sudo ln -s /etc/nginx/sites-available/guestbook.conf /etc/nginx/sites-enabled\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ej3-phpfpm/","title":"Ejercicio 3: Ejecuci\u00f3n de PHP con PHP-FPM","text":""},{"location":"iaw/ej3-phpfpm/#entrega","title":"ENTREGA","text":""},{"location":"iaw/ej3-phpfpm/#parte-1","title":"Parte 1","text":"<p>Captura para comprobar que se est\u00e1n ejecutando procesos php-fpm</p> <p>Mediante <code>top</code>:</p> <p></p> <p>Mediante <code>systemctl</code>:</p> <p></p>"},{"location":"iaw/ej3-phpfpm/#parte-2","title":"Parte 2","text":"<p>Configurar Apache para que utilice php-fpm</p> <p>Activo el m\u00f3dulo: <pre><code>sudo a2enmod proxy_fcgi\n</code></pre></p> <p>Activo la configuraci\u00f3n php-fpm global: <pre><code>sudo a2enconf php7.4-fpm\n</code></pre></p> <p>Reinicio apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p>"},{"location":"iaw/ej3-phpfpm/#parte-3","title":"Parte 3","text":"<p>Captura de <code>info.php</code> donde se vea que se utiliza php-fpm</p> <p></p>"},{"location":"iaw/ej3-phpfpm/#parte-4","title":"Parte 4","text":"<p>Captura de phpBB funcionando</p> <p></p> <p>Captura de ConcreteCMS funcionando</p> <p></p>"},{"location":"iaw/ej3-phpfpm/#parte-5","title":"Parte 5","text":"<p>Hacer que php-fpm escuche por socket TCP</p> <p>Modificar <code>/etc/php/7.4/fpm/pool.d/www.conf</code>: <pre><code>listen = 127.0.0.1:9000\n</code></pre></p> <p>Reiniciar php-fpm: <pre><code>sudo systemctl restart php7.4-fpm.service\n</code></pre></p> <p>Hacer que Apache se comunique con php-fpm por socket TCP</p> <p>Modificar <code>/etc/apache2/conf-available/php7.4-fpm.conf</code>: <pre><code>&lt;FilesMatch \".+\\.ph(ar|p|tml)$\"&gt;\n        SetHandler \"proxy:fcgi://127.0.0.1:9000/\"\n&lt;/FilesMatch&gt;\n</code></pre></p> <p>Reiniciar Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p>"},{"location":"iaw/ej3-phpfpm/#parte-6","title":"Parte 6","text":"<p>Indicar el fichero modificado para cambiar el <code>memory_limit</code></p> <p><code>/etc/php/7.4/fpm/php.ini</code></p> <p>Captura de <code>info.php</code> donde se vea el cambio</p> <p></p>"},{"location":"iaw/ej3-phpfpm/#realizacion","title":"REALIZACI\u00d3N","text":"<p>Los siguientes pasos se realizan sobre el escenario de la pr\u00e1ctica \"Implantaci\u00f3n de aplicaciones web php\".</p>"},{"location":"iaw/ej3-phpfpm/#paso-1","title":"Paso 1","text":"<p>Desinstalar el m\u00f3dulo de apache que permite ejecutar PHP</p> <pre><code>sudo apt purge libapache2-mod-php7.4\n</code></pre> <p>Sabemos que ha surtido efecto porque al probar nuestra web, no funciona y ahora nos devuelve c\u00f3digo php en crudo:</p> <p></p>"},{"location":"iaw/ej3-phpfpm/#paso-2","title":"Paso 2","text":"<p>Instalar php-fpm</p> <pre><code>sudo apt install php7.4-fpm\n</code></pre>"},{"location":"iaw/ej3-phpfpm/#paso-3","title":"Paso 3","text":"<p>Configurar Apache para que utilice php-fpm globalmente (para todos los VirtualHost)</p> <p>Activo el m\u00f3dulo: <pre><code>sudo a2enmod proxy_fcgi\n</code></pre></p> <p>Activo la configuraci\u00f3n php-fpm global: <pre><code>sudo a2enconf php7.4-fpm\n</code></pre></p> <p>Reinicio apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p>"},{"location":"iaw/ej3-phpfpm/#paso-4","title":"Paso 4","text":"<p>Acceder a un <code>info.php</code> para comprobar que se est\u00e1 usando php-fpm</p> <p>En el DocumentRoot de phpBB me descargo un <code>info.php</code>: <pre><code>sudo wget https://gist.githubusercontent.com/carlosomarsuarez/9c7860d74535f4f0960e/raw/ac8170c4142933a48fd7ed8b88eb9d4f190ec32c/info.php\n</code></pre></p> <p>Accedo al fichero:</p> <p></p> <p>Comprobar que phpBB sigue funcionando</p> <p></p> <p>Comprobar que ConcreteCMS sigue funcionando</p> <p></p>"},{"location":"iaw/ej3-phpfpm/#paso-5","title":"Paso 5","text":"<p>Hacer que php-fpm escuche por socket TCP</p> <p>Modificar <code>/etc/php/7.4/fpm/pool.d/www.conf</code>: <pre><code>listen = 127.0.0.1:9000\n</code></pre></p> <p>Reiniciar php-fpm: <pre><code>sudo systemctl restart php7.4-fpm.service\n</code></pre></p> <p>Hacer que Apache se comunique con php-fpm por socket TCP</p> <p>Modificar <code>/etc/apache2/conf-available/php7.4-fpm.conf</code>: <pre><code>&lt;FilesMatch \".+\\.ph(ar|p|tml)$\"&gt;\n        SetHandler \"proxy:fcgi://127.0.0.1:9000/\"\n&lt;/FilesMatch&gt;\n</code></pre></p> <p>Reiniciar Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p>"},{"location":"iaw/ej3-phpfpm/#paso-6","title":"Paso 6","text":"<p>Comprobar que phpBB sigue funcionando</p> <p></p> <p>Comprobar que ConcreteCMS sigue funcionando</p> <p></p>"},{"location":"iaw/ej3-phpfpm/#paso-7","title":"Paso 7","text":"<p>Cambiar el <code>memory_limit</code> de php-fpm a 256M</p> <p>Modificar <code>/etc/php/7.4/fpm/php.ini</code>: <pre><code>memory_limit = 256M\n</code></pre></p> <p>Reiniciar php-fpm: <pre><code>sudo systemctl restart php7.4-fpm.service\n</code></pre></p> <p>Comprobamos que el cambio haya tomado efecto mirando el <code>info.php</code>:</p> <p></p>"},{"location":"iaw/ejs-docker/","title":"Ejercicios Docker","text":"<p>Todos estos ejercicios estar\u00e1n sacados del curso de Docker de Jos\u00e9 Domingo.</p>"},{"location":"iaw/ejs-docker/#introduccion","title":"Introducci\u00f3n","text":""},{"location":"iaw/ejs-docker/#instalacion-de-docker","title":"Instalaci\u00f3n de docker","text":"<p>Instalo la versi\u00f3n de comunidad de Debian:</p> <pre><code>sudo apt install docker.io\n</code></pre> <p>Hago que mi usuario sin privilegios pueda usar el cliente de docker (para que este cambio surta efecto tendremos que cerrar sesi\u00f3n y volver a logearnos con nuestro usuario):</p> <pre><code>sudo usermod -aG docker atlas\n</code></pre> <p>Pruebo que Docker se instal\u00f3:</p> <pre><code>atlas@olympus:~$ docker --version\nDocker version 20.10.5+dfsg1, build 55c4c88\n</code></pre>"},{"location":"iaw/ejs-docker/#el-hola-mundo-de-docker","title":"El \u201cHola Mundo\u201d de docker","text":"<p>Creamos nuestro primer contenedor desde la imagen hello-world:</p> <pre><code>atlas@olympus:~$ docker run hello-world\nUnable to find image 'hello-world:latest' locally\nlatest: Pulling from library/hello-world\n2db29710123e: Pull complete\nDigest: sha256:80f31da1ac7b312ba29d65080fddf797dd76acfb870e677f390d5acba9741b17\nStatus: Downloaded newer image for hello-world:latest\nHello from Docker!\nThis message shows that your installation appears to be working correctly.\nTo generate this message, Docker took the following steps:\n 1. The Docker client contacted the Docker daemon.\n 2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub.\n    (amd64)\n 3. The Docker daemon created a new container from that image which runs the\n    executable that produces the output you are currently reading.\n 4. The Docker daemon streamed that output to the Docker client, which sent it\n    to your terminal.\nTo try something more ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu bash\n\nShare images, automate workflows, and more with a free Docker ID:\n https://hub.docker.com/\nFor more examples and ideas, visit:\n https://docs.docker.com/get-started/\n</code></pre> <p>Para listar los contenedores ejecut\u00e1ndose:</p> <pre><code>docker ps\n</code></pre> <p>Para listar todos los contenedores, no ejecut\u00e1ndose o ejecut\u00e1ndose:</p> <pre><code>atlas@olympus:~$ docker ps -a\nCONTAINER ID   IMAGE         COMMAND    CREATED         STATUS                     PORTS     NAMES\n0653f26a58dc   hello-world   \"/hello\"   6 minutes ago   Exited (0) 6 minutes ago             blissful_ardinghelli\n</code></pre> <p>Para eliminar contenedores por id:</p> <pre><code>docker rm 0653f26a58dc\n</code></pre> <p>Para eliminar contenedores por nombre:</p> <pre><code>docker rm blissful_ardinghelli\n</code></pre>"},{"location":"iaw/ejs-docker/#ejecucion-simple-de-contenedores","title":"Ejecuci\u00f3n simple de contenedores","text":"<p>Ejecutamos un echo desde una imagen Ubuntu:</p> <pre><code>atlas@olympus:~$ docker run ubuntu echo 'Hello world'\nUnable to find image 'ubuntu:latest' locally\nlatest: Pulling from library/ubuntu\n405f018f9d1d: Pull complete\nDigest: sha256:b6b83d3c331794420340093eb706a6f152d9c1fa51b262d9bf34594887c2c7ac\nStatus: Downloaded newer image for ubuntu:latest\nHello world\n</code></pre> <p>Comprobamos que el contenedor se ha parado:</p> <pre><code>atlas@olympus:~$ docker ps -a\nCONTAINER ID   IMAGE     COMMAND                CREATED         STATUS                     PORTS     NAMES\n45c6f4b0dbcc   ubuntu    \"echo 'Hello world'\"   2 minutes ago   Exited (0) 2 minutes ago             competent_davinci\n</code></pre> <p>Para listar las im\u00e1genes que ya tenemos descargadas:</p> <pre><code>atlas@olympus:~$ docker images\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nubuntu        latest    27941809078c   2 days ago     77.8MB\nhello-world   latest    feb5d9fea6a5   8 months ago   13.3kB\n</code></pre>"},{"location":"iaw/ejs-docker/#ejecutando-un-contenedor-interactivo","title":"Ejecutando un contenedor interactivo","text":"<pre><code>atlas@olympus:~$ docker run -it --name contenedor1 ubuntu bash\nroot@38c803b78559:/#\n</code></pre> <p>Para volver a conectarnos al contenedor despu\u00e9s de habernos salido:</p> <pre><code>atlas@olympus:~$ docker start contenedor1\ncontenedor1\natlas@olympus:~$ docker attach contenedor1\nroot@38c803b78559:/#\n</code></pre> <p>Para ejecutar comandos sobre un contenedor en ejecuci\u00f3n:</p> <pre><code>atlas@olympus:~$ docker start contenedor1\ncontenedor1\natlas@olympus:~$ docker exec contenedor1 ls -la\ntotal 56\ndrwxr-xr-x   1 root root 4096 Jun  9 19:11 .\ndrwxr-xr-x   1 root root 4096 Jun  9 19:11 ..\n-rwxr-xr-x   1 root root    0 Jun  9 19:11 .dockerenv\nlrwxrwxrwx   1 root root    7 May 31 15:42 bin -&gt; usr/bin\ndrwxr-xr-x   2 root root 4096 Apr 18 10:28 boot\ndrwxr-xr-x   5 root root  360 Jun  9 19:24 dev\ndrwxr-xr-x   1 root root 4096 Jun  9 19:11 etc\ndrwxr-xr-x   2 root root 4096 Apr 18 10:28 home\nlrwxrwxrwx   1 root root    7 May 31 15:42 lib -&gt; usr/lib\nlrwxrwxrwx   1 root root    9 May 31 15:42 lib32 -&gt; usr/lib32\nlrwxrwxrwx   1 root root    9 May 31 15:42 lib64 -&gt; usr/lib64\nlrwxrwxrwx   1 root root   10 May 31 15:42 libx32 -&gt; usr/libx32\ndrwxr-xr-x   2 root root 4096 May 31 15:42 media\ndrwxr-xr-x   2 root root 4096 May 31 15:42 mnt\ndrwxr-xr-x   2 root root 4096 May 31 15:42 opt\ndr-xr-xr-x 443 root root    0 Jun  9 19:24 proc\ndrwx------   1 root root 4096 Jun  9 19:13 root\ndrwxr-xr-x   5 root root 4096 May 31 15:45 run\nlrwxrwxrwx   1 root root    8 May 31 15:42 sbin -&gt; usr/sbin\ndrwxr-xr-x   2 root root 4096 May 31 15:42 srv\ndr-xr-xr-x  13 root root    0 Jun  9 19:24 sys\ndrwxrwxrwt   2 root root 4096 May 31 15:45 tmp\ndrwxr-xr-x  14 root root 4096 May 31 15:42 usr\ndrwxr-xr-x  11 root root 4096 May 31 15:45 var\n</code></pre> <p>Para reiniciar un contenedor:</p> <pre><code>atlas@olympus:~$ docker restart contenedor1\ncontenedor1\n</code></pre> <p>Para mostrar informaci\u00f3n sobre un contenedor:</p> <pre><code>atlas@olympus:~$ docker inspect contenedor1\n[\n    {\n        \"Id\": \"38c803b78559b214a1e74377faf006cb1758e9bee4619c782783fd685e84b192\",\n        \"Created\": \"2022-06-09T19:11:27.622457379Z\",\n        \"Path\": \"bash\",\n        \"Args\": [],\n        \"State\": {\n            \"Status\": \"running\",\n            \"Running\": true,\n            \"Paused\": false,\n            \"Restarting\": false,\n            \"OOMKilled\": false,\n            \"Dead\": false,\n            \"Pid\": 22633,\n            \"ExitCode\": 0,\n            \"Error\": \"\",\n            \"StartedAt\": \"2022-06-09T19:27:04.276188002Z\",\n            \"FinishedAt\": \"2022-06-09T19:27:03.593607062Z\"\n        },\n        \"Image\": \"sha256:27941809078cc9b2802deb2b0bb6feed6c236cde01e487f200e24653533701ee\",\n        \"ResolvConfPath\": \"/var/lib/docker/containers/38c803b78559b214a1e74377faf006cb1758e9bee4619c782783fd685e84b192/resolv.conf\",\n        \"HostnamePath\": \"/var/lib/docker/containers/38c803b78559b214a1e74377faf006cb1758e9bee4619c782783fd685e84b192/hostname\",\n        \"HostsPath\": \"/var/lib/docker/containers/38c803b78559b214a1e74377faf006cb1758e9bee4619c782783fd685e84b192/hosts\",\n        \"LogPath\": \"/var/lib/docker/containers/38c803b78559b214a1e74377faf006cb1758e9bee4619c782783fd685e84b192/38c803b78559b214a1e74377faf006cb1758e9bee4619c782783fd685e84b192-json.log\",\n        \"Name\": \"/contenedor1\",\n        \"RestartCount\": 0,\n        \"Driver\": \"overlay2\",\n        \"Platform\": \"linux\",\n        \"MountLabel\": \"\",\n        \"ProcessLabel\": \"\",\n        \"AppArmorProfile\": \"docker-default\",\n        \"ExecIDs\": null,\n        \"HostConfig\": {\n            \"Binds\": null,\n            \"ContainerIDFile\": \"\",\n            \"LogConfig\": {\n                \"Type\": \"json-file\",\n                \"Config\": {}\n            },\n            \"NetworkMode\": \"default\",\n            \"PortBindings\": {},\n            \"RestartPolicy\": {\n                \"Name\": \"no\",\n                \"MaximumRetryCount\": 0\n            },\n            \"AutoRemove\": false,\n            \"VolumeDriver\": \"\",\n            \"VolumesFrom\": null,\n            \"CapAdd\": null,\n            \"CapDrop\": null,\n            \"CgroupnsMode\": \"private\",\n            \"Dns\": [],\n            \"DnsOptions\": [],\n            \"DnsSearch\": [],\n            \"ExtraHosts\": null,\n            \"GroupAdd\": null,\n            \"IpcMode\": \"private\",\n            \"Cgroup\": \"\",\n            \"Links\": null,\n            \"OomScoreAdj\": 0,\n            \"PidMode\": \"\",\n            \"Privileged\": false,\n            \"PublishAllPorts\": false,\n            \"ReadonlyRootfs\": false,\n            \"SecurityOpt\": null,\n            \"UTSMode\": \"\",\n            \"UsernsMode\": \"\",\n            \"ShmSize\": 67108864,\n            \"Runtime\": \"runc\",\n            \"ConsoleSize\": [\n                0,\n                0\n            ],\n            \"Isolation\": \"\",\n            \"CpuShares\": 0,\n            \"Memory\": 0,\n            \"NanoCpus\": 0,\n            \"CgroupParent\": \"\",\n            \"BlkioWeight\": 0,\n            \"BlkioWeightDevice\": [],\n            \"BlkioDeviceReadBps\": null,\n            \"BlkioDeviceWriteBps\": null,\n            \"BlkioDeviceReadIOps\": null,\n            \"BlkioDeviceWriteIOps\": null,\n            \"CpuPeriod\": 0,\n            \"CpuQuota\": 0,\n            \"CpuRealtimePeriod\": 0,\n            \"CpuRealtimeRuntime\": 0,\n            \"CpusetCpus\": \"\",\n            \"CpusetMems\": \"\",\n            \"Devices\": [],\n            \"DeviceCgroupRules\": null,\n            \"DeviceRequests\": null,\n            \"KernelMemory\": 0,\n            \"KernelMemoryTCP\": 0,\n            \"MemoryReservation\": 0,\n            \"MemorySwap\": 0,\n            \"MemorySwappiness\": null,\n            \"OomKillDisable\": null,\n            \"PidsLimit\": null,\n            \"Ulimits\": null,\n            \"CpuCount\": 0,\n            \"CpuPercent\": 0,\n            \"IOMaximumIOps\": 0,\n            \"IOMaximumBandwidth\": 0,\n            \"MaskedPaths\": [\n                \"/proc/asound\",\n                \"/proc/acpi\",\n                \"/proc/kcore\",\n                \"/proc/keys\",\n                \"/proc/latency_stats\",\n                \"/proc/timer_list\",\n                \"/proc/timer_stats\",\n                \"/proc/sched_debug\",\n                \"/proc/scsi\",\n                \"/sys/firmware\"\n            ],\n            \"ReadonlyPaths\": [\n                \"/proc/bus\",\n                \"/proc/fs\",\n                \"/proc/irq\",\n                \"/proc/sys\",\n                \"/proc/sysrq-trigger\"\n            ]\n        },\n        \"GraphDriver\": {\n            \"Data\": {\n                \"LowerDir\": \"/var/lib/docker/overlay2/9fad5d5cd99a61193d036952be9856f4306065f1f2b98eec3069c1c4c25c2242-init/diff:/var/lib/docker/overlay2/4c732dfff53d5fd606c32c363b213c57a8926899ca739453ebaa448ac601efed/diff\",\n                \"MergedDir\": \"/var/lib/docker/overlay2/9fad5d5cd99a61193d036952be9856f4306065f1f2b98eec3069c1c4c25c2242/merged\",\n                \"UpperDir\": \"/var/lib/docker/overlay2/9fad5d5cd99a61193d036952be9856f4306065f1f2b98eec3069c1c4c25c2242/diff\",\n                \"WorkDir\": \"/var/lib/docker/overlay2/9fad5d5cd99a61193d036952be9856f4306065f1f2b98eec3069c1c4c25c2242/work\"\n            },\n            \"Name\": \"overlay2\"\n        },\n        \"Mounts\": [],\n        \"Config\": {\n            \"Hostname\": \"38c803b78559\",\n            \"Domainname\": \"\",\n            \"User\": \"\",\n            \"AttachStdin\": true,\n            \"AttachStdout\": true,\n            \"AttachStderr\": true,\n            \"Tty\": true,\n            \"OpenStdin\": true,\n            \"StdinOnce\": true,\n            \"Env\": [\n                \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n            ],\n            \"Cmd\": [\n                \"bash\"\n            ],\n            \"Image\": \"ubuntu\",\n            \"Volumes\": null,\n            \"WorkingDir\": \"\",\n            \"Entrypoint\": null,\n            \"OnBuild\": null,\n            \"Labels\": {}\n        },\n        \"NetworkSettings\": {\n            \"Bridge\": \"\",\n            \"SandboxID\": \"ddca79ac78e8d67018fe07a11ca7c316e2a74e58e11aca41ef07cb44a960aacd\",\n            \"HairpinMode\": false,\n            \"LinkLocalIPv6Address\": \"\",\n            \"LinkLocalIPv6PrefixLen\": 0,\n            \"Ports\": {},\n            \"SandboxKey\": \"/var/run/docker/netns/ddca79ac78e8\",\n            \"SecondaryIPAddresses\": null,\n            \"SecondaryIPv6Addresses\": null,\n            \"EndpointID\": \"868b39bc434bcdc04637157879fcf3b5bee0a09c5f44e6a438ddbb7f05e2802d\",\n            \"Gateway\": \"172.17.0.1\",\n            \"GlobalIPv6Address\": \"\",\n            \"GlobalIPv6PrefixLen\": 0,\n            \"IPAddress\": \"172.17.0.2\",\n            \"IPPrefixLen\": 16,\n            \"IPv6Gateway\": \"\",\n            \"MacAddress\": \"02:42:ac:11:00:02\",\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"d9afc200992598b8c58b8b9387d37f9d4575203de95b19a0d9c0b643073c8759\",\n                    \"EndpointID\": \"868b39bc434bcdc04637157879fcf3b5bee0a09c5f44e6a438ddbb7f05e2802d\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.2\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:02\",\n                    \"DriverOpts\": null\n                }\n            }\n        }\n    }\n]\n</code></pre> <p>Todas las im\u00e1genes tienen definidas un proceso que se ejecuta. La imagen ubuntu tiene definida por defecto el proceso bash, por lo que podr\u00edamos haber ejecutado:</p> <pre><code>atlas@olympus:~$ docker run -it --name contenedor1 ubuntu\nroot@09f0527e808f:/#\n</code></pre>"},{"location":"iaw/ejs-docker/#creando-un-contenedor-demonio","title":"Creando un contenedor demonio","text":"<p>Para ejecutar un comando en un contenedor en segundo plano:</p> <pre><code>atlas@olympus:~$ docker run -d --name contenedor2 ubuntu bash -c \"while true; do echo hello world; sleep 1; done\"\n29039571153e129b1f4d901a2e9a270385fee1905c877dda3c13de53b7ad9eb4\n</code></pre> <p>Comprobar que el contenedor se sigue ejecutando:</p> <pre><code>atlas@olympus:~$ docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES\n29039571153e   ubuntu    \"bash -c 'while true\u2026\"   14 minutes ago   Up 14 minutes             contenedor2\n</code></pre> <p>Comprobar lo que est\u00e1 haciendo el contenedor (bucle infinito de echo):</p> <pre><code>atlas@olympus:~$ docker logs contenedor2 | more\nhello world\nhello world\nhello world\n...\n</code></pre> <p>Paramos y borramos el contenedor:</p> <pre><code>atlas@olympus:~$ docker stop contenedor2\ncontenedor2\natlas@olympus:~$ docker rm contenedor2\ncontenedor2\n</code></pre> <p>Un contenedor en ejecuci\u00f3n no puede ser eliminado, hay que pararlo y borrarlo. Se puede borrar a la fuerza:</p> <pre><code>docker rm -f contenedor2\n</code></pre>"},{"location":"iaw/ejs-docker/#creando-un-contenedor-con-un-servidor-web","title":"Creando un contenedor con un servidor web","text":"<p>Para lanzar un contenedor con apache en segundo plano:</p> <pre><code>atlas@olympus:~$ docker run -d --name my-apache-app -p 8080:80 httpd:2.4\n28bd87fd47f48201f2805dc8be0a5a4a9698dd0b4289a2ed9ae0c6f11c436775\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Para ver sus logs:</p> <pre><code>atlas@olympus:~$ docker logs my-apache-app\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\n[Fri Jun 10 10:42:47.967351 2022] [mpm_event:notice] [pid 1:tid 140566825770304] AH00489: Apache/2.4.54 (Unix) configured -- resuming normal operations\n[Fri Jun 10 10:42:47.967443 2022] [core:notice] [pid 1:tid 140566825770304] AH00094: Command line: 'httpd -D FOREGROUND'\n172.17.0.1 - - [10/Jun/2022:10:45:34 +0000] \"GET / HTTP/1.1\" 200 45\n</code></pre> <p>Logs en tiempo real:</p> <pre><code>docker logs -f my-apache-app\n</code></pre> <p>Para modificar el <code>index.html</code> accediendo al contenedor:</p> <pre><code>atlas@olympus:~$ docker exec -it my-apache-app bash\nroot@eaee87a6a08f:/usr/local/apache2# cd htdocs/\nroot@eaee87a6a08f:/usr/local/apache2/htdocs# echo \"&lt;h1&gt;Curso Docker&lt;/h1&gt;\" &gt; index.html\nroot@eaee87a6a08f:/usr/local/apache2/htdocs# exit\nexit\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Para modificar el <code>index.html</code> sin acceder al contenedor:</p> <pre><code>docker exec my-apache-app bash -c 'echo \"&lt;h1&gt;Curso Docker 2&lt;/h1&gt;\" &gt; /usr/local/apache2/htdocs/index.html'\n</code></pre> <p></p>"},{"location":"iaw/ejs-docker/#configuracion-de-contenedores-con-variables-de-entorno","title":"Configuraci\u00f3n de contenedores con variables de entorno","text":"<p>Para crear un contenedor con una variable:</p> <pre><code>atlas@olympus:~$ docker run -it --name prueba -e USUARIO=prueba ubuntu bash\nroot@cf492c1f8f1a:/# echo $USUARIO\nprueba\n</code></pre> <p>Para lanzar un MariaDB con una variable:</p> <pre><code>atlas@olympus:~$ docker run -d --name some-mariadb -e MYSQL_ROOT_PASSWORD=my-secret-pw mariadb\nUnable to find image 'mariadb:latest' locally\nlatest: Pulling from library/mariadb\n405f018f9d1d: Already exists\n7a85079b8234: Pull complete\n579c7ff691b1: Pull complete\n4976663b5d6d: Pull complete\n169024b1fb13: Pull complete\nc0ffe8ce897f: Pull complete\nb583c09d23c3: Pull complete\n9b9f0c08d08f: Pull complete\n9cd51f984586: Pull complete\nd9f506bb8aca: Pull complete\n24d689f79ba4: Pull complete\nDigest: sha256:88fcb7d92c7f61cd885c4d309c98461f3607aa6dbd57a2474be86e1956b36d13\nStatus: Downloaded newer image for mariadb:latest\nfafaba08181c061d5aadbb7f79dda4e2d61cbea6dd883f80f4f51a64cecb5834\natlas@olympus:~$ docker ps\nCONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                  NAMES\nfafaba08181c   mariadb     \"docker-entrypoint.s\u2026\"   14 seconds ago   Up 12 seconds   3306/tcp               some-mariadb\neaee87a6a08f   httpd:2.4   \"httpd-foreground\"       7 hours ago      Up 7 hours      0.0.0.0:8080-&gt;80/tcp   my-apache-app\n</code></pre> <p>Para ver la variable creada:</p> <pre><code>atlas@olympus:~$ docker exec -it some-mariadb env\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHOSTNAME=fafaba08181c\nTERM=xterm\nMYSQL_ROOT_PASSWORD=my-secret-pw\nGOSU_VERSION=1.14\nMARIADB_MAJOR=10.8\nMARIADB_VERSION=1:10.8.3+maria~jammy\nHOME=/root\n</code></pre> <p>Para acceder a la BD:</p> <pre><code>atlas@olympus:~$ docker exec -it some-mariadb bash\nroot@fafaba08181c:/# mysql -u root -p\"$MYSQL_ROOT_PASSWORD\"\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 4\nServer version: 10.8.3-MariaDB-1:10.8.3+maria~jammy mariadb.org binary distribution\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMariaDB [(none)]&gt;\n</code></pre> <p>Para acceder a la BD directamente:</p> <pre><code>atlas@olympus:~$ docker exec -it some-mariadb mysql -u root -p\nEnter password:\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 5\nServer version: 10.8.3-MariaDB-1:10.8.3+maria~jammy mariadb.org binary distribution\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMariaDB [(none)]&gt;\n</code></pre> <p>Para eliminar el contenedor anterior:</p> <pre><code>atlas@olympus:~$ docker rm -f some-mariadb\nsome-mariadb\n</code></pre> <p>Para que se pueda acceder a la BD desde el exterior:</p> <pre><code>atlas@olympus:~$ docker run -d -p 3306:3306 --name some-mariadb -e MYSQL_ROOT_PASSWORD=my-secret-pw mariadb\n90b5f9c312cb79a57ca1397f80daa8294f75cf6fad3cf6ae3fed8e427d845fac\n</code></pre> <p>Para comprobar que ha funcionado el mapeo de puertos:</p> <pre><code>atlas@olympus:~$ docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                    NAMES\n90b5f9c312cb   mariadb   \"docker-entrypoint.s\u2026\"   2 minutes ago   Up 2 minutes   0.0.0.0:3306-&gt;3306/tcp   some-mariadb\n</code></pre> <p>Nos conectamos a la BD del contenedor desde nuestro equipo:</p> <pre><code>atlas@olympus:~$ mysql -u root -p -h 127.0.0.1\nEnter password:\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 4\nServer version: 10.8.3-MariaDB-1:10.8.3+maria~jammy mariadb.org binary distribution\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMariaDB [(none)]&gt;\n</code></pre>"},{"location":"iaw/ejs-docker/#ejercicios-introduccion","title":"Ejercicios introducci\u00f3n","text":"<p>Crear un contenedor con las siguientes caracter\u00edsticas:</p> <ul> <li>Demonio</li> <li>Con la imagen nginx</li> <li>Llamado servidor_web</li> <li>Acceso por puerto 8181</li> </ul> <pre><code>docker run -d -p 8181:80 --name servidor_web nginx\n</code></pre> <p>Pantallazo con creaci\u00f3n del contenedor y comprobaci\u00f3n de que est\u00e1 funcionando:</p> <p></p> <p>Pantallazo accediendo al servidor web:</p> <p></p> <p>Pantallazo de tus im\u00e1genes locales:</p> <p></p> <p>Pantallazo eliminando el contenedor:</p> <p></p> <p>Vemos en el listado final de contenedores que ya no existe \"servidor_web\".</p>"},{"location":"iaw/ejs-docker/#imagenes","title":"Im\u00e1genes","text":""},{"location":"iaw/ejs-docker/#registros-de-imagenes-docker-hub","title":"Registros de im\u00e1genes: Docker Hub","text":"<p>Estructura de nombre de una imagen:</p> <pre><code>usuario/nombre:etiqueta\n</code></pre>"},{"location":"iaw/ejs-docker/#gestion-de-imagenes","title":"Gesti\u00f3n de im\u00e1genes","text":"<p>Para listar las im\u00e1genes locales:</p> <pre><code>atlas@olympus:~$ docker images\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nhttpd         2.4       acd59370d8fb   2 days ago     144MB\nmariadb       latest    ea81af801379   4 days ago     383MB\nubuntu        latest    27941809078c   4 days ago     77.8MB\nnginx         latest    0e901e68141f   2 weeks ago    142MB\nhello-world   latest    feb5d9fea6a5   8 months ago   13.3kB\n</code></pre> <p>Para descargar la \u00faltima versi\u00f3n de una imagen:</p> <pre><code>atlas@olympus:~$ docker pull hello-world\nUsing default tag: latest\nlatest: Pulling from library/hello-world\n2db29710123e: Pull complete\nDigest: sha256:80f31da1ac7b312ba29d65080fddf797dd76acfb870e677f390d5acba9741b17\nStatus: Downloaded newer image for hello-world:latest\ndocker.io/library/hello-world:latest\n</code></pre> <p>Para eliminar im\u00e1genes sin contenedores creados:</p> <pre><code>atlas@olympus:~$ docker rmi hello-world\nUntagged: hello-world:latest\nUntagged: hello-world@sha256:80f31da1ac7b312ba29d65080fddf797dd76acfb870e677f390d5acba9741b17\nDeleted: sha256:feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412\nDeleted: sha256:e07ee1baac5fae6a26f30cabfe54a36d3402f96afda318fe0a96cec4ca393359\n</code></pre> <p>Para buscar im\u00e1genes en Docker Hub:</p> <pre><code>atlas@olympus:~$ docker search hello-world\nNAME                                       DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nhello-world                                Hello World! (an example of minimal Dockeriz\u2026   1760      [OK]\nkitematic/hello-world-nginx                A light-weight nginx container that demonstr\u2026   152\ntutum/hello-world                          Image to test docker deployments. Has Apache\u2026   88                   [OK]\ndockercloud/hello-world                    Hello World!                                    19                   [OK]\ncrccheck/hello-world                       Hello World web server in under 2.5 MB          15                   [OK]\nvad1mo/hello-world-rest                    A simple REST Service that echoes back all t\u2026   5                    [OK]\nppc64le/hello-world                        Hello World! (an example of minimal Dockeriz\u2026   2\nansibleplaybookbundle/hello-world-db-apb   An APB which deploys a sample Hello World! a\u2026   2                    [OK]\nthomaspoignant/hello-world-rest-json       This project is a REST hello-world API to bu\u2026   1\nrancher/hello-world                                                                        1\nansibleplaybookbundle/hello-world-apb      An APB which deploys a sample Hello World! a\u2026   1                    [OK]\nbusinessgeeks00/hello-world-nodejs                                                         0\nstrimzi/hello-world-producer                                                               0\nstrimzi/hello-world-consumer                                                               0\nkoudaiii/hello-world                                                                       0\nfreddiedevops/hello-world-spring-boot                                                      0\nstrimzi/hello-world-streams                                                                0\ntsepotesting123/hello-world                                                                0\narmswdev/c-hello-world                     Simple hello-world C program on Alpine Linux\u2026   0\ngarystafford/hello-world                   Simple hello-world Spring Boot service for t\u2026   0                    [OK]\nkevindockercompany/hello-world                                                             0\nrsperling/hello-world3                                                                     0\ndandando/hello-world-dotnet                                                                0\nokteto/hello-world                                                                         0\nuniplaces/hello-world                                                                      0\n</code></pre> <p>Para ver informaci\u00f3n sobre im\u00e1genes locales:</p> <pre><code>atlas@olympus:~$ docker inspect hello-world\n[\n    {\n        \"Id\": \"sha256:feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412\",\n        \"RepoTags\": [\n            \"hello-world:latest\"\n        ],\n        \"RepoDigests\": [\n            \"hello-world@sha256:80f31da1ac7b312ba29d65080fddf797dd76acfb870e677f390d5acba9741b17\"\n        ],\n        \"Parent\": \"\",\n        \"Comment\": \"\",\n        \"Created\": \"2021-09-23T23:47:57.442225064Z\",\n        \"Container\": \"8746661ca3c2f215da94e6d3f7dfdcafaff5ec0b21c9aff6af3dc379a82fbc72\",\n        \"ContainerConfig\": {\n            \"Hostname\": \"8746661ca3c2\",\n            \"Domainname\": \"\",\n            \"User\": \"\",\n            \"AttachStdin\": false,\n            \"AttachStdout\": false,\n            \"AttachStderr\": false,\n            \"Tty\": false,\n            \"OpenStdin\": false,\n            \"StdinOnce\": false,\n            \"Env\": [\n                \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n            ],\n            \"Cmd\": [\n                \"/bin/sh\",\n                \"-c\",\n                \"#(nop) \",\n                \"CMD [\\\"/hello\\\"]\"\n            ],\n            \"Image\": \"sha256:b9935d4e8431fb1a7f0989304ec86b3329a99a25f5efdc7f09f3f8c41434ca6d\",\n            \"Volumes\": null,\n            \"WorkingDir\": \"\",\n            \"Entrypoint\": null,\n            \"OnBuild\": null,\n            \"Labels\": {}\n        },\n        \"DockerVersion\": \"20.10.7\",\n        \"Author\": \"\",\n        \"Config\": {\n            \"Hostname\": \"\",\n            \"Domainname\": \"\",\n            \"User\": \"\",\n            \"AttachStdin\": false,\n            \"AttachStdout\": false,\n            \"AttachStderr\": false,\n            \"Tty\": false,\n            \"OpenStdin\": false,\n            \"StdinOnce\": false,\n            \"Env\": [\n                \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n            ],\n            \"Cmd\": [\n                \"/hello\"\n            ],\n            \"Image\": \"sha256:b9935d4e8431fb1a7f0989304ec86b3329a99a25f5efdc7f09f3f8c41434ca6d\",\n            \"Volumes\": null,\n            \"WorkingDir\": \"\",\n            \"Entrypoint\": null,\n            \"OnBuild\": null,\n            \"Labels\": null\n        },\n        \"Architecture\": \"amd64\",\n        \"Os\": \"linux\",\n        \"Size\": 13256,\n        \"VirtualSize\": 13256,\n        \"GraphDriver\": {\n            \"Data\": {\n                \"MergedDir\": \"/var/lib/docker/overlay2/d3432ee4a8fdbdb72453b41fabf1ea7d479acb51a60649810de1561a3f241b85/merged\",\n                \"UpperDir\": \"/var/lib/docker/overlay2/d3432ee4a8fdbdb72453b41fabf1ea7d479acb51a60649810de1561a3f241b85/diff\",\n                \"WorkDir\": \"/var/lib/docker/overlay2/d3432ee4a8fdbdb72453b41fabf1ea7d479acb51a60649810de1561a3f241b85/work\"\n            },\n            \"Name\": \"overlay2\"\n        },\n        \"RootFS\": {\n            \"Type\": \"layers\",\n            \"Layers\": [\n                \"sha256:e07ee1baac5fae6a26f30cabfe54a36d3402f96afda318fe0a96cec4ca393359\"\n            ]\n        },\n        \"Metadata\": {\n            \"LastTagTime\": \"0001-01-01T00:00:00Z\"\n        }\n    }\n]\n</code></pre>"},{"location":"iaw/ejs-docker/#como-se-organizan-las-imagenes","title":"\u00bfC\u00f3mo se organizan las im\u00e1genes?","text":"<p>Para ver el tama\u00f1o de las im\u00e1genes:</p> <pre><code>atlas@olympus:~$ docker images\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nhttpd         2.4       acd59370d8fb   2 days ago     144MB\nmariadb       latest    ea81af801379   4 days ago     383MB\nubuntu        latest    27941809078c   4 days ago     77.8MB\nnginx         latest    0e901e68141f   2 weeks ago    142MB\nhello-world   latest    feb5d9fea6a5   8 months ago   13.3kB\n</code></pre> <p>Creo un contenedor interactivo y me salgo:</p> <pre><code>atlas@olympus:~$ docker run -it --name contenedor1 ubuntu /bin/bash\nroot@d3a811e18218:/# exit\nexit\n</code></pre> <p>Para visualizar los contenedores con su tama\u00f1o:</p> <pre><code>atlas@olympus:~$ docker ps -a -s\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS                    NAMES               SIZE\nd3a811e18218   ubuntu    \"/bin/bash\"              14 minutes ago   Exited (0) 14 minutes ago                            contenedor1         5B (virtual 77.8MB)\n90b5f9c312cb   mariadb   \"docker-entrypoint.s\u2026\"   20 hours ago     Exited (255) 17 hours ago   0.0.0.0:3306-&gt;3306/tcp   some-mariadb        0B (virtual 383MB)\n45c6f4b0dbcc   ubuntu    \"echo 'Hello world'\"     44 hours ago     Exited (0) 44 hours ago                              competent_davinci   0B (virtual 77.8MB)\n</code></pre> <p>El tama\u00f1o real del contenedor es casi nulo. El virtual es el que comparte con la imagen de ubuntu.</p> <p>Volvemos a acceder al contenedor y creamos un fichero:</p> <pre><code>atlas@olympus:~$ docker start contenedor1\ncontenedor1\natlas@olympus:~$ docker attach contenedor1\nroot@d3a811e18218:/# echo \"00000000000000000\"&gt;file.txt\nroot@d3a811e18218:/# exit\nexit\n</code></pre> <p>Vemos que ha crecido el tama\u00f1o del contenedor:</p> <pre><code>atlas@olympus:~$ docker ps -a -s\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS                    NAMES               SIZE\nd3a811e18218   ubuntu    \"/bin/bash\"              41 minutes ago   Exited (0) 6 minutes ago                             contenedor1         62B (virtual 77.8MB)\n90b5f9c312cb   mariadb   \"docker-entrypoint.s\u2026\"   21 hours ago     Exited (255) 17 hours ago   0.0.0.0:3306-&gt;3306/tcp   some-mariadb        0B (virtual 383MB)\n45c6f4b0dbcc   ubuntu    \"echo 'Hello world'\"     45 hours ago     Exited (0) 44 hours ago                              competent_davinci   0B (virtual 77.8MB)\n</code></pre> <p>Para ver informaci\u00f3n sobre las capas de una imagen:</p> <pre><code>docker inspect ubuntu:latest\n</code></pre> <p></p>"},{"location":"iaw/ejs-docker/#creacion-de-contenedores-desde-imagenes","title":"Creaci\u00f3n de contenedores desde im\u00e1genes","text":"<p>Todas las im\u00e1genes tienen definidas un proceso que se ejecuta por defecto, pero en la mayor\u00eda de los casos podemos indicar un proceso al crear un contenedor.</p> <p>En la imagen ubuntu el proceso por defecto es bash, por lo tanto podemos ejecutar:</p> <pre><code>atlas@olympus:~$ docker run -it --name contenedor1 ubuntu\nroot@190f78badf0e:/#\n</code></pre> <p>Tambi\u00e9n podemos indicar el comando a ejecutar al crear un contenedor:</p> <pre><code>atlas@olympus:~$ docker run ubuntu /bin/echo 'Hello world'\nHello world\n</code></pre> <p>La imagen httpd:2.4 ejecuta un servidor web por defecto:</p> <pre><code>atlas@olympus:~$ docker run -d --name my-apache-app -p 8080:80 httpd:2.4\nd5d49317f2a978a8ee163db794f43a6bc09b1594444fd9a575e80ddecf04e469\n</code></pre>"},{"location":"iaw/ejs-docker/#ejemplo-desplegando-la-aplicacion-mediawiki","title":"Ejemplo: Desplegando la aplicaci\u00f3n MediaWiki","text":"<p>Para instalar la \u00faltima versi\u00f3n:</p> <pre><code>docker run -d -p 8080:80 --name mediawiki1 mediawiki\n</code></pre> <p>Comprobamos que funciona y es efectivamente la \u00faltima versi\u00f3n:</p> <p></p> <p>Instalamos otra versi\u00f3n de MediaWiki, la 1.36.3:</p> <pre><code>docker run -d -p 8081:80 --name mediawiki2 mediawiki:1.36.3\n</code></pre> <p>Comprobamos que funciona y es efectivamente la versi\u00f3n indicada:</p> <p></p> <p>Finalmente instalamos otra versi\u00f3n:</p> <pre><code>docker run -d -p 8082:80 --name mediawiki3 mediawiki:1.35.5\n</code></pre> <p>Comprobamos que funciona y es efectivamente la versi\u00f3n indicada:</p> <p></p> <p>A lo largo de este ejemplo hemos podido comprobar que las capas que ya existen no se las vuelve a descargar.</p>"},{"location":"iaw/ejs-docker/#ejercicios-imagenes","title":"Ejercicios im\u00e1genes","text":""},{"location":"iaw/ejs-docker/#servidor-web","title":"Servidor web","text":"<p>Lanzar un contenedor con caracter\u00edsticas:</p> <ul> <li>Imagen php:7.4-apache</li> <li>Llamado web</li> <li>Puerto 8000</li> </ul> <pre><code>atlas@olympus:~$ docker run -d -p 8000:80 --name web php:7.4-apache\nUnable to find image 'php:7.4-apache' locally\n7.4-apache: Pulling from library/php\n42c077c10790: Already exists\n8934009a9160: Already exists\n5357ac116991: Already exists\n54ae63894b5a: Already exists\n772088206f85: Already exists\n3b81c5474649: Already exists\nc62a528527ae: Already exists\n344c792709d4: Already exists\nef9638273c35: Already exists\n4ec70638e42f: Already exists\n5a0f65f5bb3b: Already exists\n55578a5ce5e8: Already exists\nf1dd85b4dfa5: Already exists\nDigest: sha256:c65cd02abef32e0ab1558788dbcf855e6dde301159da14651c844f533b34a411\nStatus: Downloaded newer image for php:7.4-apache\na46be0b60d37a4e009c0b40934aafa72332a1da8e04c6dec8712b8354630d161\n</code></pre> <p>Muestro que se est\u00e1 ejecutando:</p> <pre><code>atlas@olympus:~$ docker ps\nCONTAINER ID   IMAGE            COMMAND                  CREATED         STATUS         PORTS                  NAMES\na46be0b60d37   php:7.4-apache   \"docker-php-entrypoi\u2026\"   3 minutes ago   Up 3 minutes   0.0.0.0:8000-&gt;80/tcp   web\n</code></pre> <p>Colocar en <code>/var/www/html</code> un <code>index.html</code> con contenido <code>&lt;h1&gt;HOLA SOY ADRIAN JARAMILLO&lt;/h1&gt;</code>:</p> <pre><code>docker exec web bash -c 'echo \"&lt;h1&gt;HOLA SOY ADRIAN JARAMILLO&lt;/h1&gt;\" &gt; /var/www/html/index.html'\n</code></pre> <p>Muestro que ha funcionado:</p> <p></p> <p>Colocar en <code>/var/www/html</code> un <code>index.php</code> con contenido <code>&lt;?php echo phpinfo(); ?&gt;</code>:</p> <pre><code>docker exec web bash -c 'echo \"&lt;?php echo phpinfo(); ?&gt;\" &gt; /var/www/html/index.php'\n</code></pre> <p>Muestro que ha funcionado:</p> <p></p> <p>Muestro el tama\u00f1o del contenedor <code>web</code> tras crear los dos ficheros:</p> <p></p>"},{"location":"iaw/ejs-docker/#servidor-bd","title":"Servidor BD","text":"<p>Lanzar un contenedor con caracter\u00edsticas:</p> <ul> <li>Llamado bbdd</li> <li>Imagen mariadb</li> <li>Puerto 3336</li> <li>Contrase\u00f1a root: root</li> <li>Base de datos: prueba</li> <li>Usuario: invitado</li> <li>Contrase\u00f1a: invitado</li> </ul> <pre><code>docker run -d -p 3336:3306 --name bbdd -e MARIADB_ROOT_PASSWORD=root -e MARIADB_DATABASE=prueba -e MARIADB_USER=invitado -e MARIADB_PASSWORD=invitado mariadb\n</code></pre> <p>Mostrar el acceso a la BD desde nuestro ordenador con el usuario invitado, y mostrar la BD prueba:</p> <p></p> <p>Mostrar que no se puede borrar la imagen mariadb mientras el contenedor <code>bbdd</code> existe:</p> <p></p>"},{"location":"iaw/ejs-docker/#almacenamiento","title":"Almacenamiento","text":""},{"location":"iaw/ejs-docker/#los-contenedores-son-efimeros","title":"Los contenedores son ef\u00edmeros","text":"<p>Los datos de los contenedores sobreviven a paradas pero no a destrucciones.</p> <p>Ejemplo:</p> <pre><code>atlas@olympus:~$ docker run -d --name my-apache-app -p 8080:80 httpd:2.4\n4dbe1355067367db8a435256af733a1405cab06de21b61cd67c269d0891eb48c\natlas@olympus:~$ docker exec my-apache-app bash -c 'echo \"&lt;h1&gt;Hola&lt;/h1&gt;\" &gt; /usr/local/apache2/htdocs/index.html'\natlas@olympus:~$ curl http://localhost:8080\n&lt;h1&gt;Hola&lt;/h1&gt;\natlas@olympus:~$ docker rm -f my-apache-app\nmy-apache-app\natlas@olympus:~$ docker run -d --name my-apache-app -p 8080:80 httpd:2.4\nbe4204135657e6ddbeccc2d8205e5977b0fc771bddf932a21a3e0bc9b5df2b68\natlas@olympus:~$ curl http://localhost:8080\n&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;\n</code></pre> <p>Nos damos cuenta de que el <code>index.html</code> modificado se pierde, y al lanzar otro contenedor vuelve al contenido original.</p>"},{"location":"iaw/ejs-docker/#volumenes-docker-y-bind-mount","title":"Vol\u00famenes docker y bind mount","text":""},{"location":"iaw/ejs-docker/#volumenes","title":"Vol\u00famenes","text":"<p>Se guardan en <code>/var/lib/docker/volumes</code></p> <p>Para crear un volumen:</p> <pre><code>atlas@olympus:~$ docker volume create my-vol\nmy-vol\n</code></pre> <p>Para eliminar un volumen:</p> <pre><code>atlas@olympus:~$ docker volume rm my-vol\nmy-vol\n</code></pre> <p>Para eliminar vol\u00famenes que no est\u00e1n siendo usados por ning\u00fan contenedor:</p> <pre><code>atlas@olympus:~$ docker volume prune\nWARNING! This will remove all local volumes not used by at least one container.\nAre you sure you want to continue? [y/N] y\nDeleted Volumes:\nee50d8c9aa7de5fda336d094a3bb25566667f88a4c9864e3b1fd8e3bd619b0d8\n6a3bd1b8cbc0029c01daf50080d3d682918e6f3fed56164914a81df7c09535dd\nTotal reclaimed space: 295MB\n</code></pre> <p>Para listar vol\u00famenes:</p> <pre><code>atlas@olympus:~$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3\n</code></pre> <p>Para ver informaci\u00f3n sobre vol\u00famenes:</p> <pre><code>atlas@olympus:~$ docker volume inspect f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3\n[\n    {\n        \"CreatedAt\": \"2022-06-12T13:34:02+02:00\",\n        \"Driver\": \"local\",\n        \"Labels\": null,\n        \"Mountpoint\": \"/var/lib/docker/volumes/f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3/_data\",\n        \"Name\": \"f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3\",\n        \"Options\": null,\n        \"Scope\": \"local\"\n    }\n]\n</code></pre>"},{"location":"iaw/ejs-docker/#bind-mounts","title":"Bind mounts","text":"<p>Esto es mapear/montar directorios/ficheros de mi sistema de ficheros con el contenedor.</p>"},{"location":"iaw/ejs-docker/#asociando-almacenamiento-a-los-contenedores-volumenes-docker","title":"Asociando almacenamiento a los contenedores: vol\u00famenes docker","text":"<p>Ya sean vol\u00famenes o bind mount, usaremos las mismas flags de <code>docker run</code>:</p> <ul> <li><code>--volume</code> o <code>-v</code></li> <li><code>--mount</code></li> </ul> <p>Creamos un volumen:</p> <pre><code>atlas@olympus:~$ docker volume create miweb\nmiweb\n</code></pre> <p>Lanzamos un contenedor con el volumen asociado y modificamos el <code>index.html</code>:</p> <pre><code>atlas@olympus:~$ docker run -d --name my-apache-app --mount type=volume,src=miweb,dst=/usr/local/apache2/htdocs -p 8080:80 httpd:2.4\n4192e7c4df28ab3a7df706fa5eaad3c9fd893379a8be9705e1b714de80d284c2\natlas@olympus:~$ docker exec my-apache-app bash -c 'echo \"&lt;h1&gt;Hola&lt;/h1&gt;\" &gt; /usr/local/apache2/htdocs/index.html'\natlas@olympus:~$ curl http://localhost:8080\n&lt;h1&gt;Hola&lt;/h1&gt;\natlas@olympus:~$ docker rm -f my-apache-app\nmy-apache-app\n</code></pre> <p>Tras borrarlo creamos otro con el volumen asociado, pero usamos <code>-v</code>:</p> <pre><code>atlas@olympus:~$ docker run -d --name my-apache-app -v miweb:/usr/local/apache2/htdocs -p 8080:80 httpd:2.4\na115083f365e64e138c2fd9adf944382abff30318f685b75c8368d1d2802a89b\n</code></pre> <p>Comprobamos que no se ha perdido la informaci\u00f3n:</p> <pre><code>atlas@olympus:~$ curl http://localhost:8080\n&lt;h1&gt;Hola&lt;/h1&gt;\n</code></pre> <p>Si no indicamos volumen se crea uno nuevo:</p> <pre><code>atlas@olympus:~$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3\natlas@olympus:~$ docker run -d --name my-apache-app --mount type=volume,dst=/usr/local/apache2/htdocs -p 8080:80 httpd:2.4\n151f85c244bb81b8b26734c612b3b584f76dd3638b00210a0d6b30ecf4b35066\natlas@olympus:~$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     65eb5fc7fc9f541f1dd35effc2e456e615f6ef51670ef07a9971d2278c9dd4ee\nlocal     f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3\n</code></pre> <p>Si usamos <code>-v</code> y decimos un nombre se crea un volumen nuevo:</p> <pre><code>atlas@olympus:~$ docker run -d --name my-apache-app -v wwwroot:/usr/local/apache2/htdocs -p 8080:80 httpd:2.4\nc22f12f358f1f066c33d067b3492200829cce6af11cbde07724b8058caebfc3b\natlas@olympus:~$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     65eb5fc7fc9f541f1dd35effc2e456e615f6ef51670ef07a9971d2278c9dd4ee\nlocal     f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3\nlocal     wwwroot\n</code></pre> <p>Tanto vol\u00famenes como bind mount sobreescribir\u00e1n la carpeta destino del contenedor.</p>"},{"location":"iaw/ejs-docker/#asociando-almacenamiento-a-los-contenedores-bind-mount","title":"Asociando almacenamiento a los contenedores: bind mount","text":"<p>Creamos un directorio en nuestra m\u00e1quina con un <code>index.html</code>:</p> <pre><code>atlas@olympus:~$ mkdir web\natlas@olympus:~$ cd web\natlas@olympus:~/web$ echo \"&lt;h1&gt;Hola&lt;/h1&gt;\" &gt; index.html\n</code></pre> <p>Montamos ese directorio en un contenedor con <code>-v</code>:</p> <pre><code>atlas@olympus:~/web$ docker run -d --name my-apache-app -v /home/atlas/web:/usr/local/apache2/htdocs -p 8080:80 httpd:2.4\n426d7ef55bb658c87964fd7a26589e6325163549f1053930076b0696e0751550\n</code></pre> <p>Comprobamos que estamos sirviendo el fichero de nuestro directorio:</p> <pre><code>atlas@olympus:~/web$ curl http://localhost:8080\n&lt;h1&gt;Hola&lt;/h1&gt;\n</code></pre> <p>Eliminamos el contenedor y creamos otro con el directorio montado, esta vez usando <code>--mount</code>:</p> <pre><code>atlas@olympus:~$ docker rm -f my-apache-app\nmy-apache-app\natlas@olympus:~$ docker run -d --name my-apache-app --mount type=bind,src=/home/atlas/web,dst=/usr/local/apache2/htdocs -p 8080:80 httpd:2.4\nd892a24a44f42d967a3cffb218641d29812fbf258c158a676cf3fff821f9eb7e\natlas@olympus:~$ curl http://localhost:8080\n&lt;h1&gt;Hola&lt;/h1&gt;\n</code></pre> <p>Podemos modificar el <code>index.html</code> aunque est\u00e9 montado en el contenedor:</p> <pre><code>atlas@olympus:~$ echo \"&lt;h1&gt;Adios&lt;/h1&gt;\" &gt; web/index.html\natlas@olympus:~$ curl http://localhost:8080\n&lt;h1&gt;Adios&lt;/h1&gt;\n</code></pre> <p>Si usamos bind mount con <code>-v</code> y la carpeta origen no existe, se crea, pero estar\u00e1 vac\u00eda. Si usamos bind mount con <code>--mount</code> y la carpeta origen no existe, dar\u00e1 un error.</p>"},{"location":"iaw/ejs-docker/#ejemplo-1-contenedor-nextcloud-con-almacenamiento-persistente","title":"Ejemplo 1: Contenedor Nextcloud con almacenamiento persistente","text":""},{"location":"iaw/ejs-docker/#con-volumen","title":"Con volumen","text":"<p>Creo uno:</p> <pre><code>atlas@olympus:~$ docker volume create nextcloud\nnextcloud\n</code></pre> <p>Lanzo un contenedor enlazado con el volumen:</p> <pre><code>atlas@olympus:~$ docker run -d -p 80:80 -v nextcloud:/var/www/html --name contenedor_nextcloud nextcloud\ncc2e756082a06500578913dbaffdf36d6cd92e18d029f2a737737c1455a80b7d\n</code></pre> <p>Accedemos, hacemos la instalaci\u00f3n, y subimos un fichero:</p> <p></p> <p>Eliminamos el contenedor y creamos otro con el mismo volumen:</p> <pre><code>atlas@olympus:~$ docker rm -f contenedor_nextcloud\ncontenedor_nextcloud\natlas@olympus:~$ docker run -d -p 80:80 -v nextcloud:/var/www/html --name contenedor_nextcloud nextcloud\nb59bf01aa8794df605ad0546571bfbc1204cb4e2dc1b74201954c122e84f5206\n</code></pre> <p>Accedemos de nuevo y comprobamos que todo sigue igual:</p> <p></p>"},{"location":"iaw/ejs-docker/#con-bind-mount","title":"Con bind mount","text":"<p>Crearemos un directorio que luego montaremos en el contenedor:</p> <pre><code>mkdir datos_nextcloud\n</code></pre> <p>Creamos el contenedor:</p> <pre><code>atlas@olympus:~$ docker run -d -p 80:80 -v /home/atlas/datos_nextcloud:/var/www/html --name contenedor_nextcloud nextcloud\nee29347f1eafd00ba329333b232bb9020457783de5fe9d1ae561fa7fb63c85f8\n</code></pre> <p>Volvemos a acceder, instalamos, y subimos un fichero:</p> <p></p> <p>Al usar bind mount tenemos acceso al directorio:</p> <pre><code>atlas@olympus:~$ cd datos_nextcloud/\natlas@olympus:~/datos_nextcloud$ ls -la\ntotal 184\ndrwxr-xr-x 15 www-data root   4096 Jun 12 19:34 .\ndrwxr-xr-x 38 atlas    atlas  4096 Jun 12 19:30 ..\ndrwxr-xr-x 43 www-data root   4096 Jun 12 19:34 3rdparty\ndrwxr-xr-x 48 www-data root   4096 Jun 12 19:34 apps\n-rw-r--r--  1 www-data root  19327 Jun 12 19:34 AUTHORS\ndrwxr-xr-x  2 www-data root   4096 Jun 12 19:38 config\n-rw-r--r--  1 www-data root   3924 Jun 12 19:34 console.php\n-rw-r--r--  1 www-data root  34520 Jun 12 19:34 COPYING\ndrwxr-xr-x 22 www-data root   4096 Jun 12 19:34 core\n-rw-r--r--  1 www-data root   6260 Jun 12 19:34 cron.php\ndrwxr-xr-x  2 www-data root   4096 Jun 12 19:34 custom_apps\ndrwxrwx---  5 www-data root   4096 Jun 12 19:41 data\ndrwxr-xr-x  2 www-data root  12288 Jun 12 19:34 dist\n-rw-r--r--  1 www-data root   4387 Jun 12 19:38 .htaccess\n-rw-r--r--  1 www-data root    156 Jun 12 19:34 index.html\n-rw-r--r--  1 www-data root   3456 Jun 12 19:34 index.php\ndrwxr-xr-x  6 www-data root   4096 Jun 12 19:34 lib\n-rwxr-xr-x  1 www-data root    283 Jun 12 19:34 occ\ndrwxr-xr-x  2 www-data root   4096 Jun 12 19:34 ocm-provider\ndrwxr-xr-x  2 www-data root   4096 Jun 12 19:34 ocs\ndrwxr-xr-x  2 www-data root   4096 Jun 12 19:34 ocs-provider\n-rw-r--r--  1 www-data root   3139 Jun 12 19:34 public.php\n-rw-r--r--  1 www-data root   5340 Jun 12 19:34 remote.php\ndrwxr-xr-x  4 www-data root   4096 Jun 12 19:34 resources\n-rw-r--r--  1 www-data root     26 Jun 12 19:34 robots.txt\n-rw-r--r--  1 www-data root   2452 Jun 12 19:34 status.php\ndrwxr-xr-x  3 www-data root   4096 Jun 12 19:34 themes\n-rw-r--r--  1 www-data root    101 Jun 12 19:34 .user.ini\n-rw-r--r--  1 www-data root    382 Jun 12 19:34 version.php\n</code></pre> <p>Si eliminamos el contenedor y lo volvemos a crear con el mismo directorio bind mount, todo seguir\u00e1 igual:</p> <pre><code>atlas@olympus:~$ docker rm -f contenedor_nextcloud\ncontenedor_nextcloud\natlas@olympus:~$ docker run -d -p 80:80 -v /home/atlas/datos_nextcloud:/var/www/html --name contenedor_nextcloud nextcloud\n74099565d46f4ddb28547a071349a487bd511ac5e2cc47b3f29d72a6cfedd7ab\n</code></pre> <p></p>"},{"location":"iaw/ejs-docker/#ejemplo-2-contenedor-mariadb-con-almacenamiento-persistente","title":"Ejemplo 2: Contenedor MariaDB con almacenamiento persistente","text":"<p>Lanzamos el contenedor:</p> <pre><code>atlas@olympus:~$ docker run --name some-mariadb -v /home/atlas/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mariadb\nd12a51b521342a15b3b82cd59bab2d9de15946e5cd77a1d9149e892610121224\n</code></pre> <p>El directorio <code>/home/atlas/datadir</code> se crear\u00e1 autom\u00e1ticamente. Si borramos el contenedor, lo volvemos a crear, e indicamos ese directorio como bind mount, todo seguir\u00e1 igual.</p> <pre><code>atlas@olympus:~$ cd datadir/\natlas@olympus:~/datadir$ ls -la\ntotal 139260\ndrwxr-xr-x  5 systemd-coredump systemd-coredump      4096 Jun 12 20:04 .\ndrwxr-xr-x 39 atlas            atlas                 4096 Jun 12 20:04 ..\n-rw-rw----  1 systemd-coredump systemd-coredump  16719872 Jun 12 20:04 aria_log.00000001\n-rw-rw----  1 systemd-coredump systemd-coredump        52 Jun 12 20:04 aria_log_control\n-rw-rw----  1 systemd-coredump systemd-coredump         9 Jun 12 20:04 ddl_recovery.log\n-rw-rw----  1 systemd-coredump systemd-coredump       868 Jun 12 20:04 ib_buffer_pool\n-rw-rw----  1 systemd-coredump systemd-coredump  12582912 Jun 12 20:04 ibdata1\n-rw-rw----  1 systemd-coredump systemd-coredump 100663296 Jun 12 20:06 ib_logfile0\n-rw-rw----  1 systemd-coredump systemd-coredump  12582912 Jun 12 20:04 ibtmp1\n-rw-rw----  1 systemd-coredump systemd-coredump         0 Jun 12 20:04 multi-master.info\ndrwx------  2 systemd-coredump systemd-coredump      4096 Jun 12 20:04 mysql\n-rw-r--r--  1 systemd-coredump systemd-coredump        14 Jun 12 20:04 mysql_upgrade_info\ndrwx------  2 systemd-coredump systemd-coredump      4096 Jun 12 20:04 performance_schema\ndrwx------  2 systemd-coredump systemd-coredump     12288 Jun 12 20:04 sys\natlas@olympus:~/datadir$ docker exec -it some-mariadb bash -c 'mysql -uroot -p$MYSQL_ROOT_PASSWORD'\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 3\nServer version: 10.8.3-MariaDB-1:10.8.3+maria~jammy mariadb.org binary distribution\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMariaDB [(none)]&gt; create database prueba;\nQuery OK, 1 row affected (0.001 sec)\nMariaDB [(none)]&gt; quit\nBye\natlas@olympus:~/datadir$ docker rm -f some-mariadb\nsome-mariadb\natlas@olympus:~/datadir$ docker run --name some-mariadb -v /home/atlas/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mariadb\n84fb33568b2db708442f4099d6a8cf2636a2edb676630acbb7e71ca33f4ae2cc\natlas@olympus:~/datadir$ docker exec -it some-mariadb bash -c 'mysql -uroot -p$MYSQL_ROOT_PASSWORD'\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 3\nServer version: 10.8.3-MariaDB-1:10.8.3+maria~jammy mariadb.org binary distribution\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| prueba             |\n| sys                |\n+--------------------+\n5 rows in set (0.001 sec)\nMariaDB [(none)]&gt;\n</code></pre>"},{"location":"iaw/ejs-docker/#otros-usos-del-almacenamiento","title":"Otros usos del almacenamiento","text":""},{"location":"iaw/ejs-docker/#compartir-informacion-entre-contenedores","title":"Compartir informaci\u00f3n entre contenedores","text":"<p>Tendremos un contenedor principal con un servidor web sirviendo un <code>index.html</code>. El segundo contenedor  ir\u00e1 actualiz\u00e1ndolo.</p> <p>Creamos el volumen:</p> <pre><code>atlas@olympus:~$ docker volume create datos_compartidos\ndatos_compartidos\n</code></pre> <p>Lanzamos el primer contenedor con el volumen montado en su <code>DocumentRoot</code>, en solo lectura (ro):</p> <pre><code>atlas@olympus:~$ docker run -d -p 8181:80 --name contenedor1 -v datos_compartidos:/var/www/html:ro php:7.4-apache\n2c2eb3c74624156a94360ec93b431193a4eb39d9f8ce51f54ad5c7618e9b4fe5\n</code></pre> <p>Lanzamos el segundo contenedor, que ir\u00e1 modificando <code>index.html</code> en el volumen cada segundo:</p> <pre><code>atlas@olympus:~$ docker run -d --name contenedor2 -v datos_compartidos:/srv debian bash -c \"while true; do date &gt;&gt; /srv/index.html;sleep 1;done\"\nUnable to find image 'debian:latest' locally\nlatest: Pulling from library/debian\ne756f3fdd6a3: Pull complete\nDigest: sha256:3f1d6c17773a45c97bd8f158d665c9709d7b29ed7917ac934086ad96f92e4510\nStatus: Downloaded newer image for debian:latest\n33aac5ea223daf385d736bc43ea73b5e3dc0f033c050b968224b9f2a5d187f99\n</code></pre> <p>Accedemos al servidor web y comprobamos que funciona:</p> <p></p> <p>Tambi\u00e9n se podr\u00eda haber hecho con bind mount:</p> <pre><code>atlas@olympus:~$ docker run -d -p 8181:80 --name contenedor1 -v /home/atlas/compartido:/var/www/html:ro php:7.4-apache\naf6c26e17a3857d54c3c35363622412cb2381bed3f1c981add1ff4ea10713f97\natlas@olympus:~$ docker run -d --name contenedor2 -v /home/atlas/compartido:/srv debian bash -c \"while true; do date &gt;&gt; /srv/index.html;sleep 1;done\"\nf4b562b1e9c38afb49b0e830e9dc9f78d3d964b7741b6937282672f7a1256247\n</code></pre> <p>Comprobamos que sigue funcionando:</p> <p></p> <p>Podr\u00edamos ver el fichero <code>~/compartido/index.html</code> en nuestra m\u00e1quina:</p> <pre><code>atlas@olympus:~$ ls -la compartido/\ntotal 20\ndrwxr-xr-x  2 root  root  4096 Jun 12 21:04 .\ndrwxr-xr-x 40 atlas atlas 4096 Jun 12 21:03 ..\n-rw-r--r--  1 root  root  9280 Jun 12 21:09 index.html\n</code></pre>"},{"location":"iaw/ejs-docker/#comprobar-compatibilidad-de-codigo-entre-distintas-versiones-de-un-lenguaje-de-programacion","title":"Comprobar compatibilidad de c\u00f3digo entre distintas versiones de un lenguaje de programaci\u00f3n","text":"<p>Creamos el directorio <code>codigo</code>:</p> <pre><code>mkdir codigo\n</code></pre> <p>Dentro creamos un <code>index.php</code> con el siguiente c\u00f3digo:</p> <pre><code>&lt;?php\n// Funciona bien en php5 ya que list hace la asignaci\u00c3\u00b3n desde el \u00c3\u00baltimo al primero\n$info = array('cafe\u00c3\u00adna','marr\u00c3\u00b3n', 'caf\u00c3\u00a9');\n// Enumerar todas las variables\nlist($datos[], $datos[], $datos[]) = $info;\necho \"El $datos[0] es $datos[1] y la $datos[2] lo hace especial.\\n\";\n?&gt;\n</code></pre> <p>Lanzamos dos contenedores sirviendo este c\u00f3digo pero con im\u00e1genes distintas y puertos distintos:</p> <pre><code>atlas@olympus:~$ docker run -d -p 8081:80 --name php56 -v /home/atlas/codigo:/var/www/html:ro php:5.6-apache\nUnable to find image 'php:5.6-apache' locally\n5.6-apache: Pulling from library/php\n5e6ec7f28fb7: Pull complete\ncf165947b5b7: Pull complete\n7bd37682846d: Pull complete\n99daf8e838e1: Pull complete\nae320713efba: Pull complete\nebcb99c48d8c: Pull complete\n9867e71b4ab6: Pull complete\n936eb418164a: Pull complete\nbc298e7adaf7: Pull complete\nccd61b587bcd: Pull complete\nb2d4b347f67c: Pull complete\n56e9dde34152: Pull complete\n9ad99b17eb78: Pull complete\nDigest: sha256:0a40fd273961b99d8afe69a61a68c73c04bc0caa9de384d3b2dd9e7986eec86d\nStatus: Downloaded newer image for php:5.6-apache\n368c1d95a662014540b74505b892d5f0e9df214aa6708c9a10c132bb6ce03972\natlas@olympus:~$ docker run -d -p 8082:80 --name php74 -v /home/atlas/codigo:/var/www/html:ro php:7.4-apache\nae94d1294cdc62c9af7d71c383c63be295ede4eb626907cd037124a8b5f8fc47\n</code></pre> <p>Ya podemos acceder a cada puerto y comparar:</p> <p></p> <p></p>"},{"location":"iaw/ejs-docker/#ejercicios-almacenamiento","title":"Ejercicios almacenamiento","text":"<p>Creo los siguientes vol\u00famenes:</p> <pre><code>atlas@olympus:~$ docker volume create volumen_datos\nvolumen_datos\natlas@olympus:~$ docker volume create volumen_web\nvolumen_web\n</code></pre> <p></p> <p>Lanzo el primer contenedor:</p> <pre><code>docker run -d -p 8080:80 --name c1 -v volumen_web:/var/www/html php:7.4-apache\n</code></pre> <p></p> <p>Lanzo el segundo contenedor:</p> <pre><code>docker run -d --name c2 -v volumen_datos:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=admin mariadb\n</code></pre> <p></p> <p>Paramos y borramos <code>c2</code>, luego borramos <code>volumen_datos</code>:</p> <pre><code>atlas@olympus:~$ docker stop c2\nc2\natlas@olympus:~$ docker rm c2\nc2\natlas@olympus:~$ docker volume rm volumen_datos\nvolumen_datos\n</code></pre> <p></p> <p>Creamos un <code>index.html</code> en <code>c1</code> y comprobamos que funciona:</p> <pre><code>docker exec c1 bash -c 'echo \"&lt;h1&gt;Web C1&lt;/h1&gt;\" &gt; /var/www/html/index.html'\n</code></pre> <p></p> <p>Borramos <code>c1</code> y creamos <code>c3</code>:</p> <pre><code>atlas@olympus:~$ docker stop c1\nc1\natlas@olympus:~$ docker rm c1\nc1\natlas@olympus:~$ docker run -d -p 8081:80 --name c3 -v volumen_web:/var/www/html php:7.4-apache\n7c401c786a6aac6aa4c1ec8874066fb63b943554b273637e996ef4d5b6fc6e2a\n</code></pre> <p></p> <p>Comprobamos que el <code>index.html</code> anterior sigue funcionando en <code>c3</code>:</p> <p></p>"},{"location":"iaw/ejs-docker/#redes","title":"Redes","text":""},{"location":"iaw/ejs-docker/#introduccion-a-las-redes-en-docker","title":"Introducci\u00f3n a las redes en Docker","text":"<p>Lanzo un contenedor que se borrar\u00e1 al pararse (--rm):</p> <pre><code>atlas@olympus:~$ docker run -it --name contenedor1 --rm debian bash\nroot@222b4c0ff2cd:/#\n</code></pre> <p>Para ver la IP asignada:</p> <pre><code>atlas@olympus:~$ docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' contenedor1\n172.17.0.2\n</code></pre> <p>El bridge <code>docker0</code> en nuestro host es al que se conectan todos los contenedores por defecto:</p> <p></p> <p>Docker nos modifica el cortafuegos:</p> <pre><code>atlas@olympus:~$ sudo iptables -L -n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nChain FORWARD (policy DROP)\ntarget     prot opt source               destination\nDOCKER-USER  all  --  0.0.0.0/0            0.0.0.0/0\nDOCKER-ISOLATION-STAGE-1  all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED\nDOCKER     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nChain DOCKER (1 references)\ntarget     prot opt source               destination\nChain DOCKER-ISOLATION-STAGE-1 (1 references)\ntarget     prot opt source               destination\nDOCKER-ISOLATION-STAGE-2  all  --  0.0.0.0/0            0.0.0.0/0\nRETURN     all  --  0.0.0.0/0            0.0.0.0/0\nChain DOCKER-ISOLATION-STAGE-2 (1 references)\ntarget     prot opt source               destination\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\nRETURN     all  --  0.0.0.0/0            0.0.0.0/0\nChain DOCKER-USER (1 references)\ntarget     prot opt source               destination\nRETURN     all  --  0.0.0.0/0            0.0.0.0/0\n</code></pre> <pre><code>atlas@olympus:~$ sudo iptables -L -n -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination\nDOCKER     all  --  0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDOCKER     all  --  0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination\nMASQUERADE  all  --  172.17.0.0/16        0.0.0.0/0\nChain DOCKER (2 references)\ntarget     prot opt source               destination\nRETURN     all  --  0.0.0.0/0            0.0.0.0/0\n</code></pre>"},{"location":"iaw/ejs-docker/#tipos-de-redes-en-docker","title":"Tipos de redes en Docker","text":"<p>Para listar las redes:</p> <pre><code>atlas@olympus:~$ docker network ls\nNETWORK ID     NAME      DRIVER    SCOPE\ncefa7428778f   bridge    bridge    local\n34d0a5b2368f   host      host      local\n9e2bf2980f1b   none      null      local\n</code></pre> <p>Por defecto los contenedores se conectan a <code>bridge</code>:</p> <p></p> <p>En la tipo <code>host</code> el contenedor ofrece los servicios en la IP y puertos del anfitri\u00f3n. No tiene ip propia:</p> <pre><code>atlas@olympus:~$ docker run -d --name mi_servidor --network host josedom24/aplicacionweb:v1\nUnable to find image 'josedom24/aplicacionweb:v1' locally\nv1: Pulling from josedom24/aplicacionweb\nc5e155d5a1d1: Pull complete\nf2b76f8f3462: Pull complete\n2e8f82335e4d: Pull complete\nDigest: sha256:6c28c9bbb10ea66f08c27377bf35cbf23b6bf64f1cc71b20dcd0d39686835796\nStatus: Downloaded newer image for josedom24/aplicacionweb:v1\n89950cbe5d6f29c9f24fac00b720cf70671396f74770d2c2d36f14ae626b7a31\natlas@olympus:~$ docker ps\nCONTAINER ID   IMAGE                        COMMAND                  CREATED          STATUS          PORTS     NAMES\n89950cbe5d6f   josedom24/aplicacionweb:v1   \"/usr/sbin/apache2ct\u2026\"   37 seconds ago   Up 36 seconds             mi_servidor\n</code></pre> <p>Podemos acceder localmente al contenedor, sin mapeo:</p> <p></p> <p>La red <code>none</code> no asigna IP y a\u00edsla a los contenedores, solo da loopback. Se usa para batch jobs.</p>"},{"location":"iaw/ejs-docker/#gestionando-las-redes-en-docker","title":"Gestionando las redes en docker","text":"<p>Bridge <code>docker0</code> por defecto \u2260 Bridges definidos por el usuario.</p> <p>Los contenedores en producci\u00f3n deben estar en bridges de usuario, son mejores.</p> <p>Para listar redes:</p> <pre><code>atlas@olympus:~$ docker network ls\nNETWORK ID     NAME      DRIVER    SCOPE\ncefa7428778f   bridge    bridge    local\n34d0a5b2368f   host      host      local\n9e2bf2980f1b   none      null      local\n</code></pre> <p>Para crear redes:</p> <pre><code>atlas@olympus:~$ docker network create red1\ndcec4de396e9802627a000d813e5cc65da4f0992a9cf5ace62eff12f13735da5\natlas@olympus:~$ docker network create -d bridge --subnet 172.24.0.0/16 --gateway 172.24.0.1 red2\ne6cacc4df914f5cb9de6b336679ec1ed7e804407f0e56968c74a4a3e7e7a8deb\natlas@olympus:~$ docker network ls\nNETWORK ID     NAME      DRIVER    SCOPE\ncefa7428778f   bridge    bridge    local\n34d0a5b2368f   host      host      local\n9e2bf2980f1b   none      null      local\ndcec4de396e9   red1      bridge    local\ne6cacc4df914   red2      bridge    local\n</code></pre> <p>Para borrar redes:</p> <pre><code>atlas@olympus:~$ docker network rm red1\nred1\natlas@olympus:~$ docker network prune\nWARNING! This will remove all custom networks not used by at least one container.\nAre you sure you want to continue? [y/N] y\nDeleted Networks:\nred2\n</code></pre> <p>Para ver informaci\u00f3n de una red:</p> <pre><code>atlas@olympus:~$ docker network inspect bridge\n[\n    {\n        \"Name\": \"bridge\",\n        \"Id\": \"cefa7428778f2b0a5af1617a3659829650226ea874cb037d71efd441d80a8a79\",\n        \"Created\": \"2022-06-13T17:40:22.758388059+02:00\",\n        \"Scope\": \"local\",\n        \"Driver\": \"bridge\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": null,\n            \"Config\": [\n                {\n                    \"Subnet\": \"172.17.0.0/16\",\n                    \"Gateway\": \"172.17.0.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Attachable\": false,\n        \"Ingress\": false,\n        \"ConfigFrom\": {\n            \"Network\": \"\"\n        },\n        \"ConfigOnly\": false,\n        \"Containers\": {},\n        \"Options\": {\n            \"com.docker.network.bridge.default_bridge\": \"true\",\n            \"com.docker.network.bridge.enable_icc\": \"true\",\n            \"com.docker.network.bridge.enable_ip_masquerade\": \"true\",\n            \"com.docker.network.bridge.host_binding_ipv4\": \"0.0.0.0\",\n            \"com.docker.network.bridge.name\": \"docker0\",\n            \"com.docker.network.driver.mtu\": \"1500\"\n        },\n        \"Labels\": {}\n    }\n]\n</code></pre> <p>Cada red que creamos genera un bridge como podemos ver:</p> <p></p>"},{"location":"iaw/ejs-docker/#uso-de-la-red-bridge-por-defecto","title":"Uso de la red bridge por defecto","text":"<p>Manera no recomendada. Usaremos el obsoleto <code>--link</code>.</p> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~$ docker run -d --name servidor_mariadb \\\n-e MYSQL_DATABASE=mi_basededatos \\\n-e MYSQL_USER=usuario \\\n-e MYSQL_PASSWORD=asdasd \\\n-e MYSQL_ROOT_PASSWORD=asdasd \\\nmariadb\n026b003f91c9289fd2d0c1da284057b77607ab62b218321630e887675fddf148\n</code></pre> <p>Lanzo otro contenedor enlazado con el anterior:</p> <pre><code>atlas@olympus:~$ docker run -d --name servidor_web --link servidor_mariadb:mariadb nginx\n6336b40e133735e408e5b043763e5eeefea2c51f35a3447d3167fcfed17d6a0f\n</code></pre> <p>El enlace se hace por resoluci\u00f3n est\u00e1tica:</p> <pre><code>atlas@olympus:~$ docker exec servidor_web cat /etc/hosts\n127.0.0.1   localhost\n::1 localhost ip6-localhost ip6-loopback\nfe00::0ip6-localnet\nff00::0ip6-mcastprefix\nff02::1ip6-allnodes\nff02::2ip6-allrouters\n172.17.0.2  mariadb 026b003f91c9 servidor_mariadb\n172.17.0.3  6336b40e1337\n</code></pre> <p>El DNS del contenedor es el mismo que el de nuestro host = las resoluciones no se hacen con un DNS:</p> <pre><code>atlas@olympus:~$ docker exec servidor_web cat /etc/resolv.conf\n# Generated by NetworkManager\nnameserver 8.8.8.8\nnameserver 8.8.4.4\n</code></pre> <p>Se comparten variables:</p> <pre><code>atlas@olympus:~$ docker exec servidor_web env\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHOSTNAME=6336b40e1337\nMARIADB_PORT=tcp://172.17.0.2:3306\nMARIADB_PORT_3306_TCP=tcp://172.17.0.2:3306\nMARIADB_PORT_3306_TCP_ADDR=172.17.0.2\nMARIADB_PORT_3306_TCP_PORT=3306\nMARIADB_PORT_3306_TCP_PROTO=tcp\nMARIADB_NAME=/servidor_web/mariadb\nMARIADB_ENV_MYSQL_DATABASE=mi_basededatos\nMARIADB_ENV_MYSQL_USER=usuario\nMARIADB_ENV_MYSQL_PASSWORD=asdasd\nMARIADB_ENV_MYSQL_ROOT_PASSWORD=asdasd\nMARIADB_ENV_GOSU_VERSION=1.14\nMARIADB_ENV_MARIADB_MAJOR=10.8\nMARIADB_ENV_MARIADB_VERSION=1:10.8.3+maria~jammy\nNGINX_VERSION=1.21.6\nNJS_VERSION=0.7.3\nPKG_RELEASE=1~bullseye\nHOME=/root\n</code></pre>"},{"location":"iaw/ejs-docker/#uso-de-las-redes-bridge-definidas-por-el-usuario","title":"Uso de las redes bridge definidas por el usuario","text":"<p>Para crear una:</p> <pre><code>atlas@olympus:~$ docker network create red1\n15154211dbeb52ed33a98e45bc9220fa6ec8dd266d72bd8947188a47ac1f3192\n</code></pre> <p>Si no indicamos direccionamiento, docker lo asigna autom\u00e1ticamente:</p> <pre><code>atlas@olympus:~$ docker network inspect red1\n[\n    {\n        \"Name\": \"red1\",\n        \"Id\": \"15154211dbeb52ed33a98e45bc9220fa6ec8dd266d72bd8947188a47ac1f3192\",\n        \"Created\": \"2022-06-13T20:20:57.861626406+02:00\",\n        \"Scope\": \"local\",\n        \"Driver\": \"bridge\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": {},\n            \"Config\": [\n                {\n                    \"Subnet\": \"172.21.0.0/16\",\n                    \"Gateway\": \"172.21.0.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Attachable\": false,\n        \"Ingress\": false,\n        \"ConfigFrom\": {\n            \"Network\": \"\"\n        },\n        \"ConfigOnly\": false,\n        \"Containers\": {},\n        \"Options\": {},\n        \"Labels\": {}\n    }\n]\n</code></pre> <p>Conectaremos dos contenedores a esa red:</p> <pre><code>atlas@olympus:~$ docker run -d --name my-apache-app --network red1 -p 8080:80 httpd:2.4\nff7e218f3527e116d05b77c6e858b0118e49991fb71bc342b502a60a6d533a59\n</code></pre> <p>Comprobaremos la resoluci\u00f3n DNS:</p> <pre><code>atlas@olympus:~$ docker run -it --name contenedor1 --network red1 debian bash\nroot@646845be5f23:/# apt update\nGet:1 http://security.debian.org/debian-security bullseye-security InRelease [44.1 kB]\nGet:2 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [39.4 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8182 kB]\nGet:5 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [154 kB]\nGet:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [2592 B]\nFetched 8539 kB in 39s (218 kB/s)\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\n1 package can be upgraded. Run 'apt list --upgradable' to see it.\nroot@646845be5f23:/# apt install dnsutils -y\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following additional packages will be installed:\n  bind9-dnsutils bind9-host bind9-libs libbsd0 libedit2 libfstrm0 libicu67 libjson-c5 liblmdb0 libmaxminddb0 libmd0 libprotobuf-c1 libuv1 libxml2\nSuggested packages:\n  mmdb-bin\nThe following NEW packages will be installed:\n  bind9-dnsutils bind9-host bind9-libs dnsutils libbsd0 libedit2 libfstrm0 libicu67 libjson-c5 liblmdb0 libmaxminddb0 libmd0 libprotobuf-c1 libuv1 libxml2\n0 upgraded, 15 newly installed, 0 to remove and 1 not upgraded.\nNeed to get 12.2 MB of archives.\nAfter this operation, 42.3 MB of additional disk space will be used.\nSelecting previously unselected package libicu67:amd64.\nPreparing to unpack .../06-libicu67_67.1-7_amd64.deb ...\nUnpacking libicu67:amd64 (67.1-7) ...\nSelecting previously unselected package libxml2:amd64.\nPreparing to unpack .../07-libxml2_2.9.10+dfsg-6.7+deb11u2_amd64.deb ...\nUnpacking libxml2:amd64 (2.9.10+dfsg-6.7+deb11u2) ...\nSelecting previously unselected package bind9-libs:amd64.\nPreparing to unpack .../08-bind9-libs_1%3a9.16.27-1~deb11u1_amd64.deb ...\nUnpacking bind9-libs:amd64 (1:9.16.27-1~deb11u1) ...\nSelecting previously unselected package bind9-host.\nPreparing to unpack .../09-bind9-host_1%3a9.16.27-1~deb11u1_amd64.deb ...\nUnpacking bind9-host (1:9.16.27-1~deb11u1) ...\nSelecting previously unselected package libmd0:amd64.\nPreparing to unpack .../10-libmd0_1.0.3-3_amd64.deb ...\nUnpacking libmd0:amd64 (1.0.3-3) ...\nSelecting previously unselected package libbsd0:amd64.\nPreparing to unpack .../11-libbsd0_0.11.3-1_amd64.deb ...\nUnpacking libbsd0:amd64 (0.11.3-1) ...\nSelecting previously unselected package libedit2:amd64.\nPreparing to unpack .../12-libedit2_3.1-20191231-2+b1_amd64.deb ...\nUnpacking libedit2:amd64 (3.1-20191231-2+b1) ...\nSelecting previously unselected package bind9-dnsutils.\nPreparing to unpack .../13-bind9-dnsutils_1%3a9.16.27-1~deb11u1_amd64.deb ...\nUnpacking bind9-dnsutils (1:9.16.27-1~deb11u1) ...\nSelecting previously unselected package dnsutils.\nPreparing to unpack .../14-dnsutils_1%3a9.16.27-1~deb11u1_all.deb ...\nUnpacking dnsutils (1:9.16.27-1~deb11u1) ...\nSetting up liblmdb0:amd64 (0.9.24-1) ...\nSetting up libicu67:amd64 (67.1-7) ...\nSetting up libmaxminddb0:amd64 (1.5.2-1) ...\nSetting up libfstrm0:amd64 (0.6.0-1+b1) ...\nSetting up libprotobuf-c1:amd64 (1.3.3-1+b2) ...\nSetting up libuv1:amd64 (1.40.0-2) ...\nSetting up libmd0:amd64 (1.0.3-3) ...\nSetting up libbsd0:amd64 (0.11.3-1) ...\nSetting up libjson-c5:amd64 (0.15-2) ...\nSetting up libxml2:amd64 (2.9.10+dfsg-6.7+deb11u2) ...\nSetting up bind9-libs:amd64 (1:9.16.27-1~deb11u1) ...\nSetting up libedit2:amd64 (3.1-20191231-2+b1) ...\nSetting up bind9-host (1:9.16.27-1~deb11u1) ...\nSetting up bind9-dnsutils (1:9.16.27-1~deb11u1) ...\nSetting up dnsutils (1:9.16.27-1~deb11u1) ...\nProcessing triggers for libc-bin (2.31-13+deb11u3) ...\nroot@646845be5f23:/# dig my-apache-app\n\n; &lt;&lt;&gt;&gt; DiG 9.16.27-Debian &lt;&lt;&gt;&gt; my-apache-app\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 52630\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n;; QUESTION SECTION:\n;my-apache-app.         IN  A\n;; ANSWER SECTION:\nmy-apache-app.          600 IN  A   172.21.0.2\n;; Query time: 0 msec\n;; SERVER: 127.0.0.11#53(127.0.0.11)\n;; WHEN: Mon Jun 13 19:17:31 UTC 2022\n;; MSG SIZE  rcvd: 60\n</code></pre> <p>Comprobaremos el servidor DNS del contenedor:</p> <pre><code>root@646845be5f23:/# cat /etc/resolv.conf\nnameserver 127.0.0.11\noptions ndots:0\n</code></pre> <p>Desde los dos contenedores se pueden resolver los dos nombres:</p> <pre><code>root@646845be5f23:/# dig contenedor1\n\n; &lt;&lt;&gt;&gt; DiG 9.16.27-Debian &lt;&lt;&gt;&gt; contenedor1\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 3203\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n;; QUESTION SECTION:\n;contenedor1.                       IN  A\n;; ANSWER SECTION:\ncontenedor1.            600 IN  A   172.21.0.3\n;; Query time: 0 msec\n;; SERVER: 127.0.0.11#53(127.0.0.11)\n;; WHEN: Mon Jun 13 19:24:38 UTC 2022\n;; MSG SIZE  rcvd: 56\n</code></pre>"},{"location":"iaw/ejs-docker/#conectando-los-contenedores-a-otras-redes","title":"Conectando los contenedores a otras redes","text":"<p>Creamos una red bridge con direccionamiento:</p> <pre><code>atlas@olympus:~$ docker network create red2 --subnet 192.168.100.0/24 --gateway 192.168.100.1\n8090d398ee4247a29a17946a161a6e7746d45c6af098b911f5b0334f56ddd32e\n</code></pre> <p>Creamos un contenedor conectado a red2 y comprobamos que no tiene conectividad con red1:</p> <pre><code>atlas@olympus:~$ docker run -it --name contenedor2 --network red2 debian bash\nroot@bd0dcf22141c:/# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n11: eth0@if12: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:c0:a8:64:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.100.2/24 brd 192.168.100.255 scope global eth0\n       valid_lft forever preferred_lft forever\nroot@bd0dcf22141c:/# ping contenedor1\nping: contenedor1: Name or service not known\n</code></pre> <p>Conectamos un contenedor a una red:</p> <pre><code>atlas@olympus:~$ docker network connect red2 contenedor1\natlas@olympus:~$ docker start contenedor1\ncontenedor1\natlas@olympus:~$ docker start contenedor2\ncontenedor2\natlas@olympus:~$ docker attach contenedor1\nroot@4dd5cddfcc4d:/# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n13: eth0@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:ac:15:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 172.21.0.2/16 brd 172.21.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n15: eth1@if16: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:c0:a8:64:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.100.2/24 brd 192.168.100.255 scope global eth1\n       valid_lft forever preferred_lft forever\nroot@4dd5cddfcc4d:/# ping contenedor2\nPING contenedor2 (192.168.100.3) 56(84) bytes of data.\n64 bytes from contenedor2.red2 (192.168.100.3): icmp_seq=1 ttl=64 time=0.200 ms\n64 bytes from contenedor2.red2 (192.168.100.3): icmp_seq=2 ttl=64 time=0.100 ms\n^C\n--- contenedor2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 0.100/0.150/0.200/0.050 ms\n</code></pre> <p><code>contenedor2</code> tiene conectividad con <code>contenedor1</code>, pero no con <code>my-apache-app</code> (porque no est\u00e1 conectado a red2):</p> <pre><code>atlas@olympus:~$ docker attach contenedor2\nroot@bd0dcf22141c:/# ping contenedor1\nPING contenedor1 (192.168.100.2) 56(84) bytes of data.\n64 bytes from contenedor1.red2 (192.168.100.2): icmp_seq=1 ttl=64 time=0.185 ms\n^C\n--- contenedor1 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.185/0.185/0.185/0.000 ms\nroot@bd0dcf22141c:/# ping my-apache-app\nping: my-apache-app: Name or service not known\n</code></pre>"},{"location":"iaw/ejs-docker/#mas-opciones-al-trabajar-con-redes-en-docker","title":"M\u00e1s opciones al trabajar con redes en Docker","text":"<p>Creo una red:</p> <pre><code>atlas@olympus:~$ docker network create --subnet 192.168.100.0/24 red3\n74a6c4d6fa938121164d00f5cbfeda62ffb1b6845b1446679c275c5189a77e40\n</code></pre> <p>Lanzamos un contenedor en esta red:</p> <pre><code>atlas@olympus:~$ docker run -it --name contenedor --network red3 \\\n--ip 192.168.100.10 \\\n--add-host=testing.example.com:192.168.100.20 \\\n--dns 8.8.8.8 \\\n--hostname servidor1 \\\ndebian\nroot@servidor1:/#\n</code></pre> <p><code>--hostname servidor1</code> configur\u00f3 el hostname:</p> <pre><code>root@servidor1:/# cat /etc/hostname\nservidor1\n</code></pre> <p><code>--ip 192.168.100.10</code> configur\u00f3 la IP fija:</p> <pre><code>root@servidor1:/# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n28: eth0@if29: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:c0:a8:64:0a brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.100.10/24 brd 192.168.100.255 scope global eth0\n       valid_lft forever preferred_lft forever\n</code></pre> <p><code>--add-host=testing.example.com:192.168.100.20</code> configur\u00f3 un host en <code>/etc/hosts</code>:</p> <pre><code>root@servidor1:/# cat /etc/hosts\n127.0.0.1   localhost\n::1 localhost ip6-localhost ip6-loopback\nfe00::0ip6-localnet\nff00::0ip6-mcastprefix\nff02::1ip6-allnodes\nff02::2ip6-allrouters\n192.168.100.20  testing.example.com\n192.168.100.10  servidor1\nroot@servidor1:/# ping testing.example.com\nPING testing.example.com (192.168.100.20) 56(84) bytes of data.\n^C\n--- testing.example.com ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2029ms\n</code></pre> <p><code>--dns 8.8.8.8</code> configur\u00f3 el DNS:</p> <pre><code>root@servidor1:/# cat /etc/resolv.conf\nnameserver 127.0.0.11\noptions ndots:0\n</code></pre> <p>Este DNS que vemos (que siempre se crea en las redes bridge de usuario) har\u00e1 forward al que nosotros hemos configurado.</p>"},{"location":"iaw/ejs-docker/#convertir-el-uso-de-la-red-bridge-por-defecto-por-una-definida-por-el-usuario","title":"Convertir el uso de la red bridge por defecto por una definida por el usuario","text":"<p>Lanzamos un mongo:</p> <pre><code>atlas@olympus:~$ docker run -d --name some-mongo mongo\nUnable to find image 'mongo:latest' locally\nlatest: Pulling from library/mongo\nd7bfe07ed847: Pull complete\n97ef66a8492a: Pull complete\n20cec14c8f9e: Pull complete\n38c3018eb09a: Pull complete\nccc9e1c2556b: Pull complete\n593c62d03532: Pull complete\n1a103a446c3f: Pull complete\nbe887b845d3f: Pull complete\ne5543880b183: Pull complete\nDigest: sha256:3745209b24062a8ba670878bce47ad9c944682f550044721c4abc5b4daeb863d\nStatus: Downloaded newer image for mongo:latest\nb369ad614dad75e83e45c1bf0faff34ea286d477d4afc7b39b98f1b0199adc5e\n</code></pre> <p>Lanzamos un lets-chat enlazado con el mongo anterior:</p> <pre><code>atlas@olympus:~$ docker run --name some-letschat --link some-mongo:mongo -p 8080:8080 -d sdelements/lets-chat\nUnable to find image 'sdelements/lets-chat:latest' locally\nlatest: Pulling from sdelements/lets-chat\n6a5a5368e0c2: Pull complete\n7b9457ec39de: Pull complete\n22cf98377d30: Pull complete\n01e6dd0c0aed: Pull complete\neef159360227: Pull complete\na77283727d00: Pull complete\n050fb7768585: Pull complete\nd2510806c35f: Pull complete\na75c55aa55f6: Pull complete\n876c39157780: Pull complete\nDigest: sha256:5b923d428176250653530fdac8a9f925043f30c511b77701662d7f8fab74961c\nStatus: Downloaded newer image for sdelements/lets-chat:latest\nf078bbda16971fdf2eb830683e6c72688bb17b6cee07a00976130b419e7d7c7a\n</code></pre> <p>Probamos que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#usando-una-red-bridge-de-usuario","title":"Usando una red bridge de usuario","text":"<p>Creamos la red:</p> <pre><code>atlas@olympus:~$ docker network create red_letschat\ndf63456e88c7d16a6bd0af594d4e8b0950f4e26c4b9870d067f7dc8f31dfd7db\n</code></pre> <p>Lanzamos mongo:</p> <pre><code>atlas@olympus:~$ docker run -d --network red_letschat --name mongo mongo\n3583a31aa1d102886526217cb40f5bccaa088645eab416ad6ea5316dbeb7d1b5\n</code></pre> <p>Lanzamos lets-chat:</p> <pre><code>atlas@olympus:~$ docker run --name some-letschat --network red_letschat -p 8080:8080 -d sdelements/lets-chat\n1f7157f43c7d3a60136e6908932b6fb1a6e89daf62951eed342e2d4f6dd8292e\n</code></pre> <p>Probamos que funciona de nuevo:</p> <p></p>"},{"location":"iaw/ejs-docker/#ejemplo-1-despliegue-de-la-aplicacion-guestbook","title":"Ejemplo 1: Despliegue de la aplicaci\u00f3n Guestbook","text":"<p>Creo la red:</p> <pre><code>atlas@olympus:~$ docker network create red_guestbook\n0749760344c197032e1323c4add4a69912b444ab1ff6ce4a799f766d8e0db5e6\n</code></pre> <p>Lanzo los contenedores:</p> <pre><code>atlas@olympus:~$ docker run -d --name redis --network red_guestbook redis\nUnable to find image 'redis:latest' locally\nlatest: Pulling from library/redis\n42c077c10790: Already exists\na300d83d65f9: Pull complete\nebdc3afaab5c: Pull complete\n6ce178c713e4: Pull complete\n949f9d8f429f: Pull complete\n4076be5e5074: Pull complete\nDigest: sha256:cfda0458239615720cc16d6edf6bae7905c31265f218d2033c43cdb40cd59792\nStatus: Downloaded newer image for redis:latest\n96cf2e1a0af36d51cb58848eec71be9bbfaeb9596531fb3bb65b376796917860\natlas@olympus:~$ docker run -d -p 80:5000 --name guestbook --network red_guestbook iesgn/guestbook\nUnable to find image 'iesgn/guestbook:latest' locally\nlatest: Pulling from iesgn/guestbook\n0ecb575e629c: Pull complete\n7467d1831b69: Pull complete\nfeab2c490a3c: Pull complete\nf15a0f46f8c3: Pull complete\n937782447ff6: Pull complete\ne78b7aaaab2c: Pull complete\ndfce8611166c: Pull complete\n3a6aeb6d9625: Pull complete\n2b7e1323c92f: Pull complete\n4bf029403d35: Pull complete\n5e777db1f033: Pull complete\nDigest: sha256:a1fc3e0652e324f643d1ebf8ab028d652aa10e13915bcc2c115d5dc9dd0ba7d2\nStatus: Downloaded newer image for iesgn/guestbook:latest\n0d664c2abe850aefdb347c9101b07953409d9e8d33e2b879322effcea40234fe\n</code></pre> <p>Probamos que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#ejemplo-2-despliegue-de-la-aplicacion-temperaturas","title":"Ejemplo 2: Despliegue de la aplicaci\u00f3n Temperaturas","text":"<p>Creo la red:</p> <pre><code>atlas@olympus:~$ docker network create red_temperaturas\nd503820887ffa9e2543930675d235f6c56b9f9fdf02524278ec62b7c04e02678\n</code></pre> <p>Lanzo los contenedores:</p> <pre><code>atlas@olympus:~$ docker run -d --name temperaturas-backend --network red_temperaturas iesgn/temperaturas_backend\nUnable to find image 'iesgn/temperaturas_backend:latest' locally\nlatest: Pulling from iesgn/temperaturas_backend\n0ecb575e629c: Already exists\ndd4d4b42fc71: Pull complete\n7ce5fbadeda7: Pull complete\n54eb73ab1487: Pull complete\nDigest: sha256:47bbcb85cfa1e21aecee7cf8fec4fce03197b7e0afd2229fa681116e4d8f422d\nStatus: Downloaded newer image for iesgn/temperaturas_backend:latest\nef1fbd2d31ac6c031f6bdb374983d6f7552ea8f591d4d062c57fb6ac4be43e5b\natlas@olympus:~$ docker run -d -p 80:3000 --name temperaturas-frontend --network red_temperaturas iesgn/temperaturas_frontend\nUnable to find image 'iesgn/temperaturas_frontend:latest' locally\nlatest: Pulling from iesgn/temperaturas_frontend\n0ecb575e629c: Already exists\n1b0ea791d129: Pull complete\n18ffb3e704a1: Pull complete\nd724eea63276: Pull complete\nDigest: sha256:7a2b7b66f830e0905d2b0b7faf33a5bea3da7c12c8ea75abdc034603307c7677\nStatus: Downloaded newer image for iesgn/temperaturas_frontend:latest\n8ffd4cf58fa19fb7f39ed690b7a724b0c2e364e66bba1359ae3ba5212e48f4ae\n</code></pre> <p>Probamos que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#ejemplo-3-despliegue-de-wordpress-mariadb","title":"Ejemplo 3: Despliegue de Wordpress + MariaDB","text":"<p>Creo la red:</p> <pre><code>atlas@olympus:~$ docker network create red_wp\n80c955b07b17dcf9eda18567b0b65cba6344bf3ac45beba35eff131e77630abf\n</code></pre> <p>Lanzo los contenedores:</p> <pre><code>atlas@olympus:~$ docker run -d --name servidor_mysql \\\n--network red_wp \\\n-v /opt/mysql_wp:/var/lib/mysql \\\n-e MYSQL_DATABASE=bd_wp \\\n-e MYSQL_USER=user_wp \\\n-e MYSQL_PASSWORD=asdasd \\\n-e MYSQL_ROOT_PASSWORD=asdasd \\\nmariadb\n3d892aa3847a19b4fc877dfa2dd085e7182d07f01ccc9be42fd6aa731e20255e\natlas@olympus:~$ docker run -d --name servidor_wp \\\n--network red_wp \\\n-v /opt/wordpress:/var/www/html/wp-content \\\n-e WORDPRESS_DB_HOST=servidor_mysql \\\n-e WORDPRESS_DB_USER=user_wp \\\n-e WORDPRESS_DB_PASSWORD=asdasd \\\n-e WORDPRESS_DB_NAME=bd_wp \\\n-p 80:80 \\\nwordpress\nUnable to find image 'wordpress:latest' locally\nlatest: Pulling from library/wordpress\n42c077c10790: Already exists\n8934009a9160: Already exists\n5357ac116991: Already exists\n54ae63894b5a: Already exists\n772088206f85: Already exists\n3b81c5474649: Already exists\nc62a528527ae: Already exists\n344c792709d4: Already exists\nef9638273c35: Already exists\n4ec70638e42f: Already exists\n5a0f65f5bb3b: Already exists\n55578a5ce5e8: Already exists\nf1dd85b4dfa5: Already exists\n35dc259d9d51: Pull complete\n48147606c534: Pull complete\nc88c969d9899: Pull complete\ne08b6500594a: Pull complete\n027690aff84d: Pull complete\n8770aef363f4: Pull complete\n336e4cd7d982: Pull complete\n8e0e84b1add6: Pull complete\nDigest: sha256:92a0f6f7e92eab575659ff6c6ee3d1abb56752977d1d729de5da1a876f9f1f42\nStatus: Downloaded newer image for wordpress:latest\nec1b9fac1479fde88682d5071b86f198b69a9442064b29bc3ac5770ed1a07b33\n</code></pre> <p>Muestro que est\u00e1n activos:</p> <pre><code>atlas@olympus:~$ docker ps\nCONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                NAMES\nec1b9fac1479   wordpress   \"docker-entrypoint.s\u2026\"   57 seconds ago   Up 55 seconds   0.0.0.0:80-&gt;80/tcp   servidor_wp\n3d892aa3847a   mariadb     \"docker-entrypoint.s\u2026\"   2 minutes ago    Up 2 minutes    3306/tcp             servidor_mysql\n</code></pre> <p>Probamos que funciona (har\u00e9 la instalaci\u00f3n y lo mostrar\u00e9 directamente funcionando):</p> <p></p>"},{"location":"iaw/ejs-docker/#ejemplo-4-despliegue-de-tomcat-nginx","title":"Ejemplo 4: Despliegue de Tomcat + Nginx","text":"<p>Creo la red:</p> <pre><code>atlas@olympus:~$ docker network create red_tomcat\n891d29f1d2054410e0c43654924fe8400584ea1d2b411262a9d4085182e60234\n</code></pre> <p>Creo el directorio tomcat y entro:</p> <pre><code>atlas@olympus:~$ mkdir tomcat\natlas@olympus:~$ cd tomcat\natlas@olympus:~/tomcat$\n</code></pre> <p>Descargo en \u00e9l los 2 ficheros que necesito y muestro que los tengo:</p> <pre><code>atlas@olympus:~/tomcat$ wget https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion4/ejemplo4/default.conf\n--2022-06-14 20:35:44--  https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion4/ejemplo4/default.conf\nResolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.111.133, 185.199.109.133, ...\nConnecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 387 [text/plain]\nSaving to: \u2018default.conf\u2019\ndefault.conf                                100%[=========================================================================================&gt;]     387  --.-KB/s    in 0s\n2022-06-14 20:35:44 (15.6 MB/s) - \u2018default.conf\u2019 saved [387/387]\natlas@olympus:~/tomcat$ wget https://github.com/iesgn/curso_docker_2021/raw/main/ejemplos/sesion4/ejemplo4/sample.war\n--2022-06-14 20:38:59--  https://github.com/iesgn/curso_docker_2021/raw/main/ejemplos/sesion4/ejemplo4/sample.war\nResolving github.com (github.com)... 140.82.121.4\nConnecting to github.com (github.com)|140.82.121.4|:443... connected.\nHTTP request sent, awaiting response... 302 Found\nLocation: https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion4/ejemplo4/sample.war [following]\n--2022-06-14 20:38:59--  https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion4/ejemplo4/sample.war\nResolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.111.133, 185.199.108.133, 185.199.109.133, ...\nConnecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.111.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 4606 (4.5K) [application/octet-stream]\nSaving to: \u2018sample.war\u2019\nsample.war                                  100%[=========================================================================================&gt;]   4.50K  --.-KB/s    in 0.002s\n2022-06-14 20:38:59 (2.21 MB/s) - \u2018sample.war\u2019 saved [4606/4606]\natlas@olympus:~/tomcat$ ls -la\ntotal 20\ndrwxr-xr-x  2 atlas atlas 4096 Jun 14 20:38 .\ndrwxr-xr-x 42 atlas atlas 4096 Jun 14 20:32 ..\n-rw-r--r--  1 atlas atlas  387 Jun 14 20:35 default.conf\n-rw-r--r--  1 atlas atlas 4606 Jun 14 20:38 sample.war\n</code></pre> <p>Lanzo el contenedor de Tomcat:</p> <pre><code>atlas@olympus:~/tomcat$ docker run -d --name aplicacionjava \\\n--network red_tomcat \\\n-v /home/atlas/tomcat/sample.war:/usr/local/tomcat/webapps/sample.war:ro \\\ntomcat:9.0\nUnable to find image 'tomcat:9.0' locally\n9.0: Pulling from library/tomcat\ne756f3fdd6a3: Already exists\nbf168a674899: Pull complete\ne604223835cc: Pull complete\n6d5c91c4cd86: Pull complete\n5e20d165240e: Pull complete\n1334d60df9a8: Pull complete\n16c2728dcd90: Pull complete\n05288798d23d: Pull complete\n3bbce73846a1: Pull complete\n58e753cca0c7: Pull complete\nDigest: sha256:8558e9b51d8aa9f08d6611c54a832b1be64636e713532729fca44774d6a0765d\nStatus: Downloaded newer image for tomcat:9.0\nbd9c22e54e6e7b96e27ab502c0db185ca24ea87635d222c8e16aed84e92dc6c6\n</code></pre> <p>Lanzo el contenedor de Nginx:</p> <pre><code>atlas@olympus:~/tomcat$ docker run -d --name proxy \\\n-p 80:80 \\\n--network red_tomcat \\\n-v /home/atlas/tomcat/default.conf:/etc/nginx/conf.d/default.conf:ro \\\nnginx\na62ecf82ea16924e06a49bbedd7a32857a2ebebb04becde4b0e57ed8d4f31751\n</code></pre> <p>Probamos que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#ejercicios-redes","title":"Ejercicios redes","text":"<p>Creo <code>red1</code>:</p> <pre><code>atlas@olympus:~$ docker network create red1 --subnet 172.28.0.0/16 --gateway 172.28.0.1\n83eb74c0d72db336bd40fd2c48cdd6583b8b232b304ecc858fde6e5d05432709\n</code></pre> <p>Creo <code>red2</code>:</p> <pre><code>atlas@olympus:~$ docker network create red2\n501db55f3c489ba353ac40105eea56c5053707f04199af73dc47b38f317e677d\n</code></pre> <p>Lanzo el primer contenedor e instalo ping:</p> <pre><code>atlas@olympus:~$ docker run -it --name u1 --network red1 --ip 172.28.0.10 --hostname host1 ubuntu:20.04\nroot@host1:/# apt update\nGet:1 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]\nGet:2 http://archive.ubuntu.com/ubuntu focal InRelease [265 kB]\nGet:3 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\nGet:4 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [27.5 kB]\nGet:5 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]\nGet:6 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [880 kB]\nGet:7 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [1931 kB]\nGet:8 http://archive.ubuntu.com/ubuntu focal/main amd64 Packages [1275 kB]\nGet:9 http://archive.ubuntu.com/ubuntu focal/universe amd64 Packages [11.3 MB]\nGet:10 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [1286 kB]\nGet:11 http://archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [33.4 kB]\nGet:12 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [177 kB]\nGet:13 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2364 kB]\nGet:14 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [1365 kB]\nGet:15 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1169 kB]\nGet:16 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [30.2 kB]\nGet:17 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [27.1 kB]\nGet:18 http://archive.ubuntu.com/ubuntu focal-backports/main amd64 Packages [53.8 kB]\nFetched 22.6 MB in 9s (2566 kB/s)\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\n7 packages can be upgraded. Run 'apt list --upgradable' to see them.\nroot@host1:/# apt install inetutils-ping\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following additional packages will be installed:\n  libidn11 netbase\nThe following NEW packages will be installed:\n  inetutils-ping libidn11 netbase\n0 upgraded, 3 newly installed, 0 to remove and 7 not upgraded.\nNeed to get 120 kB of archives.\nAfter this operation, 657 kB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 http://archive.ubuntu.com/ubuntu focal/main amd64 netbase all 6.1 [13.1 kB]\nGet:2 http://archive.ubuntu.com/ubuntu focal/main amd64 libidn11 amd64 1.33-2.2ubuntu2 [46.2 kB]\nGet:3 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 inetutils-ping amd64 2:1.9.4-11ubuntu0.1 [60.7 kB]\nFetched 120 kB in 1s (113 kB/s)\ndebconf: delaying package configuration, since apt-utils is not installed\nSelecting previously unselected package netbase.\n(Reading database ... 4126 files and directories currently installed.)\nPreparing to unpack .../archives/netbase_6.1_all.deb ...\nUnpacking netbase (6.1) ...\nSelecting previously unselected package libidn11:amd64.\nPreparing to unpack .../libidn11_1.33-2.2ubuntu2_amd64.deb ...\nUnpacking libidn11:amd64 (1.33-2.2ubuntu2) ...\nSelecting previously unselected package inetutils-ping.\nPreparing to unpack .../inetutils-ping_2%3a1.9.4-11ubuntu0.1_amd64.deb ...\nUnpacking inetutils-ping (2:1.9.4-11ubuntu0.1) ...\nSetting up libidn11:amd64 (1.33-2.2ubuntu2) ...\nSetting up netbase (6.1) ...\nSetting up inetutils-ping (2:1.9.4-11ubuntu0.1) ...\nProcessing triggers for libc-bin (2.31-0ubuntu9.9) ...\n</code></pre> <p>Mostrar la configuraci\u00f3n de red de <code>u1</code>:</p> <pre><code>docker inspect u1\n</code></pre> <p></p> <p>Lanzo el segundo contenedor e instalo ping:</p> <pre><code>atlas@olympus:~$ docker run -it --name u2 --network red2 --hostname host2 ubuntu:20.04\nroot@host2:/# apt update\nGet:1 http://archive.ubuntu.com/ubuntu focal InRelease [265 kB]\nGet:2 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]\nGet:3 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\nGet:4 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]\nGet:5 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [177 kB]\nGet:6 http://archive.ubuntu.com/ubuntu focal/main amd64 Packages [1275 kB]\nGet:7 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [880 kB]\nGet:8 http://archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [33.4 kB]\nGet:9 http://archive.ubuntu.com/ubuntu focal/universe amd64 Packages [11.3 MB]\nGet:10 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [1931 kB]\nGet:11 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [27.5 kB]\nGet:12 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [1286 kB]\nGet:13 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1169 kB]\nGet:14 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [1365 kB]\nGet:15 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2364 kB]\nGet:16 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [30.2 kB]\nGet:17 http://archive.ubuntu.com/ubuntu focal-backports/main amd64 Packages [53.8 kB]\nGet:18 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [27.1 kB]\nFetched 22.6 MB in 25s (905 kB/s)\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\n7 packages can be upgraded. Run 'apt list --upgradable' to see them.\nroot@host2:/# apt install inetutils-ping\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following additional packages will be installed:\n  libidn11 netbase\nThe following NEW packages will be installed:\n  inetutils-ping libidn11 netbase\n0 upgraded, 3 newly installed, 0 to remove and 7 not upgraded.\nNeed to get 120 kB of archives.\nAfter this operation, 657 kB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 http://archive.ubuntu.com/ubuntu focal/main amd64 netbase all 6.1 [13.1 kB]\nGet:2 http://archive.ubuntu.com/ubuntu focal/main amd64 libidn11 amd64 1.33-2.2ubuntu2 [46.2 kB]\nGet:3 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 inetutils-ping amd64 2:1.9.4-11ubuntu0.1 [60.7 kB]\nFetched 120 kB in 0s (3242 kB/s)\ndebconf: delaying package configuration, since apt-utils is not installed\nSelecting previously unselected package netbase.\n(Reading database ... 4126 files and directories currently installed.)\nPreparing to unpack .../archives/netbase_6.1_all.deb ...\nUnpacking netbase (6.1) ...\nSelecting previously unselected package libidn11:amd64.\nPreparing to unpack .../libidn11_1.33-2.2ubuntu2_amd64.deb ...\nUnpacking libidn11:amd64 (1.33-2.2ubuntu2) ...\nSelecting previously unselected package inetutils-ping.\nPreparing to unpack .../inetutils-ping_2%3a1.9.4-11ubuntu0.1_amd64.deb ...\nUnpacking inetutils-ping (2:1.9.4-11ubuntu0.1) ...\nSetting up libidn11:amd64 (1.33-2.2ubuntu2) ...\nSetting up netbase (6.1) ...\nSetting up inetutils-ping (2:1.9.4-11ubuntu0.1) ...\nProcessing triggers for libc-bin (2.31-0ubuntu9.9) ...\n</code></pre> <p>Mostrar la configuraci\u00f3n de red de <code>u2</code>:</p> <pre><code>docker inspect u2\n</code></pre> <p></p> <p>Compruebo que el ping IP <code>u1</code> \u2192 <code>u2</code> no funciona:</p> <p></p> <p>Compruebo que el ping por nombre <code>u1</code> \u2192 <code>u2</code> no funciona:</p> <p></p> <p>Compruebo que el ping IP <code>u2</code> \u2192 <code>u1</code> no funciona:</p> <p></p> <p>Compruebo que el ping por nombre <code>u2</code> \u2192 <code>u1</code> no funciona:</p> <p></p> <p>Conectamos ahora <code>u1</code> a <code>red2</code>:</p> <p></p> <p>Comprobamos que ahora el ping IP/nombre <code>u1</code> \u2192 <code>u2</code> funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#escenarios-multicontenedor","title":"Escenarios multicontenedor","text":""},{"location":"iaw/ejs-docker/#instalacion-de-docker-compose","title":"Instalaci\u00f3n de docker-compose","text":"<pre><code>sudo apt install docker-compose\n</code></pre>"},{"location":"iaw/ejs-docker/#el-fichero-docker-composeyml","title":"El fichero docker-compose.yml","text":"<p><code>docker-compose</code> se ejecuta en el mismo directorio donde est\u00e9 el <code>docker-compose.yml</code>, por lo que acabaremos teniendo un directorio por cada <code>docker-compose.yml</code>.</p> <p>Por ejemplo, para <code>Let\u2019s Chat</code>, podr\u00edamos tener este <code>docker-compose.yml</code> dentro de un directorio:</p> <pre><code>version: '3.1'\nservices:\n  app:\n    container_name: letschat\n    image: sdelements/lets-chat\n    restart: always\n    environment:\n      LCB_DATABASE_URI: mongodb://mongo/letschat\n    ports:\n      - 80:8080\n    depends_on:\n      - db\n  db:\n    container_name: mongo\n    image: mongo\n    restart: always\n    volumes:\n      - /opt/mongo:/data/db\n</code></pre> <p>Cada <code>service</code> crea un contenedor.</p> <p><code>depends_on</code> obliga a que X contenedor no se inicie hasta que otro est\u00e9 iniciado.</p> <p>Por cada escenario <code>docker-compose</code> se crea un bridge de usuario. Existir\u00e1 resoluci\u00f3n DNS para nombre de contenedor y de servicio.</p>"},{"location":"iaw/ejs-docker/#el-comando-docker-compose","title":"El comando docker-compose","text":"<p>Creo la estructura de directorios <code>/home/atlas/docker/letschat</code> con el siguiente <code>docker-compose.yml</code> dentro:</p> <pre><code>version: '3.1'\nservices:\n  app:\n    container_name: letschat\n    image: sdelements/lets-chat\n    restart: always\n    environment:\n      LCB_DATABASE_URI: mongodb://mongo/letschat\n    ports:\n      - 80:8080\n    depends_on:\n      - db\n  db:\n    container_name: mongo\n    image: mongo\n    restart: always\n    volumes:\n      - /opt/mongo:/data/db\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/letschat$ docker-compose up -d\nCreating mongo ... done\nCreating letschat ... done\n</code></pre> <p>Comprobamos que los contenedores se est\u00e1n ejecutando:</p> <pre><code>atlas@olympus:~/docker/letschat$ docker-compose ps\n  Name               Command             State               Ports\n-------------------------------------------------------------------------------\nletschat   npm start                     Up      5222/tcp, 0.0.0.0:80-&gt;8080/tcp\nmongo      docker-entrypoint.sh mongod   Up      27017/tcp\n</code></pre> <p>Comprobamos que funciona:</p> <p></p> <p>Para eliminar el escenario:</p> <pre><code>atlas@olympus:~/docker/letschat$ docker-compose down\nStopping letschat ... done\nStopping mongo    ... done\nRemoving letschat ... done\nRemoving mongo    ... done\nRemoving network letschat_default\n</code></pre>"},{"location":"iaw/ejs-docker/#almacenamiento-con-docker-compose","title":"Almacenamiento con docker-compose","text":""},{"location":"iaw/ejs-docker/#volumenes-docker-compose","title":"Vol\u00famenes docker-compose","text":"<p>Ejemplo:</p> <pre><code>version: '3.1'\nservices:\n  db:\n    container_name: contenedor_mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: asdasd\n    volumes:\n      - mariadb_data:/var/lib/mysql\nvolumes:\n    mariadb_data:\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/volumenes$ docker-compose up -d\nCreating network \"volumenes_default\" with the default driver\nCreating volume \"volumenes_mariadb_data\" with default driver\nCreating contenedor_mariadb ... done\n</code></pre> <p>Compruebo que est\u00e1 activo:</p> <pre><code>atlas@olympus:~/docker/volumenes$ docker-compose ps\n       Name                     Command              State    Ports\n---------------------------------------------------------------------\ncontenedor_mariadb   docker-entrypoint.sh mariadbd   Up      3306/tcp\n</code></pre> <p>Compruebo que se ha creado el volumen:</p> <pre><code>atlas@olympus:~/docker/volumenes$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     3f39653a3a30f881672c01433725daeb04ab6ba632a723b1af18b093f50e06ae\nlocal     04e463e496d920db4b021cd270aa770d27abaaf32a08d0d035d1fe03356f87b3\nlocal     7df3bfbe82aaf633a16cafb30628c3d0384d48404851b99dc892cb337d530950\nlocal     7e6492fdc4515b59e4d3e86d9c69f31b6e771d78e3c8231dbb0a3eed24bed33c\nlocal     07c295fb652fc3ec7f0f51a3df2d13849aac8795b44e4b55e22e371dea84022d\nlocal     19b03e7f9608f78aac80ee1284c4fa4c5f78afb723499cc664f7753971639753\nlocal     65eb5fc7fc9f541f1dd35effc2e456e615f6ef51670ef07a9971d2278c9dd4ee\nlocal     76c389c617b86588b5950575e9bfbb3f9a17316c491880f30621d3e3bcbe251f\nlocal     256e88e1d29e428176b13909592ca4f124845226dec90aae73f9ddfd26021c9c\nlocal     582b8ad89272ee7607a9e56dfaeae28c1eba9a7263a8052d64e82e6361b4ef1c\nlocal     972306d6e9955703c733bd57d9e270d953e8a028760fd6d3af13c2085af8d1f8\nlocal     d13dcfcda6c5bcbb2b75fdce9f7b74136b88d82d8d4c2e08e6b957840273b0b4\nlocal     da9451ceb333f905d8a8fbe4e764ab2a057139f1641a024ffae408b81cfb72d7\nlocal     datos_compartidos\nlocal     e6c217e966db3c2491c2b6989789f6c7488aaa1222313415722e3d06aaedca03\nlocal     f108fc0c5812145adaa6d4987a0afd9748876ff8bd7b5520e916eb530a3d35c3\nlocal     f9783771ca7c6480508aab09a722d746803e0955cd6b0e8cadcebfd7f1aff44a\nlocal     nextcloud\nlocal     volumen_web\nlocal     volumenes_mariadb_data\nlocal     wwwroot\n</code></pre> <p>Compruebo que el montaje del volumen se ha realizado en el contenedor:</p> <pre><code>docker inspect contenedor_mariadb\n</code></pre> <pre><code>        \"Mounts\": [\n            {\n                \"Type\": \"volume\",\n                \"Name\": \"volumenes_mariadb_data\",\n                \"Source\": \"/var/lib/docker/volumes/volumenes_mariadb_data/_data\",\n                \"Destination\": \"/var/lib/mysql\",\n                \"Driver\": \"local\",\n                \"Mode\": \"rw\",\n                \"RW\": true,\n                \"Propagation\": \"\"\n            }\n        ],\n</code></pre> <p>Elimino escenario + posibles vol\u00famenes:</p> <pre><code>atlas@olympus:~/docker/volumenes$ docker-compose down -v\nStopping contenedor_mariadb ... done\nRemoving contenedor_mariadb ... done\nRemoving network volumenes_default\nRemoving volume volumenes_mariadb_data\n</code></pre>"},{"location":"iaw/ejs-docker/#bind-mount-docker-compose","title":"Bind mount docker-compose","text":"<p>Ejemplo:</p> <pre><code>version: '3.1'\nservices:\n  db:\n    container_name: contenedor_mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: asdasd\n    volumes:\n      - ./data:/var/lib/mysql\n</code></pre> <p>Lanzo el escenario</p> <pre><code>atlas@olympus:~/docker/bindmount$ docker-compose up -d\nCreating network \"bindmount_default\" with the default driver\nCreating contenedor_mariadb ... done\n</code></pre> <p>Compruebo que se ha creado el directorio <code>data</code>:</p> <pre><code>atlas@olympus:~/docker/bindmount$ cd data\natlas@olympus:~/docker/bindmount/data$ ls -la\ntotal 139260\ndrwxr-xr-x 5 systemd-coredump systemd-coredump      4096 Jun 15 21:57 .\ndrwxr-xr-x 3 atlas            atlas                 4096 Jun 15 21:57 ..\n-rw-rw---- 1 systemd-coredump systemd-coredump  16719872 Jun 15 21:57 aria_log.00000001\n-rw-rw---- 1 systemd-coredump systemd-coredump        52 Jun 15 21:57 aria_log_control\n-rw-rw---- 1 systemd-coredump systemd-coredump         9 Jun 15 21:57 ddl_recovery.log\n-rw-rw---- 1 systemd-coredump systemd-coredump       868 Jun 15 21:57 ib_buffer_pool\n-rw-rw---- 1 systemd-coredump systemd-coredump  12582912 Jun 15 21:57 ibdata1\n-rw-rw---- 1 systemd-coredump systemd-coredump 100663296 Jun 15 21:57 ib_logfile0\n-rw-rw---- 1 systemd-coredump systemd-coredump  12582912 Jun 15 21:57 ibtmp1\n-rw-rw---- 1 systemd-coredump systemd-coredump         0 Jun 15 21:57 multi-master.info\ndrwx------ 2 systemd-coredump systemd-coredump      4096 Jun 15 21:57 mysql\n-rw-r--r-- 1 systemd-coredump systemd-coredump        14 Jun 15 21:57 mysql_upgrade_info\ndrwx------ 2 systemd-coredump systemd-coredump      4096 Jun 15 21:57 performance_schema\ndrwx------ 2 systemd-coredump systemd-coredump     12288 Jun 15 21:57 sys\n</code></pre>"},{"location":"iaw/ejs-docker/#redes-con-docker-compose","title":"Redes con docker-compose","text":"<p>Ejemplo:</p> <pre><code>version: '3.1'\nservices:\n  app:\n    container_name: servidor_web\n    image: httpd:2.4\n    restart: always\n    ports:\n      - 8080:80\n    networks:\n      red_web:\n        ipv4_address: 192.168.10.10\n      red_interna:\n        ipv4_address: 192.168.20.10\n    hostname: servidor_web\n  db:\n    container_name: servidor_mariadb\n    image: mariadb\n    environment:\n      MYSQL_ROOT_PASSWORD: asdasd\n    restart: always\n    networks:\n      red_interna:\n        ipv4_address: 192.168.20.20\n    hostname: servidor_mariadb\nnetworks:\n    red_web:\n        ipam:\n            config:\n              - subnet: 192.168.10.0/24\n    red_interna:\n        ipam:\n            config:\n              - subnet: 192.168.20.0/24\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/redes$ docker-compose up -d\nCreating network \"redes_red_web\" with the default driver\nCreating network \"redes_red_interna\" with the default driver\nCreating servidor_web     ... done\nCreating servidor_mariadb ... done\n</code></pre> <p>Compruebo que los contenedores se est\u00e1n ejecutando:</p> <pre><code>atlas@olympus:~/docker/redes$ docker-compose ps\n      Name                    Command              State          Ports\n-------------------------------------------------------------------------------\nservidor_mariadb   docker-entrypoint.sh mariadbd   Up      3306/tcp\nservidor_web       httpd-foreground                Up      0.0.0.0:8080-&gt;80/tcp\n</code></pre> <p>Accedo a <code>servidor_web</code> e instalo paquetes para comprobaciones:</p> <pre><code>atlas@olympus:~/docker/redes$ docker-compose exec app bash\nroot@servidor_web:/usr/local/apache2# apt-get update &amp;&amp; apt-get install -y inetutils-ping iproute2 dnsutils\nGet:1 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:2 http://security.debian.org/debian-security bullseye-security InRelease [44.1 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [39.4 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8182 kB]\nGet:5 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [154 kB]\nGet:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [2592 B]\nFetched 8539 kB in 4s (2245 kB/s)\nReading package lists... Done\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following additional packages will be installed:\n  bind9-dnsutils bind9-host bind9-libs libatm1 libbpf0 libbsd0 libcap2 libcap2-bin libedit2 libelf1 libfstrm0 libjson-c5 liblmdb0 libmaxminddb0 libmd0 libmnl0 libpam-cap\n  libprotobuf-c1 libuv1 libxtables12 netbase\nSuggested packages:\n  iproute2-doc mmdb-bin\nThe following NEW packages will be installed:\n  bind9-dnsutils bind9-host bind9-libs dnsutils inetutils-ping iproute2 libatm1 libbpf0 libbsd0 libcap2 libcap2-bin libedit2 libelf1 libfstrm0 libjson-c5 liblmdb0\n  libmaxminddb0 libmd0 libmnl0 libpam-cap libprotobuf-c1 libuv1 libxtables12 netbase\n0 upgraded, 24 newly installed, 0 to remove and 1 not upgraded.\nNeed to get 4565 kB of archives.\nAfter this operation, 11.6 MB of additional disk space will be used.\nGet:1 http://deb.debian.org/debian bullseye/main amd64 libelf1 amd64 0.183-1 [165 kB]\nGet:2 http://deb.debian.org/debian bullseye/main amd64 libbpf0 amd64 1:0.3-2 [98.3 kB]\nGet:3 http://deb.debian.org/debian bullseye/main amd64 libmd0 amd64 1.0.3-3 [28.0 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 libbsd0 amd64 0.11.3-1 [108 kB]\nGet:5 http://deb.debian.org/debian bullseye/main amd64 libcap2 amd64 1:2.44-1 [23.6 kB]\nGet:6 http://deb.debian.org/debian bullseye/main amd64 libmnl0 amd64 1.0.4-3 [12.5 kB]\nGet:7 http://deb.debian.org/debian bullseye/main amd64 libxtables12 amd64 1.8.7-1 [45.1 kB]\nGet:8 http://deb.debian.org/debian bullseye/main amd64 libcap2-bin amd64 1:2.44-1 [32.6 kB]\nGet:9 http://deb.debian.org/debian bullseye/main amd64 iproute2 amd64 5.10.0-4 [930 kB]\nGet:10 http://deb.debian.org/debian bullseye/main amd64 netbase all 6.3 [19.9 kB]\nGet:11 http://deb.debian.org/debian bullseye/main amd64 libfstrm0 amd64 0.6.0-1+b1 [21.5 kB]\nGet:12 http://deb.debian.org/debian bullseye/main amd64 libjson-c5 amd64 0.15-2 [42.8 kB]\nGet:13 http://deb.debian.org/debian bullseye/main amd64 liblmdb0 amd64 0.9.24-1 [45.0 kB]\nGet:14 http://deb.debian.org/debian bullseye/main amd64 libmaxminddb0 amd64 1.5.2-1 [29.8 kB]\nGet:15 http://deb.debian.org/debian bullseye/main amd64 libprotobuf-c1 amd64 1.3.3-1+b2 [27.0 kB]\nGet:16 http://deb.debian.org/debian bullseye/main amd64 libuv1 amd64 1.40.0-2 [132 kB]\nGet:17 http://deb.debian.org/debian bullseye/main amd64 bind9-libs amd64 1:9.16.27-1~deb11u1 [1413 kB]\nGet:18 http://deb.debian.org/debian bullseye/main amd64 bind9-host amd64 1:9.16.27-1~deb11u1 [302 kB]\nGet:19 http://deb.debian.org/debian bullseye/main amd64 libedit2 amd64 3.1-20191231-2+b1 [96.7 kB]\nGet:20 http://deb.debian.org/debian bullseye/main amd64 bind9-dnsutils amd64 1:9.16.27-1~deb11u1 [398 kB]\nGet:21 http://deb.debian.org/debian bullseye/main amd64 dnsutils all 1:9.16.27-1~deb11u1 [262 kB]\nGet:22 http://deb.debian.org/debian bullseye/main amd64 inetutils-ping amd64 2:2.0-1 [245 kB]\nGet:23 http://deb.debian.org/debian bullseye/main amd64 libatm1 amd64 1:2.5.1-4 [71.3 kB]\nGet:24 http://deb.debian.org/debian bullseye/main amd64 libpam-cap amd64 1:2.44-1 [15.4 kB]\nFetched 4565 kB in 2s (2995 kB/s)\ndebconf: delaying package configuration, since apt-utils is not installed\nSelecting previously unselected package libelf1:amd64.\n(Reading database ... 6833 files and directories currently installed.)\nPreparing to unpack .../00-libelf1_0.183-1_amd64.deb ...\nUnpacking libelf1:amd64 (0.183-1) ...\nSelecting previously unselected package libbpf0:amd64.\nPreparing to unpack .../01-libbpf0_1%3a0.3-2_amd64.deb ...\nUnpacking libbpf0:amd64 (1:0.3-2) ...\nSelecting previously unselected package libmd0:amd64.\nPreparing to unpack .../02-libmd0_1.0.3-3_amd64.deb ...\nUnpacking libmd0:amd64 (1.0.3-3) ...\nSelecting previously unselected package libbsd0:amd64.\nPreparing to unpack .../03-libbsd0_0.11.3-1_amd64.deb ...\nUnpacking libbsd0:amd64 (0.11.3-1) ...\nSelecting previously unselected package libcap2:amd64.\nPreparing to unpack .../04-libcap2_1%3a2.44-1_amd64.deb ...\nUnpacking libcap2:amd64 (1:2.44-1) ...\nSelecting previously unselected package libmnl0:amd64.\nPreparing to unpack .../05-libmnl0_1.0.4-3_amd64.deb ...\nUnpacking libmnl0:amd64 (1.0.4-3) ...\nSelecting previously unselected package libxtables12:amd64.\nPreparing to unpack .../06-libxtables12_1.8.7-1_amd64.deb ...\nUnpacking libxtables12:amd64 (1.8.7-1) ...\nSelecting previously unselected package libcap2-bin.\nPreparing to unpack .../07-libcap2-bin_1%3a2.44-1_amd64.deb ...\nUnpacking libcap2-bin (1:2.44-1) ...\nSelecting previously unselected package iproute2.\nPreparing to unpack .../08-iproute2_5.10.0-4_amd64.deb ...\nUnpacking iproute2 (5.10.0-4) ...\nSelecting previously unselected package netbase.\nPreparing to unpack .../09-netbase_6.3_all.deb ...\nUnpacking netbase (6.3) ...\nSelecting previously unselected package libfstrm0:amd64.\nPreparing to unpack .../10-libfstrm0_0.6.0-1+b1_amd64.deb ...\nUnpacking libfstrm0:amd64 (0.6.0-1+b1) ...\nSelecting previously unselected package libjson-c5:amd64.\nPreparing to unpack .../11-libjson-c5_0.15-2_amd64.deb ...\nUnpacking libjson-c5:amd64 (0.15-2) ...\nSelecting previously unselected package liblmdb0:amd64.\nPreparing to unpack .../12-liblmdb0_0.9.24-1_amd64.deb ...\nUnpacking liblmdb0:amd64 (0.9.24-1) ...\nSelecting previously unselected package libmaxminddb0:amd64.\nPreparing to unpack .../13-libmaxminddb0_1.5.2-1_amd64.deb ...\nUnpacking libmaxminddb0:amd64 (1.5.2-1) ...\nSelecting previously unselected package libprotobuf-c1:amd64.\nPreparing to unpack .../14-libprotobuf-c1_1.3.3-1+b2_amd64.deb ...\nUnpacking libprotobuf-c1:amd64 (1.3.3-1+b2) ...\nSelecting previously unselected package libuv1:amd64.\nPreparing to unpack .../15-libuv1_1.40.0-2_amd64.deb ...\nUnpacking libuv1:amd64 (1.40.0-2) ...\nSelecting previously unselected package bind9-libs:amd64.\nPreparing to unpack .../16-bind9-libs_1%3a9.16.27-1~deb11u1_amd64.deb ...\nUnpacking bind9-libs:amd64 (1:9.16.27-1~deb11u1) ...\nSelecting previously unselected package bind9-host.\nPreparing to unpack .../17-bind9-host_1%3a9.16.27-1~deb11u1_amd64.deb ...\nUnpacking bind9-host (1:9.16.27-1~deb11u1) ...\nSelecting previously unselected package libedit2:amd64.\nPreparing to unpack .../18-libedit2_3.1-20191231-2+b1_amd64.deb ...\nUnpacking libedit2:amd64 (3.1-20191231-2+b1) ...\nSelecting previously unselected package bind9-dnsutils.\nPreparing to unpack .../19-bind9-dnsutils_1%3a9.16.27-1~deb11u1_amd64.deb ...\nUnpacking bind9-dnsutils (1:9.16.27-1~deb11u1) ...\nSelecting previously unselected package dnsutils.\nPreparing to unpack .../20-dnsutils_1%3a9.16.27-1~deb11u1_all.deb ...\nUnpacking dnsutils (1:9.16.27-1~deb11u1) ...\nSelecting previously unselected package inetutils-ping.\nPreparing to unpack .../21-inetutils-ping_2%3a2.0-1_amd64.deb ...\nUnpacking inetutils-ping (2:2.0-1) ...\nSelecting previously unselected package libatm1:amd64.\nPreparing to unpack .../22-libatm1_1%3a2.5.1-4_amd64.deb ...\nUnpacking libatm1:amd64 (1:2.5.1-4) ...\nSelecting previously unselected package libpam-cap:amd64.\nPreparing to unpack .../23-libpam-cap_1%3a2.44-1_amd64.deb ...\nUnpacking libpam-cap:amd64 (1:2.44-1) ...\nSetting up liblmdb0:amd64 (0.9.24-1) ...\nSetting up libmaxminddb0:amd64 (1.5.2-1) ...\nSetting up libfstrm0:amd64 (0.6.0-1+b1) ...\nSetting up libatm1:amd64 (1:2.5.1-4) ...\nSetting up libprotobuf-c1:amd64 (1.3.3-1+b2) ...\nSetting up libcap2:amd64 (1:2.44-1) ...\nSetting up libcap2-bin (1:2.44-1) ...\nSetting up libuv1:amd64 (1.40.0-2) ...\nSetting up libmnl0:amd64 (1.0.4-3) ...\nSetting up libxtables12:amd64 (1.8.7-1) ...\nSetting up libmd0:amd64 (1.0.3-3) ...\nSetting up netbase (6.3) ...\nSetting up libbsd0:amd64 (0.11.3-1) ...\nSetting up libelf1:amd64 (0.183-1) ...\nSetting up libpam-cap:amd64 (1:2.44-1) ...\ndebconf: unable to initialize frontend: Dialog\ndebconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78.)\ndebconf: falling back to frontend: Readline\ndebconf: unable to initialize frontend: Readline\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.32.1 /usr/local/share/perl/5.32.1 /usr/lib/x86_64-linux-gnu/perl5/5.32 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl-base /usr/lib/x86_64-linux-gnu/perl/5.32 /usr/share/perl/5.32 /usr/local/lib/site_perl) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)\ndebconf: falling back to frontend: Teletype\nSetting up libjson-c5:amd64 (0.15-2) ...\nSetting up bind9-libs:amd64 (1:9.16.27-1~deb11u1) ...\nSetting up libedit2:amd64 (3.1-20191231-2+b1) ...\nSetting up inetutils-ping (2:2.0-1) ...\nSetting up libbpf0:amd64 (1:0.3-2) ...\nSetting up bind9-host (1:9.16.27-1~deb11u1) ...\nSetting up iproute2 (5.10.0-4) ...\ndebconf: unable to initialize frontend: Dialog\ndebconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78.)\ndebconf: falling back to frontend: Readline\ndebconf: unable to initialize frontend: Readline\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.32.1 /usr/local/share/perl/5.32.1 /usr/lib/x86_64-linux-gnu/perl5/5.32 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl-base /usr/lib/x86_64-linux-gnu/perl/5.32 /usr/share/perl/5.32 /usr/local/lib/site_perl) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)\ndebconf: falling back to frontend: Teletype\nSetting up bind9-dnsutils (1:9.16.27-1~deb11u1) ...\nSetting up dnsutils (1:9.16.27-1~deb11u1) ...\nProcessing triggers for libc-bin (2.31-13+deb11u3) ...\n</code></pre> <p>Compruebo que el hostname es correcto:</p> <pre><code>root@servidor_web:/usr/local/apache2# cat /etc/hostname\nservidor_web\n</code></pre> <p>Compruebo que <code>servidor_web</code> est\u00e1 conectado a las dos redes:</p> <pre><code>root@servidor_web:/usr/local/apache2# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n30: eth0@if31: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:c0:a8:14:0a brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.20.10/24 brd 192.168.20.255 scope global eth0\n       valid_lft forever preferred_lft forever\n32: eth1@if33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:c0:a8:0a:0a brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.10.10/24 brd 192.168.10.255 scope global eth1\n       valid_lft forever preferred_lft forever\n</code></pre> <p>Compruebo que hay resoluci\u00f3n DNS al nombre de servicio/contenedor <code>servidor_web</code> \u2192 <code>servidor_mariadb</code>:</p> <pre><code>root@servidor_web:/usr/local/apache2# dig servidor_mariadb\n\n; &lt;&lt;&gt;&gt; DiG 9.16.27-Debian &lt;&lt;&gt;&gt; servidor_mariadb\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 38120\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n;; QUESTION SECTION:\n;servidor_mariadb.          IN  A\n;; ANSWER SECTION:\nservidor_mariadb.   600 IN  A   192.168.20.20\n;; Query time: 0 msec\n;; SERVER: 127.0.0.11#53(127.0.0.11)\n;; WHEN: Wed Jun 15 21:08:40 UTC 2022\n;; MSG SIZE  rcvd: 66\nroot@servidor_web:/usr/local/apache2# dig db\n\n; &lt;&lt;&gt;&gt; DiG 9.16.27-Debian &lt;&lt;&gt;&gt; db\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 32469\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n;; QUESTION SECTION:\n;db.                                IN  A\n;; ANSWER SECTION:\ndb.                     600 IN  A   192.168.20.20\n;; Query time: 0 msec\n;; SERVER: 127.0.0.11#53(127.0.0.11)\n;; WHEN: Wed Jun 15 21:09:29 UTC 2022\n;; MSG SIZE  rcvd: 38\n</code></pre> <p>Compruebo que hay ping <code>servidor_web</code> \u2192 <code>servidor_mariadb</code>:</p> <pre><code>root@servidor_web:/usr/local/apache2# ping servidor_mariadb\nPING servidor_mariadb (192.168.20.20): 56 data bytes\n64 bytes from 192.168.20.20: icmp_seq=0 ttl=64 time=0.222 ms\n64 bytes from 192.168.20.20: icmp_seq=1 ttl=64 time=0.132 ms\n^C--- servidor_mariadb ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max/stddev = 0.132/0.177/0.222/0.045 ms\n</code></pre>"},{"location":"iaw/ejs-docker/#ejemplo-1-despliegue-de-la-aplicacion-guestbook_1","title":"Ejemplo 1: Despliegue de la aplicaci\u00f3n guestbook","text":"<p>Creo el directorio y entro:</p> <pre><code>atlas@olympus:~/docker$ mkdir guestbook\natlas@olympus:~/docker$ cd guestbook\natlas@olympus:~/docker/guestbook$\n</code></pre> <p>Creo el siguiente <code>docker-compose.yml</code>:</p> <pre><code>version: '3.1'\nservices:\n  app:\n    container_name: guestbook\n    image: iesgn/guestbook\n    restart: always\n    ports:\n      - 80:5000\n  db:\n    container_name: redis\n    image: redis\n    restart: always\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/guestbook$ docker-compose up -d\nCreating network \"guestbook_default\" with the default driver\nCreating redis     ... done\nCreating guestbook ... done\n</code></pre> <p>Listo los contenedores:</p> <pre><code>atlas@olympus:~/docker/guestbook$ docker-compose ps\n  Name                 Command               State          Ports\n-------------------------------------------------------------------------\nguestbook   python3 app.py                   Up      0.0.0.0:80-&gt;5000/tcp\nredis       docker-entrypoint.sh redis ...   Up      6379/tcp\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Paro los contenedores:</p> <pre><code>atlas@olympus:~/docker/guestbook$ docker-compose stop\nStopping guestbook ... done\nStopping redis     ... done\n</code></pre> <p>Elimino el escenario:</p> <pre><code>atlas@olympus:~/docker/guestbook$ docker-compose down\nRemoving guestbook ... done\nRemoving redis     ... done\nRemoving network guestbook_default\n</code></pre>"},{"location":"iaw/ejs-docker/#ejemplo-2-despliegue-de-la-aplicacion-temperaturas_1","title":"Ejemplo 2: Despliegue de la aplicaci\u00f3n temperaturas","text":"<p>Creo el directorio y entro:</p> <pre><code>atlas@olympus:~/docker$ mkdir temperaturas\natlas@olympus:~/docker$ cd temperaturas/\natlas@olympus:~/docker/temperaturas$\n</code></pre> <p>Creo el siguiente <code>docker-compose.yml</code>:</p> <pre><code>version: '3.1'\nservices:\n  frontend:\n    container_name: temperaturas-frontend\n    image: iesgn/temperaturas_frontend\n    restart: always\n    ports:\n      - 80:3000\n    depends_on:\n      - backend\n  backend:\n    container_name: temperaturas-backend\n    image: iesgn/temperaturas_backend\n    restart: always\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/temperaturas$ docker-compose up -d\nCreating network \"temperaturas_default\" with the default driver\nCreating temperaturas-backend ... done\nCreating temperaturas-frontend ... done\n</code></pre> <p>Listo los contenedores:</p> <pre><code>atlas@olympus:~/docker/temperaturas$ docker-compose ps\n        Name               Command       State          Ports\n---------------------------------------------------------------------\ntemperaturas-backend    python3 app.py   Up      5000/tcp\ntemperaturas-frontend   python3 app.py   Up      0.0.0.0:80-&gt;3000/tcp\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Elimino el escenario:</p> <pre><code>atlas@olympus:~/docker/temperaturas$ docker-compose down\nStopping temperaturas-frontend ... done\nStopping temperaturas-backend  ... done\nRemoving temperaturas-frontend ... done\nRemoving temperaturas-backend  ... done\nRemoving network temperaturas_default\n</code></pre>"},{"location":"iaw/ejs-docker/#ejemplo-3-despliegue-de-wordpress-mariadb_1","title":"Ejemplo 3: Despliegue de WordPress + MariaDB","text":""},{"location":"iaw/ejs-docker/#wp-con-volumenes","title":"WP con vol\u00famenes","text":"<p>Creo el directorio y entro:</p> <pre><code>atlas@olympus:~/docker$ mkdir wp_vol\natlas@olympus:~/docker$ cd wp_vol\natlas@olympus:~/docker/wp_vol$\n</code></pre> <p>Creo el siguiente <code>docker-compose.yml</code>:</p> <pre><code>version: '3.1'\nservices:\n  wordpress:\n    container_name: servidor_wp\n    image: wordpress\n    restart: always\n    environment:\n      WORDPRESS_DB_HOST: db\n      WORDPRESS_DB_USER: user_wp\n      WORDPRESS_DB_PASSWORD: asdasd\n      WORDPRESS_DB_NAME: bd_wp\n    ports:\n      - 80:80\n    volumes:\n      - wordpress_data:/var/www/html/wp-content\n  db:\n    container_name: servidor_mysql\n    image: mariadb\n    restart: always\n    environment:\n      MYSQL_DATABASE: bd_wp\n      MYSQL_USER: user_wp\n      MYSQL_PASSWORD: asdasd\n      MYSQL_ROOT_PASSWORD: asdasd\n    volumes:\n      - mariadb_data:/var/lib/mysql\nvolumes:\n    wordpress_data:\n    mariadb_data:\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/wp_vol$ docker-compose up -d\nCreating network \"wp_vol_default\" with the default driver\nCreating volume \"wp_vol_wordpress_data\" with default driver\nCreating volume \"wp_vol_mariadb_data\" with default driver\nCreating servidor_wp    ... done\nCreating servidor_mysql ... done\n</code></pre> <p>Listo los contenedores:</p> <pre><code>atlas@olympus:~/docker/wp_vol$ docker-compose ps\n     Name                   Command               State         Ports\n----------------------------------------------------------------------------\nservidor_mysql   docker-entrypoint.sh mariadbd    Up      3306/tcp\nservidor_wp      docker-entrypoint.sh apach ...   Up      0.0.0.0:80-&gt;80/tcp\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Paro los contenedores:</p> <pre><code>atlas@olympus:~/docker/wp_vol$ docker-compose stop\nStopping servidor_mysql ... done\nStopping servidor_wp    ... done\n</code></pre> <p>Borro los contenedores:</p> <pre><code>atlas@olympus:~/docker/wp_vol$ docker-compose rm\nGoing to remove servidor_mysql, servidor_wp\nAre you sure? [yN] y\nRemoving servidor_mysql ... done\nRemoving servidor_wp    ... done\n</code></pre> <p>Elimino el escenario:</p> <pre><code>atlas@olympus:~/docker/wp_vol$ docker-compose down -v\nRemoving network wp_vol_default\nRemoving volume wp_vol_wordpress_data\nRemoving volume wp_vol_mariadb_data\n</code></pre>"},{"location":"iaw/ejs-docker/#wp-con-bind-mount","title":"WP con bind mount","text":"<p>Creo el directorio y entro:</p> <pre><code>atlas@olympus:~/docker$ mkdir wp_bind_mount\natlas@olympus:~/docker$ cd wp_bind_mount\natlas@olympus:~/docker/wp_bind_mount$\n</code></pre> <p>Creo el siguiente <code>docker-compose.yml</code>:</p> <pre><code>version: '3.1'\nservices:\n  wordpress:\n    container_name: servidor_wp\n    image: wordpress\n    restart: always\n    environment:\n      WORDPRESS_DB_HOST: db\n      WORDPRESS_DB_USER: user_wp\n      WORDPRESS_DB_PASSWORD: asdasd\n      WORDPRESS_DB_NAME: bd_wp\n    ports:\n      - 80:80\n    volumes:\n      - ./wordpress:/var/www/html/wp-content\n  db:\n    container_name: servidor_mysql\n    image: mariadb\n    restart: always\n    environment:\n      MYSQL_DATABASE: bd_wp\n      MYSQL_USER: user_wp\n      MYSQL_PASSWORD: asdasd\n      MYSQL_ROOT_PASSWORD: asdasd\n    volumes:\n      - ./mysql:/var/lib/mysql\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/wp_bind_mount$ docker-compose up -d\nCreating network \"wp_bind_mount_default\" with the default driver\nCreating servidor_wp    ... done\nCreating servidor_mysql ... done\n</code></pre> <p>Listo los contenedores:</p> <pre><code>atlas@olympus:~/docker/wp_bind_mount$ docker-compose ps\n     Name                   Command               State         Ports\n----------------------------------------------------------------------------\nservidor_mysql   docker-entrypoint.sh mariadbd    Up      3306/tcp\nservidor_wp      docker-entrypoint.sh apach ...   Up      0.0.0.0:80-&gt;80/tcp\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Elimino el escenario:</p> <pre><code>atlas@olympus:~/docker/wp_bind_mount$ docker-compose down -v\nStopping servidor_mysql ... done\nStopping servidor_wp    ... done\nRemoving servidor_mysql ... done\nRemoving servidor_wp    ... done\nRemoving network wp_bind_mount_default\n</code></pre>"},{"location":"iaw/ejs-docker/#ejemplo-4-despliegue-de-tomcat-nginx_1","title":"Ejemplo 4: Despliegue de tomcat + nginx","text":"<p>Creo el directorio y entro:</p> <pre><code>atlas@olympus:~/docker$ mkdir tomcat\natlas@olympus:~/docker$ cd tomcat\natlas@olympus:~/docker/tomcat$\n</code></pre> <p>Creo el siguiente <code>docker-compose.yml</code>:</p> <pre><code>version: '3.1'\nservices:\n  aplicacionjava:\n    container_name: tomcat\n    image: tomcat:9.0\n    restart: always\n    volumes:\n      - ./sample.war:/usr/local/tomcat/webapps/sample.war:ro\n  proxy:\n    container_name: nginx\n    image: nginx\n    ports:\n      - 80:80\n    volumes:\n      - ./default.conf:/etc/nginx/conf.d/default.conf:ro\n</code></pre> <p>Obtengo los 2 ficheros que necesito:</p> <pre><code>atlas@olympus:~/docker/tomcat$ wget https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion5/ejemplo4/default.conf\n--2022-06-16 09:27:24--  https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion5/ejemplo4/default.conf\nResolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.108.133, ...\nConnecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 387 [text/plain]\nSaving to: \u2018default.conf\u2019\ndefault.conf                                100%[=========================================================================================&gt;]     387  --.-KB/s    in 0s\n2022-06-16 09:27:24 (16.0 MB/s) - \u2018default.conf\u2019 saved [387/387]\natlas@olympus:~/docker/tomcat$ wget https://github.com/iesgn/curso_docker_2021/raw/main/ejemplos/sesion5/ejemplo4/sample.war\n--2022-06-16 09:28:18--  https://github.com/iesgn/curso_docker_2021/raw/main/ejemplos/sesion5/ejemplo4/sample.war\nResolving github.com (github.com)... 140.82.121.4\nConnecting to github.com (github.com)|140.82.121.4|:443... connected.\nHTTP request sent, awaiting response... 302 Found\nLocation: https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion5/ejemplo4/sample.war [following]\n--2022-06-16 09:28:18--  https://raw.githubusercontent.com/iesgn/curso_docker_2021/main/ejemplos/sesion5/ejemplo4/sample.war\nResolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.108.133, 185.199.110.133, ...\nConnecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 4606 (4.5K) [application/octet-stream]\nSaving to: \u2018sample.war\u2019\nsample.war                                  100%[=========================================================================================&gt;]   4.50K  --.-KB/s    in 0s\n2022-06-16 09:28:19 (30.0 MB/s) - \u2018sample.war\u2019 saved [4606/4606]\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/tomcat$ docker-compose up -d\nCreating network \"tomcat_default\" with the default driver\nCreating tomcat ... done\nCreating nginx  ... done\n</code></pre> <p>Compruebo que los contenedores est\u00e1n activos:</p> <pre><code>atlas@olympus:~/docker/tomcat$ docker-compose ps\n Name               Command               State         Ports\n--------------------------------------------------------------------\nnginx    /docker-entrypoint.sh ngin ...   Up      0.0.0.0:80-&gt;80/tcp\ntomcat   catalina.sh run                  Up      8080/tcp\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Elimino el escenario:</p> <pre><code>atlas@olympus:~/docker/tomcat$ docker-compose down -v\nStopping nginx  ... done\nStopping tomcat ... done\nRemoving nginx  ... done\nRemoving tomcat ... done\nRemoving network tomcat_default\n</code></pre>"},{"location":"iaw/ejs-docker/#ejemplos-reales-de-despliegues-usando-docker-compose","title":"Ejemplos reales de despliegues usando docker-compose","text":"<ul> <li>Jitsi</li> <li>Bitnami</li> <li>Guacamole</li> </ul>"},{"location":"iaw/ejs-docker/#ejercicios-multicontenedor","title":"Ejercicios multicontenedor","text":"<p>Creo el directorio y entro:</p> <pre><code>atlas@olympus:~/docker$ mkdir prestashop\natlas@olympus:~/docker$ cd prestashop\natlas@olympus:~/docker/prestashop$\n</code></pre> <p>Descargo el <code>docker-compose.yml</code> oficial de bitnami:</p> <pre><code>curl -sSL https://raw.githubusercontent.com/bitnami/bitnami-docker-prestashop/master/docker-compose.yml &gt; docker-compose.yml\n</code></pre> <p>Lo muestro sin modificar:</p> <pre><code>atlas@olympus:~/docker/prestashop$ cat docker-compose.yml\nversion: '2'\nservices:\n  mariadb:\n    image: docker.io/bitnami/mariadb:10.6\n    environment:\n      # ALLOW_EMPTY_PASSWORD is recommended only for development.\n      - ALLOW_EMPTY_PASSWORD=yes\n      - MARIADB_USER=bn_prestashop\n      - MARIADB_DATABASE=bitnami_prestashop\n    volumes:\n      - 'mariadb_data:/bitnami/mariadb'\n  prestashop:\n    image: docker.io/bitnami/prestashop:1.7\n    ports:\n      - '80:8080'\n      - '443:8443'\n    environment:\n      - PRESTASHOP_HOST=localhost\n      - PRESTASHOP_DATABASE_HOST=mariadb\n      - PRESTASHOP_DATABASE_PORT_NUMBER=3306\n      - PRESTASHOP_DATABASE_USER=bn_prestashop\n      - PRESTASHOP_DATABASE_NAME=bitnami_prestashop\n      # ALLOW_EMPTY_PASSWORD is recommended only for development.\n      - ALLOW_EMPTY_PASSWORD=yes\n    volumes:\n      - 'prestashop_data:/bitnami/prestashop'\n    depends_on:\n      - mariadb\nvolumes:\n  mariadb_data:\n    driver: local\n  prestashop_data:\n    driver: local\n</code></pre> <p>Lo muestro modificado:</p> <p></p> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/prestashop$ docker-compose up -d\nCreating network \"prestashop_default\" with the default driver\nCreating volume \"prestashop_mariadb_data\" with local driver\nCreating volume \"prestashop_prestashop_data\" with local driver\nCreating prestashop_mariadb_1 ... done\nCreating prestashop_prestashop_1 ... done\n</code></pre> <p>Muestro los contenedores funcionando:</p> <p></p> <p>Muestro la web funcionando:</p> <p></p>"},{"location":"iaw/ejs-docker/#creacion-de-imagenes","title":"Creaci\u00f3n de im\u00e1genes","text":""},{"location":"iaw/ejs-docker/#creacion-de-imagenes-a-partir-de-un-contenedor","title":"Creaci\u00f3n de im\u00e1genes a partir de un contenedor","text":"<p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker$ docker run -it --name contenedor debian bash\nroot@d42a140c8da0:/#\n</code></pre> <p>Hago modificaciones:</p> <pre><code>root@d42a140c8da0:/# apt update\nGet:1 http://security.debian.org/debian-security bullseye-security InRelease [44.1 kB]\nGet:2 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [39.4 kB]\nGet:4 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [154 kB]\nGet:5 http://deb.debian.org/debian bullseye/main amd64 Packages [8182 kB]\nGet:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [2592 B]\nFetched 8539 kB in 6s (1401 kB/s)\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\n1 package can be upgraded. Run 'apt list --upgradable' to see it.\nroot@d42a140c8da0:/# apt install apache2 -y\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following additional packages will be installed:\n  apache2-bin apache2-data apache2-utils bzip2 ca-certificates file libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libbrotli1 libcurl4 libexpat1\n  libgdbm-compat4 libgdbm6 libgpm2 libicu67 libjansson4 libldap-2.4-2 libldap-common liblua5.3-0 libmagic-mgc libmagic1 libncurses6 libncursesw6 libnghttp2-14 libperl5.32\n  libprocps8 libpsl5 librtmp1 libsasl2-2 libsasl2-modules libsasl2-modules-db libsqlite3-0 libssh2-1 libxml2 mailcap media-types mime-support netbase openssl perl\n  perl-modules-5.32 procps psmisc publicsuffix ssl-cert xz-utils\nSuggested packages:\n  apache2-doc apache2-suexec-pristine | apache2-suexec-custom www-browser bzip2-doc gdbm-l10n gpm sensible-utils libsasl2-modules-gssapi-mit\n  | libsasl2-modules-gssapi-heimdal libsasl2-modules-ldap libsasl2-modules-otp libsasl2-modules-sql perl-doc libterm-readline-gnu-perl | libterm-readline-perl-perl make\n  libtap-harness-archive-perl\nThe following NEW packages will be installed:\n  apache2 apache2-bin apache2-data apache2-utils bzip2 ca-certificates file libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libbrotli1 libcurl4 libexpat1\n  libgdbm-compat4 libgdbm6 libgpm2 libicu67 libjansson4 libldap-2.4-2 libldap-common liblua5.3-0 libmagic-mgc libmagic1 libncurses6 libncursesw6 libnghttp2-14 libperl5.32\n  libprocps8 libpsl5 librtmp1 libsasl2-2 libsasl2-modules libsasl2-modules-db libsqlite3-0 libssh2-1 libxml2 mailcap media-types mime-support netbase openssl perl\n  perl-modules-5.32 procps psmisc publicsuffix ssl-cert xz-utils\n0 upgraded, 49 newly installed, 0 to remove and 1 not upgraded.\nNeed to get 24.6 MB of archives.\nAfter this operation, 111 MB of additional disk space will be used.\nGet:1 http://security.debian.org/debian-security bullseye-security/main amd64 libldap-2.4-2 amd64 2.4.57+dfsg-3+deb11u1 [232 kB]\nGet:2 http://security.debian.org/debian-security bullseye-security/main amd64 libxml2 amd64 2.9.10+dfsg-6.7+deb11u2 [692 kB]\nGet:3 http://deb.debian.org/debian bullseye/main amd64 perl-modules-5.32 all 5.32.1-4+deb11u2 [2823 kB]\nGet:4 http://security.debian.org/debian-security bullseye-security/main amd64 openssl amd64 1.1.1n-0+deb11u2 [852 kB]\nGet:5 http://security.debian.org/debian-security bullseye-security/main amd64 xz-utils amd64 5.2.5-2.1~deb11u1 [220 kB]\nGet:6 http://security.debian.org/debian-security bullseye-security/main amd64 libldap-common all 2.4.57+dfsg-3+deb11u1 [95.8 kB]\nGet:7 http://deb.debian.org/debian bullseye/main amd64 libgdbm6 amd64 1.19-2 [64.9 kB]\nSetting up libgdbm-compat4:amd64 (1.19-2) ...\nSetting up libperl5.32:amd64 (5.32.1-4+deb11u2) ...\nSetting up procps (2:3.3.17-5) ...\nSetting up libcurl4:amd64 (7.74.0-1.3+deb11u1) ...\nSetting up apache2-utils (2.4.53-1~deb11u1) ...\nSetting up perl (5.32.1-4+deb11u2) ...\nSetting up mailcap (3.69) ...\nSetting up mime-support (3.66) ...\nSetting up apache2-bin (2.4.53-1~deb11u1) ...\nSetting up apache2 (2.4.53-1~deb11u1) ...\nEnabling module mpm_event.\nEnabling module authz_core.\nEnabling module authz_host.\nEnabling module authn_core.\nEnabling module auth_basic.\nEnabling module access_compat.\nEnabling module authn_file.\nEnabling module authz_user.\nEnabling module alias.\nEnabling module dir.\nEnabling module autoindex.\nEnabling module env.\nEnabling module mime.\nEnabling module negotiation.\nEnabling module setenvif.\nEnabling module filter.\nEnabling module deflate.\nEnabling module status.\nEnabling module reqtimeout.\nEnabling conf charset.\nEnabling conf localized-error-pages.\nEnabling conf other-vhosts-access-log.\nEnabling conf security.\nEnabling conf serve-cgi-bin.\nEnabling site 000-default.\ninvoke-rc.d: could not determine current runlevel\ninvoke-rc.d: policy-rc.d denied execution of start.\nProcessing triggers for libc-bin (2.31-13+deb11u3) ...\nProcessing triggers for ca-certificates (20210119) ...\nUpdating certificates in /etc/ssl/certs...\n0 added, 0 removed; done.\nRunning hooks in /etc/ca-certificates/update.d...\ndone.\nroot@d42a140c8da0:/# echo \"&lt;h1&gt;Curso Docker&lt;/h1&gt;\" &gt; /var/www/html/index.html\nroot@d42a140c8da0:/# exit\nexit\n</code></pre> <p>Creo una nueva imagen partiendo de los cambios en el contenedor. Esta imagen ser\u00e1 el resultado de las capas base + cambios:</p> <pre><code>atlas@olympus:~$ docker commit contenedor adrianjaramillo/myapache2:v1\nsha256:4d7daf41fb1034a6667c2464ac9bcf809d3c6460af908120f755672d66bc6433\n</code></pre> <p>Muestro que ya la tengo localmente:</p> <p></p> <p>Al lanzar contenedores desde la imagen modificada estamos obligados a indicar el proceso a iniciar, ya que por defecto se ejecuta el de la imagen base y no podemos cambiarlo (por ahora):</p> <pre><code>atlas@olympus:~$ docker run -d -p 8080:80 \\\n--name servidor_web \\\nadrianjaramillo/myapache2:v1 \\\nbash -c \"apache2ctl -D FOREGROUND\"\nfed43969a4a81ddfe4473097201a271fdd10aa7ee0053caf11193c12e540e321\n</code></pre> <p>Muestro que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#creacion-de-imagenes-a-partir-de-un-dockerfile","title":"Creaci\u00f3n de im\u00e1genes a partir de un Dockerfile","text":"<p>Creo un directorio donde estar\u00e1 el Dockerfile y lo que se necesite:</p> <pre><code>atlas@olympus:~/docker$ mkdir build1\natlas@olympus:~/docker$ cd build1\natlas@olympus:~/docker/build1$\n</code></pre> <p>El Dockerfile ser\u00e1:</p> <pre><code>FROM debian:buster-slim\nMAINTAINER Adri\u00e1n Jaramillo Rodr\u00edguez \"adristudy@gmail.com\"\nRUN apt-get update &amp;&amp; apt-get install -y apache2\nCOPY index.html /var/www/html/\nCMD [\"/usr/sbin/apache2ctl\", \"-D\", \"FOREGROUND\"]\n</code></pre> <p>Me bajo un <code>index.html</code> de prueba:</p> <pre><code>atlas@olympus:~/docker/build1$ wget https://gist.githubusercontent.com/chrisvfritz/bc010e6ed25b802da7eb/raw/18eaa48addae7e3021f6bcea03b7a6557e3f0132/index.html\n--2022-06-16 18:53:29--  https://gist.githubusercontent.com/chrisvfritz/bc010e6ed25b802da7eb/raw/18eaa48addae7e3021f6bcea03b7a6557e3f0132/index.html\nResolving gist.githubusercontent.com (gist.githubusercontent.com)... 185.199.111.133, 185.199.110.133, 185.199.108.133, ...\nConnecting to gist.githubusercontent.com (gist.githubusercontent.com)|185.199.111.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 285 [text/plain]\nSaving to: \u2018index.html\u2019\nindex.html                                  100%[=========================================================================================&gt;]     285  --.-KB/s    in 0s\n2022-06-16 18:53:30 (11.6 MB/s) - \u2018index.html\u2019 saved [285/285]\n</code></pre> <p>Al final, acabaremos con la siguiente estructura:</p> <pre><code>atlas@olympus:~/docker/build1$ ls -la\ntotal 16\ndrwxr-xr-x  2 atlas atlas 4096 Jun 16 18:53 .\ndrwxr-xr-x 13 atlas atlas 4096 Jun 16 18:37 ..\n-rw-r--r--  1 atlas atlas  216 Jun 16 18:50 Dockerfile\n-rw-r--r--  1 atlas atlas  285 Jun 16 18:53 index.html\n</code></pre> <p>Genero la imagen:</p> <pre><code>atlas@olympus:~/docker/build1$ docker build -t adrianjaramillo/myapache2:v2 .\nSending build context to Docker daemon  3.072kB\nStep 1/5 : FROM debian:buster-slim\n ---&gt; c2303a498941\nStep 2/5 : MAINTAINER Adri\u00e1n Jaramillo Rodr\u00edguez \"adristudy@gmail.com\"\n ---&gt; Using cache\n ---&gt; 31ec41690e42\nStep 3/5 : RUN apt-get update &amp;&amp; apt-get install -y apache2\n ---&gt; Running in 82497c561473\nGet:1 http://deb.debian.org/debian buster InRelease [122 kB]\nGet:2 http://security.debian.org/debian-security buster/updates InRelease [65.4 kB]\nGet:3 http://deb.debian.org/debian buster-updates InRelease [51.9 kB]\nGet:4 http://security.debian.org/debian-security buster/updates/main amd64 Packages [328 kB]\nGet:5 http://deb.debian.org/debian buster/main amd64 Packages [7911 kB]\nGet:6 http://deb.debian.org/debian buster-updates/main amd64 Packages [8788 B]\nFetched 8487 kB in 1min 9s (123 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nThe following additional packages will be installed:\n  apache2-bin apache2-data apache2-utils bzip2 ca-certificates file\n  krb5-locales libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap\n  libbrotli1 libcurl4 libexpat1 libgdbm-compat4 libgdbm6 libgpm2\n  libgssapi-krb5-2 libicu63 libjansson4 libk5crypto3 libkeyutils1 libkrb5-3\n  libkrb5support0 libldap-2.4-2 libldap-common liblua5.2-0 libmagic-mgc\n  libmagic1 libncurses6 libnghttp2-14 libperl5.28 libprocps7 libpsl5 librtmp1\n  libsasl2-2 libsasl2-modules libsasl2-modules-db libsqlite3-0 libssh2-1\n  libssl1.1 libxml2 lsb-base mime-support netbase openssl perl\n  perl-modules-5.28 procps psmisc publicsuffix ssl-cert xz-utils\nSuggested packages:\n  apache2-doc apache2-suexec-pristine | apache2-suexec-custom www-browser\n  bzip2-doc gdbm-l10n gpm krb5-doc krb5-user sensible-utils\n  libsasl2-modules-gssapi-mit | libsasl2-modules-gssapi-heimdal\n  libsasl2-modules-ldap libsasl2-modules-otp libsasl2-modules-sql perl-doc\n  libterm-readline-gnu-perl | libterm-readline-perl-perl make libb-debug-perl\n  liblocale-codes-perl openssl-blacklist\nThe following NEW packages will be installed:\n  apache2 apache2-bin apache2-data apache2-utils bzip2 ca-certificates file\n  krb5-locales libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap\n  libbrotli1 libcurl4 libexpat1 libgdbm-compat4 libgdbm6 libgpm2\n  libgssapi-krb5-2 libicu63 libjansson4 libk5crypto3 libkeyutils1 libkrb5-3\n  libkrb5support0 libldap-2.4-2 libldap-common liblua5.2-0 libmagic-mgc\n  libmagic1 libncurses6 libnghttp2-14 libperl5.28 libprocps7 libpsl5 librtmp1\n  libsasl2-2 libsasl2-modules libsasl2-modules-db libsqlite3-0 libssh2-1\n  libssl1.1 libxml2 lsb-base mime-support netbase openssl perl\n  perl-modules-5.28 procps psmisc publicsuffix ssl-cert xz-utils\n0 upgraded, 54 newly installed, 0 to remove and 1 not upgraded.\nNeed to get 25.6 MB of archives.\nAfter this operation, 112 MB of additional disk space will be used.\nGet:1 http://security.debian.org/debian-security buster/updates/main amd64 libssl1.1 amd64 1.1.1n-0+deb10u2 [1551 kB]\nGet:2 http://deb.debian.org/debian buster/main amd64 perl-modules-5.28 all 5.28.1-6+deb10u1 [2873 kB]\nGet:3 http://deb.debian.org/debian buster/main amd64 libgdbm6 amd64 1.18.1-4 [64.7 kB]\nGet:4 http://deb.debian.org/debian buster/main amd64 libgdbm-compat4 amd64 1.18.1-4 [44.1 kB]\nGet:5 http://deb.debian.org/debian buster/main amd64 libperl5.28 amd64 5.28.1-6+deb10u1 [3894 kB]\nGet:6 http://security.debian.org/debian-security buster/updates/main amd64 libldap-common all 2.4.47+dfsg-3+deb10u7 [90.1 kB]\nGet:7 http://security.debian.org/debian-security buster/updates/main amd64 libldap-2.4-2 amd64 2.4.47+dfsg-3+deb10u7 [224 kB]\nGet:8 http://security.debian.org/debian-security buster/updates/main amd64 libxml2 amd64 2.9.4+dfsg1-7+deb10u4 [689 kB]\nGet:9 http://security.debian.org/debian-security buster/updates/main amd64 xz-utils amd64 5.2.4-1+deb10u1 [183 kB]\nGet:10 http://security.debian.org/debian-security buster/updates/main amd64 openssl amd64 1.1.1n-0+deb10u2 [855 kB]\nGet:11 http://deb.debian.org/debian buster/main amd64 perl amd64 5.28.1-6+deb10u1 [204 kB]\nGet:12 http://deb.debian.org/debian buster/main amd64 libapr1 amd64 1.6.5-1+b1 [102 kB]\nGet:13 http://deb.debian.org/debian buster/main amd64 libexpat1 amd64 2.2.6-2+deb10u4 [108 kB]\nGet:14 http://deb.debian.org/debian buster/main amd64 libaprutil1 amd64 1.6.1-4 [91.8 kB]\nGet:15 http://deb.debian.org/debian buster/main amd64 libsqlite3-0 amd64 3.27.2-3+deb10u1 [641 kB]\nGet:16 http://deb.debian.org/debian buster/main amd64 libaprutil1-dbd-sqlite3 amd64 1.6.1-4 [18.7 kB]\nGet:17 http://deb.debian.org/debian buster/main amd64 libsasl2-modules-db amd64 2.1.27+dfsg-1+deb10u2 [69.2 kB]\nGet:18 http://deb.debian.org/debian buster/main amd64 libsasl2-2 amd64 2.1.27+dfsg-1+deb10u2 [106 kB]\nGet:19 http://deb.debian.org/debian buster/main amd64 libaprutil1-ldap amd64 1.6.1-4 [16.8 kB]\nGet:20 http://deb.debian.org/debian buster/main amd64 libbrotli1 amd64 1.0.7-2+deb10u1 [269 kB]\nGet:21 http://deb.debian.org/debian buster/main amd64 libkeyutils1 amd64 1.6-6 [15.0 kB]\nGet:22 http://deb.debian.org/debian buster/main amd64 libkrb5support0 amd64 1.17-3+deb10u3 [65.8 kB]\nGet:23 http://deb.debian.org/debian buster/main amd64 libk5crypto3 amd64 1.17-3+deb10u3 [122 kB]\nGet:24 http://deb.debian.org/debian buster/main amd64 libkrb5-3 amd64 1.17-3+deb10u3 [370 kB]\nGet:25 http://deb.debian.org/debian buster/main amd64 libgssapi-krb5-2 amd64 1.17-3+deb10u3 [158 kB]\nGet:26 http://deb.debian.org/debian buster/main amd64 libnghttp2-14 amd64 1.36.0-2+deb10u1 [85.0 kB]\nGet:27 http://deb.debian.org/debian buster/main amd64 libpsl5 amd64 0.20.2-2 [53.7 kB]\nGet:28 http://deb.debian.org/debian buster/main amd64 librtmp1 amd64 2.4+20151223.gitfa8646d.1-2 [60.5 kB]\nGet:29 http://deb.debian.org/debian buster/main amd64 libssh2-1 amd64 1.8.0-2.1 [140 kB]\nGet:30 http://deb.debian.org/debian buster/main amd64 libcurl4 amd64 7.64.0-4+deb10u2 [332 kB]\nGet:31 http://deb.debian.org/debian buster/main amd64 libjansson4 amd64 2.12-1 [38.0 kB]\nGet:32 http://deb.debian.org/debian buster/main amd64 liblua5.2-0 amd64 5.2.4-1.1+b2 [110 kB]\nGet:33 http://deb.debian.org/debian buster/main amd64 libicu63 amd64 63.1-6+deb10u3 [8293 kB]\nGet:34 http://deb.debian.org/debian buster/main amd64 apache2-bin amd64 2.4.38-3+deb10u7 [1308 kB]\nGet:35 http://deb.debian.org/debian buster/main amd64 apache2-data all 2.4.38-3+deb10u7 [165 kB]\nGet:36 http://deb.debian.org/debian buster/main amd64 apache2-utils amd64 2.4.38-3+deb10u7 [237 kB]\nGet:37 http://deb.debian.org/debian buster/main amd64 lsb-base all 10.2019051400 [28.4 kB]\nGet:38 http://deb.debian.org/debian buster/main amd64 mime-support all 3.62 [37.2 kB]\nGet:39 http://deb.debian.org/debian buster/main amd64 libncurses6 amd64 6.1+20181013-2+deb10u2 [102 kB]\nGet:40 http://deb.debian.org/debian buster/main amd64 libprocps7 amd64 2:3.3.15-2 [61.7 kB]\nGet:41 http://deb.debian.org/debian buster/main amd64 procps amd64 2:3.3.15-2 [259 kB]\nGet:42 http://deb.debian.org/debian buster/main amd64 apache2 amd64 2.4.38-3+deb10u7 [252 kB]\nGet:43 http://deb.debian.org/debian buster/main amd64 netbase all 5.6 [19.4 kB]\nGet:44 http://deb.debian.org/debian buster/main amd64 bzip2 amd64 1.0.6-9.2~deb10u1 [48.4 kB]\nGet:45 http://deb.debian.org/debian buster/main amd64 libmagic-mgc amd64 1:5.35-4+deb10u2 [242 kB]\nGet:46 http://deb.debian.org/debian buster/main amd64 libmagic1 amd64 1:5.35-4+deb10u2 [118 kB]\nGet:47 http://deb.debian.org/debian buster/main amd64 file amd64 1:5.35-4+deb10u2 [66.4 kB]\nGet:48 http://deb.debian.org/debian buster/main amd64 krb5-locales all 1.17-3+deb10u3 [95.5 kB]\nGet:49 http://deb.debian.org/debian buster/main amd64 ca-certificates all 20200601~deb10u2 [166 kB]\nGet:50 http://deb.debian.org/debian buster/main amd64 libgpm2 amd64 1.20.7-5 [35.1 kB]\nGet:51 http://deb.debian.org/debian buster/main amd64 libsasl2-modules amd64 2.1.27+dfsg-1+deb10u2 [104 kB]\nGet:52 http://deb.debian.org/debian buster/main amd64 psmisc amd64 23.2-1+deb10u1 [126 kB]\nGet:53 http://deb.debian.org/debian buster/main amd64 publicsuffix all 20211109.1735-0+deb10u1 [125 kB]\nGet:54 http://deb.debian.org/debian buster/main amd64 ssl-cert all 1.0.39 [20.8 kB]\ndebconf: delaying package configuration, since apt-utils is not installed\nFetched 25.6 MB in 1min 54s (224 kB/s)\nSelecting previously unselected package perl-modules-5.28.\n(Reading database ... 6460 files and directories currently installed.)\nPreparing to unpack .../00-perl-modules-5.28_5.28.1-6+deb10u1_all.deb ...\nUnpacking perl-modules-5.28 (5.28.1-6+deb10u1) ...\nSelecting previously unselected package libgdbm6:amd64.\nPreparing to unpack .../01-libgdbm6_1.18.1-4_amd64.deb ...\nUnpacking libgdbm6:amd64 (1.18.1-4) ...\nSelecting previously unselected package libgdbm-compat4:amd64.\nPreparing to unpack .../02-libgdbm-compat4_1.18.1-4_amd64.deb ...\nUnpacking libgdbm-compat4:amd64 (1.18.1-4) ...\nSelecting previously unselected package libperl5.28:amd64.\nPreparing to unpack .../03-libperl5.28_5.28.1-6+deb10u1_amd64.deb ...\nUnpacking libperl5.28:amd64 (5.28.1-6+deb10u1) ...\nSelecting previously unselected package perl.\nPreparing to unpack .../04-perl_5.28.1-6+deb10u1_amd64.deb ...\nUnpacking perl (5.28.1-6+deb10u1) ...\nSelecting previously unselected package libapr1:amd64.\nPreparing to unpack .../05-libapr1_1.6.5-1+b1_amd64.deb ...\nUnpacking libapr1:amd64 (1.6.5-1+b1) ...\nSelecting previously unselected package libexpat1:amd64.\nPreparing to unpack .../06-libexpat1_2.2.6-2+deb10u4_amd64.deb ...\nUnpacking libexpat1:amd64 (2.2.6-2+deb10u4) ...\nSelecting previously unselected package libssl1.1:amd64.\nPreparing to unpack .../07-libssl1.1_1.1.1n-0+deb10u2_amd64.deb ...\nUnpacking libssl1.1:amd64 (1.1.1n-0+deb10u2) ...\nSelecting previously unselected package libaprutil1:amd64.\nPreparing to unpack .../08-libaprutil1_1.6.1-4_amd64.deb ...\nUnpacking libaprutil1:amd64 (1.6.1-4) ...\nSelecting previously unselected package libsqlite3-0:amd64.\nPreparing to unpack .../09-libsqlite3-0_3.27.2-3+deb10u1_amd64.deb ...\nUnpacking libsqlite3-0:amd64 (3.27.2-3+deb10u1) ...\nSelecting previously unselected package libaprutil1-dbd-sqlite3:amd64.\nPreparing to unpack .../10-libaprutil1-dbd-sqlite3_1.6.1-4_amd64.deb ...\nUnpacking libaprutil1-dbd-sqlite3:amd64 (1.6.1-4) ...\nSelecting previously unselected package libsasl2-modules-db:amd64.\nPreparing to unpack .../11-libsasl2-modules-db_2.1.27+dfsg-1+deb10u2_amd64.deb ...\nUnpacking libsasl2-modules-db:amd64 (2.1.27+dfsg-1+deb10u2) ...\nSelecting previously unselected package libsasl2-2:amd64.\nPreparing to unpack .../12-libsasl2-2_2.1.27+dfsg-1+deb10u2_amd64.deb ...\nUnpacking libsasl2-2:amd64 (2.1.27+dfsg-1+deb10u2) ...\nSelecting previously unselected package libldap-common.\nPreparing to unpack .../13-libldap-common_2.4.47+dfsg-3+deb10u7_all.deb ...\nUnpacking libldap-common (2.4.47+dfsg-3+deb10u7) ...\nSelecting previously unselected package libldap-2.4-2:amd64.\nPreparing to unpack .../14-libldap-2.4-2_2.4.47+dfsg-3+deb10u7_amd64.deb ...\nUnpacking libldap-2.4-2:amd64 (2.4.47+dfsg-3+deb10u7) ...\nSelecting previously unselected package libaprutil1-ldap:amd64.\nPreparing to unpack .../15-libaprutil1-ldap_1.6.1-4_amd64.deb ...\nUnpacking libaprutil1-ldap:amd64 (1.6.1-4) ...\nSelecting previously unselected package libbrotli1:amd64.\nPreparing to unpack .../16-libbrotli1_1.0.7-2+deb10u1_amd64.deb ...\nUnpacking libbrotli1:amd64 (1.0.7-2+deb10u1) ...\nSelecting previously unselected package libkeyutils1:amd64.\nPreparing to unpack .../17-libkeyutils1_1.6-6_amd64.deb ...\nUnpacking libkeyutils1:amd64 (1.6-6) ...\nSelecting previously unselected package libkrb5support0:amd64.\nPreparing to unpack .../18-libkrb5support0_1.17-3+deb10u3_amd64.deb ...\nUnpacking libkrb5support0:amd64 (1.17-3+deb10u3) ...\nSelecting previously unselected package libk5crypto3:amd64.\nPreparing to unpack .../19-libk5crypto3_1.17-3+deb10u3_amd64.deb ...\nUnpacking libk5crypto3:amd64 (1.17-3+deb10u3) ...\nSelecting previously unselected package libkrb5-3:amd64.\nPreparing to unpack .../20-libkrb5-3_1.17-3+deb10u3_amd64.deb ...\nUnpacking libkrb5-3:amd64 (1.17-3+deb10u3) ...\nSelecting previously unselected package libgssapi-krb5-2:amd64.\nPreparing to unpack .../21-libgssapi-krb5-2_1.17-3+deb10u3_amd64.deb ...\nUnpacking libgssapi-krb5-2:amd64 (1.17-3+deb10u3) ...\nSelecting previously unselected package libnghttp2-14:amd64.\nPreparing to unpack .../22-libnghttp2-14_1.36.0-2+deb10u1_amd64.deb ...\nUnpacking libnghttp2-14:amd64 (1.36.0-2+deb10u1) ...\nSelecting previously unselected package libpsl5:amd64.\nPreparing to unpack .../23-libpsl5_0.20.2-2_amd64.deb ...\nUnpacking libpsl5:amd64 (0.20.2-2) ...\nSelecting previously unselected package librtmp1:amd64.\nPreparing to unpack .../24-librtmp1_2.4+20151223.gitfa8646d.1-2_amd64.deb ...\nUnpacking librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2) ...\nSelecting previously unselected package libssh2-1:amd64.\nPreparing to unpack .../25-libssh2-1_1.8.0-2.1_amd64.deb ...\nUnpacking libssh2-1:amd64 (1.8.0-2.1) ...\nSelecting previously unselected package libcurl4:amd64.\nPreparing to unpack .../26-libcurl4_7.64.0-4+deb10u2_amd64.deb ...\nUnpacking libcurl4:amd64 (7.64.0-4+deb10u2) ...\nSelecting previously unselected package libjansson4:amd64.\nPreparing to unpack .../27-libjansson4_2.12-1_amd64.deb ...\nUnpacking libjansson4:amd64 (2.12-1) ...\nSelecting previously unselected package liblua5.2-0:amd64.\nPreparing to unpack .../28-liblua5.2-0_5.2.4-1.1+b2_amd64.deb ...\nUnpacking liblua5.2-0:amd64 (5.2.4-1.1+b2) ...\nSelecting previously unselected package libicu63:amd64.\nPreparing to unpack .../29-libicu63_63.1-6+deb10u3_amd64.deb ...\nUnpacking libicu63:amd64 (63.1-6+deb10u3) ...\nSelecting previously unselected package libxml2:amd64.\nPreparing to unpack .../30-libxml2_2.9.4+dfsg1-7+deb10u4_amd64.deb ...\nUnpacking libxml2:amd64 (2.9.4+dfsg1-7+deb10u4) ...\nSelecting previously unselected package apache2-bin.\nPreparing to unpack .../31-apache2-bin_2.4.38-3+deb10u7_amd64.deb ...\nUnpacking apache2-bin (2.4.38-3+deb10u7) ...\nSelecting previously unselected package apache2-data.\nPreparing to unpack .../32-apache2-data_2.4.38-3+deb10u7_all.deb ...\nUnpacking apache2-data (2.4.38-3+deb10u7) ...\nSelecting previously unselected package apache2-utils.\nPreparing to unpack .../33-apache2-utils_2.4.38-3+deb10u7_amd64.deb ...\nUnpacking apache2-utils (2.4.38-3+deb10u7) ...\nSelecting previously unselected package lsb-base.\nPreparing to unpack .../34-lsb-base_10.2019051400_all.deb ...\nUnpacking lsb-base (10.2019051400) ...\nSelecting previously unselected package mime-support.\nPreparing to unpack .../35-mime-support_3.62_all.deb ...\nUnpacking mime-support (3.62) ...\nSelecting previously unselected package libncurses6:amd64.\nPreparing to unpack .../36-libncurses6_6.1+20181013-2+deb10u2_amd64.deb ...\nUnpacking libncurses6:amd64 (6.1+20181013-2+deb10u2) ...\nSelecting previously unselected package libprocps7:amd64.\nPreparing to unpack .../37-libprocps7_2%3a3.3.15-2_amd64.deb ...\nUnpacking libprocps7:amd64 (2:3.3.15-2) ...\nSelecting previously unselected package procps.\nPreparing to unpack .../38-procps_2%3a3.3.15-2_amd64.deb ...\nUnpacking procps (2:3.3.15-2) ...\nSelecting previously unselected package apache2.\nPreparing to unpack .../39-apache2_2.4.38-3+deb10u7_amd64.deb ...\nUnpacking apache2 (2.4.38-3+deb10u7) ...\nSelecting previously unselected package netbase.\nPreparing to unpack .../40-netbase_5.6_all.deb ...\nUnpacking netbase (5.6) ...\nSelecting previously unselected package bzip2.\nPreparing to unpack .../41-bzip2_1.0.6-9.2~deb10u1_amd64.deb ...\nUnpacking bzip2 (1.0.6-9.2~deb10u1) ...\nSelecting previously unselected package libmagic-mgc.\nPreparing to unpack .../42-libmagic-mgc_1%3a5.35-4+deb10u2_amd64.deb ...\nUnpacking libmagic-mgc (1:5.35-4+deb10u2) ...\nSelecting previously unselected package libmagic1:amd64.\nPreparing to unpack .../43-libmagic1_1%3a5.35-4+deb10u2_amd64.deb ...\nUnpacking libmagic1:amd64 (1:5.35-4+deb10u2) ...\nSelecting previously unselected package file.\nPreparing to unpack .../44-file_1%3a5.35-4+deb10u2_amd64.deb ...\nUnpacking file (1:5.35-4+deb10u2) ...\nSelecting previously unselected package krb5-locales.\nPreparing to unpack .../45-krb5-locales_1.17-3+deb10u3_all.deb ...\nUnpacking krb5-locales (1.17-3+deb10u3) ...\nSelecting previously unselected package xz-utils.\nPreparing to unpack .../46-xz-utils_5.2.4-1+deb10u1_amd64.deb ...\nUnpacking xz-utils (5.2.4-1+deb10u1) ...\nSelecting previously unselected package openssl.\nPreparing to unpack .../47-openssl_1.1.1n-0+deb10u2_amd64.deb ...\nUnpacking openssl (1.1.1n-0+deb10u2) ...\nSelecting previously unselected package ca-certificates.\nPreparing to unpack .../48-ca-certificates_20200601~deb10u2_all.deb ...\nUnpacking ca-certificates (20200601~deb10u2) ...\nSelecting previously unselected package libgpm2:amd64.\nPreparing to unpack .../49-libgpm2_1.20.7-5_amd64.deb ...\nUnpacking libgpm2:amd64 (1.20.7-5) ...\nSelecting previously unselected package libsasl2-modules:amd64.\nPreparing to unpack .../50-libsasl2-modules_2.1.27+dfsg-1+deb10u2_amd64.deb ...\nUnpacking libsasl2-modules:amd64 (2.1.27+dfsg-1+deb10u2) ...\nSelecting previously unselected package psmisc.\nPreparing to unpack .../51-psmisc_23.2-1+deb10u1_amd64.deb ...\nUnpacking psmisc (23.2-1+deb10u1) ...\nSelecting previously unselected package publicsuffix.\nPreparing to unpack .../52-publicsuffix_20211109.1735-0+deb10u1_all.deb ...\nUnpacking publicsuffix (20211109.1735-0+deb10u1) ...\nSelecting previously unselected package ssl-cert.\nPreparing to unpack .../53-ssl-cert_1.0.39_all.deb ...\nUnpacking ssl-cert (1.0.39) ...\nSetting up perl-modules-5.28 (5.28.1-6+deb10u1) ...\nSetting up libexpat1:amd64 (2.2.6-2+deb10u4) ...\nSetting up lsb-base (10.2019051400) ...\nSetting up libkeyutils1:amd64 (1.6-6) ...\nSetting up libpsl5:amd64 (0.20.2-2) ...\nSetting up libgpm2:amd64 (1.20.7-5) ...\nSetting up mime-support (3.62) ...\nSetting up libmagic-mgc (1:5.35-4+deb10u2) ...\nSetting up psmisc (23.2-1+deb10u1) ...\nSetting up libssl1.1:amd64 (1.1.1n-0+deb10u2) ...\ndebconf: unable to initialize frontend: Dialog\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\ndebconf: falling back to frontend: Readline\nSetting up libprocps7:amd64 (2:3.3.15-2) ...\nSetting up libbrotli1:amd64 (1.0.7-2+deb10u1) ...\nSetting up libsqlite3-0:amd64 (3.27.2-3+deb10u1) ...\nSetting up libsasl2-modules:amd64 (2.1.27+dfsg-1+deb10u2) ...\nSetting up libnghttp2-14:amd64 (1.36.0-2+deb10u1) ...\nSetting up libmagic1:amd64 (1:5.35-4+deb10u2) ...\nSetting up libapr1:amd64 (1.6.5-1+b1) ...\nSetting up krb5-locales (1.17-3+deb10u3) ...\nSetting up file (1:5.35-4+deb10u2) ...\nSetting up bzip2 (1.0.6-9.2~deb10u1) ...\nSetting up libldap-common (2.4.47+dfsg-3+deb10u7) ...\nSetting up libicu63:amd64 (63.1-6+deb10u3) ...\nSetting up libjansson4:amd64 (2.12-1) ...\nSetting up libkrb5support0:amd64 (1.17-3+deb10u3) ...\nSetting up libsasl2-modules-db:amd64 (2.1.27+dfsg-1+deb10u2) ...\nSetting up librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2) ...\nSetting up libncurses6:amd64 (6.1+20181013-2+deb10u2) ...\nSetting up xz-utils (5.2.4-1+deb10u1) ...\nupdate-alternatives: using /usr/bin/xz to provide /usr/bin/lzma (lzma) in auto mode\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzma.1.gz because associated file /usr/share/man/man1/xz.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/unlzma.1.gz because associated file /usr/share/man/man1/unxz.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzcat.1.gz because associated file /usr/share/man/man1/xzcat.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzmore.1.gz because associated file /usr/share/man/man1/xzmore.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzless.1.gz because associated file /usr/share/man/man1/xzless.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzdiff.1.gz because associated file /usr/share/man/man1/xzdiff.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzcmp.1.gz because associated file /usr/share/man/man1/xzcmp.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzgrep.1.gz because associated file /usr/share/man/man1/xzgrep.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzegrep.1.gz because associated file /usr/share/man/man1/xzegrep.1.gz (of link group lzma) doesn't exist\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/lzfgrep.1.gz because associated file /usr/share/man/man1/xzfgrep.1.gz (of link group lzma) doesn't exist\nSetting up libk5crypto3:amd64 (1.17-3+deb10u3) ...\nSetting up libsasl2-2:amd64 (2.1.27+dfsg-1+deb10u2) ...\nSetting up liblua5.2-0:amd64 (5.2.4-1.1+b2) ...\nSetting up procps (2:3.3.15-2) ...\nupdate-alternatives: using /usr/bin/w.procps to provide /usr/bin/w (w) in auto mode\nupdate-alternatives: warning: skip creation of /usr/share/man/man1/w.1.gz because associated file /usr/share/man/man1/w.procps.1.gz (of link group w) doesn't exist\nSetting up libssh2-1:amd64 (1.8.0-2.1) ...\nSetting up netbase (5.6) ...\nSetting up libkrb5-3:amd64 (1.17-3+deb10u3) ...\nSetting up apache2-data (2.4.38-3+deb10u7) ...\nSetting up openssl (1.1.1n-0+deb10u2) ...\nSetting up publicsuffix (20211109.1735-0+deb10u1) ...\nSetting up libxml2:amd64 (2.9.4+dfsg1-7+deb10u4) ...\nSetting up libgdbm6:amd64 (1.18.1-4) ...\nSetting up libaprutil1:amd64 (1.6.1-4) ...\nSetting up libldap-2.4-2:amd64 (2.4.47+dfsg-3+deb10u7) ...\nSetting up libaprutil1-ldap:amd64 (1.6.1-4) ...\nSetting up libaprutil1-dbd-sqlite3:amd64 (1.6.1-4) ...\nSetting up ca-certificates (20200601~deb10u2) ...\ndebconf: unable to initialize frontend: Dialog\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\ndebconf: falling back to frontend: Readline\nUpdating certificates in /etc/ssl/certs...\n137 added, 0 removed; done.\nSetting up ssl-cert (1.0.39) ...\ndebconf: unable to initialize frontend: Dialog\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\ndebconf: falling back to frontend: Readline\nSetting up libgssapi-krb5-2:amd64 (1.17-3+deb10u3) ...\nSetting up libgdbm-compat4:amd64 (1.18.1-4) ...\nSetting up libperl5.28:amd64 (5.28.1-6+deb10u1) ...\nSetting up libcurl4:amd64 (7.64.0-4+deb10u2) ...\nSetting up apache2-utils (2.4.38-3+deb10u7) ...\nSetting up perl (5.28.1-6+deb10u1) ...\nSetting up apache2-bin (2.4.38-3+deb10u7) ...\nSetting up apache2 (2.4.38-3+deb10u7) ...\nEnabling module mpm_event.\nEnabling module authz_core.\nEnabling module authz_host.\nEnabling module authn_core.\nEnabling module auth_basic.\nEnabling module access_compat.\nEnabling module authn_file.\nEnabling module authz_user.\nEnabling module alias.\nEnabling module dir.\nEnabling module autoindex.\nEnabling module env.\nEnabling module mime.\nEnabling module negotiation.\nEnabling module setenvif.\nEnabling module filter.\nEnabling module deflate.\nEnabling module status.\nEnabling module reqtimeout.\nEnabling conf charset.\nEnabling conf localized-error-pages.\nEnabling conf other-vhosts-access-log.\nEnabling conf security.\nEnabling conf serve-cgi-bin.\nEnabling site 000-default.\ninvoke-rc.d: could not determine current runlevel\ninvoke-rc.d: policy-rc.d denied execution of start.\nProcessing triggers for libc-bin (2.28-10+deb10u1) ...\nProcessing triggers for ca-certificates (20200601~deb10u2) ...\nUpdating certificates in /etc/ssl/certs...\n0 added, 0 removed; done.\nRunning hooks in /etc/ca-certificates/update.d...\ndone.\nRemoving intermediate container 82497c561473\n ---&gt; 878ba4d423c6\nStep 4/5 : COPY index.html /var/www/html/\n ---&gt; 4a7b35abef6e\nStep 5/5 : CMD [\"/usr/sbin/apache2ctl\", \"-D\", \"FOREGROUND\"]\n ---&gt; Running in b4ea0360f338\nRemoving intermediate container b4ea0360f338\n ---&gt; fa8b78ee9ce4\nSuccessfully built fa8b78ee9ce4\nSuccessfully tagged adrianjaramillo/myapache2:v2\n</code></pre> <p>Compruebo que tengo la nueva imagen:</p> <p></p> <p>Lanzo un contenedor a partir de esta imagen:</p> <pre><code>atlas@olympus:~/docker/build1$ docker run -d -p 8080:80 --name servidor_web adrianjaramillo/myapache2:v2\n83a16f4cd2bfe74313b38c590697c9d940c3a0d2c3e586e84975748c52e79069\n</code></pre> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#distribucion-de-imagenes","title":"Distribuci\u00f3n de im\u00e1genes","text":""},{"location":"iaw/ejs-docker/#por-fichero","title":"Por fichero","text":"<p>Pasamos la imagen a un <code>.tar</code>:</p> <pre><code>docker save adrianjaramillo/myapache2:v1 &gt; myapache2.tar\n</code></pre> <p>El fichero generado ya podr\u00edamos pasarlo a cualquier sitio.</p> <p>Para a\u00f1adir un <code>.tar</code> a nuestro repositorio local:</p> <pre><code>atlas@olympus:~/docker$ docker load -i myapache2.tar\ne54f845af4e5: Loading layer [==================================================&gt;]  131.7MB/131.7MB\nLoaded image: adrianjaramillo/myapache2:v1\n</code></pre>"},{"location":"iaw/ejs-docker/#por-docker-hub","title":"Por Docker Hub","text":"<p>Me autentico:</p> <pre><code>atlas@olympus:~/docker$ docker login\nLogin with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.\nUsername: adrianjaramillo\nPassword:\nWARNING! Your password will be stored unencrypted in /home/atlas/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n</code></pre> <p>Subimos a Docker Hub:</p> <pre><code>atlas@olympus:~/docker$ docker push adrianjaramillo/myapache2:v2\nThe push refers to repository [docker.io/adrianjaramillo/myapache2]\n2f99db70a821: Pushed\n928f71c072df: Pushed\n10e6bc6fdee2: Mounted from library/debian\nv2: digest: sha256:f5e64a6aca0b4642827146857d52f1adf6dcfc6932ba8e844c0ded7a003959d7 size: 948\n</code></pre> <p>Cualquier persona se podr\u00eda bajar nuestra imagen ahora:</p> <pre><code>atlas@olympus:~/docker$ docker pull adrianjaramillo/myapache2:v2\nv2: Pulling from adrianjaramillo/myapache2\nc1ad9731b2c7: Already exists\n7b785f89fe92: Pull complete\n73b5fa52da1c: Pull complete\nDigest: sha256:f5e64a6aca0b4642827146857d52f1adf6dcfc6932ba8e844c0ded7a003959d7\nStatus: Downloaded newer image for adrianjaramillo/myapache2:v2\ndocker.io/adrianjaramillo/myapache2:v2\n</code></pre>"},{"location":"iaw/ejs-docker/#ejemplo-1-construccion-de-imagenes-con-una-pagina-estatica","title":"Ejemplo 1: Construcci\u00f3n de im\u00e1genes con una p\u00e1gina est\u00e1tica","text":""},{"location":"iaw/ejs-docker/#version-1-desde-una-imagen-base","title":"Versi\u00f3n 1: Desde una imagen base","text":"<p>Parto de la siguiente estructura:</p> <pre><code>atlas@olympus:~/docker/ejemplo1build/version1$ ls -la\ntotal 16\ndrwxr-xr-x 3 atlas atlas 4096 Jun 16 20:44 .\ndrwxr-xr-x 5 atlas atlas 4096 Jun 16 20:49 ..\n-rw-r--r-- 1 atlas atlas  203 Jun 16 20:44 Dockerfile\ndrwxr-xr-x 4 atlas atlas 4096 Jun 16 20:44 public_html\n</code></pre> <p>Muestro el <code>Dockerfile</code>:</p> <pre><code>FROM debian\nRUN apt-get update &amp;&amp; apt-get install -y apache2 &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nADD public_html /var/www/html/\nEXPOSE 80\nCMD [\"/usr/sbin/apache2ctl\", \"-D\", \"FOREGROUND\"]\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/ejemplo1:v1 .\n</code></pre> <p>Compruebo que la imagen se ha creado:</p> <pre><code>atlas@olympus:~/docker/ejemplo1build/version1$ docker images\nREPOSITORY                    TAG           IMAGE ID       CREATED              SIZE\nadrianjaramillo/ejemplo1      v1            78598efe38b7   About a minute ago   235MB\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ejemplo1build/version1$ docker run -d -p 80:80 --name ejemplo1 adrianjaramillo/ejemplo1:v1\n54f3831fbfba45202e6cf9019bcf6f8ca68ab557c00f573364ed55c146ec8fe2\n</code></pre> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#version-2-desde-una-imagen-con-apache2","title":"Versi\u00f3n 2: Desde una imagen con apache2","text":"<p>Muestro el <code>Dockerfile</code>:</p> <pre><code>atlas@olympus:~/docker/ejemplo1build/version2$ cat Dockerfile\nFROM httpd:2.4\nADD public_html /usr/local/apache2/htdocs/\nEXPOSE 80\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/ejemplo1:v2 .\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ejemplo1build/version2$ docker run -d -p 80:80 --name ejemplo1 adrianjaramillo/ejemplo1:v2\nc31ba3ff6a7eb6bfca1388aae222931d503f3159762c2ed1bfe387a4a977c4e6\n</code></pre> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#version-3-desde-una-imagen-con-nginx","title":"Versi\u00f3n 3: Desde una imagen con nginx","text":"<p>Muestro el <code>Dockerfile</code>:</p> <pre><code>atlas@olympus:~/docker/ejemplo1build/version3$ cat Dockerfile\nFROM nginx\nADD public_html /usr/share/nginx/html\nEXPOSE 80\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/ejemplo1:v3 .\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ejemplo1build/version3$ docker run -d -p 80:80 --name ejemplo1 adrianjaramillo/ejemplo1:v3\na71cf3e153588cbbc4d7b810e06a7808d2e13203fe11ab107520360abdb92ea1\n</code></pre> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#ejemplo-2-construccion-de-imagenes-con-una-aplicacion-php","title":"Ejemplo 2: Construcci\u00f3n de im\u00e1genes con una aplicaci\u00f3n PHP","text":""},{"location":"iaw/ejs-docker/#version-1-desde-una-imagen-base-sin-php","title":"Versi\u00f3n 1: Desde una imagen base sin PHP","text":"<p>Muestro el <code>Dockerfile</code>:</p> <pre><code>FROM debian\nRUN apt-get update &amp;&amp; apt-get install -y apache2 libapache2-mod-php php &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nADD app /var/www/html/\nRUN rm /var/www/html/index.html\nEXPOSE 80\nCMD [\"/usr/sbin/apache2ctl\", \"-D\", \"FOREGROUND\"]\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/ejemplo2:v1 .\n</code></pre> <p>Compruebo que la imagen est\u00e1:</p> <pre><code>atlas@olympus:~/docker/ejemplo2build/version1$ docker images\nREPOSITORY                    TAG           IMAGE ID       CREATED              SIZE\nadrianjaramillo/ejemplo2      v1            4deacc77ef43   About a minute ago   254MB\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ejemplo2build/version1$ docker run -d -p 80:80 --name ejemplo2 adrianjaramillo/ejemplo2:v1\n7629bc3a4ed786025dce58351d80599a7725353d40e0a6c5edb0cb5b7f845ebd\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Muestro el <code>info.php</code>:</p> <p></p>"},{"location":"iaw/ejs-docker/#version-2-desde-una-imagen-con-php-instalado","title":"Versi\u00f3n 2: Desde una imagen con PHP instalado","text":"<p>Muestro el <code>Dockerfile</code>:</p> <pre><code>FROM php:7.4-apache\nADD app /var/www/html/\nEXPOSE 80\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/ejemplo2:v2 .\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ejemplo2build/version2$ docker run -d -p 80:80 --name ejemplo2 adrianjaramillo/ejemplo2:v2\n863fb6d27a48fbace7bf41a224ebc38db555e3cb9d9635a35506831e2268cacc\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Muestro el <code>info.php</code>:</p> <p></p>"},{"location":"iaw/ejs-docker/#ejemplo-3-construccion-de-imagenes-con-una-aplicacion-python","title":"Ejemplo 3: Construcci\u00f3n de im\u00e1genes con una aplicaci\u00f3n Python","text":"<p>Muestro el <code>Dockerfile</code>:</p> <pre><code>FROM debian\nRUN apt-get update &amp;&amp; apt-get install -y python3-pip  &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nCOPY app /usr/share/app\nWORKDIR /usr/share/app\nRUN pip3 install --no-cache-dir -r requirements.txt\nEXPOSE 3000\nCMD [ \"python3\", \"app.py\"]\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/ejemplo3:v1 .\n</code></pre> <p>Compruebo que la imagen est\u00e1:</p> <pre><code>atlas@olympus:~/docker/ejemplo3build$ docker images\nREPOSITORY                    TAG           IMAGE ID       CREATED          SIZE\nadrianjaramillo/ejemplo3      v1            5d390f9bcd8e   47 seconds ago   510MB\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ejemplo3build$ docker run -d -p 80:3000 --name ejemplo3 adrianjaramillo/ejemplo3:v1\n24db90990b340ce8d14bf76dc5f3f6fbf08608dc31cbb3a14b751f6c843acb42\n</code></pre> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#ciclo-de-vida-de-las-aplicaciones","title":"Ciclo de vida de las aplicaciones","text":""},{"location":"iaw/ejs-docker/#paso-1-desarrollo-de-nuestra-aplicacion","title":"Paso 1: Desarrollo de nuestra aplicaci\u00f3n","text":"<p>Creo una estructura de p\u00e1gina web:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ mkdir public_html\natlas@olympus:~/docker/ciclovida$ cd public_html\natlas@olympus:~/docker/ciclovida/public_html$ echo \"&lt;h1&gt;Prueba&lt;/h1&gt;\" &gt; index.html\n</code></pre>"},{"location":"iaw/ejs-docker/#paso-2-creacion-de-la-imagen-docker","title":"Paso 2: Creaci\u00f3n de la imagen Docker","text":"<p>Creo el siguiente <code>Dockerfile</code>:</p> <pre><code>FROM httpd:2.4\nADD ./public_html /usr/local/apache2/htdocs/\n</code></pre> <p>Genero la imagen:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker build -t adrianjaramillo/aplicacionweb:v1 .\nSending build context to Docker daemon  3.584kB\nStep 1/2 : FROM httpd:2.4\n ---&gt; acd59370d8fb\nStep 2/2 : ADD ./public_html /usr/local/apache2/htdocs/\n ---&gt; 4415b1fcea4e\nSuccessfully built 4415b1fcea4e\nSuccessfully tagged adrianjaramillo/aplicacionweb:v1\n</code></pre> <p>Compruebo que la imagen est\u00e1:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker image ls\nREPOSITORY                      TAG           IMAGE ID       CREATED              SIZE\nadrianjaramillo/aplicacionweb   v1            4415b1fcea4e   About a minute ago   144MB\n</code></pre>"},{"location":"iaw/ejs-docker/#paso-3-probamos-nuestra-aplicacion-en-el-entorno-de-desarrollo","title":"Paso 3: Probamos nuestra aplicaci\u00f3n en el entorno de desarrollo","text":"<p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker run --name aplweb -d -p 80:80 adrianjaramillo/aplicacionweb:v1\n39c8937b5badb9dc5f910498aeaf9380d6aa1b0e326e5ea19c527ff40a499e85\n</code></pre> <p>Compruebo que est\u00e9 activo:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker ps\nCONTAINER ID   IMAGE                              COMMAND              CREATED              STATUS              PORTS                NAMES\n39c8937b5bad   adrianjaramillo/aplicacionweb:v1   \"httpd-foreground\"   About a minute ago   Up About a minute   0.0.0.0:80-&gt;80/tcp   aplweb\n</code></pre> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/ejs-docker/#paso-4-distribuimos-nuestra-imagen","title":"Paso 4: Distribuimos nuestra imagen","text":"<p>Subo a Docker Hub:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker push adrianjaramillo/aplicacionweb:v1\nThe push refers to repository [docker.io/adrianjaramillo/aplicacionweb]\n14d158b7d9db: Pushed\n2db1ee0a0f4f: Mounted from library/httpd\n857d0bc0663f: Mounted from library/httpd\n4a48959ac654: Mounted from library/httpd\n4e2b986e3da3: Mounted from library/httpd\nad6562704f37: Mounted from library/wordpress\nv1: digest: sha256:414d9c7a3d0b84fc327da8414eb9baa8abf32ce1807dae19d3448c1e0c8f84cb size: 1572\n</code></pre>"},{"location":"iaw/ejs-docker/#paso-5-implantacion-de-la-aplicacion","title":"Paso 5: Implantaci\u00f3n de la aplicaci\u00f3n","text":"<p>Para simular que nuestra m\u00e1quina es el entorno de producci\u00f3n, borramos nuestra imagen local original...</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker rmi adrianjaramillo/aplicacionweb:v1\nUntagged: adrianjaramillo/aplicacionweb:v1\nUntagged: adrianjaramillo/aplicacionweb@sha256:414d9c7a3d0b84fc327da8414eb9baa8abf32ce1807dae19d3448c1e0c8f84cb\nDeleted: sha256:4415b1fcea4ef1b5adf4e912bc4f14670ea4c713b326d16c0ca4452f57852cb0\nDeleted: sha256:d2dcb5a1a671e6661428ac9e379493d6e73574bc2befa9c7027ace21ba14ed44\n</code></pre> <p>... y nos la volvemos a descargar desde Docker Hub:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker pull adrianjaramillo/aplicacionweb:v1\nv1: Pulling from adrianjaramillo/aplicacionweb\n42c077c10790: Already exists\n77a357ba66a8: Already exists\nc56c780a8904: Already exists\necb885e1c489: Already exists\nba0337d73eed: Already exists\n35e5b4af3e12: Pull complete\nDigest: sha256:414d9c7a3d0b84fc327da8414eb9baa8abf32ce1807dae19d3448c1e0c8f84cb\nStatus: Downloaded newer image for adrianjaramillo/aplicacionweb:v1\ndocker.io/adrianjaramillo/aplicacionweb:v1\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>tlas@olympus:~/docker/ciclovida$ docker run --name aplweb_prod -d -p 80:80 adrianjaramillo/aplicacionweb:v1\nc7bf2af9a3c91426a80e22edd67d72f99a1571512d5ddd7a20f7a7dea3a39134\n</code></pre> <p>Pruebo que sigue funcionando:</p> <p></p>"},{"location":"iaw/ejs-docker/#paso-6-modificacion-de-la-aplicacion","title":"Paso 6: Modificaci\u00f3n de la aplicaci\u00f3n","text":"<p>Si modificamos el c\u00f3digo de la aplicaci\u00f3n tendremos que generar una nueva imagen:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ cd public_html\natlas@olympus:~/docker/ciclovida/public_html$ echo \"&lt;h1&gt;Prueba 2&lt;/h1&gt;\" &gt; index.html\natlas@olympus:~/docker/ciclovida/public_html$ cd ..\natlas@olympus:~/docker/ciclovida$ docker build -t adrianjaramillo/aplicacionweb:v2 .\nSending build context to Docker daemon  3.584kB\nStep 1/2 : FROM httpd:2.4\n ---&gt; acd59370d8fb\nStep 2/2 : ADD ./public_html /usr/local/apache2/htdocs/\n ---&gt; 44a890a9da01\nSuccessfully built 44a890a9da01\nSuccessfully tagged adrianjaramillo/aplicacionweb:v2\n</code></pre> <p>Lanzo un contenedor en el entorno de desarrollo:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker run --name aplweb2 -d -p 80:80 adrianjaramillo/aplicacionweb:v2\n22fc8df544b24d536aa745d502ace5215d5e56ef74365e8fb92447db881606af\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Subo la nueva imagen:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker push adrianjaramillo/aplicacionweb:v2\nThe push refers to repository [docker.io/adrianjaramillo/aplicacionweb]\naa226b1a6620: Pushed\n2db1ee0a0f4f: Layer already exists\n857d0bc0663f: Layer already exists\n4a48959ac654: Layer already exists\n4e2b986e3da3: Layer already exists\nad6562704f37: Layer already exists\nv2: digest: sha256:78c66a668b1d4b946edc1a00594480d666fb05ff4ab799d97b5e724afd3ed3ae size: 1572\n</code></pre> <p>Elimino la imagen local original:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker rmi adrianjaramillo/aplicacionweb:v2\nUntagged: adrianjaramillo/aplicacionweb:v2\nUntagged: adrianjaramillo/aplicacionweb@sha256:78c66a668b1d4b946edc1a00594480d666fb05ff4ab799d97b5e724afd3ed3ae\nDeleted: sha256:44a890a9da01acbe029eb7ac5a57e5b2c27c114370e0a03e682739f738083f0b\nDeleted: sha256:71ba067af316ee14e14780b5ce532be1bb4fc390ae803cc8e29ccff6ae05ebe0\n</code></pre> <p>La vuelvo a descargar de Docker Hub:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker pull adrianjaramillo/aplicacionweb:v2\nv2: Pulling from adrianjaramillo/aplicacionweb\n42c077c10790: Already exists\n77a357ba66a8: Already exists\nc56c780a8904: Already exists\necb885e1c489: Already exists\nba0337d73eed: Already exists\n0fb57bd0a568: Pull complete\nDigest: sha256:78c66a668b1d4b946edc1a00594480d666fb05ff4ab799d97b5e724afd3ed3ae\nStatus: Downloaded newer image for adrianjaramillo/aplicacionweb:v2\ndocker.io/adrianjaramillo/aplicacionweb:v2\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ciclovida$ docker run --name aplweb2_prod -d -p 80:80 adrianjaramillo/aplicacionweb:v2\nc9be3aaf8cb31898140aeb0967a3063debd44d2587eb01dce0dcb54a8bdb7fca\n</code></pre> <p>Pruebo que sigue funcionando:</p> <p></p>"},{"location":"iaw/ejs-docker/#ejercicios-creacion-imagenes","title":"Ejercicios creaci\u00f3n im\u00e1genes","text":"<p>Muestro el directorio donde tengo la estructura de mi web y donde tendr\u00e9 el <code>Dockerfile</code>:</p> <pre><code>atlas@olympus:~/docker/ejimagenes$ ls -la\ntotal 12\ndrwxr-xr-x  3 atlas atlas 4096 Jun 17 18:04 .\ndrwxr-xr-x 18 atlas atlas 4096 Jun 17 17:25 ..\ndrwxr-xr-x  8 atlas atlas 4096 Jun 17 18:03 public_html\n</code></pre> <p>Creo el siguiente <code>Dockerfile</code>:</p> <p></p> <p>Genero la imagen:</p> <p></p> <p>Compruebo que la tengo localmente:</p> <pre><code>atlas@olympus:~/docker/ejimagenes$ docker images\nREPOSITORY                        TAG           IMAGE ID       CREATED             SIZE\nadrianjaramillo/mi_servidor_web   v1            c5533b4dd021   2 minutes ago       142MB\n</code></pre> <p>Lanzo un contenedor:</p> <pre><code>atlas@olympus:~/docker/ejimagenes$ docker run -d -p 80:80 --name prueba1 adrianjaramillo/mi_servidor_web:v1\n31196fe55dc33d3f818c4c979ba570ff6569c6fde885f1cef433d16bbd2a2f1d\n</code></pre> <p>Pruebo que funciona:</p> <p></p> <p>Subo la nueva imagen a Docker Hub:</p> <p></p> <p>Compruebo que se subi\u00f3 correctamente:</p> <p></p> <p>Para simular que nuestra m\u00e1quina es el entorno de producci\u00f3n, borramos nuestra imagen local original...</p> <pre><code>atlas@olympus:~/docker/ejimagenes$ docker rmi adrianjaramillo/mi_servidor_web:v1\nUntagged: adrianjaramillo/mi_servidor_web:v1\nUntagged: adrianjaramillo/mi_servidor_web@sha256:b1ab1fd223167e4a6b5234fa6bde88ae2e677c0cfb19b38abab12a0411ead882\nDeleted: sha256:9b1fa17c1533b7f8e6596976bf1e839a9cd15e4b0f58c77008d0a62985e004c4\nDeleted: sha256:a9efe2bdee3e0d17ee5316f9eec7489e1c67fa166ed7fb780de3f848ca90380d\nDeleted: sha256:07a7bf31da7166779623897641084ec5f05bd7b1095a339ed89b17de8828ccb3\n</code></pre> <p>... y nos la volvemos a descargar desde Docker Hub:</p> <p></p> <p>Lanzo otro contenedor:</p> <p></p> <p>Pruebo que funciona de nuevo:</p> <p></p>"},{"location":"iaw/practica-cms-java/","title":"Pr\u00e1ctica: Despliegue de CMS java","text":""},{"location":"iaw/practica-cms-java/#parte-1","title":"Parte 1","text":"<p>Indicar la aplicaci\u00f3n escogida y su funcionalidad</p> <p>Elijo OpenCms.</p> <p>OpenCms est\u00e1 enfocado a crear p\u00e1ginas web en entornos profesionales tanto peque\u00f1os como grandes, en intranets y en Internet. Sus funcionalidades a destacar son:</p> <ul> <li>Interfaz web avanzada para estructurar el sitio</li> <li>Creaci\u00f3n de contenido con un editor WYSIWYG</li> <li>Webs multilenguaje editables por m\u00faltiples usuarios con diferentes permisos</li> <li>Posibilidad de a\u00f1adir nuevas funcionalidades creando tus propios m\u00f3dulos</li> <li>Generaci\u00f3n de PDF</li> <li>Formularios web</li> </ul>"},{"location":"iaw/practica-cms-java/#parte-2","title":"Parte 2","text":"<p>Escribir una gu\u00eda con los pasos fundamentales para realizar la instalaci\u00f3n</p> <p>Instalo Tomcat:</p> <pre><code>sudo apt install tomcat9\n</code></pre> <p>Compruebo que funciona:</p> <p></p> <p>Instalo mariadb:</p> <pre><code>sudo apt install mariadb-server\n</code></pre> <p>A\u00f1ado una contrase\u00f1a al usuario root:</p> <pre><code>ALTER USER 'root'@'localhost' IDENTIFIED BY 'vagrant';\n</code></pre> <p>En <code>/tmp</code> descargo y extraigo el zip de opencms:</p> <pre><code>wget http://www.opencms.org/downloads/opencms/opencms-13.0.zip\nunzip opencms-13.0.zip\n</code></pre> <p>Muevo <code>opencms.war</code> a <code>/var/lib/tomcat9/webapps</code> para que se despliegue:</p> <pre><code>sudo mv opencms.war /var/lib/tomcat9/webapps\n</code></pre> <p>Inicio la instalaci\u00f3n del CMS:</p> <p></p> <p></p> <p></p> <p>(la contrase\u00f1a es la que antes a\u00f1adimos, vagrant)</p> <p></p> <p></p> <p></p> <p></p>"},{"location":"iaw/practica-cms-java/#parte-3","title":"Parte 3","text":"<p>\u00bfHas necesitado instalar alguna librer\u00eda? \u00bfHas necesitado instalar un conector de una base de datos?</p> <p>No a las 2 preguntas, no se han tenido que instalar elementos adicionales.</p> <p>Teniendo Tomcat, MariaDB, y haciendo la instalaci\u00f3n inicial del CMS en la web, no se necesita nada m\u00e1s dada la simpleza de OpenCms.</p>"},{"location":"iaw/practica-cms-java/#parte-4","title":"Parte 4","text":"<p>Entregar una captura de pantalla donde se vea OpenCms funcionando desde Tomcat</p> <p></p>"},{"location":"iaw/practica-cms-java/#parte-5","title":"Parte 5","text":"<p>Realizar la configuraci\u00f3n necesaria en Nginx para que OpenCms sea servido por el servidor web</p> <p>Instalo Nginx:</p> <pre><code>sudo apt install nginx\n</code></pre> <p>Creo <code>/etc/nginx/sites-available/opencms.conf</code>:</p> <pre><code>server {\n    listen 80;\n    server_name www.opencms.com;\n    location / {\n        proxy_pass http://localhost:8080;\n        include proxy_params;\n    }\n}\n</code></pre> <p>Lo habilito:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/opencms.conf /etc/nginx/sites-enabled\n</code></pre> <p>Reinicio Nginx:</p> <pre><code>sudo systemctl restart nginx\n</code></pre> <p>A\u00f1ado lo siguiente a mi <code>/etc/hosts</code>:</p> <pre><code># CMS Java\n192.168.121.89 www.opencms.com\n</code></pre> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/practica-cms-python/","title":"Pr\u00e1ctica: Instalaci\u00f3n de un CMS python","text":""},{"location":"iaw/practica-cms-python/#apartado-1","title":"Apartado 1","text":"<p>Instalar Django Fiber en desarrollo, utilizando un entorno virtual</p> <p>Escenario: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :practicacmspython do |practicacmspython|\n    practicacmspython.vm.box = \"rockylinux/8\"\n    practicacmspython.vm.hostname = \"practicacmspython\"\n  end\n\nend\n</code></pre></p> <p>Creo entorno virtual: <pre><code>mkdir venv\ncd venv\nsudo dnf install virtualenv\npython3 -m venv .\nsource bin/activate\n</code></pre></p> <p>Descargo el proyecto: <pre><code>sudo dnf install git\ngit clone https://github.com/django-fiber/django-fiber.git\n</code></pre></p> <p>Instalo paquetes necesarios: <pre><code>sudo dnf groupinstall 'Development Tools'\npip install --upgrade pip\npip install -r requirements.txt\npip install django-fiber\n</code></pre></p> <p>Modifico <code>settings.py</code>: <pre><code>ALLOWED_HOSTS = ['192.168.121.54']\n</code></pre></p> <p>Creo las tablas: <pre><code>python3 manage.py migrate\n</code></pre></p> <p>Creo el usuario admin: <pre><code>python3 manage.py createsuperuser\n</code></pre> <pre><code>Username (leave blank to use 'vagrant'): admin\nEmail address:\nPassword:\nPassword (again):\nSuperuser created successfully.\n</code></pre></p> <ul> <li>Username: admin</li> <li>Password: 123admin456</li> </ul> <p>Ejecuto el server web de desarrollo: <pre><code>python3 manage.py runserver 0.0.0.0:8000\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/practica-cms-python/#apartado-2","title":"Apartado 2","text":"<p>Personalizar la p\u00e1gina</p> <p>Para ello es necesario acceder a <code>/admin</code>.</p> <p>Principal:</p> <p></p> <p>Art\u00edculo 1:</p> <p></p>"},{"location":"iaw/practica-cms-python/#apartado-3","title":"Apartado 3","text":"<p>Volcar la base de datos  </p> <pre><code>python manage.py dumpdata --exclude auth.permission --exclude contenttypes &gt; db.json\n</code></pre> <p>Guardar la aplicaci\u00f3n en repositorio</p> <p>Lo creo: https://github.com/adriasir123/django-fiber</p> <p>Modifico <code>.gitignore</code>: <pre><code>*.pyc\n/build/\n/dist/\n/testproject/reports/\n#/testproject/static/\ndjango_fiber.egg-info\n.tox\n\ntestproject/fiber_test/__pycache__\ntestproject/testproject/__pycache__\n</code></pre></p> <p>Subo cambios al repo: <pre><code>git remote remove origin\ngit branch -M main\ngit add .\ngit config --global user.email \"adristudy@gmail.com\"\ngit config --global user.name \"Adri\u00e1n Jaramillo\"\ngit commit -m \"Initial commit\"\ngit push --set-upstream origin master\n</code></pre></p>"},{"location":"iaw/practica-cms-python/#apartado-4","title":"Apartado 4","text":"<p>Desplegar la app en hera con Utiliza uWSGI, y la BD en ares. . El contenido est\u00e1tico debe servirlo el servidor web. La aplicaci\u00f3n ser\u00e1 accesible en la url python.adrianj.gonzalonazareno.org.</p> <p>Clonar repositorio: <pre><code>sudo dnf install git\ngit clone https://github.com/adriasir123/django-fiber.git\n</code></pre></p> <p>Creo entorno virtual: <pre><code>mkdir venv\ncd venv\nsudo dnf install virtualenv\npython3 -m venv .\nsource bin/activate\n</code></pre></p> <p>Instalo paquetes necesarios: <pre><code>sudo dnf groupinstall 'Development Tools'\npip install --upgrade pip\npip install -r requirements.txt\npip install django-fiber\n</code></pre></p> <p>Instalar m\u00f3dulo para que python se pueda comunicar con MariaDB: <pre><code>sudo dnf install python3-devel mysql-devel\npip install mysqlclient\n</code></pre></p> <p>Crear BD: <pre><code>CREATE DATABASE `django_fiber_db`;\n</code></pre></p> <p>Crear usuario con permisos sobre <code>django_fiber_db</code>: <pre><code>CREATE USER 'django_fiber_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'django_fiber_user'@'%' IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `django_fiber_db`.* TO 'django_fiber_user'@'%';\n\nFLUSH PRIVILEGES;\n</code></pre></p> <p>Modificar la conexi\u00f3n a la BD en <code>settings.py</code>: <pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'django_fiber_db',\n        'USER': 'django_fiber_user',\n        'PASSWORD': '1234',         \n        'HOST': 'bd.adrianj.gonzalonazareno.org',\n        'PORT': '',\n    }\n}\n</code></pre></p> <p>Crear tablas en MariaDB: <pre><code>python3 manage.py migrate\n</code></pre></p> <p>Recuperar de datos: <pre><code>python3 manage.py loaddata db.json\n</code></pre></p> <p>Instalar uwsgi <pre><code>pip install uwsgi\n</code></pre></p> <p>Creo <code>/var/www/django-fiber/testproject/django-fiber.ini</code>: <pre><code>[uwsgi]\nhttp = :8080\nchdir = /var/www/django-fiber/testproject\nwsgi-file = /var/www/django-fiber/testproject/testproject/wsgi.py\nprocesses = 4\nthreads = 2\n</code></pre></p> <p>Crear unidad systemd, <code>/etc/systemd/system/uwsgi-django-fiber.service</code>: <pre><code>[Unit]\nDescription=uwsgi-django-fiber\nAfter=network.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=root\nGroup=root\nRestart=always\n\nExecStart=/home/vagrant/venv/bin/uwsgi /var/www/django-fiber/testproject/django-fiber.ini\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s TERM $MAINPID\n\nWorkingDirectory=/var/www/django-fiber/testproject\nEnvironment=PYTHONPATH='/var/www/django-fiber/testproject:/home/vagrant/venv/lib/python3.6/site-packages'\n\nPrivateTmp=true\n</code></pre></p> <p>Cambio permisos: <pre><code>sudo chown -R apache:apache /home/vagrant/django-fiber/\nsudo chown -R apache:apache /home/vagrant/venv\nsudo chmod 777 django-fiber.ini\n</code></pre></p> <p>Deshabilitar selinux: <pre><code>sudo setenforce 0\n</code></pre></p> <p>La activo e inicio: <pre><code>sudo systemctl enable uwsgi-django-fiber.service\nsudo systemctl start uwsgi-django-fiber.service\n</code></pre></p>"},{"location":"iaw/practica-cms-python/#apache-uwsgi","title":"Apache + uWSGI","text":"<pre><code>python manage.py collectstatic --link\n</code></pre> <p>Creo <code>/etc/httpd/conf.d/python.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n\n        ServerName python.adrianj.gonzalonazareno.org\n        DocumentRoot /var/www/django-fiber/testproject\n\n        &lt;Directory /var/www/django-fiber/testproject&gt;\n            Require all granted\n            Options +FollowSymLinks\n        &lt;/Directory&gt;\n\n        ProxyPass /static/ !\n        ProxyPass / http://127.0.0.1:8080/\n        ProxyPassReverse / http://127.0.0.1:8080/\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Mover la app: <pre><code>sudo mv django-fiber/ /var/www/\n</code></pre></p> <p>Permisos: <pre><code>sudo chown -R root:root /var/www/django-fiber/\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart httpd\n</code></pre></p>"},{"location":"iaw/practica-cms-python/#nuevos-registro-dns","title":"Nuevos registro DNS","text":"<p>A\u00f1ado a <code>db.externa.adrianj.gonzalonazareno.org</code>: <pre><code>python         IN    CNAME   zeus\n</code></pre></p> <p>A\u00f1ado a <code>db.dmz.adrianj.gonzalonazareno.org</code>: <pre><code>python         IN    CNAME   hera\n</code></pre></p> <p>A\u00f1ado a <code>db.interna.adrianj.gonzalonazareno.org</code>: <pre><code>python         IN    CNAME   hera\n</code></pre></p> <p>Reiniciar bind9: <pre><code>sudo systemctl restart bind9\n</code></pre></p>"},{"location":"iaw/practica-cms-python/#modifico-puntos-de-entrada","title":"Modifico puntos de entrada","text":"<pre><code>ALLOWED_HOSTS = ['python.adrianj.gonzalonazareno.org','127.0.0.1']\n</code></pre> <p>Reinicio uwsgi: <pre><code>sudo systemctl restart uwsgi-django-fiber.service\n</code></pre></p>"},{"location":"iaw/practica-despliegue-apps-python/","title":"Pr\u00e1ctica: Despliegue de aplicaciones python","text":"<p>En esta pr\u00e1ctica se usa la aplicaci\u00f3n Django tutorial.</p>"},{"location":"iaw/practica-despliegue-apps-python/#tarea-1-entorno-de-desarrollo","title":"Tarea 1: Entorno de desarrollo","text":""},{"location":"iaw/practica-despliegue-apps-python/#parte-0","title":"Parte 0","text":"<p>Crear escenario</p> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :desplieguepython do |desplieguepython|\n    desplieguepython.vm.box = \"debian/bullseye64\"\n    desplieguepython.vm.hostname = \"desplieguepython\"\n  end\n\nend\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-1","title":"Parte 1","text":"<p>Hacer fork de https://github.com/josedom24/django_tutorial</p> <p></p> <p>Clonar repo</p> <pre><code>git clone git@github.com:adriasir123/django_tutorial.git\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-2","title":"Parte 2","text":"<p>Crear entorno virtual</p> <pre><code>mkdir venv\ncd venv\nsudo apt update\nsudo apt install python3-venv\npython3 -m venv .\nsource ~/venv/bin/activate\n</code></pre> <p>Instalar dependencias</p> <pre><code>pip install -r requirements.txt\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-3","title":"Parte 3","text":"<p>Comprobar que se usa SQLite. \u00bfQu\u00e9 fichero la define?</p> <p><code>settings.py</code>, en el siguiente bloque: <pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.sqlite3',\n        'NAME': BASE_DIR / 'db.sqlite3',\n    }\n}\n</code></pre></p> <p>\u00bfNombre de la BD que se crear\u00e1?</p> <p><code>db.sqlite3</code></p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-4","title":"Parte 4","text":"<p>Crear tablas en SQLite</p> <pre><code>python3 manage.py migrate\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-5","title":"Parte 5","text":"<p>Crear usuario admin</p> <p><pre><code>python3 manage.py createsuperuser\n</code></pre> <pre><code>Username (leave blank to use 'vagrant'): admin\nEmail address:\nPassword:\nPassword (again):\nSuperuser created successfully.\n</code></pre></p> <ul> <li>Username: admin</li> <li>Password: 123admin456</li> </ul>"},{"location":"iaw/practica-despliegue-apps-python/#parte-6","title":"Parte 6","text":"<p>Habilitar acceso a la app</p> <p><code>settings.py</code>: <pre><code>ALLOWED_HOSTS = ['192.168.121.102']\n</code></pre> (Direcci\u00f3n de destino a habilitar)</p> <p>Ejecutar servidor web desarrollo</p> <pre><code>python3 manage.py runserver 0.0.0.0:8000\n</code></pre> <p>Index:</p> <p></p> <p>/admin:</p> <p></p> <p>Comprobar que el usuario admin se ha a\u00f1adido correctamente:</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-7","title":"Parte 7","text":"<p>Crear dos preguntas con respuestas</p> <p>Pregunta 1:</p> <p></p> <p>Pregunta 2:</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-8","title":"Parte 8","text":"<p>Comprobar que la URL <code>/polls</code> funciona</p> <p>/polls:</p> <p></p> <p>Poll 1:</p> <p></p> <p>Poll 2:</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#tarea-2-entorno-de-produccion-vps","title":"Tarea 2: Entorno de producci\u00f3n (VPS)","text":""},{"location":"iaw/practica-despliegue-apps-python/#parte-1_1","title":"Parte 1","text":"<p>Clonar repositorio en VPS</p> <pre><code>git clone https://github.com/adriasir123/django_tutorial.git\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-2_1","title":"Parte 2","text":"<p>Crear entorno virtual</p> <pre><code>mkdir venv\ncd venv\nsudo apt install python3-venv\npython3 -m venv .\nsource bin/activate\n</code></pre> <p>Instalar dependencias</p> <pre><code>pip install -r requirements.txt\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-3_1","title":"Parte 3","text":"<p>Instalar m\u00f3dulo para que python se pueda comunicar con MariaDB</p> <pre><code>sudo apt install python3-dev default-libmysqlclient-dev build-essential\npip install mysqlclient\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-4_1","title":"Parte 4","text":"<p>Crear BD</p> <pre><code>CREATE DATABASE `django_tutorial_db`;\n</code></pre> <p>Crear usuario con permisos sobre <code>django_tutorial_db</code></p> <pre><code>CREATE USER 'django_tutorial_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'django_tutorial_user'@localhost IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `django_tutorial_db`.* TO 'django_tutorial_user'@localhost;\n\nFLUSH PRIVILEGES;\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-5_1","title":"Parte 5","text":"<p>Modificar la conexi\u00f3n a la BD en <code>settings.py</code></p> <pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'django_tutorial_db',\n        'USER': 'django_tutorial_user',\n        'PASSWORD': '1234',         \n        'HOST': 'localhost',\n        'PORT': '',\n    }\n}\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-6_1","title":"Parte 6","text":"<p>Crear tablas en MariaDB</p> <pre><code>python3 manage.py migrate\n</code></pre> <p>Comprobar que se han creado</p> <pre><code>MariaDB [django_tutorial_db]&gt; show tables;\n+------------------------------+\n| Tables_in_django_tutorial_db |\n+------------------------------+\n| auth_group                   |\n| auth_group_permissions       |\n| auth_permission              |\n| auth_user                    |\n| auth_user_groups             |\n| auth_user_user_permissions   |\n| django_admin_log             |\n| django_content_type          |\n| django_migrations            |\n| django_session               |\n| polls_choice                 |\n| polls_question               |\n+------------------------------+\n12 rows in set (0.001 sec)\n</code></pre> <p>Volcado de datos en desarrollo</p> <pre><code>python3 manage.py dumpdata &gt; db.json\n</code></pre> <p>Volcado de datos en VPS:</p> <pre><code>python3 manage.py loaddata db.json\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#parte-7_1","title":"Parte 7","text":"<p>Instalar y configurar Gunicorn para ejecutar Django. Luego, configurar Nginx como proxy inverso para servir <code>django_tutorial</code></p>"},{"location":"iaw/practica-despliegue-apps-python/#instalar-gunicorn","title":"Instalar Gunicorn","text":"<pre><code>pip install gunicorn\n</code></pre>"},{"location":"iaw/practica-despliegue-apps-python/#crear-unidad-systemd","title":"Crear unidad systemd","text":"<p><code>/etc/systemd/system/gunicorn-django-tutorial.service</code>: <pre><code>[Unit]\nDescription=gunicorn-django-tutorial\nAfter=network.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=www-data\nGroup=www-data\nRestart=always\n\nExecStart=/home/blackmamba/venv/bin/gunicorn -w 2 -b :8080 django_tutorial.wsgi\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s TERM $MAINPID\n\nWorkingDirectory=/home/blackmamba/django_tutorial\nEnvironment=PYTHONPATH='/home/blackmamba/django_tutorial:/home/blackmamba/venv/lib/python3.9/site-packages'\n\nPrivateTmp=true\n</code></pre></p> <p>La activo e inicio: <pre><code>sudo systemctl enable gunicorn-django-tutorial.service\nsudo systemctl start gunicorn-django-tutorial.service\n</code></pre></p>"},{"location":"iaw/practica-despliegue-apps-python/#nginx-gunicorn","title":"Nginx + Gunicorn","text":"<p>Creo <code>/etc/nginx/sites-available/django.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name django.adrianjaramillo.tk;\n    root /home/blackmamba/django_tutorial;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        include proxy_params;\n    }\n\n}\n</code></pre></p> <p>Lo habilito: <pre><code>sudo ln -s /etc/nginx/sites-available/django.conf /etc/nginx/sites-enabled/\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p>"},{"location":"iaw/practica-despliegue-apps-python/#anadir-nuevo-registro-dns","title":"A\u00f1adir nuevo registro DNS","text":""},{"location":"iaw/practica-despliegue-apps-python/#modificar-settingspy","title":"Modificar settings.py","text":"<pre><code>ALLOWED_HOSTS = ['django.adrianjaramillo.tk']\n</code></pre> <p>Reinicio: <pre><code>sudo systemctl restart gunicorn-django-tutorial.service\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-8_1","title":"Parte 8","text":"<p>\u00bfFunciona el css de polls? Arr\u00e9glalo.</p> <p><code>/etc/nginx/sites-available/django.conf</code>: <pre><code>location /static/polls {\n    alias /home/blackmamba/django_tutorial/polls/static/polls;\n}\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p> <p>\u00bfFunciona el css de admin? Arr\u00e9glalo.</p> <p><code>/etc/nginx/sites-available/django.conf</code>: <pre><code>location /static/admin {\n    alias /home/blackmamba/venv/lib/python3.9/site-packages/django/contrib/admin/static/admin/;\n}\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-9","title":"Parte 9","text":"<p>Desactivar debug</p> <p><code>settings.py</code>: <pre><code>DEBUG = False\n</code></pre></p> <p>Reinicio: <pre><code>sudo systemctl restart gunicorn-django-tutorial.service\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p> <p>Si DEBUG fuese True, al escribir esa URL que no existe, me habr\u00eda aparecido mucha m\u00e1s informaci\u00f3n:</p> <p></p> <p>(DEBUG = True)</p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-10","title":"Parte 10","text":"<p>Mostrar la p\u00e1gina funcionando</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#tarea-3-modificacion-de-nuestra-aplicacion","title":"Tarea 3: Modificaci\u00f3n de nuestra aplicaci\u00f3n","text":"<p>En esta secci\u00f3n primero se cambia en desarrollo, y luego se pasa a producci\u00f3n.</p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-0_1","title":"Parte 0","text":"<p>A\u00f1adir <code>settings.py</code> a <code>.gitignore</code></p> <pre><code>django_tutorial/settings.py\n</code></pre> <p>\u00a1Esta acci\u00f3n es importante! El fichero cambia MUCHO con respecto a desarrollo/producci\u00f3n (DEBUG, ALLOWED_HOSTS, DATABASES).</p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-1_2","title":"Parte 1","text":"<p>Modificar <code>django_tutorial/polls/templates/polls/index.html</code> con tu nombre</p> <pre><code>{% load static %}\n\n&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"{% static 'polls/style.css' %}\"&gt;\n\n{% if latest_question_list %}\n    &lt;ul&gt;\n    {% for question in latest_question_list %}\n    &lt;li&gt;&lt;a href=\"{% url 'polls:detail' question.id %}\"&gt;{{ question.question_text }}&lt;/a&gt;&lt;/li&gt;\n    {% endfor %}\n    &lt;/ul&gt;\n{% else %}\n    &lt;p&gt;No polls are available.&lt;/p&gt;\n{% endif %}\n\n&lt;h2&gt;Adri\u00e1n Jaramillo Rodr\u00edguez&lt;/h2&gt;\n</code></pre> <p>Prueba en desarrollo:</p> <p></p> <p>Subir cambios desde desarrollo: <pre><code>git commit -am \"mi nombre polls index.html\"\ngit push\n</code></pre></p> <p>Bajar cambios en producci\u00f3n: <pre><code>git pull\n</code></pre></p> <p>Reinicio gunicorn para que actualice la configuraci\u00f3n: <pre><code>sudo systemctl restart gunicorn-django-tutorial.service\n</code></pre></p> <p>Prueba en producci\u00f3n:</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-2_2","title":"Parte 2","text":"<p>Modificar la imagen de fondo en la p\u00e1gina principal</p> <p>En <code>/home/vagrant/django_tutorial/polls/templates/index.html</code>...</p> <p>A\u00f1adir en el head: <pre><code>&lt;style&gt;\n  body {\n    background-image: url('https://w.wallhaven.cc/full/lm/wallhaven-lm12ey.jpg');\n  }\n&lt;/style&gt;\n</code></pre></p> <p>Comentar en el body: <pre><code>&lt;!--\n  &lt;div id=\"stripes\"&gt;\n    &lt;span&gt;&lt;/span&gt;\n    &lt;span&gt;&lt;/span&gt;\n    &lt;span&gt;&lt;/span&gt;\n    &lt;span&gt;&lt;/span&gt;\n    &lt;span&gt;&lt;/span&gt;\n  &lt;/div&gt;\n--&gt;\n</code></pre></p> <p>Prueba en desarrollo:</p> <p></p> <p>Subir cambios desde desarrollo: <pre><code>git commit -am \"fondo cambiado en index.html\"\ngit push\n</code></pre></p> <p>Bajar cambios en producci\u00f3n: <pre><code>git pull\n</code></pre></p> <p>Reinicio gunicorn para que actualice la configuraci\u00f3n: <pre><code>sudo systemctl restart gunicorn-django-tutorial.service\n</code></pre></p> <p>Prueba en producci\u00f3n:</p> <p></p>"},{"location":"iaw/practica-despliegue-apps-python/#parte-3_2","title":"Parte 3","text":"<p>Crear una nueva tabla en la base de datos</p> <p>A\u00f1adir a <code>django_tutorial/polls/models.py</code>: <pre><code>class Categoria(models.Model):\n    Abr = models.CharField(max_length=4)\n    Nombre = models.CharField(max_length=50)\n\n    def __str__(self):\n        return self.Abr+\" - \"+self.Nombre\n</code></pre></p> <p>Aplicar cambios: <pre><code>python manage.py makemigrations\npython manage.py migrate\n</code></pre></p> <p>Modificar la siguiente l\u00ednea en <code>django_tutorial/polls/admin.py</code>... <pre><code>from .models import Choice, Question, Categoria\n</code></pre></p> <p>...y a\u00f1adir esta otra: <pre><code>admin.site.register(Categoria)\n</code></pre></p> <p>Prueba en desarrollo:</p> <p> (la tabla categor\u00edas se ha creado, y he rellenado datos)</p> <p>Vuelco los nuevos datos en desarrollo: <pre><code>python3 manage.py dumpdata &gt; db2.json\n</code></pre></p> <p>Subir cambios desde desarrollo: <pre><code>git add .\ngit commit -am \"nueva tabla\"\ngit push\n</code></pre></p> <p>Bajar cambios en producci\u00f3n: <pre><code>git pull\n</code></pre></p> <p>Creo la tabla: <pre><code>python manage.py migrate\n</code></pre></p> <p>Cargo los datos: <pre><code>python3 manage.py loaddata db2.json\n</code></pre></p> <p>Reinicio gunicorn para que actualice la configuraci\u00f3n: <pre><code>sudo systemctl restart gunicorn-django-tutorial.service\n</code></pre></p> <p>Prueba en producci\u00f3n:</p> <p></p>"},{"location":"iaw/practica-docker-php/","title":"Pr\u00e1ctica: BookMedik en Docker","text":""},{"location":"iaw/practica-docker-php/#info-previa","title":"Info previa","text":"<p>Crearemos varias versiones de una imagen de BookMedik que implantaremos.</p>"},{"location":"iaw/practica-docker-php/#tarea-1-creacion-de-una-imagen-docker-con-una-aplicacion-web-desde-una-imagen-base","title":"Tarea 1: Creaci\u00f3n de una imagen docker con una aplicaci\u00f3n web desde una imagen base","text":"<p>Muestro el directorio donde construir\u00e9 la imagen:</p> <pre><code>atlas@olympus:~/docker/bookmedikv1build$ ls -la\ntotal 8\ndrwxr-xr-x  2 atlas atlas 4096 Jun 18 15:47 .\ndrwxr-xr-x 19 atlas atlas 4096 Jun 18 15:47 ..\n</code></pre> <p>Me bajo aqu\u00ed el c\u00f3digo de BookMedik:</p> <pre><code>atlas@olympus:~/docker/bookmedikv1build$ git clone https://github.com/evilnapsis/bookmedik.git\nCloning into 'bookmedik'...\nremote: Enumerating objects: 856, done.\nremote: Total 856 (delta 0), reused 0 (delta 0), pack-reused 856\nReceiving objects: 100% (856/856), 1.90 MiB | 2.25 MiB/s, done.\nResolving deltas: 100% (372/372), done.\natlas@olympus:~/docker/bookmedikv1build$ ls -la\ntotal 12\ndrwxr-xr-x  3 atlas atlas 4096 Jun 18 16:46 .\ndrwxr-xr-x 19 atlas atlas 4096 Jun 18 15:47 ..\ndrwxr-xr-x  7 atlas atlas 4096 Jun 18 16:46 bookmedik\n</code></pre> <p>Elimino las siguientes l\u00edneas de <code>schema.sql</code>:</p> <pre><code>create database bookmedik;\nuse bookmedik;\n</code></pre> <p>Modifico <code>core/controller/Database.php</code> de la siguiente manera:</p> <pre><code>&lt;?php\nclass Database {\n    public static $db;\n    public static $con;\n    function Database(){\n            $this-&gt;user=getenv('BOOKMEDIK_DB_USER');$this-&gt;pass=getenv('BOOKMEDIK_DB_PASSWORD');$this-&gt;host=getenv('BOOKMEDIK_DB_HOST');$this-&gt;ddbb=getenv('BOOKMEDIK_DB_NAME');\n    }\n    function connect(){\n            $con = new mysqli($this-&gt;host,$this-&gt;user,$this-&gt;pass,$this-&gt;ddbb);\n            $con-&gt;query(\"set sql_mode=''\");\n            return $con;\n    }\n    public static function getCon(){\n            if(self::$con==null &amp;&amp; self::$db==null){\n                        self::$db = new Database();\n                        self::$con = self::$db-&gt;connect();\n            }\n            return self::$con;\n    }\n}\n?&gt;\n</code></pre> <p>Creo aqu\u00ed <code>script.sh</code>:</p> <pre><code>#! /bin/sh\n\nsleep 10\nmysql -u $BOOKMEDIK_DB_USER --password=$BOOKMEDIK_DB_PASSWORD -h $BOOKMEDIK_DB_HOST $BOOKMEDIK_DB_NAME &lt; /var/www/html/schema.sql\n/usr/sbin/apache2ctl -D FOREGROUND\n</code></pre> <p>Crear\u00e9 el siguiente <code>Dockerfile</code>:</p> <pre><code>FROM debian\nMAINTAINER Adri\u00e1n Jaramillo Rodr\u00edguez \"adristudy@gmail.com\"\nRUN apt-get update &amp;&amp; apt-get install -y apache2 libapache2-mod-php php php-mysql mariadb-client &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nRUN rm /var/www/html/index.html\nADD bookmedik /var/www/html/\nADD script.sh /opt/\nRUN chmod +x /opt/script.sh\nEXPOSE 80\nENTRYPOINT [\"/opt/script.sh\"]\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/bookmedik:v1 .\n</code></pre>"},{"location":"iaw/practica-docker-php/#entregas-tarea-1","title":"Entregas tarea 1","text":"<p>Repositorio para la generaci\u00f3n de la imagen v1</p> <p>Imagen generada localmente:</p> <p></p>"},{"location":"iaw/practica-docker-php/#tarea-2-despliegue-en-el-entorno-de-desarrollo","title":"Tarea 2: Despliegue en el entorno de desarrollo","text":"<p>Muestro el directorio donde lanzar\u00e9 el escenario:</p> <pre><code>atlas@olympus:~/docker/bookmedikescenario$ ls -la\ntotal 8\ndrwxr-xr-x  2 atlas atlas 4096 Jun 18 18:08 .\ndrwxr-xr-x 20 atlas atlas 4096 Jun 18 18:08 ..\n</code></pre> <p>Crear\u00e9 el siguiente <code>docker-compose.yml</code>:</p> <pre><code>version: '3.1'\nservices:\n  bookmedik:\n    container_name: bookmedik\n    image: adrianjaramillo/bookmedik:v1\n    restart: always\n    environment:\n      BOOKMEDIK_DB_USER: bookmedik_user\n      BOOKMEDIK_DB_PASSWORD: bookmedik_pass\n      BOOKMEDIK_DB_NAME: bookmedik\n      BOOKMEDIK_DB_HOST: mariadb\n    ports:\n      - 80:80\n    depends_on:\n      - mariadb\n    volumes:\n      - bookmedik_logs:/var/log/apache2\n  mariadb:\n    container_name: mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MARIADB_DATABASE: bookmedik\n      MARIADB_USER: bookmedik_user\n      MARIADB_PASSWORD: bookmedik_pass\n      MARIADB_ROOT_PASSWORD: root\n    volumes:\n      - mariadb_data:/var/lib/mysql\nvolumes:\n    bookmedik_logs:\n    mariadb_data:\n</code></pre> <p>Lanzo los contenedores:</p> <pre><code>atlas@olympus:~/docker/bookmedikescenario$ docker-compose up -d\nCreating network \"bookmedikescenario_default\" with the default driver\nCreating volume \"bookmedikescenario_bookmedik_logs\" with default driver\nCreating volume \"bookmedikescenario_mariadb_data\" with default driver\nCreating mariadb ... done\nCreating bookmedik ... done\n</code></pre>"},{"location":"iaw/practica-docker-php/#entregas-tarea-2","title":"Entregas tarea 2","text":"<p>Repositorio para la creaci\u00f3n del escenario</p> <p>Escenario funcionando:</p> <p></p> <p>BookMedik funcionando:</p> <p></p>"},{"location":"iaw/practica-docker-php/#tarea-3-creacion-de-una-imagen-docker-con-una-aplicacion-web-desde-una-imagen-php","title":"Tarea 3: Creaci\u00f3n de una imagen docker con una aplicaci\u00f3n web desde una imagen PHP","text":"<p>Copio el directorio de construcci\u00f3n de la imagen anterior, ya que esta versi\u00f3n de la imagen ser\u00e1 muy parecida a la anterior:</p> <pre><code>cp -r bookmedikv1build bookmedikv2build\n</code></pre> <p>Limpio el directorio <code>.git</code> antiguo:</p> <pre><code>sudo rm -r .git\n</code></pre> <p>Modifico el <code>Dockerfile</code>:</p> <pre><code>FROM php:7.4-apache\nMAINTAINER Adri\u00e1n Jaramillo Rodr\u00edguez \"adristudy@gmail.com\"\nRUN apt-get update &amp;&amp; apt-get install -y mariadb-client &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nRUN docker-php-ext-install mysqli pdo pdo_mysql &amp;&amp; docker-php-ext-enable pdo_mysql\nADD bookmedik /var/www/html/\nADD script.sh /opt/\nRUN chmod +x /opt/script.sh\nEXPOSE 80\nENTRYPOINT [\"/opt/script.sh\"]\n</code></pre> <p>Genero la imagen:</p> <pre><code>docker build -t adrianjaramillo/bookmedik:v2 .\n</code></pre> <p>Modifico el <code>docker-compose.yml</code> para que use la nueva imagen:</p> <pre><code>version: '3.1'\nservices:\n  bookmedik:\n    container_name: bookmedik\n    image: adrianjaramillo/bookmedik:v2\n    restart: always\n    environment:\n      BOOKMEDIK_DB_USER: bookmedik_user\n      BOOKMEDIK_DB_PASSWORD: bookmedik_pass\n      BOOKMEDIK_DB_NAME: bookmedik\n      BOOKMEDIK_DB_HOST: mariadb\n    ports:\n      - 80:80\n    depends_on:\n      - mariadb\n    volumes:\n      - bookmedik_logs:/var/log/apache2\n  mariadb:\n    container_name: mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MARIADB_DATABASE: bookmedik\n      MARIADB_USER: bookmedik_user\n      MARIADB_PASSWORD: bookmedik_pass\n      MARIADB_ROOT_PASSWORD: root\n    volumes:\n      - mariadb_data:/var/lib/mysql\nvolumes:\n    bookmedik_logs:\n    mariadb_data:\n</code></pre> <p>Lanzo los contenedores:</p> <pre><code>atlas@olympus:~/docker/bookmedikescenario$ docker-compose up -d\nCreating network \"bookmedikescenario_default\" with the default driver\nCreating volume \"bookmedikescenario_bookmedik_logs\" with default driver\nCreating volume \"bookmedikescenario_mariadb_data\" with default driver\nCreating mariadb ... done\nCreating bookmedik ... done\n</code></pre>"},{"location":"iaw/practica-docker-php/#entregas-tarea-3","title":"Entregas tarea 3","text":"<p>Repositorio para la generaci\u00f3n de la imagen v2</p> <p>Imagen generada localmente:</p> <p></p> <p>Escenario funcionando:</p> <p></p> <p>BookMedik funcionando:</p> <p></p>"},{"location":"iaw/practica-docker-php/#tarea-5-puesta-en-produccion-de-nuestra-aplicacion","title":"Tarea 5: Puesta en producci\u00f3n de nuestra aplicaci\u00f3n","text":""},{"location":"iaw/practica-docker-php/#renovacion-de-certificado","title":"Renovaci\u00f3n de certificado","text":"<p>Voy a documentar una situaci\u00f3n que se me ha dado personalmente al intentar poner en producci\u00f3n la imagen de Docker, que no se pide expl\u00edcitamente que se documente durante la pr\u00e1ctica, pero que me parece de vital importancia el saber hacerlo porque es algo que nos puede suceder a todos durante el curso....</p> <p>\u00a1Mi certificado Let's Encrypt ha expirado, necesita renovaci\u00f3n!</p> <p>En mi caso era un wilcard para <code>*.adrianjaramillo.tk</code>, por lo que para renovarlo b\u00e1sicamente tenemos que repetir el proceso que hicimos para su primera expedici\u00f3n.</p> <p>Por ahora, muestro que tenemos un error de certificado expirado:</p> <p></p> <p>Inicio la petici\u00f3n del certificado:</p> <pre><code>blackmamba@kampe:~$ sudo certbot certonly --manual --preferred-challenges dns -d *.adrianjaramillo.tk\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator manual, Installer None\nCert is due for renewal, auto-renewing...\nRenewing an existing certificate for *.adrianjaramillo.tk\nPerforming the following challenges:\ndns-01 challenge for adrianjaramillo.tk\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPlease deploy a DNS TXT record under the name\n_acme-challenge.adrianjaramillo.tk with the following value:\nK2G9aLEv8hrXEthRTua27QfKkXyI8iWCAkh8NntOcmQ\nBefore continuing, verify the record is deployed.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPress Enter to Continue\n</code></pre> <p>Cerbot se ha dado cuenta de que el certificado ha expirado y necesita renovaci\u00f3n, es decir, sabe que no est\u00e1 pidiendo un certificado nuevo.</p> <p>A\u00f1ado el siguiente registro a mi DNS:</p> <p></p> <p>Tras comprobar con un <code>dig</code> que el registro se ha publicado, finalizo la renovaci\u00f3n:</p> <pre><code>blackmamba@kampe:~$ sudo certbot certonly --manual --preferred-challenges dns -d *.adrianjaramillo.tk\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator manual, Installer None\nCert is due for renewal, auto-renewing...\nRenewing an existing certificate for *.adrianjaramillo.tk\nPerforming the following challenges:\ndns-01 challenge for adrianjaramillo.tk\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPlease deploy a DNS TXT record under the name\n_acme-challenge.adrianjaramillo.tk with the following value:\nK2G9aLEv8hrXEthRTua27QfKkXyI8iWCAkh8NntOcmQ\nBefore continuing, verify the record is deployed.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPress Enter to Continue\nWaiting for verification...\nCleaning up challenges\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at:\n   /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem\n   Your key file has been saved at:\n   /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem\n   Your certificate will expire on 2022-09-17. To obtain a new or\n   tweaked version of this certificate in the future, simply run\n   certbot again. To non-interactively renew *all* of your\n   certificates, run \"certbot renew\"\n - If you like Certbot, please consider supporting our work by:\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n</code></pre> <p>Verifico que el certificado est\u00e1 renovado y vuelve a ser v\u00e1lido:</p> <pre><code>blackmamba@kampe:~$ sudo certbot certificates\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nFound the following certs:\n  Certificate Name: adrianjaramillo.tk\n    Serial Number: 4ebd40230aa2fa7404df1db4bb401513314\n    Key Type: RSA\n    Domains: *.adrianjaramillo.tk\n    Expiry Date: 2022-09-17 12:04:09+00:00 (VALID: 89 days)\n    Certificate Path: /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem\n    Private Key Path: /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n</code></pre> <p>Es necesario reiniciar Nginx ya que si no se hace, no ofrecer\u00e1 el certificado renovado:</p> <pre><code>sudo systemctl restart nginx\n</code></pre> <p>Muestro que ya tengo acceso a mi web sin problemas:</p> <p></p>"},{"location":"iaw/practica-docker-php/#publicacion-de-imagen","title":"Publicaci\u00f3n de imagen","text":"<p>Subo la <code>v2</code> a Docker Hub:</p> <pre><code>atlas@olympus:~$ docker push adrianjaramillo/bookmedik:v2\nThe push refers to repository [docker.io/adrianjaramillo/bookmedik]\n1010d1bbc144: Pushed\n771eec85b637: Pushed\n6f115feedd78: Pushed\nce64b16b53a7: Pushed\n1cb3eb48df9d: Pushed\n7480afd8fa60: Mounted from library/wordpress\n027c5bd47ef8: Mounted from library/wordpress\n13b107c2dc5f: Mounted from library/wordpress\n484b057405b5: Mounted from library/wordpress\na9157dcd056e: Mounted from library/wordpress\n73d6f16bc909: Mounted from library/wordpress\nff48eea959aa: Mounted from library/wordpress\ne71e1bcde4cb: Mounted from library/wordpress\nc41e2fe9ff49: Mounted from library/wordpress\nfc39acdd710d: Mounted from library/wordpress\ndf29ad355f78: Mounted from library/wordpress\nca59c88c69a3: Mounted from library/wordpress\nad6562704f37: Mounted from adrianjaramillo/mi_servidor_web\nv2: digest: sha256:77c06993dcf3988354fcc79eb86506fbc01bf7031690a0f72b80bd2c031cb0bc size: 4081\n</code></pre>"},{"location":"iaw/practica-docker-php/#registro-dns","title":"Registro DNS","text":""},{"location":"iaw/practica-docker-php/#preparacion-de-docker-en-vps","title":"Preparaci\u00f3n de Docker en VPS","text":"<pre><code>sudo apt update\nsudo apt install docker.io\nsudo usermod -aG docker blackmamba\nsudo apt install docker-compose\n</code></pre>"},{"location":"iaw/practica-docker-php/#preparacion-de-nginx","title":"Preparaci\u00f3n de Nginx","text":"<p>Configurar\u00e9 el par de VirtualHosts (HTTP y HTTPS) para BookMedik.</p> <p><code>bookmedik_http.conf</code>:</p> <pre><code>server {\n    listen 80;\n    server_name bookmedik.adrianjaramillo.tk;\n    return 301 https://$host$request_uri;\n}\n</code></pre> <p>Lo activo:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/bookmedik_http.conf /etc/nginx/sites-enabled/\n</code></pre> <p><code>bookmedik_https.conf</code>:</p> <pre><code>server {\n    listen 443 ssl;\n    server_name bookmedik.adrianjaramillo.tk;\n    ###################\n    # RSA certificate #\n    ###################\n    ssl_certificate /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n    #############\n    # Locations #\n    #############\n    location / {\n        proxy_pass http://localhost:8081;\n        include proxy_params;\n    }\n}\n</code></pre> <p>Lo activo:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/bookmedik_https.conf /etc/nginx/sites-enabled/\n</code></pre> <p>Reinicio Nginx:</p> <pre><code>sudo systemctl restart nginx\n</code></pre>"},{"location":"iaw/practica-docker-php/#despliegue-de-bookmedik","title":"Despliegue de BookMedik","text":"<p>Clono mi repositorio que tiene el <code>docker-compose.yml</code> que necesito:</p> <pre><code>blackmamba@kampe:~/docker$ git clone git@github.com:adriasir123/bookmedik-escenario.git\nCloning into 'bookmedik-escenario'...\nWarning: Permanently added the ECDSA host key for IP address '140.82.121.3' to the list of known hosts.\nremote: Enumerating objects: 6, done.\nremote: Counting objects: 100% (6/6), done.\nremote: Compressing objects: 100% (3/3), done.\nremote: Total 6 (delta 1), reused 6 (delta 1), pack-reused 0\nReceiving objects: 100% (6/6), done.\nResolving deltas: 100% (1/1), done.\n</code></pre> <p>Cambio el puerto real en el que se servir\u00e1 BookMedik, ya que el 80 y el 8080 los tengo ocupados en mi VPS:</p> <pre><code>version: '3.1'\nservices:\n  bookmedik:\n    container_name: bookmedik\n    image: adrianjaramillo/bookmedik:v2\n    restart: always\n    environment:\n      BOOKMEDIK_DB_USER: bookmedik_user\n      BOOKMEDIK_DB_PASSWORD: bookmedik_pass\n      BOOKMEDIK_DB_NAME: bookmedik\n      BOOKMEDIK_DB_HOST: mariadb\n    ports:\n      - 8081:80\n    depends_on:\n      - mariadb\n    volumes:\n      - bookmedik_logs:/var/log/apache2\n  mariadb:\n    container_name: mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MARIADB_DATABASE: bookmedik\n      MARIADB_USER: bookmedik_user\n      MARIADB_PASSWORD: bookmedik_pass\n      MARIADB_ROOT_PASSWORD: root\n    volumes:\n      - mariadb_data:/var/lib/mysql\nvolumes:\n    bookmedik_logs:\n    mariadb_data:\n</code></pre> <p>Me bajo las im\u00e1genes:</p> <pre><code>blackmamba@kampe:~/docker/bookmedik-escenario$ docker pull adrianjaramillo/bookmedik:v2\nv2: Pulling from adrianjaramillo/bookmedik\n42c077c10790: Pull complete\n8934009a9160: Pull complete\n5357ac116991: Pull complete\n54ae63894b5a: Pull complete\n772088206f85: Pull complete\n3b81c5474649: Pull complete\nc62a528527ae: Pull complete\n344c792709d4: Pull complete\nef9638273c35: Pull complete\n4ec70638e42f: Pull complete\n5a0f65f5bb3b: Pull complete\n55578a5ce5e8: Pull complete\nf1dd85b4dfa5: Pull complete\nf42db0cb760d: Pull complete\n3fe0a43063d9: Pull complete\n5630d2e894d6: Pull complete\n1178877b058a: Pull complete\n8a3b5072a55a: Pull complete\nDigest: sha256:77c06993dcf3988354fcc79eb86506fbc01bf7031690a0f72b80bd2c031cb0bc\nStatus: Downloaded newer image for adrianjaramillo/bookmedik:v2\ndocker.io/adrianjaramillo/bookmedik:v2\nblackmamba@kampe:~/docker/bookmedik-escenario$ docker pull mariadb\nUsing default tag: latest\nlatest: Pulling from library/mariadb\n405f018f9d1d: Pull complete\n7a85079b8234: Pull complete\n579c7ff691b1: Pull complete\n4976663b5d6d: Pull complete\n169024b1fb13: Pull complete\nc0ffe8ce897f: Pull complete\nb583c09d23c3: Pull complete\n9b9f0c08d08f: Pull complete\n9cd51f984586: Pull complete\nd9f506bb8aca: Pull complete\n24d689f79ba4: Pull complete\nDigest: sha256:88fcb7d92c7f61cd885c4d309c98461f3607aa6dbd57a2474be86e1956b36d13\nStatus: Downloaded newer image for mariadb:latest\ndocker.io/library/mariadb:latest\n</code></pre> <p>Compruebo que las tengo:</p> <pre><code>blackmamba@kampe:~/docker/bookmedik-escenario$ docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED        SIZE\nadrianjaramillo/bookmedik   v2        64331ad6b6f9   15 hours ago   496MB\nmariadb                     latest    ea81af801379   12 days ago    383MB\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>blackmamba@kampe:~/docker/bookmedik-escenario$ docker-compose up -d\nCreating network \"bookmedik-escenario_default\" with the default driver\nCreating volume \"bookmedik-escenario_bookmedik_logs\" with default driver\nCreating volume \"bookmedik-escenario_mariadb_data\" with default driver\nCreating mariadb ... done\nCreating bookmedik ... done\n</code></pre>"},{"location":"iaw/practica-docker-php/#entregas-tarea-5","title":"Entregas tarea 5","text":"<p>Muestro mi imagen v2 en Docker Hub:</p> <p></p> <p>Mi configuraci\u00f3n de Nginx ya se ha mostrado aqu\u00ed.</p> <p>BookMedik funcionando:</p> <p></p>"},{"location":"iaw/practica-docker-php/#tarea-6-modificacion-de-la-aplicacion","title":"Tarea 6: Modificaci\u00f3n de la aplicaci\u00f3n","text":""},{"location":"iaw/practica-docker-php/#cambios-en-desarrollo","title":"Cambios en desarrollo","text":"<p>En el directorio <code>bookmedikv1build</code> modificamos el fichero <code>core/app/view/login-view.php</code> de la siguiente manera:</p> <p></p> <p>Genero la nueva imagen:</p> <pre><code>atlas@olympus:~/docker/bookmedikv1build$ docker build -t adrianjaramillo/bookmedik:v1_2 .\nSending build context to Docker daemon  5.476MB\nStep 1/9 : FROM debian\n ---&gt; 4eacea30377a\nStep 2/9 : MAINTAINER Adri\u00e1n Jaramillo Rodr\u00edguez \"adristudy@gmail.com\"\n ---&gt; Using cache\n ---&gt; 377f4544c492\nStep 3/9 : RUN apt-get update &amp;&amp; apt-get install -y apache2 libapache2-mod-php php php-mysql mariadb-client &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\n ---&gt; Using cache\n ---&gt; 3edbcee70ef0\nStep 4/9 : RUN rm /var/www/html/index.html\n ---&gt; Using cache\n ---&gt; 765311b13ccf\nStep 5/9 : ADD bookmedik /var/www/html/\n ---&gt; e87b936760f4\nStep 6/9 : ADD script.sh /opt/\n ---&gt; 914ae2687446\nStep 7/9 : RUN chmod +x /opt/script.sh\n ---&gt; Running in 380ed8fa6f33\nRemoving intermediate container 380ed8fa6f33\n ---&gt; a70e0de4811d\nStep 8/9 : EXPOSE 80\n ---&gt; Running in 6162bc8d46b1\nRemoving intermediate container 6162bc8d46b1\n ---&gt; 9223c78cb164\nStep 9/9 : ENTRYPOINT [\"/opt/script.sh\"]\n ---&gt; Running in 76aadabd2773\nRemoving intermediate container 76aadabd2773\n ---&gt; 64141bbe8f9f\nSuccessfully built 64141bbe8f9f\nSuccessfully tagged adrianjaramillo/bookmedik:v1_2\n</code></pre> <p>Cambio el <code>docker-compose.yml</code> para que use esta nueva imagen:</p> <pre><code>version: '3.1'\nservices:\n  bookmedik:\n    container_name: bookmedik\n    image: adrianjaramillo/bookmedik:v1_2\n    restart: always\n    environment:\n      BOOKMEDIK_DB_USER: bookmedik_user\n      BOOKMEDIK_DB_PASSWORD: bookmedik_pass\n      BOOKMEDIK_DB_NAME: bookmedik\n      BOOKMEDIK_DB_HOST: mariadb\n    ports:\n      - 80:80\n    depends_on:\n      - mariadb\n    volumes:\n      - bookmedik_logs:/var/log/apache2\n  mariadb:\n    container_name: mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MARIADB_DATABASE: bookmedik\n      MARIADB_USER: bookmedik_user\n      MARIADB_PASSWORD: bookmedik_pass\n      MARIADB_ROOT_PASSWORD: root\n    volumes:\n      - mariadb_data:/var/lib/mysql\nvolumes:\n    bookmedik_logs:\n    mariadb_data:\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>atlas@olympus:~/docker/bookmedikescenario$ docker-compose up -d\nCreating network \"bookmedikescenario_default\" with the default driver\nCreating volume \"bookmedikescenario_bookmedik_logs\" with default driver\nCreating volume \"bookmedikescenario_mariadb_data\" with default driver\nCreating mariadb ... done\nCreating bookmedik ... done\n</code></pre> <p>Muestro que funciona:</p> <p></p> <p>Subo la <code>v1_2</code> a Docker Hub:</p> <pre><code>atlas@olympus:~/docker/bookmedikescenario$ docker push adrianjaramillo/bookmedik:v1_2\nThe push refers to repository [docker.io/adrianjaramillo/bookmedik]\nfe7b5820a058: Pushed\n6beeca6aa86e: Pushed\nb0e71684709a: Pushed\n67840b9e5228: Pushed\na43bb9feb494: Pushed\ne7597c345c2e: Mounted from library/tomcat\nv1_2: digest: sha256:26b318c747464015d068c04feebc513a4a9d96c67d7d8d7fbcee5aa92a0676d1 size: 1572\n</code></pre>"},{"location":"iaw/practica-docker-php/#cambios-en-produccion","title":"Cambios en producci\u00f3n","text":"<p>Me bajo la imagen <code>v1_2</code>:</p> <pre><code>blackmamba@kampe:~$ docker pull adrianjaramillo/bookmedik:v1_2\nv1_2: Pulling from adrianjaramillo/bookmedik\ne756f3fdd6a3: Pull complete\n1d676b04bbdd: Pull complete\n8d729c2d5900: Pull complete\n94ce319f9350: Pull complete\n9fc65713e191: Pull complete\n3553ab644f30: Pull complete\nDigest: sha256:26b318c747464015d068c04feebc513a4a9d96c67d7d8d7fbcee5aa92a0676d1\nStatus: Downloaded newer image for adrianjaramillo/bookmedik:v1_2\ndocker.io/adrianjaramillo/bookmedik:v1_2\n</code></pre> <p>Compruebo que la tengo:</p> <pre><code>blackmamba@kampe:~$ docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED          SIZE\nadrianjaramillo/bookmedik   v1_2      64141bbe8f9f   32 minutes ago   297MB\nadrianjaramillo/bookmedik   v2        64331ad6b6f9   17 hours ago     496MB\nmariadb                     latest    ea81af801379   12 days ago      383MB\n</code></pre> <p>Modifico el <code>docker-compose.yml</code> con la imagen <code>v1_2</code>:</p> <pre><code>version: '3.1'\nservices:\n  bookmedik:\n    container_name: bookmedik\n    image: adrianjaramillo/bookmedik:v1_2\n    restart: always\n    environment:\n      BOOKMEDIK_DB_USER: bookmedik_user\n      BOOKMEDIK_DB_PASSWORD: bookmedik_pass\n      BOOKMEDIK_DB_NAME: bookmedik\n      BOOKMEDIK_DB_HOST: mariadb\n    ports:\n      - 8081:80\n    depends_on:\n      - mariadb\n    volumes:\n      - bookmedik_logs:/var/log/apache2\n  mariadb:\n    container_name: mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MARIADB_DATABASE: bookmedik\n      MARIADB_USER: bookmedik_user\n      MARIADB_PASSWORD: bookmedik_pass\n      MARIADB_ROOT_PASSWORD: root\n    volumes:\n      - mariadb_data:/var/lib/mysql\nvolumes:\n    bookmedik_logs:\n    mariadb_data:\n</code></pre> <p>Tiro el escenario antiguo y levanto el nuevo:</p> <pre><code>blackmamba@kampe:~/docker/bookmedik-escenario$ docker-compose down -v\nStopping bookmedik ... done\nStopping mariadb   ... done\nRemoving bookmedik ... done\nRemoving mariadb   ... done\nRemoving network bookmedik-escenario_default\nRemoving volume bookmedik-escenario_bookmedik_logs\nRemoving volume bookmedik-escenario_mariadb_data\nblackmamba@kampe:~/docker/bookmedik-escenario$ docker-compose up -d\nCreating network \"bookmedik-escenario_default\" with the default driver\nCreating volume \"bookmedik-escenario_bookmedik_logs\" with default driver\nCreating volume \"bookmedik-escenario_mariadb_data\" with default driver\nCreating mariadb ... done\nCreating bookmedik ... done\n</code></pre> <p>Muestro que funciona</p> <p></p>"},{"location":"iaw/practica-docker-php/#entregas-tarea-6","title":"Entregas tarea 6","text":"<p>Muestro mi imagen <code>v1_2</code> en Docker Hub:</p> <p></p> <p>Mi <code>v1_2</code> funcionando ya se ha mostrado aqu\u00ed.</p>"},{"location":"iaw/practica-docker-python/","title":"Pr\u00e1ctica: Django tutorial en Docker","text":""},{"location":"iaw/practica-docker-python/#info-previa","title":"Info previa","text":"<p>Crearemos una imagen de Django tutorial que implantaremos.</p>"},{"location":"iaw/practica-docker-python/#paso-1-creacion-de-la-imagen","title":"Paso 1: Creaci\u00f3n de la imagen","text":"<p>Muestro el directorio donde construiremos:</p> <pre><code>atlas@olympus:~/docker/django-build$ ls -la\ntotal 8\ndrwxr-xr-x  2 atlas atlas 4096 Jun 20 00:23 .\ndrwxr-xr-x 22 atlas atlas 4096 Jun 20 00:23 ..\n</code></pre>"},{"location":"iaw/practica-docker-python/#descarga-del-codigo-original-y-cambios","title":"Descarga del c\u00f3digo original y cambios","text":"<p>Me bajo el c\u00f3digo:</p> <pre><code>atlas@olympus:~/docker/django-build$ git clone git@github.com:josedom24/django_tutorial.git\nCloning into 'django_tutorial'...\nremote: Enumerating objects: 153, done.\nremote: Total 153 (delta 0), reused 0 (delta 0), pack-reused 153\nReceiving objects: 100% (153/153), 4.25 MiB | 1.59 MiB/s, done.\nResolving deltas: 100% (50/50), done.\natlas@olympus:~/docker/django-build$ ls -la\ntotal 12\ndrwxr-xr-x  3 atlas atlas 4096 Jun 20 00:26 .\ndrwxr-xr-x 22 atlas atlas 4096 Jun 20 00:23 ..\ndrwxr-xr-x  5 atlas atlas 4096 Jun 20 00:27 django_tutorial\n</code></pre> <p>En la base del c\u00f3digo creo un directorio <code>static</code>:</p> <pre><code>atlas@olympus:~/docker/django-build/django_tutorial$ ls -la\ntotal 40\ndrwxr-xr-x 6 atlas atlas 4096 Jun 20 02:02 .\ndrwxr-xr-x 3 atlas atlas 4096 Jun 20 01:53 ..\ndrwxr-xr-x 2 atlas atlas 4096 Jun 20 01:59 django_tutorial\ndrwxr-xr-x 8 atlas atlas 4096 Jun 20 00:27 .git\n-rw-r--r-- 1 atlas atlas   91 Jun 20 00:27 .gitignore\n-rw-r--r-- 1 atlas atlas  671 Jun 20 00:27 manage.py\ndrwxr-xr-x 5 atlas atlas 4096 Jun 20 00:27 polls\n-rw-r--r-- 1 atlas atlas   91 Jun 20 00:27 README.md\n-rw-r--r-- 1 atlas atlas    7 Jun 20 00:27 requirements.txt\ndrwxr-xr-x 2 atlas atlas 4096 Jun 20 02:02 static\n</code></pre> <p>Personalizo un poco el c\u00f3digo, modificando el icono del IESGN en <code>django_tutorial/polls/templates/index.html</code>. En el body modifico lo siguiente:</p> <pre><code>      &lt;img src=\"https://64.media.tumblr.com/712c85234ad2f4654b08109761881933/tumblr_otq4duwzAB1voqnhpo2_250.png\" alt=\"DigitalOcean Logo\" width=\"100\" /&gt;\n</code></pre> <p>Modifico <code>settings.py</code> de la siguiente manera:</p> <pre><code>\"\"\"\nDjango settings for django_tutorial project.\nGenerated by 'django-admin startproject' using Django 3.1.3.\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/3.1/topics/settings/\nFor the full list of settings and their values, see\nhttps://docs.djangoproject.com/en/3.1/ref/settings/\n\"\"\"\nimport os\nfrom pathlib import Path\n# Build paths inside the project like this: BASE_DIR / 'subdir'.\nBASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\n# Quick-start development settings - unsuitable for production\n# See https://docs.djangoproject.com/en/3.1/howto/deployment/checklist/\n\n# SECURITY WARNING: keep the secret key used in production secret!\nSECRET_KEY = '9f0h)gozf$g%6igo8&amp;767w1xro0adm+)msxe)!eic$!fhvynb8'\n# SECURITY WARNING: don't run with debug turned on in production!\nDEBUG = True\nALLOWED_HOSTS = [os.environ.get(\"ALLOWED_HOSTS\")]\n# Application definition\n\nINSTALLED_APPS = [\n    'polls.apps.PollsConfig',\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n]\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n    'django.middleware.clickjacking.XFrameOptionsMiddleware',\n]\nROOT_URLCONF = 'django_tutorial.urls'\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [],\n        'APP_DIRS': True,\n        'OPTIONS': {\n            'context_processors': [\n                'django.template.context_processors.debug',\n                'django.template.context_processors.request',\n                'django.contrib.auth.context_processors.auth',\n                'django.contrib.messages.context_processors.messages',\n            ],\n        },\n    },\n]\nWSGI_APPLICATION = 'django_tutorial.wsgi.application'\n# Database\n# https://docs.djangoproject.com/en/3.1/ref/settings/#databases\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': os.environ.get(\"DJANGO_DB_NAME\"),\n        'USER': os.environ.get('DJANGO_DB_USER'),\n        'PASSWORD': os.environ.get(\"DJANGO_DB_PASSWORD\"),\n        'HOST': os.environ.get('DJANGO_DB_HOST'),\n        'PORT': '3306',\n    }\n}\n# Password validation\n# https://docs.djangoproject.com/en/3.1/ref/settings/#auth-password-validators\n\nAUTH_PASSWORD_VALIDATORS = [\n    {\n        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',\n    },\n]\n# Internationalization\n# https://docs.djangoproject.com/en/3.1/topics/i18n/\n\nLANGUAGE_CODE = 'en-us'\nTIME_ZONE = 'UTC'\nUSE_I18N = True\nUSE_L10N = True\nUSE_TZ = True\n# Static files (CSS, JavaScript, Images)\n# https://docs.djangoproject.com/en/3.1/howto/static-files/\n\nSTATIC_ROOT = os.path.join(BASE_DIR, 'static')\nSTATIC_URL = '/static/'\nCSRF_TRUSTED_ORIGINS = ['http://*.adrianjaramillo.tk','http://*.127.0.0.1','https://*.adrianjaramillo.tk','https://*.127.0.0.1']\nDEFAULT_AUTO_FIELD='django.db.models.AutoField'\n</code></pre>"},{"location":"iaw/practica-docker-python/#cambios-en-el-directorio-base","title":"Cambios en el directorio base","text":"<p>Creo <code>script.sh</code>:</p> <pre><code>#! /bin/sh\n\nsleep 10\npython3 manage.py makemigrations\npython3 manage.py migrate\npython3 manage.py createsuperuser --username $DJANGO_SUPERUSER_USERNAME --email $DJANGO_SUPERUSER_EMAIL --noinput\npython3 manage.py collectstatic --no-input\npython3 manage.py runserver 0.0.0.0:3000\n</code></pre> <p>Creo el <code>Dockerfile</code>:</p> <pre><code>FROM debian\nMAINTAINER Adri\u00e1n Jaramillo Rodr\u00edguez \"adristudy@gmail.com\"\nRUN apt-get update &amp;&amp; apt-get install -y python3-pip python3-dev default-libmysqlclient-dev build-essential &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nCOPY django_tutorial /usr/share/app\nADD script.sh /usr/share/app\nRUN chmod +x /usr/share/app/script.sh\nWORKDIR /usr/share/app\nRUN pip3 install --no-cache-dir -r requirements.txt\nRUN pip3 install mysqlclient\nEXPOSE 3000\nENTRYPOINT [\"/usr/share/app/script.sh\"]\n</code></pre>"},{"location":"iaw/practica-docker-python/#generacion-y-publicacion","title":"Generaci\u00f3n y publicaci\u00f3n","text":"<p>Genero:</p> <pre><code>docker build -t adrianjaramillo/django .\n</code></pre> <p>Publico:</p> <pre><code>atlas@olympus:~/docker/django-build$ docker push adrianjaramillo/django\nUsing default tag: latest\nThe push refers to repository [docker.io/adrianjaramillo/django]\n970fc0539140: Pushed\nb164ba16140b: Pushed\n51a4a55b26c1: Pushed\n137e2b7e3cb1: Pushed\n1e54713ae38a: Pushed\n3c8da5335d03: Pushed\ne7597c345c2e: Mounted from adrianjaramillo/bookmedik\nlatest: digest: sha256:3c398b1701511781690001089f970b4aeb4e4f470df886db19f4adf9595c0b7f size: 1788\n</code></pre>"},{"location":"iaw/practica-docker-python/#demostraciones-paso-1","title":"Demostraciones paso 1","text":"<p>Repositorio para la generaci\u00f3n de la imagen</p> <p>Imagen generada localmente:</p> <p></p> <p>Imagen en Docker Hub:</p> <p></p>"},{"location":"iaw/practica-docker-python/#paso-2-despliegue-en-desarrollo","title":"Paso 2: Despliegue en desarrollo","text":"<p>Muestro el directorio donde lanzar\u00e9 el escenario:</p> <pre><code>atlas@olympus:~/docker/django-escenario$ ls -la\ntotal 8\ndrwxr-xr-x  2 atlas atlas 4096 Jun 20 00:35 .\ndrwxr-xr-x 23 atlas atlas 4096 Jun 20 00:35 ..\n</code></pre> <p>Creo el siguiente <code>docker-compose.yml</code>:</p> <pre><code>version: '3.1'\nservices:\n  django:\n    container_name: django\n    image: adrianjaramillo/django\n    restart: always\n    environment:\n      ALLOWED_HOSTS: \"*\"\n      DJANGO_DB_USER: django_user\n      DJANGO_DB_PASSWORD: django_pass\n      DJANGO_DB_NAME: django\n      DJANGO_DB_HOST: django_mariadb\n      DJANGO_SUPERUSER_USERNAME: admin\n      DJANGO_SUPERUSER_PASSWORD: admin\n      DJANGO_SUPERUSER_EMAIL: admin@example.org\n    ports:\n      - 8082:3000\n    depends_on:\n      - django_db\n  django_db:\n    container_name: django_mariadb\n    image: mariadb\n    restart: always\n    environment:\n      MARIADB_DATABASE: django\n      MARIADB_USER: django_user\n      MARIADB_PASSWORD: django_pass\n      MARIADB_ROOT_PASSWORD: root\n    volumes:\n      - django_mariadb_data:/var/lib/mysql\nvolumes:\n    django_mariadb_data:\n</code></pre> <p>Lanzo los contenedores:</p> <pre><code>atlas@olympus:~/docker/django-escenario$ docker-compose up -d\nCreating network \"django-escenario_default\" with the default driver\nCreating volume \"django-escenario_django_mariadb_data\" with default driver\nCreating django_mariadb ... done\nCreating django         ... done\n</code></pre>"},{"location":"iaw/practica-docker-python/#demostraciones-paso-2","title":"Demostraciones paso 2","text":"<p>Repositorio para la creaci\u00f3n del escenario</p> <p>Escenario funcionando:</p> <p></p> <p>Django tutorial funcionando:</p> <p></p> <p></p>"},{"location":"iaw/practica-docker-python/#paso-3-puesta-en-produccion-en-la-vps","title":"Paso 3: Puesta en producci\u00f3n en la VPS","text":""},{"location":"iaw/practica-docker-python/#registro-dns","title":"Registro DNS","text":""},{"location":"iaw/practica-docker-python/#preparacion-de-nginx","title":"Preparaci\u00f3n de Nginx","text":"<p>Configurar\u00e9 el par de VirtualHosts (HTTP y HTTPS) para Django tutorial.</p> <p><code>djangotutorial_http.conf</code>:</p> <pre><code>server {\n    listen 80;\n    server_name djangotutorial.adrianjaramillo.tk;\n    return 301 https://$host$request_uri;\n}\n</code></pre> <p>Lo activo:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/djangotutorial_http.conf /etc/nginx/sites-enabled/\n</code></pre> <p><code>djangotutorial_https.conf</code>:</p> <pre><code>server {\n    listen 443 ssl;\n    server_name djangotutorial.adrianjaramillo.tk;\n    ###################\n    # RSA certificate #\n    ###################\n    ssl_certificate /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n    #############\n    # Locations #\n    #############\n    location / {\n        proxy_pass http://localhost:8082;\n        include proxy_params;\n    }\n}\n</code></pre> <p>Lo activo:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/djangotutorial_https.conf /etc/nginx/sites-enabled/\n</code></pre> <p>Reinicio Nginx:</p> <pre><code>sudo systemctl restart nginx\n</code></pre>"},{"location":"iaw/practica-docker-python/#despliegue-de-django-tutorial","title":"Despliegue de Django tutorial","text":"<p>Clono mi repositorio que tiene el <code>docker-compose.yml</code> que necesito:</p> <pre><code>blackmamba@kampe:~/docker$ git clone git@github.com:adriasir123/django-escenario.git\nCloning into 'django-escenario'...\nremote: Enumerating objects: 3, done.\nremote: Counting objects: 100% (3/3), done.\nremote: Compressing objects: 100% (2/2), done.\nremote: Total 3 (delta 0), reused 3 (delta 0), pack-reused 0\nReceiving objects: 100% (3/3), done.\n</code></pre> <p>Me bajo la imagen:</p> <pre><code>blackmamba@kampe:~/docker/django-escenario$ docker pull adrianjaramillo/django\nUsing default tag: latest\nlatest: Pulling from adrianjaramillo/django\ne756f3fdd6a3: Already exists\n8f5f46ed1055: Pull complete\n759268033427: Pull complete\ndac2fee9d4d5: Pull complete\nb8823c35e13b: Pull complete\nd03f9b37dc5f: Pull complete\n2741b7f5624c: Pull complete\nDigest: sha256:3c398b1701511781690001089f970b4aeb4e4f470df886db19f4adf9595c0b7f\nStatus: Downloaded newer image for adrianjaramillo/django:latest\ndocker.io/adrianjaramillo/django:latest\n</code></pre> <p>Compruebo que la tengo:</p> <pre><code>blackmamba@kampe:~/docker/django-escenario$ docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED          SIZE\nadrianjaramillo/django      latest    d11be0720035   50 minutes ago   548MB\nadrianjaramillo/bookmedik   v1_2      64141bbe8f9f   8 hours ago      297MB\nadrianjaramillo/bookmedik   v2        64331ad6b6f9   25 hours ago     496MB\nmariadb                     latest    ea81af801379   13 days ago      383MB\n</code></pre> <p>Lanzo el escenario:</p> <pre><code>blackmamba@kampe:~/docker/django-escenario$ docker-compose up -d\nCreating network \"django-escenario_default\" with the default driver\nCreating volume \"django-escenario_django_mariadb_data\" with default driver\nCreating django_mariadb ... done\nCreating django         ... done\n</code></pre>"},{"location":"iaw/practica-docker-python/#demostraciones-paso-3","title":"Demostraciones paso 3","text":"<p>Django tutorial funcionando:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/","title":"Pr\u00e1ctica 1: Implantaci\u00f3n de aplicaciones web PHP","text":""},{"location":"iaw/practica1-implantacion-apps-php/#tarea-0-preliminares","title":"Tarea 0: Preliminares","text":""},{"location":"iaw/practica1-implantacion-apps-php/#paso-1","title":"Paso 1","text":"<p>Mostrar escenario Vagrant</p> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :implantacionphp do |implantacionphp|\n    implantacionphp.vm.box = \"debian/bullseye64\"\n    implantacionphp.vm.hostname = \"implantacionphp\"\n  end\n\nend\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-2","title":"Paso 2","text":"<p>Instalar LAMP en esa m\u00e1quina</p> <pre><code>sudo apt update &amp;&amp; sudo apt -y upgrade\nsudo apt install mariadb-server\nsudo apt install apache2\nsudo chown -R www-data:www-data /var/www/\nsudo apt install php libapache2-mod-php php-cli php-fpm php-json php-pdo php-mysql php-zip php-gd php-mbstring php-curl php-xml php-pear php-bcmath\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#tarea-1-instalacion-de-phpbb-en-servidor-local","title":"Tarea 1: Instalaci\u00f3n de phpBB en servidor local","text":""},{"location":"iaw/practica1-implantacion-apps-php/#paso-1_1","title":"Paso 1","text":"<p>Crear VirtualHost con <code>ServerName</code> <code>www.adrianjaramillo-phpBB.org</code></p> <pre><code>&lt;VirtualHost *:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n\n    ServerName www.adrianjaramillo-phpBB.org\n    DocumentRoot /var/www/phpBB\n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre> <p>Lo habilito: <pre><code>sudo a2ensite phpBB.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># practica-implantacion-apps-php resolutions\n192.168.121.245 www.adrianjaramillo-phpBB.org\n</code></pre></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-2_1","title":"Paso 2","text":"<p>Crear BD para phpBB</p> <pre><code>CREATE DATABASE `phpBB_db`;\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-3","title":"Paso 3","text":"<p>Crear usuario con permisos sobre <code>phpBB_db</code></p> <pre><code>CREATE USER 'phpBB_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'phpBB_user'@localhost IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `phpBB_db`.* TO 'phpBB_user'@localhost;\n\nFLUSH PRIVILEGES;\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-4","title":"Paso 4","text":"<p>Descargar phpBB</p> <pre><code>sudo apt install unzip\nsudo wget https://download.phpbb.com/pub/release/3.3/3.3.5/phpBB-3.3.5.zip\nsudo unzip phpBB-3.3.5.zip\nsudo mv phpBB3 phpBB\n</code></pre> <p>Todo este proceso lo hago sobre <code>/var/www</code>, para que el directorio resultante coincida con el <code>DocumentRoot</code> del VirtualHost previamente configurado.</p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-5","title":"Paso 5","text":"<p>Instalaci\u00f3n de phpBB</p> <p>Credenciales para el usuario administrador:</p> <ul> <li>Usuario: admin</li> <li>Contrase\u00f1a: admin1</li> <li>Correo: adristudy@gmail.com</li> </ul> <p></p> <p>Introducimos los datos de conexi\u00f3n con la BD:</p> <p></p> <p>Configuraci\u00f3n del servidor:</p> <p></p> <p>Configuraci\u00f3n de email:</p> <p></p> <p>Configuraci\u00f3n del tabl\u00f3n:</p> <p></p> <p>Proceso de instalaci\u00f3n completado:</p> <p></p> <p>Vemos que phpBB ya est\u00e1 funcionando:</p> <p></p> <p>Tal como nos indica en ese mensaje, es importante que borremos el directorio <code>install</code> <pre><code>sudo rm -r install\n</code></pre></p> <p>A partir de ahora, s\u00ed que est\u00e1 funcionando phpBB completamente:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-6","title":"Paso 6","text":"<p>Cambiar el tema</p> <p>Descargo el tema \"Ultra Light\": <pre><code>wget https://www.phpbb.com/customise/db/download/192276 -P /tmp\n</code></pre></p> <p>Descomprimo el tema en el directorio requerido: <pre><code>sudo unzip 192276 -d /var/www/phpBB/styles/\n</code></pre></p> <p>Compruebo la estructura del tema para ver que se haya descomprimido correctamente: <pre><code>vagrant@implantacionphp:/var/www/phpBB/styles/ultra_light$ ls -la\ntotal 36\ndrwxr-xr-x 4 root     root      4096 Oct 28 07:36 .\ndrwxr-xr-x 5 www-data www-data  4096 Oct 28 07:36 ..\n-rw-rw-rw- 1 root     root     15405 Oct  4 09:26 license.txt\n-rw-rw-rw- 1 root     root       938 Oct  4 09:26 style.cfg\ndrwxr-xr-x 2 root     root      4096 Oct 28 07:36 template\ndrwxr-xr-x 5 root     root      4096 Oct 28 07:36 theme\n</code></pre></p> <p>En nuestro ACP (panel de administraci\u00f3n), instalamos el tema:</p> <p></p> <p>Se instal\u00f3 correctamente:</p> <p></p> <p>En el ACP, dentro de General -&gt; Board Configuration -&gt; Board settings, aplicamos el nuevo tema:</p> <p></p> <p>Muestro que ya funciona:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-7","title":"Paso 7","text":"<p>Crear contenido</p> <p>Hago un post de prueba en el foro:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-8","title":"Paso 8","text":"<p>Instalar una extensi\u00f3n a phpBB</p> <p>Descargo la extensi\u00f3n \"Media Embed PlugIn\": <pre><code>wget https://www.phpbb.com/customise/db/download/182026 -P /tmp\n</code></pre></p> <p>Descomprimo la extensi\u00f3n en el directorio requerido: <pre><code>sudo unzip 182026 -d /var/www/phpBB/ext/\n</code></pre></p> <p>Compruebo que se haya descomprimido correctamente: <pre><code>vagrant@implantacionphp:/var/www/phpBB/ext/phpbb/mediaembed$ ls -la\ntotal 80\ndrwxr-xr-x 12 root     root      4096 Oct 28 09:06 .\ndrwxr-xr-x  4 www-data www-data  4096 Oct 28 09:06 ..\n-rw-rw-rw-  1 root     root      2392 Aug 14  2020 CHANGELOG.md\ndrwxr-xr-x  2 root     root      4096 Oct 28 09:06 acp\ndrwxr-xr-x  3 root     root      4096 Oct 28 09:06 adm\ndrwxr-xr-x  2 root     root      4096 Oct 28 09:06 cache\ndrwxr-xr-x  3 root     root      4096 Oct 28 09:06 collection\n-rw-rw-rw-  1 root     root      1631 Aug 14  2020 composer.json\ndrwxr-xr-x  2 root     root      4096 Oct 28 09:06 config\ndrwxr-xr-x  2 root     root      4096 Oct 28 09:06 cron\ndrwxr-xr-x  2 root     root      4096 Oct 28 09:06 event\n-rw-rw-rw-  1 root     root      1946 Aug 14  2020 ext.php\ndrwxr-xr-x 19 root     root      4096 Oct 28 09:06 language\n-rw-rw-rw-  1 root     root     18092 Aug 14  2020 license.txt\ndrwxr-xr-x  2 root     root      4096 Oct 28 09:06 migrations\ndrwxr-xr-x  3 root     root      4096 Oct 28 09:06 styles\n</code></pre></p> <p>En nuestro ACP, habilitamos la extensi\u00f3n:</p> <p></p> <p>Mi extensi\u00f3n a\u00f1adida posibilita los v\u00eddeos embebidos en los posts. Muestro que funciona:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#tarea-2-configuracion-multinodo","title":"Tarea 2: Configuraci\u00f3n multinodo","text":""},{"location":"iaw/practica1-implantacion-apps-php/#paso-1_2","title":"Paso 1","text":"<p>Realizar backup de la base de datos</p> <pre><code>sudo mysqldump -u root phpBB_db &gt; phpBB_db_backup.sql\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-2_2","title":"Paso 2","text":"<p>Crear otra m\u00e1quina Vagrant, conectada con una red interna a la anterior</p> <p>Vagrantfile actualizado: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :implantacionphp do |implantacionphp|\n    implantacionphp.vm.box = \"debian/bullseye64\"\n    implantacionphp.vm.hostname = \"implantacionphp\"\n    implantacionphp.vm.network :private_network,\n      :libvirt__network_name =&gt; \"implantacionphpnet\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :dbserver do |dbserver|\n    dbserver.vm.box = \"debian/bullseye64\"\n    dbserver.vm.hostname = \"dbserver\"\n    dbserver.vm.network :private_network,\n      :libvirt__network_name =&gt; \"implantacionphpnet\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.3\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-3_1","title":"Paso 3","text":"<p>Instalar <code>mariadb-server</code> y crear la BD en la segunda m\u00e1quina</p> <pre><code>sudo apt update\nsudo apt install mariadb-server\nCREATE DATABASE `phpBB_db`;\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-4_1","title":"Paso 4","text":"<p>Crear usuario con privilegios sobre la nueva BD</p> <pre><code>CREATE USER 'phpBB_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'phpBB_user'@'%' IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `phpBB_db`.* TO 'phpBB_user'@'%';\n\nFLUSH PRIVILEGES;\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-5_1","title":"Paso 5","text":"<p>Restaurar la backup en la nueva BD</p> <pre><code>use phpBB_db;\nsource phpBB_db_backup.sql;\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-6_1","title":"Paso 6","text":"<p>Habilitar conexiones remotas en el nuevo servidor de BD</p> <p>En <code>/etc/mysql/mariadb.conf.d/50-server.cnf</code> modificar: <pre><code>bind-address            = 0.0.0.0\n</code></pre></p> <p>Reiniciar mariadb: <pre><code>sudo systemctl restart mariadb\n</code></pre></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-7_1","title":"Paso 7","text":"<p>Desinstalar mariadb en el servidor principal</p> <pre><code>sudo apt purge \"mariadb*\"\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-8_1","title":"Paso 8","text":"<p>Modificar <code>config.php</code> con los nuevos datos de conexi\u00f3n a la BD</p> <pre><code>&lt;?php\n// phpBB 3.3.x auto-generated configuration file\n// Do not change anything in this file!\n$dbms = 'phpbb\\\\db\\\\driver\\\\mysqli';\n$dbhost = '10.0.0.3';\n$dbport = '';\n$dbname = 'phpBB_db';\n$dbuser = 'phpBB_user';\n$dbpasswd = '1234';\n$table_prefix = 'phpbb_';\n$phpbb_adm_relative_path = 'adm/';\n$acm_type = 'phpbb\\\\cache\\\\driver\\\\file';\n\n@define('PHPBB_INSTALLED', true);\n@define('PHPBB_ENVIRONMENT', 'production');\n// @define('DEBUG_CONTAINER', true);\n</code></pre> <p>Solamente hemos modificado la variable <code>$dbhost</code>, porque lo \u00fanico que ha cambiado de la BD es la ubicaci\u00f3n.</p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-9","title":"Paso 9","text":"<p>Mostrar de nuevo phpBB funcionando</p> <p></p> <p>La \u00fanica diferencia es que ahora, se accede a la BD remotamente.</p>"},{"location":"iaw/practica1-implantacion-apps-php/#tarea-3-instalacion-de-concretecms","title":"Tarea 3: Instalaci\u00f3n de ConcreteCMS","text":""},{"location":"iaw/practica1-implantacion-apps-php/#paso-1_3","title":"Paso 1","text":"<p>Configurar otro VirtualHost, ahora con <code>ServerName</code> <code>www.adrianjaramillo-concretecms.org</code></p> <pre><code>&lt;VirtualHost *:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n\n    ServerName www.adrianjaramillo-concretecms.org\n    DocumentRoot /var/www/ConcreteCMS\n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre> <p>Lo habilito: <pre><code>sudo a2ensite ConcreteCMS.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># practica-implantacion-apps-php resolutions\n192.168.121.31 www.adrianjaramillo-phpBB.org\n192.168.121.31 www.adrianjaramillo-concretecms.org\n</code></pre></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-2_3","title":"Paso 2","text":"<p>Crear BD para ConcreteCMS</p> <pre><code>CREATE DATABASE `ConcreteCMS_db`;\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-3_2","title":"Paso 3","text":"<p>Crear usuario con permisos sobre <code>ConcreteCMS_db</code></p> <pre><code>CREATE USER 'ConcreteCMS_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'ConcreteCMS_user'@'%' IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `ConcreteCMS_db`.* TO 'ConcreteCMS_user'@'%';\n\nFLUSH PRIVILEGES;\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-4_2","title":"Paso 4","text":"<p>Descargar ConcreteCMS</p> <pre><code>sudo wget https://www.concretecms.com/download_file/61dab82f-fb01-47bc-8cf1-deffff890224\nsudo unzip 61dab82f-fb01-47bc-8cf1-deffff890224\nsudo mv concrete5-8.5.6 ConcreteCMS\n</code></pre> <p>Todo este proceso lo hago sobre <code>/var/www</code>, para que el directorio resultante coincida con el <code>DocumentRoot</code> del VirtualHost previamente configurado.</p> <p>ConcreteCMS va a necesitar escribir sobre su DocumentRoot, as\u00ed que cambiamos los propietarios a <code>www-data</code>: <pre><code>sudo chown -R www-data:www-data /var/www/ConcreteCMS\n</code></pre></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-5_2","title":"Paso 5","text":"<p>Instalaci\u00f3n de ConcreteCMS</p> <p>Accedemos a <code>www.adrianjaramillo-concretecms.org</code> y comenzamos:</p> <p></p> <p>Tenemos todos los requerimientos, as\u00ed que podemos seguir.</p> <p>Datos de la cuenta admin introducidos:</p> <ul> <li>Email: adristudy@gmail.com</li> <li>Username: admin (no aparece en la instalaci\u00f3n, pero es as\u00ed)</li> <li>Password: admin</li> </ul> <p>Datos de conexi\u00f3n a la BD introducidos:</p> <ul> <li>Server: 10.0.0.3</li> <li>Username: ConcreteCMS_user</li> <li>Password: 1234</li> <li>Database Name: ConcreteCMS_db</li> </ul> <p>Esos datos son los que a\u00f1ado en la instalaci\u00f3n:</p> <p></p> <p>ConcreteCMS se empieza a instalar:</p> <p></p> <p>Instalaci\u00f3n completada:</p> <p></p> <p>Vemos que la web funciona:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-6_2","title":"Paso 6","text":"<p>Cambiar el tema</p> <p>Paso el zip de mi m\u00e1quina al home de la VM: <pre><code>scp Downloads/theme_neat.zip vagrant@192.168.121.31:~/\n</code></pre></p> <p>No he podido pasar el zip directamente al directorio requerido, porque el usuario Vagrant no tiene permiso de escritura all\u00ed.</p> <p>Extraigo el zip en el directorio requerido: <pre><code>sudo unzip ~/theme_neat.zip -d /var/www/ConcreteCMS/packages\n</code></pre></p> <p>Para instalarlo, hacemos lo siguiente:</p> <p></p> <p>Para activarlo, hacemos lo siguiente:</p> <p></p> <p>Vemos que el tema se ha aplicado:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-7_2","title":"Paso 7","text":"<p>Crear contenido</p> <p>He creado una entrada en el blog, y muestro que funciona:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-8_2","title":"Paso 8","text":"<p>Instalar un add-on en ConcreteCMS</p> <p>Paso el zip de mi m\u00e1quina al home de la VM: <pre><code>scp Downloads/hw_back_to_top.zip vagrant@192.168.121.31:~/\n</code></pre></p> <p>Extraigo el zip en el directorio requerido: <pre><code>sudo unzip ~/hw_back_to_top.zip -d /var/www/ConcreteCMS/packages\n</code></pre></p> <p>Instalo el add-on:</p> <p></p> <p>Lo a\u00f1ado a la web:</p> <p></p> <p>Muestro que funciona:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#tarea-4-migracion-de-concretecms-a-hosting","title":"Tarea 4: Migraci\u00f3n de ConcreteCMS a hosting","text":""},{"location":"iaw/practica1-implantacion-apps-php/#paso-1_4","title":"Paso 1","text":"<p>Eligir un servicio de hosting con PHP y base de datos</p> <p>https://freehostingnoads.net/</p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-2_4","title":"Paso 2","text":"<p>Crear un subdominio gratuito</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-3_3","title":"Paso 3","text":"<p>Subir todo el DocumentRoot de ConcreteCMS usando FTP</p> <p>Instalo un cliente FTP: <pre><code>sudo apt show ncftp\n</code></pre></p> <p>Las credenciales FTP que me ofrece el hosting son las siguientes:</p> <ul> <li>FTP Username: 3976052</li> <li>FTP Password: concretecmsadmin1 (cambiada por m\u00ed)</li> <li>Hostname: concretecms.atwebpages.com</li> </ul> <p>Subo todo el DocumentRoot al directorio remoto (nos pregunta la contrase\u00f1a antes de empezar a subir ficheros):</p> <pre><code>ncftpput -R -v -u \"3976052\" concretecms.atwebpages.com /concretecms.atwebpages.com /var/www/ConcreteCMS/*\n</code></pre>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-4_3","title":"Paso 4","text":"<p>Crear BD</p> <p>Introduzco lo siguiente en el hosting para crear la BD:</p> <p></p> <p>Ya la tengo creada:</p> <p></p> <p>Mi hosting por motivos de seguridad no permite las conexiones remotas a la BD, as\u00ed que...</p> <p>Exporto la BD: <pre><code>sudo mysqldump -u root ConcreteCMS_db &gt; ConcreteCMS_db_backup.sql\n</code></pre></p> <p>Paso el fichero a mi m\u00e1quina: <pre><code>scp ConcreteCMS_db_backup.sql atlas@192.168.121.1:~/Downloads\n</code></pre></p> <p>Importo la BD en mi hosting:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-5_3","title":"Paso 5","text":"<p>Modificar los datos de conexi\u00f3n a la BD</p> <p>Modifico el fichero <code>application/config/database.php</code> en el hosting de la siguiente manera:</p> <p></p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-6_3","title":"Paso 6","text":"<p>Borrar el directorio <code>application/files/cache/</code> en el hosting</p> <p>Este paso es MUY IMPORTANTE, porque tal y como dicen en la documentaci\u00f3n oficial de Concrete CMS sobre mover un site...</p> <p></p> <p>Si no borramos ese directorio con cach\u00e9, nuestra web no funcionar\u00e1.</p>"},{"location":"iaw/practica1-implantacion-apps-php/#paso-7_3","title":"Paso 7","text":"<p>Mostrar la web funcionando en el hosting</p> <p></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/","title":"Pr\u00e1ctica 2: Instalaci\u00f3n/migraci\u00f3n de aplicaciones web PHP en tu VPS","text":""},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#tarea-1-migracion-de-phpbb","title":"Tarea 1: Migraci\u00f3n de phpBB","text":""},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear VirtualHost con <code>server_name</code> <code>portal.adrianjaramillo.tk</code></p> <p>Creo <code>/etc/nginx/sites-available/portal.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name portal.adrianjaramillo.tk;\n    root /var/www/portal;\n\n    location / {\n        index index.php index.html index.htm;\n    }\n\n    location ~ \\.php$ {\n        include        fastcgi_params;\n        fastcgi_pass   unix:/run/php/php7.4-fpm.sock;\n        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    }\n\n}\n</code></pre></p> <p>Lo habilito: <pre><code>sudo ln -s /etc/nginx/sites-available/portal.conf /etc/nginx/sites-enabled/\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Creo un registro CNAME en la zona DNS p\u00fablica para <code>portal.adrianjaramillo.tk</code>:</p> <p></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#ejercicio-2","title":"Ejercicio 2","text":"<p>Nombrar en <code>/etc/hosts</code> la BD como <code>bd.adrianjaramillo.tk</code></p> <p>Modifico la siguiente l\u00ednea en <code>/etc/hosts</code>: <pre><code>127.0.0.1       localhost.localdomain localhost bd.adrianjaramillo.tk\n</code></pre></p> <p>Muestro que funciona: <pre><code>blackmamba@kampe:/etc/nginx/sites-available$ ping bd.adrianjaramillo.tk\nPING localhost.localdomain (127.0.0.1) 56(84) bytes of data.\n64 bytes from localhost.localdomain (127.0.0.1): icmp_seq=1 ttl=64 time=0.039 ms\n64 bytes from localhost.localdomain (127.0.0.1): icmp_seq=2 ttl=64 time=0.058 ms\n^C\n--- localhost.localdomain ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1031ms\nrtt min/avg/max/mdev = 0.039/0.048/0.058/0.009 ms\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#ejercicio-3","title":"Ejercicio 3","text":"<p>Realizar la migraci\u00f3n de phpBB.</p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-1","title":"Parte 1","text":"<p>Instalar las dependencias de paqueter\u00eda requeridas para que <code>phpBB</code> funcione</p> <pre><code>sudo apt install php-json php-mbstring php-xml php-mysql php-pdo php-zip php-gd php-curl php-pear php-bcmath\n</code></pre>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-2","title":"Parte 2","text":"<p>Transferir el DocumentRoot de <code>phpBB</code> al VPS mediante repositorios</p> <p>Hago una copia del DocumentRoot en el home: <pre><code>sudo cp -r /var/www/phpBB ~\n</code></pre></p> <p>Cambio los propietarios: <pre><code>sudo chown -R vagrant:vagrant ~/phpBB/\n</code></pre></p> <p>Inicializo el directorio como repo git: <pre><code>git init\n</code></pre></p> <p>Creo el repositorio en github: https://github.com/adriasir123/phpBB-document-root</p> <p>Subo el directorio al repositorio creado: <pre><code>git remote add origin git@github.com:adriasir123/phpBB-document-root.git\ngit branch -M main\ngit add .\ngit config --global user.email \"adristudy@gmail.com\"\ngit config --global user.name \"Adri\u00e1n Jaramillo Rodr\u00edguez\"\ngit commit -m \"Initial commit\"\ngit push -u origin main\n</code></pre></p> <p>Me bajo el repositorio en <code>/var/www/portal</code> del VPS: <pre><code>sudo git clone https://github.com/adriasir123/phpBB-document-root.git .\n</code></pre></p> <p>Modifico los propietarios correctamente en <code>/var/www/portal/</code>: <pre><code>sudo chown -R www-data:www-data /var/www/portal/\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-3","title":"Parte 3","text":"<p>Migrar la BD al VPS</p> <p>Exporto la BD: <pre><code>sudo mysqldump -u root phpBB_db &gt; phpBB_db.sql\n</code></pre></p> <p>Creo la BD en el VPS: <pre><code>CREATE DATABASE `phpBB_db`;\n</code></pre></p> <p>Creo un usuario con permisos sobre <code>phpBB_db</code>:</p> <pre><code>CREATE USER 'phpBB_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'phpBB_user'@localhost IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `phpBB_db`.* TO 'phpBB_user'@localhost;\n\nFLUSH PRIVILEGES;\n</code></pre> <p>Importo la copia de seguridad: <pre><code>sudo mysql -u root phpBB_db &lt; phpBB_db.sql\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-4","title":"Parte 4","text":"<p>Cambiar los datos de conexi\u00f3n a la base de datos</p> <p>Modifico la siguiente l\u00ednea en <code>config.php</code>: <pre><code>$dbhost = 'bd.adrianjaramillo.tk';\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#ejercicio-4","title":"Ejercicio 4","text":"<p>Comprobar que <code>phpBB</code> sigue funcionando en <code>portal.adrianjaramillo.tk</code></p> <p></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#tarea-2-instalacionmigracion-nextcloud","title":"Tarea 2: Instalaci\u00f3n/migraci\u00f3n Nextcloud","text":""},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#ejercicio-1_1","title":"Ejercicio 1","text":"<p>Instalar Nextcloud en el entorno de desarrollo.</p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-1_1","title":"Parte 1","text":"<p>Crear el escenario</p> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :nextcloudnginx do |nextcloudnginx|\n    nextcloudnginx.vm.box = \"debian/bullseye64\"\n    nextcloudnginx.vm.hostname = \"nextcloudnginx\"\n  end\n\nend\n</code></pre>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-2_1","title":"Parte 2","text":"<p>Instalar y configurar Nginx</p> <p>Lo instalo: <pre><code>sudo apt update\nsudo apt install curl gnupg2 ca-certificates lsb-release\nsudo apt install nginx\n</code></pre></p> <p>Creo <code>/etc/nginx/sites-available/nextcloud.conf</code>, con <code>server_name</code> <code>www.nextcloud-adrianj.com</code>: <pre><code>server {\n    listen 80;\n    server_name www.nextcloud-adrianj.com;\n\n    # Path to the root of the domain\n    root /var/www/nextcloud;\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n\n    location ^~ /.well-known {\n        # The rules in this block are an adaptation of the rules\n        # in the Nextcloud `.htaccess` that concern `/.well-known`.\n\n        location = /.well-known/carddav { return 301 /cloud/remote.php/dav/; }\n        location = /.well-known/caldav  { return 301 /cloud/remote.php/dav/; }\n\n        location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }\n        location /.well-known/pki-validation    { try_files $uri $uri/ =404; }\n\n        # Let Nextcloud's API for `/.well-known` URIs handle all other\n        # requests by passing them to the front-end controller.\n        return 301 /cloud/index.php$request_uri;\n    }\n\n    location ^~ /cloud {\n        # set max upload size and increase upload timeout:\n        client_max_body_size 512M;\n        client_body_timeout 300s;\n        fastcgi_buffers 64 4K;\n\n        # Enable gzip but do not remove ETag headers\n        gzip on;\n        gzip_vary on;\n        gzip_comp_level 4;\n        gzip_min_length 256;\n        gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;\n        gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;\n\n        # Pagespeed is not supported by Nextcloud, so if your server is built\n        # with the `ngx_pagespeed` module, uncomment this line to disable it.\n        #pagespeed off;\n\n        # HTTP response headers borrowed from Nextcloud `.htaccess`\n        add_header Referrer-Policy                      \"no-referrer\"   always;\n        add_header X-Content-Type-Options               \"nosniff\"       always;\n        add_header X-Download-Options                   \"noopen\"        always;\n        add_header X-Frame-Options                      \"SAMEORIGIN\"    always;\n        add_header X-Permitted-Cross-Domain-Policies    \"none\"          always;\n        add_header X-Robots-Tag                         \"none\"          always;\n        add_header X-XSS-Protection                     \"1; mode=block\" always;\n\n        # Remove X-Powered-By, which is an information leak\n        fastcgi_hide_header X-Powered-By;\n\n        # Specify how to handle directories -- specifying `/nextcloud/index.php$request_uri`\n        # here as the fallback means that Nginx always exhibits the desired behaviour\n        # when a client requests a path that corresponds to a directory that exists\n        # on the server. In particular, if that directory contains an index.php file,\n        # that file is correctly served; if it doesn't, then the request is passed to\n        # the front-end controller. This consistent behaviour means that we don't need\n        # to specify custom rules for certain paths (e.g. images and other assets,\n        # `/updater`, `/ocm-provider`, `/ocs-provider`), and thus\n        # `try_files $uri $uri/ /nextcloud/index.php$request_uri`\n        # always provides the desired behaviour.\n        index index.php index.html /cloud/index.php$request_uri;\n\n        # Rule borrowed from `.htaccess` to handle Microsoft DAV clients\n        location = /cloud {\n            if ( $http_user_agent ~ ^DavClnt ) {\n                return 302 /cloud/remote.php/webdav/$is_args$args;\n            }\n        }\n\n        # Rules borrowed from `.htaccess` to hide certain paths from clients\n        location ~ ^/cloud/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)    { return 404; }\n        location ~ ^/cloud/(?:\\.|autotest|occ|issue|indie|db_|console)                  { return 404; }\n\n        # Ensure this block, which passes PHP files to the PHP process, is above the blocks\n        # which handle static assets (as seen below). If this block is not declared first,\n        # then Nginx will encounter an infinite rewriting loop when it prepends\n        # `/nextcloud/index.php` to the URI, resulting in a HTTP 500 error response.\n        location ~ \\.php(?:$|/) {\n            # Required for legacy support\n            rewrite ^/cloud/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v[12]|updater\\/.+|oc[ms]-provider\\/.+|.+\\/richdocumentscode\\/proxy) /cloud/index.php$request_uri;\n\n            fastcgi_split_path_info ^(.+?\\.php)(/.*)$;\n            set $path_info $fastcgi_path_info;\n\n            try_files $fastcgi_script_name =404;\n\n            include fastcgi_params;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param PATH_INFO $path_info;\n\n            fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice\n            fastcgi_param front_controller_active true;     # Enable pretty urls\n            fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;\n\n            fastcgi_intercept_errors on;\n            fastcgi_request_buffering off;\n        }\n\n        location ~ \\.(?:css|js|svg|gif|png|jpg|ico)$ {\n            try_files $uri /cloud/index.php$request_uri;\n            expires 6M;         # Cache-Control policy borrowed from `.htaccess`\n            access_log off;     # Optional: Don't log access to assets\n        }\n\n        location ~ \\.woff2?$ {\n            try_files $uri /cloud/index.php$request_uri;\n            expires 7d;         # Cache-Control policy borrowed from `.htaccess`\n            access_log off;     # Optional: Don't log access to assets\n        }\n\n        # Rule borrowed from `.htaccess`\n        location /cloud/remote {\n            return 301 /cloud/remote.php$request_uri;\n        }\n\n        location /cloud {\n            try_files $uri $uri/ /cloud/index.php$request_uri;\n        }\n    }\n}\n</code></pre> Nextcloud no est\u00e1 oficialmente soportado para Nginx, as\u00ed que esta configuraci\u00f3n est\u00e1 hecha por contribuidores. Igualmente, est\u00e1 publicada en la documentaci\u00f3n oficial de Nextcloud: https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html#nextcloud-in-a-subdir-of-the-nginx-webroot Espec\u00edficamente, he elegido hacer la manera en subdirectorio, para que mi entorno de desarrollo y el de producci\u00f3n sean lo m\u00e1s parecidos posible. As\u00ed, la migraci\u00f3n luego ser\u00e1 m\u00e1s sencilla.</p> <p>Lo habilito: <pre><code>sudo ln -s /etc/nginx/sites-available/nextcloud.conf /etc/nginx/sites-enabled/\n</code></pre></p> <p>Compruebo que la configuraci\u00f3n sea correcta: <pre><code>sudo nginx -t\n</code></pre> <pre><code>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># nextcloudnginx resolutions\n192.168.121.62 www.nextcloud-adrianj.com\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-3_1","title":"Parte 3","text":"<p>Instalar y configurar php</p> <p>Instalo PHP-FPM y dependencias php para Nextcloud: <pre><code>sudo apt install php-fpm php-mysql php-zip php-xml php-mbstring php-gd php-curl php-cli php-common php-json php-intl php-pear php-imagick php-dev php-soap php-bz2\n</code></pre></p> <p>Modifico las siguientes l\u00edneas en <code>/etc/php/7.4/fpm/php.ini</code> y <code>/etc/php/7.4/cli/php.ini</code>: <pre><code>date.timezone = Europe/Madrid\ncgi.fix_pathinfo=0\n</code></pre></p> <p>Descomentar las siguientes l\u00edneas en <code>/etc/php/7.4/fpm/pool.d/www.conf</code>: <pre><code>env[HOSTNAME] = $HOSTNAME\nenv[PATH] = /usr/local/bin:/usr/bin:/bin\nenv[TMP] = /tmp\nenv[TMPDIR] = /tmp\nenv[TEMP] = /tmp\n</code></pre></p> <p>Habilito y reinicio php-fpm: <pre><code>sudo systemctl enable php7.4-fpm\nsudo systemctl restart php7.4-fpm\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-4_1","title":"Parte 4","text":"<p>Instalar servidor MariaDB</p> <pre><code>sudo apt install mariadb-server\n</code></pre> <p>Creo la BD para Nextcloud: <pre><code>CREATE DATABASE `nextcloud_db`;\n</code></pre></p> <p>Creo un usuario con permisos sobre <code>nextcloud_db</code>: <pre><code>CREATE USER 'nextcloud_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'nextcloud_user'@localhost IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `nextcloud_db`.* TO 'nextcloud_user'@localhost;\n\nFLUSH PRIVILEGES;\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-5","title":"Parte 5","text":"<p>Descargar Nextcloud</p> <p>En <code>/var/www/nextcloud</code> hago lo siguiente: <pre><code>sudo apt install unzip\nsudo wget https://download.nextcloud.com/server/releases/nextcloud-22.2.1.zip\nsudo unzip nextcloud-22.2.1.zip\nsudo mv nextcloud cloud\n</code></pre></p> <p>Cambio los propietarios: <pre><code>sudo chown -R www-data:www-data /var/www/nextcloud/\n</code></pre></p> <p>As\u00ed, consigo tener Nextcloud descargado en un directorio <code>cloud</code> dentro del Document Root <code>/var/www/nextcloud</code>, lo cual ser\u00e1 una situaci\u00f3n muy parecida a lo que tendr\u00e9 en el entorno de producci\u00f3n.</p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-6","title":"Parte 6","text":"<p>Instalaci\u00f3n de Nextcloud</p> <p>Para empezar, accedo a <code>www.nextcloud-adrianj.com/cloud</code></p> <p>Datos de la cuenta admin:</p> <ul> <li>Username: admin</li> <li>Password: admin1</li> </ul> <p>Introduciendo esos datos, junto con los de conexi\u00f3n a la BD, instalamos:</p> <p></p> <p>Despu\u00e9s de esto, ya tendr\u00edamos Nextcloud funcionando:</p> <p></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#ejercicio-2_1","title":"Ejercicio 2","text":"<p>Realizar la migraci\u00f3n de Nextcloud, para que se acceda en <code>www.adrianjaramillo.tk/cloud</code>.</p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-1_2","title":"Parte 1","text":"<p>Instalar dependencias y configurar php</p> <p>Instalo los siguientes paquetes necesarios para que Nextcloud funcione, y que faltan en el VPS: <pre><code>sudo apt install php-cli php-intl php-imagick php-dev php-soap php-bz2\n</code></pre></p> <p>Modifico las siguientes l\u00edneas en <code>/etc/php/7.4/fpm/php.ini</code> y <code>/etc/php/7.4/cli/php.ini</code>: <pre><code>date.timezone = Europe/Madrid\ncgi.fix_pathinfo=0\n</code></pre></p> <p>Descomentar las siguientes l\u00edneas en <code>/etc/php/7.4/fpm/pool.d/www.conf</code>: <pre><code>env[HOSTNAME] = $HOSTNAME\nenv[PATH] = /usr/local/bin:/usr/bin:/bin\nenv[TMP] = /tmp\nenv[TMPDIR] = /tmp\nenv[TEMP] = /tmp\n</code></pre></p> <p>Habilito y reinicio php-fpm: <pre><code>sudo systemctl enable php7.4-fpm\nsudo systemctl restart php7.4-fpm\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-2_2","title":"Parte 2","text":"<p>Transferir el subdirectorio de <code>Nextcloud</code> al VPS mediante repositorios</p> <p>Hago una copia del subdirectorio que contiene la app en el home: <pre><code>sudo cp -r /var/www/nextcloud/cloud ~\n</code></pre></p> <p>Cambio los propietarios: <pre><code>sudo chown -R vagrant:vagrant ~/cloud/\n</code></pre></p> <p>Inicializo el directorio como repo git: <pre><code>git init\n</code></pre></p> <p>Creo el repositorio en github: https://github.com/adriasir123/nextcloud-subdirectorio-cloud</p> <p>Subo el directorio al repositorio creado: <pre><code>git remote add origin git@github.com:adriasir123/nextcloud-subdirectorio-cloud.git\ngit branch -M main\ngit add .\ngit config --global user.email \"adristudy@gmail.com\"\ngit config --global user.name \"Adri\u00e1n Jaramillo Rodr\u00edguez\"\ngit commit -m \"Initial commit\"\ngit push -u origin main\n</code></pre></p> <p>Me bajo el repositorio en <code>/var/www/www/cloud</code> del VPS: <pre><code>sudo git clone https://github.com/adriasir123/nextcloud-subdirectorio-cloud.git .\n</code></pre></p> <p>Modifico los propietarios correctamente en <code>/var/www/www/cloud/</code>: <pre><code>sudo chown -R www-data:www-data /var/www/www/cloud/\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-3_2","title":"Parte 3","text":"<p>Migrar la BD al VPS</p> <p>Exporto la BD: <pre><code>sudo mysqldump -u root nextcloud_db &gt; nextcloud_db.sql\n</code></pre></p> <p>Creo la BD para Nextcloud: <pre><code>CREATE DATABASE `nextcloud_db`;\n</code></pre></p> <p>Creo un usuario con permisos sobre <code>nextcloud_db</code>: <pre><code>CREATE USER 'nextcloud_user' IDENTIFIED BY '1234';\n\nGRANT USAGE ON *.* TO 'nextcloud_user'@localhost IDENTIFIED BY '1234';\n\nGRANT ALL privileges ON `nextcloud_db`.* TO 'nextcloud_user'@localhost;\n\nFLUSH PRIVILEGES;\n</code></pre></p> <p>Importo la copia de seguridad: <pre><code>sudo mysql -u root nextcloud_db &lt; nextcloud_db.sql\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-4_2","title":"Parte 4","text":"<p>Cambiar el fichero de configuraci\u00f3n de Nextcloud</p> <p>Modifico <code>/var/www/www/cloud/config/config.php</code>: <pre><code>&lt;?php\n$CONFIG = array (\n  'instanceid' =&gt; 'ocr2lp6lisyt',\n  'passwordsalt' =&gt; 'RjrrSdcDyvgGXhx/Grnoccv298gljL',\n  'secret' =&gt; 'b7JkIA6v1+MGT70voUpA9XOvvMRVAc/PsgImxoDmYQytgHut',\n  'trusted_domains' =&gt;\n  array (\n    0 =&gt; 'www.adrianjaramillo.tk',\n  ),\n  'datadirectory' =&gt; '/var/www/www/cloud/data',\n  'dbtype' =&gt; 'mysql',\n  'version' =&gt; '22.2.1.2',\n  'overwrite.cli.url' =&gt; 'http://www.adrianjaramillo.tk/cloud',\n  'dbname' =&gt; 'nextcloud_db',\n  'dbhost' =&gt; 'bd.adrianjaramillo.tk',\n  'dbport' =&gt; '',\n  'dbtableprefix' =&gt; 'oc_',\n  'mysql.utf8mb4' =&gt; true,\n  'dbuser' =&gt; 'nextcloud_user',\n  'dbpassword' =&gt; '1234',\n  'installed' =&gt; true,\n);\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-5_1","title":"Parte 5","text":"<p>Configurar Nginx</p> <p>Hago una copia de seguridad del VirtualHost que voy a modificar: <pre><code>sudo cp www.conf www.conf.backup\n</code></pre></p> <p>Modifico <code>www.conf</code>: <pre><code>server {\n\n    ###########\n    # GENERAL #\n    ###########\n\n    listen 80;\n    server_name www.adrianjaramillo.tk;\n\n    root /var/www/www;\n    index index.html index.htm;\n\n    error_page 404 /error/404.html;\n    error_page 403 /error/403.html;\n\n    #############\n    # PRINCIPAL #\n    #############\n\n    rewrite ^/$ http://www.adrianjaramillo.tk/principal permanent;\n\n    location /principal {\n        autoindex off;\n        disable_symlinks on;\n    }\n\n    location /principal/documentos {\n        alias /srv/doc;\n        autoindex on;\n        disable_symlinks off;\n    }\n\n    location /secreto {\n        auth_basic \"Acceso restringido\";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n    }\n\n    #############\n    # NEXTCLOUD #\n    #############\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n\n    location ^~ /.well-known {\n        # The rules in this block are an adaptation of the rules\n        # in the Nextcloud `.htaccess` that concern `/.well-known`.\n\n        location = /.well-known/carddav { return 301 /cloud/remote.php/dav/; }\n        location = /.well-known/caldav  { return 301 /cloud/remote.php/dav/; }\n\n        location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }\n        location /.well-known/pki-validation    { try_files $uri $uri/ =404; }\n\n        # Let Nextcloud's API for `/.well-known` URIs handle all other\n        # requests by passing them to the front-end controller.\n        return 301 /cloud/index.php$request_uri;\n    }\n\n    location ^~ /cloud {\n        # set max upload size and increase upload timeout:\n        client_max_body_size 512M;\n        client_body_timeout 300s;\n        fastcgi_buffers 64 4K;\n\n        # Enable gzip but do not remove ETag headers\n        gzip on;\n        gzip_vary on;\n        gzip_comp_level 4;\n        gzip_min_length 256;\n        gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;\n        gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;\n\n        # Pagespeed is not supported by Nextcloud, so if your server is built\n        # with the `ngx_pagespeed` module, uncomment this line to disable it.\n        #pagespeed off;\n\n        # HTTP response headers borrowed from Nextcloud `.htaccess`\n        add_header Referrer-Policy                      \"no-referrer\"   always;\n        add_header X-Content-Type-Options               \"nosniff\"       always;\n        add_header X-Download-Options                   \"noopen\"        always;\n        add_header X-Frame-Options                      \"SAMEORIGIN\"    always;\n        add_header X-Permitted-Cross-Domain-Policies    \"none\"          always;\n        add_header X-Robots-Tag                         \"none\"          always;\n        add_header X-XSS-Protection                     \"1; mode=block\" always;\n\n        # Remove X-Powered-By, which is an information leak\n        fastcgi_hide_header X-Powered-By;\n\n        # Specify how to handle directories -- specifying `/nextcloud/index.php$request_uri`\n        # here as the fallback means that Nginx always exhibits the desired behaviour\n        # when a client requests a path that corresponds to a directory that exists\n        # on the server. In particular, if that directory contains an index.php file,\n        # that file is correctly served; if it doesn't, then the request is passed to\n        # the front-end controller. This consistent behaviour means that we don't need\n        # to specify custom rules for certain paths (e.g. images and other assets,\n        # `/updater`, `/ocm-provider`, `/ocs-provider`), and thus\n        # `try_files $uri $uri/ /nextcloud/index.php$request_uri`\n        # always provides the desired behaviour.\n        index index.php index.html /cloud/index.php$request_uri;\n\n        # Rule borrowed from `.htaccess` to handle Microsoft DAV clients\n        location = /cloud {\n            if ( $http_user_agent ~ ^DavClnt ) {\n                return 302 /cloud/remote.php/webdav/$is_args$args;\n            }\n        }\n\n        # Rules borrowed from `.htaccess` to hide certain paths from clients\n        location ~ ^/cloud/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)    { return 404; }\n        location ~ ^/cloud/(?:\\.|autotest|occ|issue|indie|db_|console)                  { return 404; }\n\n        # Ensure this block, which passes PHP files to the PHP process, is above the blocks\n        # which handle static assets (as seen below). If this block is not declared first,\n        # then Nginx will encounter an infinite rewriting loop when it prepends\n        # `/nextcloud/index.php` to the URI, resulting in a HTTP 500 error response.\n        location ~ \\.php(?:$|/) {\n            # Required for legacy support\n            rewrite ^/cloud/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v[12]|updater\\/.+|oc[ms]-provider\\/.+|.+\\/richdocumentscode\\/proxy) /cloud/index.php$request_uri;\n\n            fastcgi_split_path_info ^(.+?\\.php)(/.*)$;\n            set $path_info $fastcgi_path_info;\n\n            try_files $fastcgi_script_name =404;\n\n            include fastcgi_params;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param PATH_INFO $path_info;\n\n            fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice\n            fastcgi_param front_controller_active true;     # Enable pretty urls\n            fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;\n\n            fastcgi_intercept_errors on;\n            fastcgi_request_buffering off;\n        }\n\n        location ~ \\.(?:css|js|svg|gif|png|jpg|ico)$ {\n            try_files $uri /cloud/index.php$request_uri;\n            expires 6M;         # Cache-Control policy borrowed from `.htaccess`\n            access_log off;     # Optional: Don't log access to assets\n        }\n\n        location ~ \\.woff2?$ {\n            try_files $uri /cloud/index.php$request_uri;\n            expires 7d;         # Cache-Control policy borrowed from `.htaccess`\n            access_log off;     # Optional: Don't log access to assets\n        }\n\n        # Rule borrowed from `.htaccess`\n        location /cloud/remote {\n            return 301 /cloud/remote.php$request_uri;\n        }\n\n        location /cloud {\n            try_files $uri $uri/ /cloud/index.php$request_uri;\n        }\n    }\n}\n</code></pre></p> <p>Despu\u00e9s de esto, reinicio tanto Nginx como PHP-FPM para asegurarme de que no tendr\u00e9 problemas al hacer las pruebas: <pre><code>sudo systemctl restart nginx.service\nsudo systemctl restart php7.4-fpm.service\n</code></pre></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-6_1","title":"Parte 6","text":"<p>Comprobar que Nextcloud funciona en el VPS accediendo a <code>www.adrianjaramillo.tk/cloud</code></p> <p></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#parte-7","title":"Parte 7","text":"<p>Comprobar que la p\u00e1gina principal sigue funcionando, junto con las configuraciones que ten\u00eda</p> <p></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#ejercicio-3_1","title":"Ejercicio 3","text":"<p>Instalar en tu m\u00e1quina el cliente de Nextcloud y configurarlo para el acceso al VPS.</p> <p>Est\u00e1 disponible en los repositorios de Debian, por lo que: <pre><code>sudo apt update\nsudo apt install nextcloud-desktop\n</code></pre></p> <p>Paso a configurarlo:</p> <p></p> <p></p> <p>Nos pide autenticarnos desde el navegador antes de entrar:</p> <p></p> <p>El directorio local indicado, es el que se utilizar\u00e1 para la sincronizaci\u00f3n:</p> <p></p> <p>As\u00ed se ver\u00eda nuestro cliente despu\u00e9s de haber sincronizado y estar funcionando:</p> <p></p> <p>Abajo muestro el directorio local que me ha sincronizado el cliente:</p> <p></p>"},{"location":"iaw/practica2-instalacion-migracion-apps-PHP-en-VPS/#tarea-3","title":"Tarea 3","text":"<p>Modificar la web principal con accesos a las 2 apps migradas</p> <p></p>"},{"location":"openwebinars/fundamentos-plsql/","title":"Curso de fundamentos de PL/SQL","text":""},{"location":"openwebinars/fundamentos-plsql/#introduccion","title":"Introducci\u00f3n","text":"<p>https://livesql.oracle.com/apex/f?p=590:1000</p>"},{"location":"openwebinars/fundamentos-plsql/#fundamentos-de-plsql","title":"Fundamentos de PL/SQL","text":""},{"location":"openwebinars/fundamentos-plsql/#practica-utilizando-funciones-sql-en-plsql","title":"Pr\u00e1ctica: Utilizando funciones SQL en PL/SQL","text":"<p>NVL con variable nula:</p> <pre><code>DECLARE\nvv_micadena VARCHAR2(20 CHAR);\nBEGIN\nvv_micadena := NVL(vv_micadena, 'Cadena vacia');\nDBMS_OUTPUT.PUT_LINE('El valor de la variable vv_micadena es ' || vv_micadena);\nEND;\n/\n</code></pre> <pre><code>El valor de la variable vv_micadena es Cadena vacia\nPL/SQL procedure successfully completed.\n</code></pre> <p>NVL con variable con valor:</p> <pre><code>DECLARE\nvv_micadena VARCHAR2(20 CHAR) := 'Un valor';\nBEGIN\nvv_micadena := NVL(vv_micadena, 'Cadena vacia');\nDBMS_OUTPUT.PUT_LINE('El valor de la variable vv_micadena es ' || vv_micadena);\nEND;\n/\n</code></pre> <pre><code>El valor de la variable vv_micadena es Un valor\nPL/SQL procedure successfully completed.\n</code></pre> <p>Como la variable no era nula, la funci\u00f3n NVL no ha cambiado el resultado.</p> <p>LENGTH:</p> <pre><code>DECLARE\nvv_micadena VARCHAR2(20 CHAR) := 'Un valor';\nBEGIN\nDBMS_OUTPUT.PUT_LINE('La longitud de la variable vv_micadena es ' || LENGTH(vv_micadena));\nEND;\n/\n</code></pre> <pre><code>La longitud de la variable vv_micadena es 8\nPL/SQL procedure successfully completed.\n</code></pre> <p>ROUND:</p> <pre><code>DECLARE\nvn_mi_numero NUMBER(3, 2) := 7.77;\nBEGIN\nvn_mi_numero := ROUND(vn_mi_numero);\nDBMS_OUTPUT.PUT_LINE('El valor de vn_mi_numero es ' || vn_mi_numero);\nEND;\n/\n</code></pre> <pre><code>El valor de vn_mi_numero es 8\nPL/SQL procedure successfully completed.\n</code></pre> <p>Hasta 1 decimal:</p> <pre><code>DECLARE\nvn_mi_numero NUMBER(3, 2) := 7.77;\nBEGIN\nvn_mi_numero := ROUND(vn_mi_numero, 1);\nDBMS_OUTPUT.PUT_LINE('El valor de vn_mi_numero es ' || vn_mi_numero);\nEND;\n/\n</code></pre> <pre><code>El valor de vn_mi_numero es 7.8\nPL/SQL procedure successfully completed.\n</code></pre> <p>TRUNC:</p> <pre><code>DECLARE\nvn_mi_numero NUMBER(3, 2) := 7.77;\nBEGIN\nvn_mi_numero := TRUNC(vn_mi_numero);\nDBMS_OUTPUT.PUT_LINE('El valor de vn_mi_numero es ' || vn_mi_numero);\nEND;\n/\n</code></pre> <pre><code>El valor de vn_mi_numero es 7\nPL/SQL procedure successfully completed.\n</code></pre> <p>Hasta 1 decimal:</p> <pre><code>DECLARE\nvn_mi_numero NUMBER(3, 2) := 7.77;\nBEGIN\nvn_mi_numero := TRUNC(vn_mi_numero, 1);\nDBMS_OUTPUT.PUT_LINE('El valor de vn_mi_numero es ' || vn_mi_numero);\nEND;\n/\n</code></pre> <pre><code>El valor de vn_mi_numero es 7.7\nPL/SQL procedure successfully completed.\n</code></pre> <p>SUBSTR:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := SUBSTR(vv_mi_cadena, 6);\nDBMS_OUTPUT.PUT_LINE('El valor de vv_mi_cadena es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor de vv_mi_cadena es: es mi cadena\nPL/SQL procedure successfully completed.\n</code></pre> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := SUBSTR(vv_mi_cadena, 6, 2);\nDBMS_OUTPUT.PUT_LINE('El valor de vv_mi_cadena es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor de vv_mi_cadena es: es\nPL/SQL procedure successfully completed.\n</code></pre> <p>INSRT:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nvn_mi_numero NUMBER(2);\nBEGIN\nvn_mi_numero := INSTR(vv_mi_cadena, 'mi');\nDBMS_OUTPUT.PUT_LINE('El valor de vn_mi_numero es: ' || vn_mi_numero);\nEND;\n/\n</code></pre> <pre><code>El valor de vn_mi_numero es: 9\nPL/SQL procedure successfully completed.\n</code></pre> <p>Devuelve la posici\u00f3n num\u00e9rica de la primera aparici\u00f3n de la substring buscada dentro de la string.</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nvn_mi_numero NUMBER(2);\nBEGIN\nvn_mi_numero := INSTR(vv_mi_cadena, 'a', 1, 2);\nDBMS_OUTPUT.PUT_LINE('El valor de vn_mi_numero es: ' || vn_mi_numero);\nEND;\n/\n</code></pre> <pre><code>El valor de vn_mi_numero es: 13\nPL/SQL procedure successfully completed.\n</code></pre> <p>Devuelve la posici\u00f3n de la segunda ocurrencia de la letra a partir de la ocurrencia 1.</p> <p>UPPER:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := UPPER(vv_mi_cadena);\nDBMS_OUTPUT.PUT_LINE('El valor de vv_mi_cadena es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor de vv_mi_cadena es: ESTA ES MI CADENA\nPL/SQL procedure successfully completed.\n</code></pre> <p>LOWER:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := LOWER(vv_mi_cadena);\nDBMS_OUTPUT.PUT_LINE('El valor de vv_mi_cadena es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor de vv_mi_cadena es: esta es mi cadena\nPL/SQL procedure successfully completed.\n</code></pre> <p>REPLACE:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := REPLACE(vv_mi_cadena, 'a', '$');\nDBMS_OUTPUT.PUT_LINE('El valor de vv_mi_cadena es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor de vv_mi_cadena es: Est$ es mi c$den$\nPL/SQL procedure successfully completed.\n</code></pre> <p>LPAD:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := LPAD(vv_mi_cadena, 50, '$');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor es: $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$Esta es mi cadena\nPL/SQL procedure successfully completed.\n</code></pre> <p>RPAD:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := RPAD(vv_mi_cadena, 50, '$');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor es: Esta es mi cadena$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nPL/SQL procedure successfully completed.\n</code></pre> <p>TRIM:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := RPAD(vv_mi_cadena, 50, '$');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nvv_mi_cadena := TRIM('$' FROM vv_mi_cadena);\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor es: Esta es mi cadena$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nEl valor es: Esta es mi cadena\nPL/SQL procedure successfully completed.\n</code></pre> <p>RTRIM:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := RPAD(vv_mi_cadena, 50, '$');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nvv_mi_cadena := RTRIM(vv_mi_cadena, '$');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor es: Esta es mi cadena$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nEl valor es: Esta es mi cadena\nPL/SQL procedure successfully completed.\n</code></pre> <p>LTRIM:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := 'Esta es mi cadena';\nBEGIN\nvv_mi_cadena := LPAD(vv_mi_cadena, 50, '$');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nvv_mi_cadena := LTRIM(vv_mi_cadena, '$');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vv_mi_cadena);\nEND;\n/\n</code></pre> <pre><code>El valor es: $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$Esta es mi cadena\nEl valor es: Esta es mi cadena\nPL/SQL procedure successfully completed.\n</code></pre> <p>TO_NUMBER:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := '10';\nvn_mi_numero NUMBER(2);\nBEGIN\nvn_mi_numero := TO_NUMBER(vv_mi_cadena);\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vn_mi_numero);\nEND;\n/\n</code></pre> <pre><code>El valor es: 10\nPL/SQL procedure successfully completed.\n</code></pre> <p>TO_DATE:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := '10/05/2022';\nvd_mi_fecha DATE;\nBEGIN\nvd_mi_fecha := TO_DATE(vv_mi_cadena, 'DD/MM/YYYY');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || vd_mi_fecha);\nEND;\n/\n</code></pre> <pre><code>El valor es: 10-MAY-22\nPL/SQL procedure successfully completed.\n</code></pre> <p>TO_CHAR:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := '10/05/2022';\nvd_mi_fecha DATE;\nBEGIN\nvd_mi_fecha := TO_DATE(vv_mi_cadena, 'DD/MM/YYYY');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || TO_CHAR(vd_mi_fecha, 'DD/MM/YYYY'));\nEND;\n/\n</code></pre> <pre><code>El valor es: 10/05/2022\nPL/SQL procedure successfully completed.\n</code></pre> <p>ADD_MONTHS:</p> <pre><code>DECLARE\nvv_mi_cadena VARCHAR2(50 CHAR) := '10/05/2022';\nvd_mi_fecha DATE;\nBEGIN\nvd_mi_fecha := TO_DATE(vv_mi_cadena, 'DD/MM/YYYY');\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || TO_CHAR(vd_mi_fecha, 'DD/MM/YYYY'));\nvd_mi_fecha := ADD_MONTHS(vd_mi_fecha, 1);\nDBMS_OUTPUT.PUT_LINE('El valor es: ' || TO_CHAR(vd_mi_fecha, 'DD/MM/YYYY'));\nEND;\n/\n</code></pre> <pre><code>El valor es: 10/05/2022\nEl valor es: 10/06/2022\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"openwebinars/fundamentos-plsql/#bloques-anidados","title":"Bloques anidados","text":"<pre><code>DECLARE\nvv_aplicacion VARCHAR2(10 CHAR) := 'Mi app';\nBEGIN\nBEGIN\nvv_aplicacion := vv_aplicacion || ' 2';\nEND;\nDBMS_OUTPUT.PUT_LINE('La variable vv_aplicacion contiene el valor ' || vv_aplicacion);\nEND;\n/\n</code></pre> <pre><code>La variable vv_aplicacion contiene el valor Mi app 2\nPL/SQL procedure successfully completed.\n</code></pre> <p>Un bloque anidado puede usar las variables del bloque padre.</p> <p>A la inversa no funciona:</p> <pre><code>DECLARE\nvv_aplicacion VARCHAR2(10 CHAR) := 'Mi app';\nBEGIN\nDECLARE\nvv_aplicacion VARCHAR2(10 CHAR);\nBEGIN\nvv_aplicacion := 'Subbloque';\nEND;\nDBMS_OUTPUT.PUT_LINE('La variable vv_aplicacion contiene el valor ' || vv_aplicacion);\nEND;\n/\n</code></pre> <pre><code>La variable vv_aplicacion contiene el valor Mi app\nPL/SQL procedure successfully completed.\n</code></pre> <p>El bloque padre no puede usar variables del bloque hijo.</p>"},{"location":"openwebinars/fundamentos-plsql/#cursores","title":"Cursores","text":"<p>Se pueden hacer cursores din\u00e1micos, a los que se le pueden pasar par\u00e1metros:</p> <pre><code>DECLARE\nCURSOR c_proveedores (p_id NUMBER) IS\nSELECT *\nFROM tbproveedores\nWHERE nidproveedor = p_id;\nBEGIN\nFOR r_proveedor IN c_proveedores(1) LOOP\nDBMS_OUTPUT.PUT_LINE('El ID del proveedor es ' || r_proveedor.NIDPROVEEDOR);\nEND LOOP;\nEND;\n/\n</code></pre> <p>As\u00ed podr\u00edamos tener un mismo c\u00f3digo de cursor que variar\u00eda en resultados.</p>"},{"location":"openwebinars/fundamentos-plsql/#excepciones","title":"Excepciones","text":"<pre><code>BEGIN\nINSERT INTO dept VALUES (10, 'ACCOUNTING', 'NEW YORK');\nEXCEPTION\nWHEN DUP_VAL_ON_INDEX THEN\nDBMS_OUTPUT.PUT_LINE('El registro tiene un ID que ya existe en el sistema');\nEND;\n/\n</code></pre> <pre><code>El registro tiene un ID que ya existe en el sistema\nPL/SQL procedure successfully completed.\n</code></pre> <p>Cuando ocurre una excepci\u00f3n se para la ejecuci\u00f3n, y no se sigue ejecutando nada m\u00e1s. Si queremos que cuando ocurra un error se trate, y siga la ejecuci\u00f3n, podemos usar bloques anidados:</p> <pre><code>BEGIN\nBEGIN\nINSERT INTO dept VALUES (10, 'ACCOUNTING', 'NEW YORK');\nEXCEPTION\nWHEN DUP_VAL_ON_INDEX THEN\nDBMS_OUTPUT.PUT_LINE('El registro tiene un ID que ya existe en el sistema');\nEND;\nDBMS_OUTPUT.PUT_LINE('Test');\nEND;\n/\n</code></pre> <pre><code>El registro tiene un ID que ya existe en el sistema\nTest\nPL/SQL procedure successfully completed.\n</code></pre> <p>Excepci\u00f3n personalizada nuestra:</p> <pre><code>DECLARE\nex_mi_excepcion EXCEPTION;\nBEGIN\nBEGIN\nINSERT INTO dept VALUES (10, 'ACCOUNTING', 'NEW YORK');\nEXCEPTION\nWHEN DUP_VAL_ON_INDEX THEN\nRAISE ex_mi_excepcion;\nEND;\nEXCEPTION\nWHEN ex_mi_excepcion THEN\nDBMS_OUTPUT.PUT_LINE('El registro tiene un ID que ya existe en el sistema');\nEND;\n/\n</code></pre> <pre><code>El registro tiene un ID que ya existe en el sistema\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"openwebinars/fundamentos-plsql/#organizacion-del-codigo","title":"Organizaci\u00f3n del c\u00f3digo","text":""},{"location":"openwebinars/fundamentos-plsql/#funciones","title":"Funciones","text":"<p>Errores en funciones con excepciones:</p> <pre><code>CREATE OR REPLACE FUNCTION fn_alta_proveedor (po_v_error VARCHAR2)\nRETURN NUMBER\nDECLARE\nex_mi_excepcion EXCEPTION;\nBEGIN\nBEGIN\nINSERT INTO dept VALUES (10, 'ACCOUNTING', 'NEW YORK');\nEXCEPTION\nWHEN DUP_VAL_ON_INDEX THEN\nRAISE ex_mi_excepcion;\nEND;\nRETURN TRUE;\nEXCEPTION\nWHEN ex_mi_excepcion THEN\npo_v_error := 'error';\nRETURN FALSE;\nEND;\n/\n</code></pre> <p>Para llamar a esa funci\u00f3n:</p> <pre><code>fn_alta_proveedor(vn_IDProveedor, 'Martillos la forja 3', vd_Fecha, vv_ErrorAlta);\n</code></pre> <p>El error es un par\u00e1metro de salida normal.</p> <p>Control de funciones en el padre que devuelve booleano:</p> <pre><code>DECLARE\nvb_AltaOK BOOLEAN;\nvv_ErrorAlta VARCHAR2(2000 CHAR);\nBEGIN\nvb_AltaOK := fn_alta_proveedor(vn_IDProveedor, 'Martillos El Hierro', vd_Fecha, vv_ErrorAlta);\nIF vb_AltaOK THEN\nDBMS_OUTPUT.PUT_LINE('El alta se ha realizado correctamente');\nELSE\nDBMS_OUTPUT.PUT_LINE('El alta no se ha realizado correctamente. Error: ' || vv_ErrorAlta);\nEND IF;\nEND;\n/\n</code></pre>"},{"location":"openwebinars/fundamentos-plsql/#practica-paquetes","title":"Pr\u00e1ctica: paquetes","text":"<p>Especificaci\u00f3n del paquete:</p> <pre><code>CREATE OR REPLACE PACKAGE pk_empleados IS\nFUNCTION fn_nombre_empleado (pi_n_idEmpleado emp.empno%TYPE)\nRETURN emp.ename%TYPE;\nPROCEDURE pr_invoca_alta_e (pi_n_idEmpleado emp.empno%TYPE);\nEND pk_empleados;\n/\n</code></pre> <p>Cuerpo del paquete:</p> <pre><code>CREATE OR REPLACE PACKAGE BODY pk_empleados IS\nFUNCTION fn_nombre_empleado (pi_n_idEmpleado emp.empno%TYPE)\nRETURN emp.ename%TYPE\nIS\nvv_nomEmpleado emp.ename%TYPE;\nBEGIN\nSELECT ename\nINTO vv_nomEmpleado\nFROM emp\nWHERE empno = pi_n_idEmpleado;\nRETURN vv_nomEmpleado;\nEND fn_nombre_empleado;\nPROCEDURE pr_invoca_alta_e (pi_n_idEmpleado emp.empno%TYPE)\nIS\nvv_nomEmpleado emp.ename%TYPE;\nBEGIN\nvv_nomEmpleado := fn_nombre_empleado(pi_n_idEmpleado =&gt; pi_n_idEmpleado);\nDBMS_OUTPUT.PUT_LINE('El nombre del empleado es ' || vv_nomEmpleado);\nEND pr_invoca_alta_e;\nEND pk_empleados;\n/\n</code></pre> <p>Llamo al procedimiento de entrada al paquete:</p> <pre><code>BEGIN\npk_empleados.pr_invoca_alta_e(7876);\nEND;\n/\n</code></pre>"},{"location":"openwebinars/fundamentos-plsql/#otros-elementos-plsql","title":"Otros elementos PL/SQL","text":""},{"location":"openwebinars/fundamentos-plsql/#practica-triggers","title":"Pr\u00e1ctica: Triggers","text":"<p>Muestro el estado actual de <code>dept</code>:</p> <pre><code>SELECT * FROM dept;\n</code></pre> <p></p> <p>Creo su tabla de log:</p> <pre><code>CREATE TABLE LOGDEPT (\nDEPTNO_OLD NUMBER(2),\nDEPTNO_NEW NUMBER(2),\nDNAME_OLD VARCHAR2(14),\nDNAME_NEW VARCHAR2(14),\nLOC_OLD VARCHAR2(13),\nLOC_NEW VARCHAR2(13),\nVACCION VARCHAR2(20)\n);\n</code></pre> <p>Creo el trigger que insertar\u00e1 en la tabla de log por cada INSERT, UPDATE o DELETE en <code>dept</code>:</p> <pre><code>CREATE OR REPLACE TRIGGER tr_log_departamentos\nAFTER INSERT OR UPDATE OR DELETE ON dept\nFOR EACH ROW\nDECLARE\nvv_accion VARCHAR2(20 CHAR);\nBEGIN\nCASE\nWHEN INSERTING THEN vv_accion := 'INSERT';\nWHEN UPDATING THEN vv_accion := 'UPDATE';\nWHEN DELETING THEN vv_accion := 'DELETE';\nEND CASE;\nINSERT INTO LOGDEPT VALUES (:OLD.deptno, :NEW.deptno, :OLD.dname, :NEW.dname, :OLD.loc, :NEW.loc, vv_accion);\nEND tr_log_departamentos;\n/\n</code></pre> <p>Para probar el trigger, hago las siguientes operaciones sobre <code>dept</code>:</p> <pre><code>SQL&gt; INSERT INTO dept VALUES (50, 'ENGINEERING', 'VIRGINIA');\n1 row created.\nCommit complete.\nSQL&gt; UPDATE dept SET dname = 'ENGINEERING 2' WHERE deptno = 50;\n1 row updated.\nCommit complete.\nSQL&gt; DELETE FROM dept WHERE deptno = 50;\n1 row deleted.\nCommit complete.\n</code></pre> <p>Muestro el resultado del log:</p> <pre><code>SELECT * FROM LOGDEPT;\n</code></pre> <p></p>"},{"location":"openwebinars/fundamentos-plsql/#tipos-y-registros","title":"Tipos y registros","text":"<p>Registro con TYPE:</p> <pre><code>DECLARE\nTYPE t_registro IS RECORD (\nv_producto VARCHAR2(20),\nn_unidades NUMBER(3),\nd_fechaAlta DATE\n);\nvtr_producto t_registro;\nBEGIN\nvtr_producto.v_producto := 'Martillo';\nvtr_producto.n_unidades := 10;\nvtr_producto.d_fechaAlta := SYSDATE;\nDBMS_OUTPUT.PUT_LINE('El producto es ' || vtr_producto.v_producto);\nDBMS_OUTPUT.PUT_LINE('Unidades: ' || vtr_producto.n_unidades);\nDBMS_OUTPUT.PUT_LINE('La fecha de alta es ' || TO_CHAR(vtr_producto.d_fechaAlta, 'DD/MM/YYYY'));\nEND;\n/\n</code></pre> <p>Otra manera de crear un registro:</p> <pre><code>DECLARE\nvr_empleados emp%ROWTYPE;\nBEGIN\nSELECT *\nINTO vr_empleados\nFROM emp\nWHERE empno = 7876;\nDBMS_OUTPUT.PUT_LINE('El ID del empleado es ' || vr_empleados.empno);\nDBMS_OUTPUT.PUT_LINE('El nombre del empleado es ' || vr_empleados.ename);\nDBMS_OUTPUT.PUT_LINE('La fecha de contratacion es ' || vr_empleados.hiredate);\nEND;\n/\n</code></pre>"},{"location":"openwebinars/fundamentos-plsql/#practica-colecciones","title":"Pr\u00e1ctica: Colecciones","text":"<p>Tipo VARRAY:</p> <pre><code>DECLARE\n-- Creamos el tipo\nTYPE ttab_ty_nombre IS VARRAY(5) OF VARCHAR2(20 CHAR);\n-- Declaramos e inicializamos una variable del tipo creado\nvttab_ty_nombre ttab_ty_nombre := ttab_ty_nombre();\nBEGIN\nDBMS_OUTPUT.PUT_LINE('El n\u00famero m\u00e1ximo de registros en el vector es: ' || vttab_ty_nombre.LIMIT);\nDBMS_OUTPUT.PUT_LINE('El n\u00famero de registros en el vector es: ' || vttab_ty_nombre.COUNT);\nFOR i IN 1 .. vttab_ty_nombre.LIMIT LOOP\nvttab_ty_nombre.EXTEND;\nvttab_ty_nombre(i) := 'Valor ' || TO_CHAR(i);\nEND LOOP;\nIF vttab_ty_nombre.COUNT &gt; 0 THEN\nFOR i IN vttab_ty_nombre.FIRST .. vttab_ty_nombre.LAST LOOP\nDBMS_OUTPUT.PUT_LINE('El ID del registro es: ' || vttab_ty_nombre(i));\nEND LOOP;\nEND IF;\nDBMS_OUTPUT.PUT_LINE('El n\u00famero de registros en el vector es: ' || vttab_ty_nombre.COUNT);\nEND;\n/\n</code></pre> <pre><code>El n\u00famero m\u00e1ximo de registros en el vector es: 5\nEl n\u00famero de registros en el vector es: 0\nEl ID del registro es: Valor 1\nEl ID del registro es: Valor 2\nEl ID del registro es: Valor 3\nEl ID del registro es: Valor 4\nEl ID del registro es: Valor 5\nEl n\u00famero de registros en el vector es: 5\nPL/SQL procedure successfully completed.\n</code></pre> <p>Otra forma de VARRAY si conocemos los valores:</p> <pre><code>DECLARE\n-- Creamos el tipo\nTYPE ttab_ty_nombre IS VARRAY(5) OF VARCHAR2(20 CHAR);\n-- Declaramos e inicializamos una variable del tipo creado\nvttab_ty_nombre ttab_ty_nombre := ttab_ty_nombre(5, 2, 4, 6, 7);\nBEGIN\nDBMS_OUTPUT.PUT_LINE('El n\u00famero m\u00e1ximo de registros en el vector es: ' || vttab_ty_nombre.LIMIT);\nDBMS_OUTPUT.PUT_LINE('El n\u00famero de registros en el vector es: ' || vttab_ty_nombre.COUNT);\nIF vttab_ty_nombre.COUNT &gt; 0 THEN\nFOR i IN vttab_ty_nombre.FIRST .. vttab_ty_nombre.LAST LOOP\nDBMS_OUTPUT.PUT_LINE('El ID del registro es: ' || vttab_ty_nombre(i));\nEND LOOP;\nEND IF;\nDBMS_OUTPUT.PUT_LINE('El n\u00famero de registros en el vector es: ' || vttab_ty_nombre.COUNT);\nEND;\n/\n</code></pre> <pre><code>El n\u00famero m\u00e1ximo de registros en el vector es: 5\nEl n\u00famero de registros en el vector es: 5\nEl ID del registro es: 5\nEl ID del registro es: 2\nEl ID del registro es: 4\nEl ID del registro es: 6\nEl ID del registro es: 7\nEl n\u00famero de registros en el vector es: 5\nPL/SQL procedure successfully completed.\n</code></pre> <p>Tabla anidada:</p> <pre><code>DECLARE\n-- Creamos el tipo\nTYPE ttab_ty_nombre IS TABLE OF VARCHAR2(20 CHAR);\n-- Declaramos e inicializamos una variable del tipo creado\nvttab_ty_nombre ttab_ty_nombre := ttab_ty_nombre(NULL, NULL, NULL);\nBEGIN\nDBMS_OUTPUT.PUT_LINE('El n\u00famero de registros en el vector es: ' || vttab_ty_nombre.COUNT);\nFOR i IN vttab_ty_nombre.FIRST .. vttab_ty_nombre.LAST LOOP\nvttab_ty_nombre(i) := 'Prueba' || TO_CHAR(i);\nEND LOOP;\nIF vttab_ty_nombre.COUNT &gt; 0 THEN\nFOR i IN vttab_ty_nombre.FIRST .. vttab_ty_nombre.LAST LOOP\nDBMS_OUTPUT.PUT_LINE('El ID del registro es: ' || vttab_ty_nombre(i));\nEND LOOP;\nEND IF;\nEND;\n/\n</code></pre> <pre><code>El n\u00famero de registros en el vector es: 3\nEl ID del registro es: Prueba1\nEl ID del registro es: Prueba2\nEl ID del registro es: Prueba3\nPL/SQL procedure successfully completed.\n</code></pre> <p>Vector asociativo:</p> <pre><code>DECLARE\n-- Creamos el tipo\nTYPE ttab_ty_nombre IS TABLE OF VARCHAR2(20 CHAR) INDEX BY VARCHAR2(2);\n-- Declaramos una variable del tipo creado\nvttab_ty_nombre ttab_ty_nombre;\nv_indice VARCHAR2(2);\nBEGIN\nDBMS_OUTPUT.PUT_LINE('El n\u00famero de registros en el vector es: ' || vttab_ty_nombre.COUNT);\nvttab_ty_nombre('ES') := 'Espa\u00f1a';\nvttab_ty_nombre('AR') := 'Argentina';\nvttab_ty_nombre('ME') := 'Mexico';\nvttab_ty_nombre('CO') := 'Colombia';\nv_indice := vttab_ty_nombre.FIRST;\nDBMS_OUTPUT.PUT_LINE('El indice del registro es: ' || v_indice);\nWHILE v_indice IS NOT NULL LOOP\nDBMS_OUTPUT.PUT_LINE('El ID es: ' || v_indice || ' y el valor es: ' || vttab_ty_nombre(v_indice));\nv_indice := vttab_ty_nombre.NEXT(v_indice);\nEND LOOP;\nDBMS_OUTPUT.PUT_LINE('Acceso directo: El ID es ES y su valor es: ' || vttab_ty_nombre('ES'));\nDBMS_OUTPUT.PUT_LINE('El n\u00famero de registros en el vector es: ' || vttab_ty_nombre.COUNT);\nEND;\n/\n</code></pre> <pre><code>El n\u00famero de registros en el vector es: 0\nEl indice del registro es: AR\nEl ID es: AR y el valor es: Argentina\nEl ID es: CO y el valor es: Colombia\nEl ID es: ES y el valor es: Espa\u00f1a\nEl ID es: ME y el valor es: Mexico\nAcceso directo: El ID es ES y su valor es: Espa\u00f1a\nEl n\u00famero de registros en el vector es: 4\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"openwebinars/productividad-equipos-desconexion-digital/","title":"Productividad en los equipos de trabajo y desconexi\u00f3n digital","text":""},{"location":"openwebinars/productividad-equipos-desconexion-digital/#ejercicio-valores-asociados-a-metas-y-objetivos-profesionales","title":"Ejercicio: Valores asociados a metas y objetivos profesionales","text":"<p>\u00bfQu\u00e9 3 cosas te gustan de tu vida?</p> <ul> <li>Poder tener una zona (mi cuarto), que yo controle en la medida de lo que cabe</li> <li>Poder ducharme todos los d\u00edas con agua caliente</li> <li>Por fin, despu\u00e9s de muchos a\u00f1os, poder tener un calentador (adem\u00e1s de bajo consumo de 600 W solamente) en mi cuarto, peque\u00f1o y que funciona muy bien</li> </ul> <p>Pensar una meta profesional</p> <p>Cuando termine este ciclo superior quiero poder llegar a trabajar en el \u00e1mbito de sysadmin, m\u00e1s espec\u00edficamente en temas relacionados con la virtualizaci\u00f3n. \u00daltimamente me ha estado llamando la atenci\u00f3n el tema de sysadmin de RedHat, sus certificaciones...etc.</p> <p>Todos estos objetivos deser\u00eda que fuesen en Holanda, es una meta profesional m\u00eda el querer trabajar all\u00ed.</p> <p>\u00bfQu\u00e9 resulta importante para t\u00ed acerca de esa meta?</p> <p>El especializarme en el \u00e1mbito de la inform\u00e1tica que m\u00e1s me ha parecido interesante hasta ahora, y la independencia econ\u00f3mica y personal que me dar\u00eda.</p> <p>Tambi\u00e9n conseguir\u00eda utilizar el ingl\u00e9s continuamente, idioma que me encanta, y aprender un idioma nuevo que no me disgusta, el holand\u00e9s. Conseguir\u00eda vivir en un pa\u00eds nuevo en el que ya tengo una m\u00ednima experiencia, y huir de lo que no me gusta de aqu\u00ed.</p> <p>\u00bfQue te aporta esa meta?</p> <p>Un nuevo sentido en la vida, independencia econ\u00f3mica, y sobre todo ganas de vivir y esperanza en el futuro.</p> <p>\u00bfQu\u00e9 es lo que obtienes al hacer esa meta?</p> <p>Obtendr\u00eda casi una nueva vida b\u00e1sicamente. Cumplir un sue\u00f1o.</p> <p>Actualmente hay muy pocas cosas, o casi ninguna, que despierten un fuego dentro de m\u00ed y energ\u00edas de vivir, menos estas metas y objetivos.</p> <p>\u00bfQu\u00e9 te molesta, enoja y frustra?</p> <p>Me frustra vivir en un ambiente que no me beneficia y que es t\u00f3xico para m\u00ed, en una familia en la que no existe confianza ni comunicaci\u00f3n y con un padre maltratador por el que s\u00f3lo existe odio y rencor.</p> <p>\u00bfQu\u00e9 valor se est\u00e1 incumpliendo en esa situaci\u00f3n?</p> <p>El seguir adelante con mi desarrollo personal, el no seguir adelante con mi vida y estar estancado en un bucle de adicci\u00f3n para escapar de esto.</p>"},{"location":"openwebinars/productividad-equipos-desconexion-digital/#efecto-zeigarnik","title":"Efecto Zeigarnik","text":"<p>Cuando tengamos muchas ruminaciones en el cerebro, es importante escribirlas para que el cerebro deje de darles vueltas, y pueda dar una especie de \"cierre\".</p> <p>Cuando el cerebro no deja de rumiar sobre cosas es porque nos ayuda a que no nos olvidemos de cosas importantes, y para que eso pare necesita un cierre. Escribir sirve como \"cierre\".</p>"},{"location":"openwebinars/sql-desde-cero/","title":"SQL desde Cero","text":""},{"location":"openwebinars/sql-desde-cero/#pasos-previos","title":"Pasos previos","text":"<p>En <code>servidormariadb</code> descargo el comprimido de <code>sakila</code>:</p> <pre><code>wget https://downloads.mysql.com/docs/sakila-db.tar.gz\n</code></pre> <p>Extraigo y entro:</p> <pre><code>tar -xvf sakila-db.tar.gz\ncd sakila-db\n</code></pre> <p>Entro como root a mariadb:</p> <pre><code>sudo mariadb\n</code></pre> <p>Ejecuto los 2 scripts necesarios:</p> <pre><code>source sakila-schema.sql;\nsource sakila-data.sql;\n</code></pre> <p>Compruebo que tengo las tablas:</p> <pre><code>SHOW FULL TABLES;\n</code></pre> <p>Compruebo que tengo registros en <code>film</code> y en <code>film_text</code>:</p> <pre><code>SELECT COUNT(*) FROM film;\nSELECT COUNT(*) FROM film_text;\n</code></pre>"},{"location":"openwebinars/sql-desde-cero/#dml","title":"DML","text":""},{"location":"openwebinars/sql-desde-cero/#modificadores","title":"Modificadores","text":"<p>DISTINCT elimina repetidos:</p> <pre><code>select distinct last_name from actor;\n</code></pre> <p>Si empezamos a pedir datos de m\u00e1s columnas, DISTINCT tiene en cuenta TODAS las columnas as\u00ed que habr\u00e1n menos repetidos:</p> <pre><code>select distinct last_name, first_name from actor;\n</code></pre> <p>Toma en cuenta que no se repitan registros iguales de 2 columnas, lo cual ser\u00e1 un poco m\u00e1s dif\u00edcil.</p> <p>Si hacemos lo siguiente nunca afectar\u00e1 DISTINCT, porque no deber\u00edan de haber registros completos repetidos nunca:</p> <pre><code>select distinct * from actor;\n</code></pre> <p>Alias de columnas, para cambiar los nombres reales de las columnas a los que queramos:</p> <pre><code>select title AS 'FILM NAME', description AS 'SINOPSIS' from film LIMIT 10;\n</code></pre> <p>Si el alias es de 1 palabra, no necesita comillas, pero si es de m\u00e1s de 1 palabra, s\u00ed.</p>"},{"location":"openwebinars/sql-desde-cero/#where-y-order-by","title":"WHERE y ORDER BY","text":"<p>Mayor o igual:</p> <pre><code>select * from film where length &gt;= 120;\n</code></pre> <p>Con un comentario:</p> <pre><code>select * from film /*where length &gt;= 120*/;\n</code></pre> <p>Orden descendente (el ascendente es el por defecto):</p> <pre><code>select title from film ORDER BY title DESC;\n</code></pre> <p>Mezcla de ambos:</p> <pre><code>SELECT last_name, first_name\nFROM actor\nWHERE last_name = 'ALLEN'\nORDER BY first_name DESC;\n</code></pre> <p>Se puede ordenar por un campo que no se muestre:</p> <pre><code>SELECT actor_id, first_name\nFROM actor\nORDER BY last_name DESC;\n</code></pre>"},{"location":"openwebinars/sql-desde-cero/#operadores-logicos-and-or-not-like-in-between","title":"Operadores l\u00f3gicos: AND, OR, NOT, LIKE, IN, BETWEEN","text":"<p>Ejemplo de AND:</p> <pre><code>SELECT title, length, rental_rate\nFROM film\nWHERE length &gt; 90 AND rental_rate &lt;= 3;\n</code></pre> <p>Todas las condiciones se deben cumplir</p> <p>Ejemplo de OR:</p> <pre><code>SELECT title, length, rental_rate\nFROM film\nWHERE length &gt; 90 OR rental_rate &lt;= 3;\n</code></pre> <p>El resultado suele ser mayor porque es menos estricto, o una cosa o la otra</p> <p>Ejemplo de NOT:</p> <pre><code>SELECT *\nFROM actor\nWHERE NOT last_name = 'ALLEN';\n</code></pre> <p>La ventaja del NOT es que se puede negar un bloque entero de WHERE</p> <p>Equivalente a NOT, el &lt;&gt; que significa diferente a:</p> <pre><code>SELECT *\nFROM actor\nWHERE last_name &lt;&gt; 'ALLEN';\n</code></pre> <p>Ejemplo de LIKE:</p> <pre><code>SELECT title\nFROM film\nWHERE title LIKE '%LOVE%';\n</code></pre> <p>Cualquier cosa que contenga LOVE</p> <p>Que empiece por LOVE:</p> <pre><code>SELECT title\nFROM film\nWHERE title LIKE 'LOVE%';\n</code></pre> <p>Que termine por LOVE:</p> <pre><code>SELECT title\nFROM film\nWHERE title LIKE '%LOVE';\n</code></pre> <p>Ejemplo de BETWEEN:</p> <pre><code>SELECT rental_rate\nFROM film\nWHERE rental_rate BETWEEN 0.5 AND 2.5;\n</code></pre>"},{"location":"openwebinars/sql-desde-cero/#consultas-de-union-no-mismo-que-join","title":"Consultas de uni\u00f3n (no mismo que JOIN)","text":"<pre><code>SELECT last_name, first_name\nFROM customer\nunion\nSELECT last_name, first_name\nFROM actor;\n</code></pre> <p>El n\u00famero de columnas tiene que ser igual, pero el nombre de ellas no influye. Genera una sola tabla sumando resultados Se tienen que mezclar campos compatibles, no se puede mezclar campos de texto con n\u00famero Los Alias de columna solo deben estar en la primera select</p> <pre><code>SELECT last_name AS apellido, first_name AS Nombre\nFROM customer\nunion\nSELECT last_name, first_name\nFROM actor;\n</code></pre> <p>Por defecto UNION no muestra repetidos</p> <p>Para que muestre tambi\u00e9n repetidos hacemos:</p> <pre><code>SELECT last_name AS apellido, first_name AS Nombre\nFROM customer\nUNION ALL\nSELECT last_name, first_name\nFROM actor;\n</code></pre> <p>Para ordenar con UNION va al final:</p> <pre><code>SELECT last_name AS apellido, first_name AS Nombre\nFROM customer\nUNION ALL\nSELECT last_name, first_name\nFROM actor\nORDER BY apellido;\n</code></pre>"},{"location":"openwebinars/sql-desde-cero/#subconsultas","title":"Subconsultas","text":"<p>M\u00e1xima de subconsultas: siempre tienen que trabajar sobre 1 solo campo, porque luego ese campo es el que se utilizar\u00e1 en un filtro WHERE</p> <p>Las subconsultas pueden tener m\u00e1s subconsultas anidadas</p>"},{"location":"openwebinars/sql-desde-cero/#consultas-con-funciones-escalares","title":"Consultas con funciones escalares","text":"<p>Ejemplo LCASE (convierte a min\u00fasculas):</p> <pre><code>SELECT LCASE(title)\nFROM film;\n</code></pre> <p>Ejemplo CONCAT (s\u00f3lo acepta texto):</p> <pre><code>SELECT CONCAT(last_name, ', ',first_name)\nFROM actor;\n</code></pre> <p>Anido:</p> <pre><code>SELECT CONCAT(last_name, ', ',LCASE(first_name))\nFROM actor;\n</code></pre> <p>Puedo cambiar valores usando operadores matem\u00e1ticos:</p> <pre><code>SELECT title AS 'Titulo', rental_rate * 0.75 AS 'Precio euros'\nFROM film;\n</code></pre>"},{"location":"openwebinars/sql-desde-cero/#funciones-de-agregado","title":"Funciones de agregado","text":"<p>Ejemplo count:</p> <pre><code>SELECT count(*) AS 'Num Clientes'\nFROM customer\nWHERE active = 1;\n</code></pre> <p>Ejemplo max:</p> <pre><code>SELECT MAX(rental_rate) AS 'Precio maximo'\nFROM film;\n</code></pre> <p>Ejemplo min:</p> <pre><code>SELECT min(rental_rate) AS 'Precio minimo'\nFROM film;\n</code></pre> <p>Mezcla de MAX y MIN:</p> <pre><code>SELECT MAX(rental_rate) AS 'Precio maximo', MIN(rental_rate) AS 'Precio minimo'\nFROM film;\n</code></pre>"},{"location":"openwebinars/sql-desde-cero/#consultas-de-agrupacion-group-by-having","title":"Consultas de agrupaci\u00f3n (GROUP BY / HAVING)","text":"<pre><code>SELECT COUNT(film_id), rental_rate\nFROM film\nGROUP BY rental_rate\n;\n</code></pre> <p>Normalmente GROUP BY se usa junto con funciones de agregado como COUNT</p> <p>No tiene mucho sentido pedir detalle (m\u00e1s columnas) y a la vez pedir agrupaci\u00f3n</p> <p>Se le puede a\u00f1adir WHERE y ORDER BY:</p> <pre><code>SELECT COUNT(film_id), rental_rate\nFROM film\nWHERE replacement_cost &lt;= 20\nGROUP BY rental_rate\nORDER BY rental_rate DESC\n;\n</code></pre> <p>Ejemplo de HAVING:</p> <pre><code>SELECT COUNT(film_id), rental_rate\nFROM film\nWHERE replacement_cost &lt;= 20\nGROUP BY rental_rate\nHAVING COUNT(film_id) &gt; 165\nORDER BY rental_rate DESC\n;\n</code></pre> <p>Hay quien llama a HAVING 'El WHERE dentro del WHERE'</p> <p>Una vez que se ha agrupado, HAVING filtra los grupos</p>"},{"location":"openwebinars/sql-desde-cero/#consultas-sobre-mas-de-una-tabla-join-parte-1","title":"Consultas sobre m\u00e1s de una tabla: JOIN (parte 1)","text":"<pre><code>SELECT first_name, last_name, a.address\nFROM customer c, address a\nWHERE c.address_id = a.address_id\nAND active = 1\n;\n</code></pre>"},{"location":"openwebinars/sql-desde-cero/#consultas-sobre-mas-de-una-tabla-join-parte-2","title":"Consultas sobre m\u00e1s de una tabla: JOIN (parte 2)","text":"<p>Ejemplo INNER JOIN:</p> <pre><code>SELECT first_name, last_name, a.address\nFROM customer c\nINNER JOIN address a\nON c.address_id = a.address_id\n;\n</code></pre> <p>Ejemplo LEFT JOIN:</p> <pre><code>SELECT first_name, last_name, a.address\nFROM customer c\nLEFT JOIN address a\nON c.address_id = a.address_id\n;\n</code></pre> <p>Ejemplo RIGHT JOIN:</p> <pre><code>SELECT first_name, last_name, a.address\nFROM customer c\nRIGHT JOIN address a\nON c.address_id = a.address_id\n;\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/","title":"Ejercicio 1 iptables: cortafuegos por nodo","text":""},{"location":"sad/ej1-iptables-nodo/#preliminares","title":"Preliminares","text":""},{"location":"sad/ej1-iptables-nodo/#escenario","title":"Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\nconfig.vm.define :ej1iptables1 do |ej1iptables1|\nej1iptables1.vm.box = \"debian/bullseye64\"\nej1iptables1.vm.hostname = \"ej1iptables1\"\nej1iptables1.vm.network :private_network,\n:libvirt__network_name =&gt; \"ej1-iptables-nodo\",\n:libvirt__dhcp_enabled =&gt; false,\n:ip =&gt; \"192.168.0.2\",\n:libvirt__netmask =&gt; '255.255.255.0',\n:libvirt__forward_mode =&gt; \"veryisolated\"\nend\nconfig.vm.define :ej1iptables2 do |ej1iptables2|\nej1iptables2.vm.box = \"debian/bullseye64\"\nej1iptables2.vm.hostname = \"ej1iptables2\"\nej1iptables2.vm.network :private_network,\n:libvirt__network_name =&gt; \"ej1-iptables-nodo\",\n:libvirt__dhcp_enabled =&gt; false,\n:ip =&gt; \"192.168.0.3\",\n:libvirt__netmask =&gt; '255.255.255.0',\n:libvirt__forward_mode =&gt; \"veryisolated\"\nend\nend\n</code></pre> <p>Instalo un servidor web para dejar abierto el puerto 80:</p> <pre><code>sudo apt update\nsudo apt install apache2\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#limpieza-de-reglas-previas","title":"Limpieza de reglas previas","text":"<p>En mi caso no necesito hacer este paso ya que parto de una m\u00e1quina vagrant nueva. Igualmente, dejar\u00e9 los comandos explicados por aqu\u00ed.</p> <p>Borrar todas las reglas de todas las cadenas en la tabla filter:</p> <pre><code>sudo iptables -F\n</code></pre> <p>Borrar todas las reglas de todas las cadenas en la tabla nat:</p> <pre><code>sudo iptables -t nat -F\n</code></pre> <p>Poner los contadores a cero en todas las cadenas de la tabla filter:</p> <pre><code>sudo iptables -Z\n</code></pre> <p>Poner los contadores a cero en todas las cadenas de la tabla nat:</p> <pre><code>sudo iptables -t nat -Z\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#trafico-ssh-entrante","title":"Tr\u00e1fico ssh entrante","text":"<p>Estamos conectados a la m\u00e1quina por ssh, as\u00ed que tenemos que permitir el tr\u00e1fico ssh entrante antes de cambiar las pol\u00edticas por defecto a DROP (para no perder la conexi\u00f3n):</p> <pre><code>sudo iptables -A INPUT -s 192.168.121.0/24 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -d 192.168.121.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#cambiar-politica-por-defecto","title":"Cambiar pol\u00edtica por defecto","text":"<pre><code>sudo iptables -P INPUT DROP\nsudo iptables -P OUTPUT DROP\n</code></pre> <p>Debido a estas pol\u00edticas DROP que hemos aplicado...</p> <p>No puedo hacer ping a localhost:</p> <pre><code>vagrant@ej1iptables1:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n^C\n--- 127.0.0.1 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2049ms\n</code></pre> <p>No puedo hacer ping a Internet:</p> <pre><code>vagrant@ej1iptables1:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n^C\n--- 1.1.1.1 ping statistics ---\n4 packets transmitted, 0 received, 100% packet loss, time 3062ms\n</code></pre> <p>Si no se nos corta la conexi\u00f3n ssh a la m\u00e1quina despu\u00e9s de este paso, el par de reglas que aplicamos antes funcionan.</p>"},{"location":"sad/ej1-iptables-nodo/#trafico-loopback","title":"Tr\u00e1fico loopback","text":"<pre><code>sudo iptables -A OUTPUT -o lo -p icmp -j ACCEPT\nsudo iptables -A INPUT -i lo -p icmp -j ACCEPT\n</code></pre> <p>Ya funciona el ping a localhost:</p> <pre><code>vagrant@ej1iptables1:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.097 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.090 ms\n^C\n--- 127.0.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1006ms\nrtt min/avg/max/mdev = 0.090/0.093/0.097/0.003 ms\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#trafico-icmp-saliente","title":"Tr\u00e1fico ICMP saliente","text":"<pre><code>sudo iptables -A OUTPUT -o eth0 -p icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A INPUT -i eth0 -p icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Ya funciona el ping a Internet:</p> <pre><code>vagrant@ej1iptables1:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=11.2 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=54 time=17.3 ms\n64 bytes from 1.1.1.1: icmp_seq=3 ttl=54 time=46.9 ms\n^C\n--- 1.1.1.1 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 11.218/25.145/46.884/15.573 ms\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#trafico-dns-saliente","title":"Tr\u00e1fico DNS saliente","text":"<pre><code>sudo iptables -A OUTPUT -o eth0 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -i eth0 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que las consultas DNS funcionan:</p> <pre><code>vagrant@ej1iptables1:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 21960\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n;; ANSWER SECTION:\nwww.example.org.    86400   IN  A   93.184.216.34\n;; Query time: 176 msec\n;; SERVER: 1.1.1.1#53(1.1.1.1)\n;; WHEN: Tue Jan 25 21:14:54 UTC 2022\n;; MSG SIZE  rcvd: 60\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#trafico-http-saliente","title":"Tr\u00e1fico http saliente","text":"<pre><code>sudo iptables -A OUTPUT -o eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -i eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Compruebo que funciona:</p> <pre><code>vagrant@ej1iptables1:~$ curl http://portquiz.net:80\nPort test successful!\nYour IP: 90.168.73.6\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#trafico-https-saliente","title":"Tr\u00e1fico https saliente","text":"<pre><code>sudo iptables -A OUTPUT -o eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -i eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Compruebo que funciona:</p> <pre><code>vagrant@ej1iptables1:~$ curl portquiz.net:443\nPort test successful!\nYour IP: 90.168.73.6\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#trafico-http-entrante","title":"Tr\u00e1fico http entrante","text":"<pre><code>sudo iptables -A INPUT -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -o eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Compruebo que funciona desde mi host:</p> <pre><code>atlas@olympus:~/vagrant/ej1-iptables-nodo$ telnet 192.168.121.148 80\nTrying 192.168.121.148...\nConnected to 192.168.121.148.\nEscape character is '^]'.\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#ejercicios","title":"Ejercicios","text":""},{"location":"sad/ej1-iptables-nodo/#ejercicio-1","title":"Ejercicio 1","text":"<p>Permitir conexiones ssh al exterior</p> <pre><code>sudo iptables -A OUTPUT -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona conectando a mi host:</p> <pre><code>vagrant@ej1iptables1:~$ ssh atlas@192.168.121.1\nThe authenticity of host '192.168.121.1 (192.168.121.1)' can't be established.\nECDSA key fingerprint is SHA256:xbn++TBj5GyQdixTeO+cP7UGJzvMspD3AVK0JD1RbLw.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '192.168.121.1' (ECDSA) to the list of known hosts.\natlas@192.168.121.1's password:\nLinux olympus 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nYou have new mail.\nLast login: Fri Sep 17 11:55:03 2021\natlas@olympus:~$\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#ejercicio-2","title":"Ejercicio 2","text":"<p>Denegar tr\u00e1fico http entrante desde nuestro host</p> <p>Antes de a\u00f1adir la regla de bloqueo, debemos tener en cuenta nuestra situaci\u00f3n actual de reglas en INPUT:</p> <p></p> <p>Como se puede ver, si a\u00f1adi\u00e9ramos la regla de bloqueo al final no servir\u00eda para nada porque siempre har\u00eda match con la que permite todo el tr\u00e1fico http entrante (la marcada en rojo).</p> <p>\u00bfSoluci\u00f3n? A\u00f1adirla por encima de la regla marcada en rojo.</p> <p>Necesitamos saber el n\u00famero de l\u00ednea espec\u00edfico, as\u00ed que ejecutamos:</p> <pre><code>sudo iptables -L -v -n --line-numbers\n</code></pre> <p></p> <p>Vamos a a\u00f1adir la regla de bloqueo en la posici\u00f3n marcada para que funcione:</p> <pre><code>sudo iptables -I INPUT 7 -s 192.168.121.1 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j DROP\n</code></pre> <p></p> <p>Ya tenemos la regla en la posici\u00f3n que quer\u00edamos. Ahora comprobamos que bloquea el tr\u00e1fico:</p> <pre><code>atlas@olympus:~/vagrant/ej1-iptables-nodo$ telnet 192.168.121.148 80\nTrying 192.168.121.148...\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#ejercicio-3","title":"Ejercicio 3","text":"<p>Permitir tr\u00e1fico DNS saliente s\u00f3lo a 192.168.202.2. Comprobar que no se puede hacer un dig @1.1.1.1</p> <p>Nos encontramos en una situaci\u00f3n parecida a la del ejercicio anterior, pero en este caso tenemos que borrar 2 reglas antiguas que permit\u00edan el tr\u00e1fico DNS saliente a todo:  </p> <p></p> <p>Incluso si a\u00f1adi\u00e9ramos las nuevas reglas por encima de estas, cuando hici\u00e9semos dig a 1.1.1.1 llegar\u00eda a hacer match con estas reglas y permitir\u00eda el tr\u00e1fico, y eso no es lo que queremos.</p> <p>Primero, borramos las reglas antiguas:</p> <pre><code>sudo iptables -D OUTPUT -o eth0 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -D INPUT -i eth0 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Segundo, a\u00f1adimos las nuevas reglas:</p> <pre><code>sudo iptables -A OUTPUT -d 192.168.202.2 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -s 192.168.202.2 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que las consultas DNS a <code>192.168.202.2</code> funcionan:</p> <pre><code>vagrant@ej1iptables1:~$ dig @192.168.202.2 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; @192.168.202.2 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 44911\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 5\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: a5bc7b7e522180d07f1d986561f12cdcd431eb1130baa84c (good)\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n;; ANSWER SECTION:\nwww.example.org.    86010   IN  A   93.184.216.34\n;; AUTHORITY SECTION:\nexample.org.            72269   IN  NS  a.iana-servers.net.\nexample.org.            72269   IN  NS  b.iana-servers.net.\n;; ADDITIONAL SECTION:\na.iana-servers.net. 158669  IN  A   199.43.135.53\nb.iana-servers.net. 158669  IN  A   199.43.133.53\na.iana-servers.net. 158669  IN  AAAA    2001:500:8f::53\nb.iana-servers.net. 158669  IN  AAAA    2001:500:8d::53\n;; Query time: 0 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Wed Jan 26 11:13:30 UTC 2022\n;; MSG SIZE  rcvd: 224\n</code></pre> <p>Pruebo que las consultas DNS a <code>1.1.1.1</code> no funcionan:</p> <pre><code>vagrant@ej1iptables1:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#ejercicio-4","title":"Ejercicio 4","text":"<p>Bloquear tr\u00e1fico http saliente a www.josedomingo.org (utilizar la ip). \u00bfSe puede acceder a fp.josedomingo.org?</p> <p>De nuevo, tendr\u00edamos una situaci\u00f3n de conflicto de reglas si la siguiente la a\u00f1adi\u00e9ramos al final, porque antes tenemos una que permite todo el tr\u00e1fico http saliente y los matchs se quedar\u00edan siempre ah\u00ed:</p> <p></p> <p>Tendremos que a\u00f1adir la regla de bloqueo por encima de la anterior mostrada:</p> <pre><code>sudo iptables -I OUTPUT 4 -d 37.187.119.60 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j DROP\n</code></pre> <p>Se nos quedar\u00edan las reglas as\u00ed:</p> <p></p> <p>Pruebo que no funciona el tr\u00e1fico http saliente a <code>www.josedomingo.org</code>:</p> <pre><code>vagrant@ej1iptables1:~$ curl www.josedomingo.org\n</code></pre> <p>Se quedar\u00e1 esperando infinitamente porque no hay conexi\u00f3n.</p> <p>Pruebo a ver si funciona el tr\u00e1fico http saliente a <code>fp.josedomingo.org</code>:</p> <pre><code>vagrant@ej1iptables1:~$ curl fp.josedomingo.org\n</code></pre> <p>Tampoco hay conexi\u00f3n. No funciona ya que <code>fp.josedomingo.org</code> se acaba traduciendo a la misma IP que hemos bloqueado antes.</p> <p>Pruebo que cualquier otro tr\u00e1fico http saliente funciona:</p> <pre><code>vagrant@ej1iptables1:~$ telnet www.example.org 80\nTrying 93.184.216.34...\nConnected to www.example.org.\nEscape character is '^]'.\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#ejercicio-5","title":"Ejercicio 5","text":"<p>Permitir tr\u00e1fico saliente a babuino-smtp.gonzalonazareno.org por el puerto 25</p> <pre><code>sudo iptables -A OUTPUT -d 192.168.203.3 -p tcp --dport 25 -j ACCEPT\nsudo iptables -A INPUT -s 192.168.203.3 -p tcp --sport 25 -j ACCEPT\n</code></pre> <p>Pruebo que funciona con telnet:</p> <pre><code>vagrant@ej1iptables1:~$ telnet babuino-smtp.gonzalonazareno.org 25\nTrying 192.168.203.3...\nConnected to babuino-smtp.gonzalonazareno.org.\nEscape character is '^]'.\n220 babuino-smtp.gonzalonazareno.org ESMTP Postfix (Debian/GNU)\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#ejercicio-6","title":"Ejercicio 6","text":""},{"location":"sad/ej1-iptables-nodo/#parte-1","title":"Parte 1","text":"<p>Instalar mariadb-server y habilitar conexiones remotas</p> <pre><code>sudo apt install mariadb-server\n</code></pre> <p><code>/etc/mysql/mariadb.conf.d/50-server.cnf</code>:</p> <pre><code>bind-address            = 0.0.0.0\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart mariadb\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#parte-2","title":"Parte 2","text":"<p>Permitir tr\u00e1fico entrante desde mi host</p> <pre><code>sudo iptables -A INPUT -s 192.168.121.1 -p tcp --dport 3306 -j ACCEPT\nsudo iptables -A OUTPUT -d 192.168.121.1 -p tcp --sport 3306 -j ACCEPT\n</code></pre> <p>Pruebo que funciona:</p> <pre><code>atlas@olympus:~/vagrant/ej1-iptables-nodo$ nc -zvw10 192.168.121.148 3306\nConnection to 192.168.121.148 3306 port [tcp/mysql] succeeded!\n</code></pre>"},{"location":"sad/ej1-iptables-nodo/#parte-3","title":"Parte 3","text":"<p>Comprobar que desde otro cliente bloquea el tr\u00e1fico</p> <pre><code>vagrant@ej1iptables2:~$ nc -zvw10 192.168.0.2 3306\n192.168.0.2: inverse host lookup failed: Unknown host\n(UNKNOWN) [192.168.0.2] 3306 (mysql) : Connection timed out\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/","title":"Ejercicio 1 nftables: cortafuegos por nodo","text":""},{"location":"sad/ej1-nftables-nodo/#preliminares","title":"Preliminares","text":""},{"location":"sad/ej1-nftables-nodo/#escenario","title":"Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\nconfig.vm.define :ej1nftables1 do |ej1nftables1|\nej1nftables1.vm.box = \"debian/bullseye64\"\nej1nftables1.vm.hostname = \"ej1nftables1\"\nej1nftables1.vm.network :private_network,\n:libvirt__network_name =&gt; \"ej1-nftables-nodo\",\n:libvirt__dhcp_enabled =&gt; false,\n:ip =&gt; \"192.168.0.2\",\n:libvirt__netmask =&gt; '255.255.255.0',\n:libvirt__forward_mode =&gt; \"veryisolated\"\nend\nconfig.vm.define :ej1nftables2 do |ej1nftables2|\nej1nftables2.vm.box = \"debian/bullseye64\"\nej1nftables2.vm.hostname = \"ej1nftables2\"\nej1nftables2.vm.network :private_network,\n:libvirt__network_name =&gt; \"ej1-nftables-nodo\",\n:libvirt__dhcp_enabled =&gt; false,\n:ip =&gt; \"192.168.0.3\",\n:libvirt__netmask =&gt; '255.255.255.0',\n:libvirt__forward_mode =&gt; \"veryisolated\"\nend\nend\n</code></pre> <p>Instalo un servidor web para dejar abierto el puerto 80:</p> <pre><code>sudo apt update\nsudo apt install apache2\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#preparacion-nftables","title":"Preparaci\u00f3n nftables","text":"<p>Creo la tabla filter:</p> <pre><code>sudo nft add table inet filter\n</code></pre> <p>Creo las cadenas input/output en filter:</p> <pre><code>sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy accept \\; }\nsudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy accept \\; }\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#trafico-ssh-entrante","title":"Tr\u00e1fico ssh entrante","text":"<pre><code>sudo nft add rule inet filter input ip saddr 192.168.121.0/24 tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter output ip daddr 192.168.121.0/24 tcp sport 22 ct state established counter accept\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#cambiar-politicas-por-defecto","title":"Cambiar pol\u00edticas por defecto","text":"<pre><code>sudo nft chain inet filter input { policy drop \\; }\nsudo nft chain inet filter output { policy drop \\; }\n</code></pre> <p>Despu\u00e9s de este paso me sigue funcionando la conexi\u00f3n SSH a la m\u00e1quina, por lo que las reglas del paso anterior funcionan.</p> <p>Todo tr\u00e1fico diferente a este, no funciona por ahora.</p>"},{"location":"sad/ej1-nftables-nodo/#trafico-loopback","title":"Tr\u00e1fico loopback","text":"<pre><code>sudo nft add rule inet filter output oifname \"lo\" counter accept\nsudo nft add rule inet filter input iifname \"lo\" counter accept\n</code></pre> <p>Ya funciona el ping a localhost:</p> <pre><code>vagrant@ej1nftables1:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.025 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.073 ms\n^C\n--- 127.0.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1017ms\nrtt min/avg/max/mdev = 0.025/0.049/0.073/0.024 ms\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#trafico-icmp-saliente","title":"Tr\u00e1fico ICMP saliente","text":"<pre><code>sudo nft add rule inet filter output oifname \"eth0\" icmp type echo-request counter accept\nsudo nft add rule inet filter input iifname \"eth0\" icmp type echo-reply counter accept\n</code></pre> <p>Ya funciona el ping a Internet:</p> <pre><code>vagrant@ej1nftables1:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=368 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=54 time=135 ms\n^C\n--- 1.1.1.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 135.491/251.525/367.559/116.034 ms\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#trafico-dns-saliente","title":"Tr\u00e1fico DNS saliente","text":"<pre><code>sudo nft add rule inet filter output oifname \"eth0\" udp dport 53 ct state new,established counter accept\nsudo nft add rule inet filter input iifname \"eth0\" udp sport 53 ct state established counter accept\n</code></pre> <p>Probamos que las consultas DNS funcionan:</p> <pre><code>vagrant@ej1nftables1:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 65305\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n;; ANSWER SECTION:\nwww.example.org.    86400   IN  A   93.184.216.34\n;; Query time: 132 msec\n;; SERVER: 1.1.1.1#53(1.1.1.1)\n;; WHEN: Thu Jan 27 12:41:50 UTC 2022\n;; MSG SIZE  rcvd: 60\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#trafico-httphttps-saliente","title":"Tr\u00e1fico http/https saliente","text":"<pre><code>sudo nft add rule inet filter output oifname \"eth0\" ip protocol tcp tcp dport { 80,443 } ct state new,established counter accept\nsudo nft add rule inet filter input iifname \"eth0\" ip protocol tcp tcp sport { 80,443 } ct state established counter accept\n</code></pre> <p>Compruebo que funciona http:</p> <pre><code>vagrant@ej1nftables1:~$ curl http://portquiz.net:80\nPort test successful!\nYour IP: 158.99.1.24\n</code></pre> <p>Compruebo que funciona https:</p> <pre><code>vagrant@ej1nftables1:~$ curl portquiz.net:443\nPort test successful!\nYour IP: 158.99.1.24\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#trafico-http-entrante","title":"Tr\u00e1fico http entrante","text":"<pre><code>sudo nft add rule inet filter input iifname \"eth0\" tcp dport 80 ct state new,established counter accept\nsudo nft add rule inet filter output oifname \"eth0\" tcp sport 80 ct state established counter accept\n</code></pre> <p>Compruebo que funciona desde mi host:</p> <pre><code>atlas@olympus:~/vagrant/ej1-nftables-nodo$ telnet 192.168.121.65 80\nTrying 192.168.121.65...\nConnected to 192.168.121.65.\nEscape character is '^]'.\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#ejercicios","title":"Ejercicios","text":""},{"location":"sad/ej1-nftables-nodo/#ejercicio-1","title":"Ejercicio 1","text":"<p>Permitir conexiones ssh al exterior</p> <pre><code>sudo nft add rule inet filter output tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter input tcp sport 22 ct state established counter accept\n</code></pre> <p>Pruebo que funciona conectando a mi host:</p> <pre><code>vagrant@ej1nftables1:~$ ssh atlas@192.168.121.1\nThe authenticity of host '192.168.121.1 (192.168.121.1)' can't be established.\nECDSA key fingerprint is SHA256:xbn++TBj5GyQdixTeO+cP7UGJzvMspD3AVK0JD1RbLw.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '192.168.121.1' (ECDSA) to the list of known hosts.\natlas@192.168.121.1's password:\nLinux olympus 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nYou have new mail.\nLast login: Wed Jan 26 10:32:49 2022 from 192.168.121.148\natlas@olympus:~$\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#ejercicio-2","title":"Ejercicio 2","text":"<p>Denegar tr\u00e1fico http entrante desde el host</p> <p>Antes de a\u00f1adir la regla de bloqueo, debemos tener en cuenta nuestra situaci\u00f3n actual de reglas en INPUT:</p> <p></p> <p>Como se puede ver, si a\u00f1adi\u00e9ramos la regla de bloqueo al final no servir\u00eda para nada porque siempre har\u00eda match con la que permite todo el tr\u00e1fico http entrante (la marcada en rojo).</p> <p>\u00bfSoluci\u00f3n? A\u00f1adirla por encima de la regla marcada en rojo.</p> <p>Necesitamos saber el handle de la regla que est\u00e1 por encima de la posici\u00f3n donde queremos la nueva regla, as\u00ed que ejecutamos:</p> <pre><code>sudo nft -n -a list ruleset\n</code></pre> <p></p> <p>Vamos a a\u00f1adir la regla de bloqueo usando el handle marcado para que se coloque justo debajo, y as\u00ed estar\u00e1 en la posici\u00f3n que queremos:</p> <pre><code>sudo nft add rule inet filter input position 18 ip saddr 192.168.121.1 tcp dport 80 ct state new,established counter drop\n</code></pre> <p>Muestro c\u00f3mo han quedado:</p> <p></p> <p>Compruebo que bloquea el tr\u00e1fico:</p> <pre><code>atlas@olympus:~/vagrant/ej1-nftables-nodo$ telnet 192.168.121.65 80\nTrying 192.168.121.65...\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#ejercicio-3","title":"Ejercicio 3","text":"<p>Permitir tr\u00e1fico DNS saliente s\u00f3lo a 192.168.202.2. Comprobar que no se puede hacer un dig @1.1.1.1</p> <p>Nos encontramos en una situaci\u00f3n parecida a la del ejercicio anterior, pero en este caso tenemos que borrar 2 reglas antiguas que permit\u00edan el tr\u00e1fico DNS saliente a todo:</p> <p></p> <p>Incluso si a\u00f1adi\u00e9ramos las nuevas reglas por encima de estas, cuando hici\u00e9semos dig a 1.1.1.1 llegar\u00eda a hacer match con estas reglas y permitir\u00eda el tr\u00e1fico, y eso no es lo que queremos.</p> <p>Para borrar estas reglas, primero tenemos que saber sus handles:</p> <p></p> <p>Ya podemos borrarlas:</p> <pre><code>sudo nft delete rule inet filter input handle 14\nsudo nft delete rule inet filter output handle 13\n</code></pre> <p>A\u00f1adimos las nuevas reglas:</p> <pre><code>sudo nft add rule inet filter output ip daddr 192.168.202.2 udp dport 53 ct state new,established counter accept\nsudo nft add rule inet filter input ip saddr 192.168.202.2 udp sport 53 ct state established counter accept\n</code></pre> <p>Pruebo que las consultas DNS a <code>192.168.202.2</code> funcionan:</p> <pre><code>vagrant@ej1nftables1:~$ dig @192.168.202.2 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.202.2 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 18296\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 5\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: ce3cd730cac8cfacd646547461f3e6ed8a244c9fe1c24ed8 (good)\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n;; ANSWER SECTION:\nwww.example.org.    86400   IN  A   93.184.216.34\n;; AUTHORITY SECTION:\nexample.org.            66421   IN  NS  a.iana-servers.net.\nexample.org.            66421   IN  NS  b.iana-servers.net.\n;; ADDITIONAL SECTION:\na.iana-servers.net. 152765  IN  A   199.43.135.53\nb.iana-servers.net. 152765  IN  A   199.43.133.53\na.iana-servers.net. 152765  IN  AAAA    2001:500:8f::53\nb.iana-servers.net. 152765  IN  AAAA    2001:500:8d::53\n;; Query time: 492 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Fri Jan 28 12:51:57 UTC 2022\n;; MSG SIZE  rcvd: 224\n</code></pre> <p>Pruebo que las consultas DNS a <code>1.1.1.1</code> no funcionan:</p> <pre><code>vagrant@ej1nftables1:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#ejercicio-4","title":"Ejercicio 4","text":"<p>Bloquear tr\u00e1fico http saliente a www.josedomingo.org (utilizar la ip). \u00bfSe puede acceder a fp.josedomingo.org?</p> <p>De nuevo, tendr\u00edamos una situaci\u00f3n de conflicto de reglas si la siguiente la a\u00f1adi\u00e9ramos al final, porque antes tenemos una que permite todo el tr\u00e1fico http/https saliente y los matchs se quedar\u00edan siempre ah\u00ed:</p> <p></p> <p>Tendremos que a\u00f1adir la regla de bloqueo por encima de la anterior mostrada:</p> <pre><code>sudo nft add rule inet filter output position 11 ip daddr 37.187.119.60 tcp dport 80 ct state new,established counter drop\n</code></pre> <p>Se nos quedar\u00edan las reglas as\u00ed:</p> <p></p> <p>Pruebo que no funciona el tr\u00e1fico http saliente a <code>www.josedomingo.org</code>:</p> <pre><code>vagrant@ej1nftables1:~$ curl www.josedomingo.org\n</code></pre> <p>Se quedar\u00e1 esperando infinitamente porque no hay conexi\u00f3n.</p> <p>Pruebo a ver si funciona el tr\u00e1fico http saliente a <code>fp.josedomingo.org</code>:</p> <pre><code>vagrant@ej1nftables1:~$ curl fp.josedomingo.org\n</code></pre> <p>Tampoco hay conexi\u00f3n. No funciona ya que <code>fp.josedomingo.org</code> se acaba traduciendo a la misma IP que hemos bloqueado antes.</p> <p>Pruebo que cualquier otro tr\u00e1fico http saliente funciona:</p> <pre><code>vagrant@ej1nftables1:~$ telnet www.example.org 80\nTrying 93.184.216.34...\nConnected to www.example.org.\nEscape character is '^]'.\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#ejercicio-5","title":"Ejercicio 5","text":"<p>Permitir tr\u00e1fico saliente a babuino-smtp.gonzalonazareno.org por el puerto 25</p> <pre><code>sudo nft add rule inet filter output ip daddr 192.168.203.3 tcp dport 25 ct state new,established counter accept\nsudo nft add rule inet filter input ip saddr 192.168.203.3 tcp sport 25 ct state established counter accept\n</code></pre> <p>Pruebo que funciona con telnet:</p> <pre><code>vagrant@ej1nftables1:~$ telnet babuino-smtp.gonzalonazareno.org 25\nTrying 192.168.203.3...\nConnected to babuino-smtp.gonzalonazareno.org.\nEscape character is '^]'.\n220 babuino-smtp.gonzalonazareno.org ESMTP Postfix (Debian/GNU)\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#ejercicio-6","title":"Ejercicio 6","text":""},{"location":"sad/ej1-nftables-nodo/#parte-1","title":"Parte 1","text":"<p>Instalar mariadb-server y habilitar conexiones remotas</p> <pre><code>sudo apt install mariadb-server\n</code></pre> <p><code>/etc/mysql/mariadb.conf.d/50-server.cnf</code>:</p> <pre><code>bind-address            = 0.0.0.0\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart mariadb\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#parte-2","title":"Parte 2","text":"<p>Permitir tr\u00e1fico entrante desde mi host</p> <pre><code>sudo nft add rule inet filter input ip saddr 192.168.121.1 tcp dport 3306 counter accept\nsudo nft add rule inet filter output ip daddr 192.168.121.1 tcp sport 3306 counter accept\n</code></pre> <p>Pruebo que funciona:</p> <pre><code>atlas@olympus:~/vagrant/ej1-nftables-nodo$ nc -zvw10 192.168.121.65 3306\nConnection to 192.168.121.65 3306 port [tcp/mysql] succeeded!\n</code></pre>"},{"location":"sad/ej1-nftables-nodo/#parte-3","title":"Parte 3","text":"<p>Comprobar que desde otro cliente bloquea el tr\u00e1fico</p> <pre><code>vagrant@ej1nftables2:~$ nc -zvw10 192.168.0.2 3306\n192.168.0.2: inverse host lookup failed: Unknown host\n(UNKNOWN) [192.168.0.2] 3306 (mysql) : Connection timed out\n</code></pre>"},{"location":"sad/ej2-iptables-perimetral/","title":"Ejercicio 2 iptables: cortafuegos perimetral","text":""},{"location":"sad/ej2-iptables-perimetral/#preliminares","title":"Preliminares","text":""},{"location":"sad/ej2-iptables-perimetral/#escenario","title":"Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :perimetral do |perimetral|\n    perimetral.vm.box = \"debian/bullseye64\"\n    perimetral.vm.hostname = \"perimetral\"\n    perimetral.vm.network :public_network,\n      :dev =&gt; \"br0\",\n      :mode =&gt; \"bridge\",\n      :type =&gt; \"bridge\"\n    perimetral.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej2-iptables-perimetral\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.100.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :local do |local|\n    local.vm.box = \"debian/bullseye64\"\n    local.vm.hostname = \"local\"\n    local.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej2-iptables-perimetral\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.100.3\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre> <p>Cambio la ruta por defecto del cortafuegos: <pre><code>sudo ip route del default\nsudo ip route add default via 192.168.1.1\n</code></pre></p> <p>Cambio la ruta por defecto de la m\u00e1quina de la LAN: <pre><code>sudo ip route del default\nsudo ip route add default via 192.168.100.2\n</code></pre></p> <p>Instalo un servidor web y un servidor de correos en la m\u00e1quina de la LAN para dejar abierto el puerto 80 y el 25: <pre><code>sudo apt update\nsudo apt install apache2\nsudo apt install postfix\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#trafico-ssh-entrante-al-cortafuegos","title":"Tr\u00e1fico ssh entrante al cortafuegos","text":"<pre><code>sudo iptables -A INPUT -s 192.168.121.0/24 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -d 192.168.121.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre>"},{"location":"sad/ej2-iptables-perimetral/#politicas-por-defecto","title":"Pol\u00edticas por defecto","text":"<pre><code>sudo iptables -P INPUT DROP\nsudo iptables -P OUTPUT DROP\nsudo iptables -P FORWARD DROP\n</code></pre> <p>No puedo hacer ping a localhost: <pre><code>vagrant@perimetral:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n^C\n--- 127.0.0.1 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2052ms\n</code></pre></p> <p>No puedo hacer ping a Internet: <pre><code>vagrant@perimetral:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n^C\n--- 1.1.1.1 ping statistics ---\n4 packets transmitted, 0 received, 100% packet loss, time 3077ms\n</code></pre></p> <p>Si no se nos corta la conexi\u00f3n ssh a la m\u00e1quina despu\u00e9s de este paso, el par de reglas que aplicamos antes funcionan.</p>"},{"location":"sad/ej2-iptables-perimetral/#activar-bit-de-forward","title":"Activar bit de forward","text":"<pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n</code></pre>"},{"location":"sad/ej2-iptables-perimetral/#snat","title":"SNAT","text":"<pre><code>sudo iptables -t nat -A POSTROUTING -s 192.168.100.0/24 -o eth1 -j MASQUERADE\n</code></pre>"},{"location":"sad/ej2-iptables-perimetral/#trafico-ssh-saliente-cortafuegos-lan","title":"Tr\u00e1fico ssh saliente cortafuegos -&gt; LAN","text":"<pre><code>sudo iptables -A OUTPUT -p tcp -o eth2 -d 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -p tcp -i eth2 -s 192.168.100.0/24 --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona: <pre><code>vagrant@perimetral:~$ ssh vagrant@192.168.100.3\nLinux local 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Mon Jan 31 08:25:49 2022 from 192.168.100.2\nvagrant@local:~$\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#trafico-loopback","title":"Tr\u00e1fico loopback","text":"<pre><code>sudo iptables -A OUTPUT -o lo -p icmp -j ACCEPT\nsudo iptables -A INPUT -i lo -p icmp -j ACCEPT\n</code></pre> <p>Ya funciona el ping a localhost: <pre><code>vagrant@perimetral:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.023 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.076 ms\n^C\n--- 127.0.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1005ms\nrtt min/avg/max/mdev = 0.023/0.049/0.076/0.026 ms\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#trafico-icmp","title":"Tr\u00e1fico ICMP","text":"<p>Permito ping entrante desde la red externa: <pre><code>sudo iptables -A INPUT -i eth1 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A OUTPUT -o eth1 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-iptables-perimetral$ ping 192.168.1.110\nPING 192.168.1.110 (192.168.1.110) 56(84) bytes of data.\n64 bytes from 192.168.1.110: icmp_seq=1 ttl=64 time=0.147 ms\n64 bytes from 192.168.1.110: icmp_seq=2 ttl=64 time=0.301 ms\n^C\n--- 192.168.1.110 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1024ms\nrtt min/avg/max/mdev = 0.147/0.224/0.301/0.077 ms\n</code></pre></p> <p>Permito ping saliente cortafuegos -&gt; LAN: <pre><code>sudo iptables -A OUTPUT -o eth2 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A INPUT -i eth2 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona: <pre><code>vagrant@perimetral:~$ ping 192.168.100.3\nPING 192.168.100.3 (192.168.100.3) 56(84) bytes of data.\n64 bytes from 192.168.100.3: icmp_seq=1 ttl=64 time=0.268 ms\n64 bytes from 192.168.100.3: icmp_seq=2 ttl=64 time=0.443 ms\n^C\n--- 192.168.100.3 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1009ms\nrtt min/avg/max/mdev = 0.268/0.355/0.443/0.087 ms\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#forward-trafico-icmp-saliente-lan-internet","title":"FORWARD: tr\u00e1fico icmp saliente LAN -&gt; Internet","text":"<pre><code>sudo iptables -A FORWARD -o eth1 -i eth2 -s 192.168.100.0/24 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -o eth2 -d 192.168.100.0/24 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Pruebo que funciona el ping a Internet: <pre><code>vagrant@local:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=53 time=42.5 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=53 time=132 ms\n^C\n--- 1.1.1.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 42.503/87.035/131.567/44.532 ms\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#forward-trafico-dns-saliente-desde-lan","title":"FORWARD: tr\u00e1fico DNS saliente desde LAN","text":"<pre><code>sudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -o eth2 -i eth1 -d 192.168.100.0/24 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona: <pre><code>vagrant@local:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 3057\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    86400   IN  A   93.184.216.34\n\n;; Query time: 508 msec\n;; SERVER: 1.1.1.1#53(1.1.1.1)\n;; WHEN: Mon Jan 31 11:34:11 UTC 2022\n;; MSG SIZE  rcvd: 60\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#forward-trafico-httphttps-saliente-desde-lan","title":"FORWARD: tr\u00e1fico http/https saliente desde LAN","text":"<pre><code>sudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -p tcp -m multiport --dport 80,443 -m state --state NEW,ESTABLISHED -m time --timestart 01:00 --timestop 22:00 -j ACCEPT\nsudo iptables -A FORWARD -o eth2 -i eth1 -d 192.168.100.0/24 -p tcp -m multiport --sport 80,443 -m state --state ESTABLISHED -m time --timestart 01:00 --timestop 22:00 -j ACCEPT\n</code></pre> <p>Compruebo que funciona http: <pre><code>vagrant@local:~$ curl portquiz.net:80\nPort test successful!\nYour IP: 158.99.1.24\n</code></pre></p> <p>Compruebo que funciona https: <pre><code>vagrant@local:~$ curl portquiz.net:443\nPort test successful!\nYour IP: 158.99.1.24\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#forward-trafico-http-entrante-hacia-lan","title":"FORWARD: tr\u00e1fico http entrante hacia LAN","text":"<pre><code>sudo iptables -A FORWARD -i eth1 -o eth2 -d 192.168.100.0/24 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Necesito una regla DNAT: <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 80 -j DNAT --to 192.168.100.3\n</code></pre></p> <p>Compruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-iptables-perimetral$ telnet 192.168.1.110 80\nTrying 192.168.1.110...\nConnected to 192.168.1.110.\nEscape character is '^]'.\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicios","title":"Ejercicios","text":""},{"location":"sad/ej2-iptables-perimetral/#ejercicio-0","title":"Ejercicio 0","text":"<p>Guardar la configuraci\u00f3n del cortafuegos de forma persistente</p> <p><pre><code>sudo apt install iptables-persistent\n</code></pre> (s\u00f3lo con instalar este paquete es suficiente, ya que durante la instalaci\u00f3n se nos pregunta que si queremos guardar las reglas y s\u00f3lo tenemos que responder que s\u00ed)</p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-1","title":"Ejercicio 1","text":"<p>Permitir tr\u00e1fico ssh saliente desde la m\u00e1quina cortafuegos</p> <pre><code>sudo iptables -A OUTPUT -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona conectando a mi host: <pre><code>vagrant@perimetral:~$ ssh atlas@192.168.1.106\natlas@192.168.1.106's password:\nLinux olympus 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nYou have new mail.\nLast login: Tue Feb  1 06:35:39 2022 from 192.168.1.110\natlas@olympus:~$\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-2","title":"Ejercicio 2","text":"<p>Permitir tr\u00e1fico DNS saliente desde el cortafuegos s\u00f3lo a 192.168.202.2. Comprobar que no se puede hacer un dig @1.1.1.1</p> <pre><code>sudo iptables -A OUTPUT -d 192.168.202.2 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -s 192.168.202.2 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que las consultas DNS a 192.168.202.2 funcionan: <pre><code>vagrant@perimetral:~$ dig @192.168.202.2 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.202.2 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 27464\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: ecefbd1dc86382b6f96bcd7a61fa34bcef09c617d031a22a (good)\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    33449   IN  A   93.184.216.34\n\n;; Query time: 0 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Wed Feb 02 07:37:32 UTC 2022\n;; MSG SIZE  rcvd: 88\n</code></pre></p> <p>Pruebo que las consultas DNS a 1.1.1.1 no funcionan: <pre><code>vagrant@perimetral:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-3","title":"Ejercicio 3","text":"<p>Permitir que el cortafuegos pueda navegar por Internet</p> <pre><code>sudo iptables -A OUTPUT -o eth1 -p tcp -m multiport --dports 80,443 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -i eth1 -p tcp -m multiport --sports 80,443 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Compruebo que funciona http: <pre><code>vagrant@perimetral:~$ curl portquiz.net:80\nPort test successful!\nYour IP: 90.168.73.6\n</code></pre></p> <p>Compruebo que funciona https: <pre><code>vagrant@perimetral:~$ curl portquiz.net:443\nPort test successful!\nYour IP: 90.168.73.6\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-4","title":"Ejercicio 4","text":"<p>Los equipos de la red local deben poder tener conexi\u00f3n al exterior</p> <p>Este paso ya se hizo en las preliminares as\u00ed que no lo repito. Se necesitan 2 cosas:</p> <ul> <li>SNAT</li> <li>Reglas forward para el tr\u00e1fico ICMP saliente</li> </ul> <p>Resumen de comandos para que funcione: <pre><code>sudo iptables -t nat -A POSTROUTING -s 192.168.100.0/24 -o eth1 -j MASQUERADE\nsudo iptables -A FORWARD -o eth1 -i eth2 -s 192.168.100.0/24 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -o eth2 -d 192.168.100.0/24 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-5","title":"Ejercicio 5","text":"<p>Tr\u00e1fico ssh saliente cortafuegos -&gt; LAN</p> <p>Este paso ya se hizo en las preliminares as\u00ed que no lo repito. Se necesitan estas reglas: <pre><code>sudo iptables -A OUTPUT -p tcp -o eth2 -d 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -p tcp -i eth2 -s 192.168.100.0/24 --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-6","title":"Ejercicio 6","text":"<p>Permitir ping entrante LAN -&gt; cortafuegos:</p> <pre><code>sudo iptables -A INPUT -i eth2 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A OUTPUT -o eth2 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Pruebo que funciona: <pre><code>vagrant@local:~$ ping 192.168.100.2\nPING 192.168.100.2 (192.168.100.2) 56(84) bytes of data.\n64 bytes from 192.168.100.2: icmp_seq=1 ttl=64 time=0.355 ms\n64 bytes from 192.168.100.2: icmp_seq=2 ttl=64 time=0.259 ms\n^C\n--- 192.168.100.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1010ms\nrtt min/avg/max/mdev = 0.259/0.307/0.355/0.048 ms\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-7","title":"Ejercicio 7","text":"<p>Permitir tr\u00e1fico ssh al exterior desde la LAN</p> <pre><code>sudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -o eth2 -d 192.168.100.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona conectando a mi host para que atraviese el cortafuegos: <pre><code>vagrant@local:~$ ssh atlas@192.168.1.106\natlas@192.168.1.106's password:\nLinux olympus 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nYou have new mail.\nLast login: Tue Feb  1 21:40:41 2022 from 192.168.1.113\natlas@olympus:~$\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-8","title":"Ejercicio 8","text":"<p>Permitir acceso desde el exterior al servidor de correos de la LAN</p> <pre><code>sudo iptables -A FORWARD -i eth1 -o eth2 -d 192.168.100.0/24 -p tcp --dport 25 -j ACCEPT\nsudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -p tcp --sport 25 -j ACCEPT\nsudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 25 -j DNAT --to 192.168.100.3\n</code></pre> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-iptables-perimetral$ telnet 192.168.1.113 25\nTrying 192.168.1.113...\nConnected to 192.168.1.113.\nEscape character is '^]'.\n220 local ESMTP Postfix (Debian/GNU)\n</code></pre></p> <p>Permitir acceso desde el cortafuegos al servidor de correos de la LAN</p> <pre><code>sudo iptables -A OUTPUT -d 192.168.100.3 -p tcp --dport 25 -j ACCEPT\nsudo iptables -A INPUT -s 192.168.100.3 -p tcp --sport 25 -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde el cortafuegos: <pre><code>vagrant@perimetral:~$ telnet 192.168.100.3 25\nTrying 192.168.100.3...\nConnected to 192.168.100.3.\nEscape character is '^]'.\n220 local ESMTP Postfix (Debian/GNU)\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-9","title":"Ejercicio 9","text":"<p>Permitir tr\u00e1fico ssh desde el exterior a la LAN</p> <pre><code>sudo iptables -A FORWARD -i eth1 -o eth2 -d 192.168.100.0/24 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\nsudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 22 -j DNAT --to 192.168.100.3\n</code></pre> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-iptables-perimetral$ ssh vagrant@192.168.1.113\nLinux local 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Tue Feb  1 20:01:00 2022 from 192.168.100.2\nvagrant@local:~$\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-10","title":"Ejercicio 10","text":"<p>Modifica la regla anterior, para que al acceder desde el exterior por ssh tengamos que conectar al puerto 2222, aunque el servidor ssh este configurado para acceder por el puerto 22</p> <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 2222 -j DNAT --to-destination 192.168.100.3:22\n</code></pre> <p>Pruebo que funciona: <pre><code>atlas@olympus:~/vagrant/ej2-iptables-perimetral$ ssh -p 2222 vagrant@192.168.1.113\nLinux local 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Tue Feb  1 23:54:20 2022 from 192.168.1.106\nvagrant@local:~$\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-11","title":"Ejercicio 11","text":"<p>Permitir consultas DNS desde la LAN s\u00f3lo al servidor 192.168.202.2. Comprueba que no puedes hacer un dig @1.1.1.1</p> <pre><code>sudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -d 192.168.202.2 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -o eth2 -s 192.168.202.2 -d 192.168.100.0/24 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que las consultas DNS a 192.168.202.2 funcionan: <pre><code>vagrant@local:~$ dig @192.168.202.2 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; @192.168.202.2 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 21410\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: a69a6f7c799135d6042bcb5f61fa3a83c62614c5b25bc08b (good)\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    31970   IN  A   93.184.216.34\n\n;; Query time: 4 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Wed Feb 02 08:02:11 UTC 2022\n;; MSG SIZE  rcvd: 88\n</code></pre></p> <p>Pruebo que las consultas DNS a 1.1.1.1 no funcionan: <pre><code>vagrant@local:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre></p>"},{"location":"sad/ej2-iptables-perimetral/#ejercicio-12","title":"Ejercicio 12","text":"<p>Permite que los equipos de la LAN puedan navegar por Internet</p> <p>Este paso ya se hizo en las preliminares as\u00ed que no lo repito. Se necesitan estas reglas: <pre><code>sudo iptables -A FORWARD -i eth2 -o eth1 -s 192.168.100.0/24 -p tcp -m multiport --dport 80,443 -m state --state NEW,ESTABLISHED -m time --timestart 01:00 --timestop 22:00 -j ACCEPT\nsudo iptables -A FORWARD -o eth2 -i eth1 -d 192.168.100.0/24 -p tcp -m multiport --sport 80,443 -m state --state ESTABLISHED -m time --timestart 01:00 --timestop 22:00 -j ACCEPT\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/","title":"Ejercicio 2 nftables: cortafuegos perimetral","text":""},{"location":"sad/ej2-nftables-perimetral/#preliminares","title":"Preliminares","text":""},{"location":"sad/ej2-nftables-perimetral/#escenario","title":"Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :perimetral do |perimetral|\n    perimetral.vm.box = \"debian/bullseye64\"\n    perimetral.vm.hostname = \"perimetral\"\n    perimetral.vm.network :public_network,\n      :dev =&gt; \"br0\",\n      :mode =&gt; \"bridge\",\n      :type =&gt; \"bridge\"\n    perimetral.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej2-nftables-perimetral\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.100.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :local do |local|\n    local.vm.box = \"debian/bullseye64\"\n    local.vm.hostname = \"local\"\n    local.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej2-nftables-perimetral\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.100.3\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre> <p>Cambio la ruta por defecto del cortafuegos: <pre><code>sudo ip route del default\nsudo ip route add default via 172.22.0.1\n</code></pre></p> <p>Cambio la ruta por defecto de la m\u00e1quina de la LAN: <pre><code>sudo ip route del default\nsudo ip route add default via 192.168.100.2\n</code></pre></p> <p>Instalo un servidor web y un servidor de correos en la m\u00e1quina de la LAN para dejar abierto el puerto 80 y el 25: <pre><code>sudo apt update\nsudo apt install apache2 postfix\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#preparacion-nftables","title":"Preparaci\u00f3n nftables","text":"<p>Creo las tablas filter y nat: <pre><code>sudo nft add table inet filter\nsudo nft add table inet nat\n</code></pre></p> <p>Creo las cadenas de filter: <pre><code>sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy accept \\; }\nsudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy accept \\; }\nsudo nft add chain inet filter forward { type filter hook forward priority 0 \\; counter \\; policy accept \\; }\n</code></pre></p> <p>Creo las cadenas de nat: <pre><code>sudo nft add chain inet nat prerouting { type nat hook prerouting priority 0 \\; }\nsudo nft add chain inet nat postrouting { type nat hook postrouting priority 100 \\; }\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#trafico-ssh-entrante-al-cortafuegos","title":"Tr\u00e1fico ssh entrante al cortafuegos","text":"<pre><code>sudo nft add rule inet filter input ip saddr 192.168.121.0/24 tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter output ip daddr 192.168.121.0/24 tcp sport 22 ct state established counter accept\n</code></pre>"},{"location":"sad/ej2-nftables-perimetral/#politicas-por-defecto","title":"Pol\u00edticas por defecto","text":"<pre><code>sudo nft chain inet filter input { policy drop \\; }\nsudo nft chain inet filter output { policy drop \\; }\nsudo nft chain inet filter forward { policy drop \\; }\n</code></pre> <p>No puedo hacer ping a localhost: <pre><code>vagrant@perimetral:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n^C\n--- 127.0.0.1 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2049ms\n</code></pre></p> <p>No puedo hacer ping a Internet: <pre><code>vagrant@perimetral:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n^C\n--- 1.1.1.1 ping statistics ---\n4 packets transmitted, 0 received, 100% packet loss, time 3075ms\n</code></pre></p> <p>Si no se nos corta la conexi\u00f3n ssh a la m\u00e1quina despu\u00e9s de este paso, el par de reglas que aplicamos antes funcionan.</p>"},{"location":"sad/ej2-nftables-perimetral/#activar-bit-de-forward","title":"Activar bit de forward","text":"<pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n</code></pre>"},{"location":"sad/ej2-nftables-perimetral/#snat","title":"SNAT","text":"<pre><code>sudo nft add rule inet nat postrouting oifname \"eth1\" ip saddr 192.168.100.0/24 counter masquerade\n</code></pre>"},{"location":"sad/ej2-nftables-perimetral/#trafico-ssh-saliente-cortafuegos-lan","title":"Tr\u00e1fico ssh saliente cortafuegos -&gt; LAN","text":"<pre><code>sudo nft add rule inet filter output oifname \"eth2\" ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter input iifname \"eth2\" ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept\n</code></pre> <p>Pruebo que funciona: <pre><code>vagrant@perimetral:~$ ssh vagrant@192.168.100.3\nLinux local 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Wed Feb  2 09:05:39 2022 from 192.168.121.1\nvagrant@local:~$\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#trafico-loopback","title":"Tr\u00e1fico loopback","text":"<pre><code>sudo nft add rule inet filter output oifname \"lo\" counter accept\nsudo nft add rule inet filter input iifname \"lo\" counter accept\n</code></pre> <p>Ya funciona el ping a localhost: <pre><code>vagrant@perimetral:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.102 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.033 ms\n^C\n--- 127.0.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1014ms\nrtt min/avg/max/mdev = 0.033/0.067/0.102/0.034 ms\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#trafico-icmp","title":"Tr\u00e1fico ICMP","text":"<p>Permito ping entrante desde la red externa: <pre><code>sudo nft add rule inet filter input iifname \"eth1\" icmp type echo-request counter accept\nsudo nft add rule inet filter output oifname \"eth1\" icmp type echo-reply counter accept\n</code></pre></p> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-nftables-perimetral$ ping 172.22.7.193\nPING 172.22.7.193 (172.22.7.193) 56(84) bytes of data.\n64 bytes from 172.22.7.193: icmp_seq=1 ttl=64 time=0.278 ms\n64 bytes from 172.22.7.193: icmp_seq=2 ttl=64 time=0.232 ms\n^C\n--- 172.22.7.193 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1028ms\nrtt min/avg/max/mdev = 0.232/0.255/0.278/0.023 ms\n</code></pre></p> <p>Permito ping saliente cortafuegos -&gt; LAN: <pre><code>sudo nft add rule inet filter output oifname \"eth2\" icmp type echo-request counter accept\nsudo nft add rule inet filter input iifname \"eth2\" icmp type echo-reply counter accept\n</code></pre></p> <p>Pruebo que funciona: <pre><code>vagrant@perimetral:~$ ping 192.168.100.3\nPING 192.168.100.3 (192.168.100.3) 56(84) bytes of data.\n64 bytes from 192.168.100.3: icmp_seq=1 ttl=64 time=0.398 ms\n64 bytes from 192.168.100.3: icmp_seq=2 ttl=64 time=0.325 ms\n^C\n--- 192.168.100.3 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1031ms\nrtt min/avg/max/mdev = 0.325/0.361/0.398/0.036 ms\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#forward-trafico-icmp-saliente-lan-internet","title":"FORWARD: tr\u00e1fico icmp saliente LAN -&gt; Internet","text":"<pre><code>sudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 icmp type echo-request counter accept\nsudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip daddr 192.168.100.0/24 icmp type echo-reply counter accept\n</code></pre> <p>Pruebo que funciona el ping a Internet: <pre><code>vagrant@local:~$ ping 1.1.1.1 -c 2\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=438 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=54 time=171 ms\n\n--- 1.1.1.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1000ms\nrtt min/avg/max/mdev = 170.639/304.483/438.327/133.844 ms\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#forward-trafico-dns-saliente-desde-lan","title":"FORWARD: tr\u00e1fico DNS saliente desde LAN","text":"<pre><code>sudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 udp dport 53 ct state new,established counter accept\nsudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip daddr 192.168.100.0/24 udp sport 53 ct state established counter accept\n</code></pre> <p>Pruebo que funciona: <pre><code>vagrant@local:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 7637\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    86400   IN  A   93.184.216.34\n\n;; Query time: 516 msec\n;; SERVER: 1.1.1.1#53(1.1.1.1)\n;; WHEN: Wed Feb 02 12:00:55 UTC 2022\n;; MSG SIZE  rcvd: 60\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#forward-trafico-httphttps-saliente-desde-lan","title":"FORWARD: tr\u00e1fico http/https saliente desde LAN","text":"<pre><code>sudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80,443 } ct state new,established counter accept\nsudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80,443 } ct state established counter accept\n</code></pre> <p>Compruebo que funciona http: <pre><code>vagrant@local:~$ curl portquiz.net:80\nPort test successful!\nYour IP: 158.99.1.24\n</code></pre></p> <p>Compruebo que funciona https: <pre><code>vagrant@local:~$ curl portquiz.net:443\nPort test successful!\nYour IP: 158.99.1.24\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#forward-trafico-http-entrante-hacia-lan","title":"FORWARD: tr\u00e1fico http entrante hacia LAN","text":"<pre><code>sudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip daddr 192.168.100.0/24 tcp dport 80 ct state new,established counter accept\nsudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter accept\n</code></pre> <p>Necesito una regla DNAT: <pre><code>sudo nft add rule inet nat prerouting iifname \"eth1\" tcp dport 80 counter dnat ip to 192.168.100.3\n</code></pre></p> <p>Compruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-nftables-perimetral$ telnet 172.22.7.193 80\nTrying 172.22.7.193...\nConnected to 172.22.7.193.\nEscape character is '^]'.\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicios","title":"Ejercicios","text":""},{"location":"sad/ej2-nftables-perimetral/#ejercicio-0","title":"Ejercicio 0","text":"<p>Guardar la configuraci\u00f3n del cortafuegos de forma persistente</p> <pre><code>nft list ruleset &gt; /etc/nftables.conf\nsudo systemctl enable nftables\nsudo systemctl start nftables\n</code></pre>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-1","title":"Ejercicio 1","text":"<p>Permitir tr\u00e1fico ssh saliente al exterior desde la m\u00e1quina cortafuegos</p> <pre><code>sudo nft add rule inet filter output oifname \"eth1\" tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter input iifname \"eth1\" tcp sport 22 ct state established counter accept\n</code></pre> <p>Pruebo que funciona conectando a mi host: <pre><code>vagrant@perimetral:~$ ssh atlas@192.168.1.106\natlas@192.168.1.106's password:\nLinux olympus 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nYou have new mail.\nLast login: Wed Feb  2 22:45:29 2022 from 192.168.1.114\natlas@olympus:~$\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-2","title":"Ejercicio 2","text":"<p>Permitir tr\u00e1fico DNS saliente desde el cortafuegos s\u00f3lo a 192.168.202.2. Comprobar que no se puede hacer un dig @1.1.1.1</p> <pre><code>sudo nft add rule inet filter output ip daddr 192.168.202.2 udp dport 53 ct state new,established counter accept\nsudo nft add rule inet filter input ip saddr 192.168.202.2 udp sport 53 ct state established counter accept\n</code></pre> <p>Pruebo que las consultas DNS a 192.168.202.2 funcionan: <pre><code>vagrant@perimetral:~$ dig @192.168.202.2 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.202.2 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 39297\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: 7eeeb71280505e6e78cad2c561fa79dd3cddfb164ad3691c (good)\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    15752   IN  A   93.184.216.34\n\n;; Query time: 0 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Wed Feb 02 12:32:29 UTC 2022\n;; MSG SIZE  rcvd: 88\n</code></pre></p> <p>Pruebo que las consultas DNS a 1.1.1.1 no funcionan: <pre><code>vagrant@perimetral:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-3","title":"Ejercicio 3","text":"<p>Permitir que el cortafuegos pueda navegar por Internet</p> <pre><code>sudo nft add rule inet filter output oifname \"eth1\" ip protocol tcp tcp dport { 80,443 } ct state new,established counter accept\nsudo nft add rule inet filter input iifname \"eth1\" ip protocol tcp tcp sport { 80,443 } ct state established counter accept\n</code></pre> <p>Compruebo que funciona http: <pre><code>vagrant@perimetral:~$ telnet 52.47.209.216 80\nTrying 52.47.209.216...\nConnected to 52.47.209.216.\nEscape character is '^]'.\n</code></pre></p> <p>Compruebo que funciona https: <pre><code>vagrant@perimetral:~$ telnet 52.47.209.216 443\nTrying 52.47.209.216...\nConnected to 52.47.209.216.\nEscape character is '^]'.\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-4","title":"Ejercicio 4","text":"<p>Los equipos de la red local deben poder tener conexi\u00f3n al exterior</p> <p>Este paso ya se hizo en las preliminares as\u00ed que no lo repito. Se necesitan 2 cosas:</p> <ul> <li>SNAT</li> <li>Reglas forward para el tr\u00e1fico ICMP saliente</li> </ul> <p>Resumen de comandos para que funcione: <pre><code>sudo nft add rule inet nat postrouting oifname \"eth1\" ip saddr 192.168.100.0/24 counter masquerade\nsudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 icmp type echo-request counter accept\nsudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip daddr 192.168.100.0/24 icmp type echo-reply counter accept\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-5","title":"Ejercicio 5","text":"<p>Tr\u00e1fico ssh saliente cortafuegos -&gt; LAN</p> <p>Este paso ya se hizo en las preliminares as\u00ed que no lo repito. Se necesitan estas reglas: <pre><code>sudo nft add rule inet filter output oifname \"eth2\" ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter input iifname \"eth2\" ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-6","title":"Ejercicio 6","text":"<p>Permitir ping entrante LAN -&gt; cortafuegos:</p> <pre><code>sudo nft add rule inet filter input iifname \"eth2\" icmp type echo-request counter accept\nsudo nft add rule inet filter output oifname \"eth2\" icmp type echo-reply counter accept\n</code></pre> <p>Pruebo que funciona: <pre><code>vagrant@local:~$ ping 192.168.100.2\nPING 192.168.100.2 (192.168.100.2) 56(84) bytes of data.\n64 bytes from 192.168.100.2: icmp_seq=1 ttl=64 time=0.312 ms\n64 bytes from 192.168.100.2: icmp_seq=2 ttl=64 time=0.539 ms\n^C\n--- 192.168.100.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1006ms\nrtt min/avg/max/mdev = 0.312/0.425/0.539/0.113 ms\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-7","title":"Ejercicio 7","text":"<p>Permitir tr\u00e1fico ssh al exterior desde la LAN</p> <pre><code>sudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter accept\n</code></pre> <p>Pruebo que funciona conectando a mi host para que atraviese el cortafuegos: <pre><code>vagrant@local:~$ ssh atlas@192.168.1.106\natlas@192.168.1.106's password:\nLinux olympus 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nYou have new mail.\nLast login: Thu Feb  3 01:31:42 2022 from 192.168.1.114\natlas@olympus:~$\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-8","title":"Ejercicio 8","text":"<p>Permitir acceso desde el exterior al servidor de correos de la LAN</p> <pre><code>sudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip daddr 192.168.100.0/24 tcp dport 25 counter accept\nsudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 tcp sport 25 counter accept\nsudo nft add rule inet nat prerouting iifname \"eth1\" tcp dport 25 counter dnat ip to 192.168.100.3\n</code></pre> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-nftables-perimetral$ telnet 172.22.7.193 25\nTrying 172.22.7.193...\nConnected to 172.22.7.193.\nEscape character is '^]'.\n220 local ESMTP Postfix (Debian/GNU)\n</code></pre></p> <p>Permitir acceso desde el cortafuegos al servidor de correos de la LAN</p> <pre><code>sudo nft add rule inet filter output ip daddr 192.168.100.3 tcp dport 25 counter accept\nsudo nft add rule inet filter input ip saddr 192.168.100.3 tcp sport 25 counter accept\n</code></pre> <p>Pruebo que funciona desde el cortafuegos: <pre><code>vagrant@perimetral:~$ telnet 192.168.100.3 25\nTrying 192.168.100.3...\nConnected to 192.168.100.3.\nEscape character is '^]'.\n220 local ESMTP Postfix (Debian/GNU)\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-9","title":"Ejercicio 9","text":"<p>Permitir tr\u00e1fico ssh desde el exterior a la LAN</p> <pre><code>sudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept\nsudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept\nsudo nft add rule inet nat prerouting iifname \"eth1\" tcp dport 22 counter dnat ip to 192.168.100.3\n</code></pre> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/ej2-nftables-perimetral$ ssh vagrant@172.22.7.193\nLinux local 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Thu Feb  3 07:37:45 2022 from 192.168.100.2\nvagrant@local:~$\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-10","title":"Ejercicio 10","text":"<p>Modifica la regla anterior, para que al acceder desde el exterior por ssh tengamos que conectar al puerto 2222, aunque el servidor ssh este configurado para acceder por el puerto 22</p> <pre><code>sudo nft add rule inet nat prerouting iifname \"eth1\" tcp dport 2222 counter dnat ip to 192.168.100.3:22\n</code></pre> <p>Pruebo que funciona: <pre><code>atlas@olympus:~/vagrant/ej2-nftables-perimetral$ ssh -p 2222 vagrant@172.22.7.193\nLinux local 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Thu Feb  3 08:06:47 2022 from 172.22.9.227\nvagrant@local:~$\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-11","title":"Ejercicio 11","text":"<p>Permitir consultas DNS desde la LAN s\u00f3lo al servidor 192.168.202.2. Comprueba que no puedes hacer un dig @1.1.1.1</p> <pre><code>sudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip saddr 192.168.100.0/24 ip daddr 192.168.202.2 udp dport 53 ct state new,established counter accept\nsudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip saddr 192.168.202.2 ip daddr 192.168.100.0/24 udp sport 53 ct state established counter accept\n</code></pre> <p>Pruebo que las consultas DNS a 192.168.202.2 funcionan: <pre><code>vagrant@local:~$ dig @192.168.202.2 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.202.2 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45511\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 5\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: e8ba7a0a4e288162253fa85561fb919daab6c9aee27df0e8 (good)\n;; QUESTION SECTION:\n;www.example.org.           IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    83378   IN  A   93.184.216.34\n\n;; AUTHORITY SECTION:\nexample.org.            82302   IN  NS  b.iana-servers.net.\nexample.org.            82302   IN  NS  a.iana-servers.net.\n\n;; ADDITIONAL SECTION:\na.iana-servers.net. 82275   IN  A   199.43.135.53\nb.iana-servers.net. 82275   IN  A   199.43.133.53\na.iana-servers.net. 82275   IN  AAAA    2001:500:8f::53\nb.iana-servers.net. 82275   IN  AAAA    2001:500:8d::53\n\n;; Query time: 0 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Thu Feb 03 08:26:05 UTC 2022\n;; MSG SIZE  rcvd: 224\n</code></pre></p> <p>Pruebo que las consultas DNS a 1.1.1.1 no funcionan: <pre><code>vagrant@local:~$ dig @1.1.1.1 www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @1.1.1.1 www.example.org\n; (1 server found)\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre></p>"},{"location":"sad/ej2-nftables-perimetral/#ejercicio-12","title":"Ejercicio 12","text":"<p>Permite que los equipos de la LAN puedan navegar por Internet</p> <p>Este paso ya se hizo en las preliminares as\u00ed que no lo repito. Se necesitan estas reglas: <pre><code>sudo nft add rule inet filter forward iifname \"eth2\" oifname \"eth1\" ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80,443 } ct state new,established counter accept\nsudo nft add rule inet filter forward iifname \"eth1\" oifname \"eth2\" ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80,443 } ct state established counter accept\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/","title":"Pr\u00e1ctica iptables: perimetral sobre escenario","text":"<p>ATENCI\u00d3N: La IP p\u00fablica de Zeus en este escenario es posible que cambie durante las demostraciones ya que este es un escenario que funciona tanto en clase como en casa, y existen 2 direccionamientos distintos. </p>"},{"location":"sad/perimetral-iptables-escenario/#parte-1","title":"Parte 1","text":"<p>Mostrar escenario del que se parte</p> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\nconfig.vm.provider :libvirt do |libvirt|\n  libvirt.cpus = 1\n  libvirt.memory = 512\nend\n\n  config.vm.define :zeus do |zeus|\n    zeus.vm.box = \"debian/bullseye64\"\n    zeus.vm.hostname = \"zeus\"\n    zeus.vm.network :public_network,\n      :dev =&gt; \"br0\",\n      :mode =&gt; \"bridge\",\n      :type =&gt; \"bridge\"\n    zeus.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-dmz-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"172.16.0.1\",\n      :libvirt__netmask =&gt; '255.255.0.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    zeus.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-interna-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :hera do |hera|\n    hera.vm.box = \"rockylinux/8\"\n    hera.vm.hostname = \"hera\"\n    hera.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-dmz-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"172.16.0.200\",\n      :libvirt__netmask =&gt; '255.255.0.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :apolo do |apolo|\n    apolo.vm.box = \"debian/bullseye64\"\n    apolo.vm.hostname = \"apolo\"\n    apolo.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-interna-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.102\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :ares do |ares|\n    ares.vm.box = \"generic/ubuntu2004\"\n    ares.vm.hostname = \"ares\"\n    ares.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-interna-de-adrianj\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.101\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-2","title":"Parte 2","text":"<p>Mostrar el estado iptables del que se parte</p> <p>Tabla filter: <pre><code>vagrant@zeus:~$ sudo iptables -L -v -n\n# Warning: iptables-legacy tables present, use iptables-legacy to see them\nChain INPUT (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain FORWARD (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n</code></pre></p> <p>Tabla nat: <pre><code>vagrant@zeus:~$ sudo iptables -L -v -n -t nat\n# Warning: iptables-legacy tables present, use iptables-legacy to see them\nChain PREROUTING (policy ACCEPT 437 packets, 87098 bytes)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 DNAT       udp  --  eth1   *       0.0.0.0/0            0.0.0.0/0            udp dpt:53 to:10.0.1.102:53\n    0     0 DNAT       tcp  --  eth1   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:172.16.0.200:80\n    0     0 DNAT       tcp  --  eth1   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:25 to:10.0.1.102:25\n\nChain INPUT (policy ACCEPT 41 packets, 10816 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 12 packets, 873 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain POSTROUTING (policy ACCEPT 4 packets, 257 bytes)\n pkts bytes target     prot opt in     out     source               destination\n   36  2986 MASQUERADE  all  --  *      eth1    0.0.0.0/0            0.0.0.0/0\n</code></pre></p> <p>Mismas reglas NAT pero en comandos: <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p udp --dport 53 -j DNAT --to-destination 10.0.1.102:53\nsudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 80 -j DNAT --to-destination 172.16.0.200:80\nsudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 25 -j DNAT --to-destination 10.0.1.102:25\nsudo iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-3","title":"Parte 3","text":"<p>Redigir puertos 2222-22 en Zeus desde el exterior</p> <p>DNAT para mi casa y para clase: <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -s 172.22.0.0/16 -p tcp --dport 2222 -j DNAT --to-destination 172.22.0.213:22\nsudo iptables -t nat -A PREROUTING -i eth1 -s 192.168.1.0/24 -p tcp --dport 2222 -j DNAT --to-destination 192.168.1.115:22\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-4","title":"Parte 4","text":"<p>Permitir tr\u00e1fico ssh entrante exterior \u2192 Zeus</p> <pre><code>sudo iptables -A INPUT -i eth1 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -o eth1 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~/vagrant/escenario-libvirt$ ssh zeus-casa\nLinux zeus 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\n @@@@@@@@ @@@@@@@@ @@@  @@@  @@@@@@\n      @@! @@!      @@!  @@@ !@@\n    @!!   @!!!:!   @!@  !@!  !@@!!\n  !!:     !!:      !!:  !!!     !:!\n :.::.: : : :: :::  :.:: :  ::.: :\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Sun Feb  6 16:53:51 2022 from 192.168.1.106\nvagrant@zeus:~$\n</code></pre> (no escribo el puerto 2222 al conectar porque ya est\u00e1 en mi config ssh. Ver la siguiente parte para m\u00e1s informaci\u00f3n)</p> <p>Que funcione esta conexi\u00f3n significa que tanto las reglas de este paso como del anterior funcionan.</p>"},{"location":"sad/perimetral-iptables-escenario/#parte-5","title":"Parte 5","text":"<p>Permitir tr\u00e1fico ssh para hacer proxyjump desde zeus</p> <p>Seg\u00fan como estaba planteado nuestro escenario, se ten\u00eda que acceder a la DMZ y a la LAN a trav\u00e9s de zeus por ssh. Esto nos obliga a a\u00f1adir reglas INPUT/OUPUT desde zeus hacia estas redes, para que el salto SSH pueda funcionar.</p> <p>Muestro la parte correspondiente de mi <code>.ssh/config</code>, para que sepamos de d\u00f3nde partimos: <pre><code>#####################\n# escenario libvirt #\n#####################\n\nHost zeus-clase\n    HostName 172.22.0.213\n    User vagrant\n    Port 2222\n\nHost zeus-casa\n    HostName 192.168.1.115\n    User vagrant\n    Port 2222\n\nHost apolo-clase\n  HostName 10.0.1.102\n  User vagrant\n  ProxyJump zeus-clase\n\nHost apolo-casa\n  HostName 10.0.1.102\n  User vagrant\n  ProxyJump zeus-casa\n\nHost ares-clase\n  HostName 10.0.1.101\n  User vagrant\n  ProxyJump zeus-clase\n\nHost ares-casa\n  HostName 10.0.1.101\n  User vagrant\n  ProxyJump zeus-casa\n\nHost hera-clase\n  HostName 172.16.0.200\n  User vagrant\n  ProxyJump zeus-clase\n\nHost hera-casa\n  HostName 172.16.0.200\n  User vagrant\n  ProxyJump zeus-casa\n</code></pre></p> <p>Tr\u00e1fico ssh saliente zeus \u2192 DMZ: <pre><code>sudo iptables -A OUTPUT -o eth2 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -i eth2 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre></p> <p>Tr\u00e1fico ssh saliente zeus \u2192 LAN: <pre><code>sudo iptables -A OUTPUT -o eth3 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -i eth3 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre></p> <p>Pruebo que puedo conectar a Hera desde mi host: <pre><code>atlas@olympus:~/vagrant/escenario-libvirt$ ssh hera-casa\n\n @@@  @@@ @@@@@@@@ @@@@@@@   @@@@@@\n @@!  @@@ @@!      @@!  @@@ @@!  @@@\n @!@!@!@! @!!!:!   @!@!!@!  @!@!@!@!\n !!:  !!! !!:      !!: :!!  !!:  !!!\n  :   : : : :: :::  :   : :  :   : :\n\nLast login: Sun Feb  6 16:08:56 2022 from 172.16.0.1\n[vagrant@hera ~]$\n</code></pre></p> <p>Pruebo que puedo conectar a Apolo desde mi host: <pre><code>atlas@olympus:~/vagrant/escenario-libvirt$ ssh apolo-casa\nLinux apolo 5.10.0-10-amd64 #1 SMP Debian 5.10.84-1 (2021-12-08) x86_64\n\n  @@@@@@  @@@@@@@   @@@@@@  @@@       @@@@@@\n @@!  @@@ @@!  @@@ @@!  @@@ @@!      @@!  @@@\n @!@!@!@! @!@@!@!  @!@  !@! @!!      @!@  !@!\n !!:  !!! !!:      !!:  !!! !!:      !!:  !!!\n  :   : :  :        : :. :  : ::.: :  : :. :\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nYou have mail.\nLast login: Sun Feb  6 16:07:35 2022 from 10.0.1.1\nvagrant@apolo:~$\n</code></pre></p> <p>Pruebo que puedo conectar a Ares desde mi host: <pre><code>atlas@olympus:~/vagrant/escenario-libvirt$ ssh ares-casa\n\n  @@@@@@  @@@@@@@  @@@@@@@@  @@@@@@\n @@!  @@@ @@!  @@@ @@!      !@@\n @!@!@!@! @!@!!@!  @!!!:!    !@@!!\n !!:  !!! !!: :!!  !!:          !:!\n  :   : :  :   : : : :: ::: ::.: :\n\nLast login: Thu Feb  3 12:06:44 2022 from 192.168.121.1\nvagrant@ares:~$\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-6","title":"Parte 6","text":"<p>Pol\u00edticas por defecto</p> <pre><code>sudo iptables -P INPUT DROP\nsudo iptables -P OUTPUT DROP\nsudo iptables -P FORWARD DROP\n</code></pre> <p>Si no se nos cortan las conexiones ssh a las m\u00e1quinas despu\u00e9s de este paso, las reglas que aplicamos antes funcionan.</p>"},{"location":"sad/perimetral-iptables-escenario/#parte-7","title":"Parte 7","text":"<p>Permitir tr\u00e1fico ssh Apolo-Hera \u2192 Zeus</p> <pre><code>sudo iptables -A INPUT -s 10.0.1.102,172.16.0.200 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A OUTPUT -d 10.0.1.102,172.16.0.200 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde Apolo: <pre><code>vagrant@apolo:~$ ssh vagrant@10.0.1.1\nLinux zeus 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\n @@@@@@@@ @@@@@@@@ @@@  @@@  @@@@@@\n      @@! @@!      @@!  @@@ !@@\n    @!!   @!!!:!   @!@  !@!  !@@!!\n  !!:     !!:      !!:  !!!     !:!\n :.::.: : : :: :::  :.:: :  ::.: :\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Sun Feb  6 17:38:17 2022 from 10.0.1.102\nvagrant@zeus:~$\n</code></pre></p> <p>Pruebo que funciona desde Hera: <pre><code>[vagrant@hera ~]$ ssh vagrant@172.16.0.1\nLinux zeus 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30) x86_64\n\n @@@@@@@@ @@@@@@@@ @@@  @@@  @@@@@@\n      @@! @@!      @@!  @@@ !@@\n    @!!   @!!!:!   @!@  !@!  !@@!!\n  !!:     !!:      !!:  !!!     !:!\n :.::.: : : :: :::  :.:: :  ::.: :\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Sun Feb  6 17:38:19 2022 from 10.0.1.102\nvagrant@zeus:~$\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-8","title":"Parte 8","text":"<p>Permitir tr\u00e1fico loopback en Zeus</p> <pre><code>sudo iptables -A OUTPUT -o lo -p icmp -j ACCEPT\nsudo iptables -A INPUT -i lo -p icmp -j ACCEPT\n</code></pre> <p>Ya funciona el ping a localhost: <pre><code>vagrant@zeus:~$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.064 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.095 ms\n^C\n--- 127.0.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1020ms\nrtt min/avg/max/mdev = 0.064/0.079/0.095/0.015 ms\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-9","title":"Parte 9","text":"<p>Permitir ping entrante DMZ \u2192 Zeus</p> <pre><code>sudo iptables -A INPUT -i eth2 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A OUTPUT -o eth2 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde Hera: <pre><code>[vagrant@hera ~]$ ping 172.16.0.1\nPING 172.16.0.1 (172.16.0.1) 56(84) bytes of data.\n64 bytes from 172.16.0.1: icmp_seq=1 ttl=64 time=0.267 ms\n64 bytes from 172.16.0.1: icmp_seq=2 ttl=64 time=0.492 ms\n^C\n--- 172.16.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1020ms\nrtt min/avg/max/mdev = 0.267/0.379/0.492/0.114 ms\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-10","title":"Parte 10","text":"<p>Rechazar ping entrante LAN \u2192 Zeus</p> <pre><code>sudo iptables -A INPUT -i eth3 -p icmp -m icmp --icmp-type echo-request -j REJECT\n</code></pre> <p>Pruebo que bloquea el ping desde Ares: <pre><code>vagrant@ares:~$ ping 10.0.1.1\nPING 10.0.1.1 (10.0.1.1) 56(84) bytes of data.\n^C\n--- 10.0.1.1 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2037ms\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-11","title":"Parte 11","text":"<p>Bloquear ping entrante exterior \u2192 Zeus</p> <p>La pol\u00edtica por defecto de INPUT la tenemos a DROP, y tampoco tenemos reglas en este momento que acepten el ping entrante desde el exterior (eth1): <pre><code>Chain INPUT (policy DROP 37915 packets, 1859K bytes)\n pkts bytes target     prot opt in     out     source               destination\n19351 1298K ACCEPT     tcp  --  eth1   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22 state NEW,ESTABLISHED\n  221 47538 ACCEPT     tcp  --  eth2   *       0.0.0.0/0            0.0.0.0/0            tcp spt:22 state ESTABLISHED\n   83 14061 ACCEPT     tcp  --  eth3   *       0.0.0.0/0            0.0.0.0/0            tcp spt:22 state ESTABLISHED\n  115 14256 ACCEPT     tcp  --  *      *       10.0.1.102           0.0.0.0/0            tcp dpt:22 state NEW,ESTABLISHED\n   66  9222 ACCEPT     tcp  --  *      *       172.16.0.200         0.0.0.0/0            tcp dpt:22 state NEW,ESTABLISHED\n    8   672 ACCEPT     icmp --  lo     *       0.0.0.0/0            0.0.0.0/0\n    6   504 ACCEPT     icmp --  eth2   *       0.0.0.0/0            0.0.0.0/0            icmptype 8\n   11   924 REJECT     icmp --  eth3   *       0.0.0.0/0            0.0.0.0/0            icmptype 8 reject-with icmp-port-unreachable\n</code></pre> Esto significa que no necesitamos a\u00f1adir ninguna regla adicional para que se deniegue el ping entrante a Zeus desde el exterior.</p>"},{"location":"sad/perimetral-iptables-escenario/#parte-12","title":"Parte 12","text":"<p>Permitir ping saliente Zeus \u2192 LAN-DMZ</p> <pre><code>sudo iptables -A OUTPUT -d 10.0.1.0/24,172.16.0.0/16 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A INPUT -s 10.0.1.0/24,172.16.0.0/16 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Pruebo que funciona el ping a Hera: <pre><code>vagrant@zeus:~$ ping 172.16.0.200\nPING 172.16.0.200 (172.16.0.200) 56(84) bytes of data.\n64 bytes from 172.16.0.200: icmp_seq=1 ttl=64 time=0.675 ms\n64 bytes from 172.16.0.200: icmp_seq=2 ttl=64 time=0.584 ms\n^C\n--- 172.16.0.200 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1030ms\nrtt min/avg/max/mdev = 0.584/0.629/0.675/0.045 ms\n</code></pre></p> <p>Pruebo que funciona el ping a Ares: <pre><code>vagrant@zeus:~$ ping 10.0.1.101\nPING 10.0.1.101 (10.0.1.101) 56(84) bytes of data.\n64 bytes from 10.0.1.101: icmp_seq=1 ttl=64 time=0.532 ms\n64 bytes from 10.0.1.101: icmp_seq=2 ttl=64 time=0.359 ms\n^C\n--- 10.0.1.101 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1020ms\nrtt min/avg/max/mdev = 0.359/0.445/0.532/0.086 ms\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-13","title":"Parte 13","text":"<p>Permitir ping saliente Zeus \u2192 exterior</p> <pre><code>sudo iptables -A OUTPUT -o eth1 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A INPUT -i eth1 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Pruebo que funciona: <pre><code>vagrant@zeus:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=55 time=19.1 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=55 time=19.8 ms\n^C\n--- 1.1.1.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 19.103/19.468/19.834/0.365 ms\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-14","title":"Parte 14","text":"<p>Permitir ping Hera \u2192 LAN</p> <pre><code>sudo iptables -A FORWARD -s 172.16.0.200 -o eth3 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A FORWARD -i eth3 -d 172.16.0.200 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Pruebo que funciona haciendo ping a Ares: <pre><code>[vagrant@hera ~]$ ping 10.0.1.101\nPING 10.0.1.101 (10.0.1.101) 56(84) bytes of data.\n64 bytes from 10.0.1.101: icmp_seq=1 ttl=63 time=1.94 ms\n64 bytes from 10.0.1.101: icmp_seq=2 ttl=63 time=0.898 ms\n^C\n--- 10.0.1.101 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 0.898/1.417/1.937/0.520 ms\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-15","title":"Parte 15","text":"<p>Permitir tr\u00e1fico ssh Hera \u2192 LAN</p> <pre><code>sudo iptables -A FORWARD -s 172.16.0.200 -o eth3 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth3 -d 172.16.0.200 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona haciendo ssh a Ares: <pre><code>[vagrant@hera ~]$ ssh vagrant@10.0.1.101\n\n  @@@@@@  @@@@@@@  @@@@@@@@  @@@@@@\n @@!  @@@ @@!  @@@ @@!      !@@\n @!@!@!@! @!@!!@!  @!!!:!    !@@!!\n !!:  !!! !!: :!!  !!:          !:!\n  :   : :  :   : : : :: ::: ::.: :\n\nLast login: Mon Feb  7 00:09:02 2022 from 172.16.0.200\nvagrant@ares:~$\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-16","title":"Parte 16","text":"<p>Permitir tr\u00e1fico ssh LAN \u2192 Hera</p> <pre><code>sudo iptables -A FORWARD -i eth3 -d 172.16.0.200 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -s 172.16.0.200 -o eth3 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde Ares: <pre><code>vagrant@ares:~$ ssh vagrant@172.16.0.200\n\n @@@  @@@ @@@@@@@@ @@@@@@@   @@@@@@\n @@!  @@@ @@!      @@!  @@@ @@!  @@@\n @!@!@!@! @!!!:!   @!@!!@!  @!@!@!@!\n !!:  !!! !!:      !!: :!!  !!:  !!!\n  :   : : : :: :::  :   : :  :   : :\n\nLast login: Sun Feb  6 16:56:24 2022 from 172.16.0.1\n[vagrant@hera ~]$\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-17","title":"Parte 17","text":"<p>Permitir ping LAN-DMZ \u2192 exterior</p> <pre><code>sudo iptables -A FORWARD -s 10.0.1.0/24,172.16.0.0/16 -o eth1 -p icmp -m icmp --icmp-type echo-request -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -d 10.0.1.0/24,172.16.0.0/16 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT\n</code></pre> <p>Tenemos, porque lo hicimos en una anterior pr\u00e1ctica sobre el escenario, una regla de SNAT que entra en juego en este apartado, as\u00ed que no la tenemos que volver a a\u00f1adir. Es la siguiente: <pre><code>sudo iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE\n</code></pre></p> <p>Pruebo que funciona desde Hera: <pre><code>[vagrant@hera ~]$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=19.4 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=54 time=14.7 ms\n^C\n--- 1.1.1.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 14.739/17.069/19.400/2.334 ms\n</code></pre></p> <p>Pruebo que funciona desde Ares: <pre><code>vagrant@ares:~$ ping 1.1.1.1\nPING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=14.4 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=54 time=14.1 ms\n^C\n--- 1.1.1.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 14.081/14.255/14.430/0.174 ms\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-18","title":"Parte 18","text":"<p>LAN puede navegar</p> <pre><code>sudo iptables -A FORWARD -i eth3 -o eth1 -p tcp -m multiport --dport 80,443 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -o eth3 -p tcp -m multiport --sport 80,443 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona el tr\u00e1fico http desde Ares: <pre><code>vagrant@ares:~$ telnet 52.47.209.216 80\nTrying 52.47.209.216...\nConnected to 52.47.209.216.\nEscape character is '^]'.\n</code></pre></p> <p>Pruebo que funciona el tr\u00e1fico https desde Apolo: <pre><code>vagrant@apolo:~$ telnet 52.47.209.216 443\nTrying 52.47.209.216...\nConnected to 52.47.209.216.\nEscape character is '^]'.\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-19","title":"Parte 19","text":"<p>Hera puede navegar</p> <pre><code>sudo iptables -A FORWARD -s 172.16.0.200 -o eth1 -p tcp -m multiport --dport 80,443 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -d 172.16.0.200 -p tcp -m multiport --sport 80,443 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona el tr\u00e1fico http: <pre><code>[vagrant@hera ~]$ telnet 52.47.209.216 80\nTrying 52.47.209.216...\nConnected to 52.47.209.216.\nEscape character is '^]'.\n</code></pre></p> <p>Pruebo que funciona el tr\u00e1fico https: <pre><code>[vagrant@hera ~]$ telnet 52.47.209.216 443\nTrying 52.47.209.216...\nConnected to 52.47.209.216.\nEscape character is '^]'.\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-20","title":"Parte 20","text":"<p>Tenemos que instalar en Hera un servidor de correos y un servidor ftp.</p>"},{"location":"sad/perimetral-iptables-escenario/#servidor-de-correo","title":"Servidor de correo","text":"<p>Instalo: <pre><code>sudo dnf install postfix\n</code></pre></p> <p>Modifico <code>/etc/postfix/main.cf</code> para que acepte peticiones desde cualquier IP y no s\u00f3lo desde localhost (es como est\u00e1 por defecto): <pre><code>inet_interfaces = all\n</code></pre></p> <p>Inicio postfix: <pre><code>sudo systemctl start postfix\n</code></pre></p> <p>Compruebo que est\u00e1 escuchando el puerto correctamente: <pre><code>[vagrant@hera ~]$ sudo ss -tulpn | grep LISTEN\ntcp   LISTEN 0      128          0.0.0.0:111       0.0.0.0:*    users:((\"rpcbind\",pid=603,fd=4),(\"systemd\",pid=1,fd=88))\ntcp   LISTEN 0      128          0.0.0.0:22        0.0.0.0:*    users:((\"sshd\",pid=670,fd=4))\ntcp   LISTEN 0      100          0.0.0.0:25        0.0.0.0:*    users:((\"master\",pid=32765,fd=16))\ntcp   LISTEN 0      128             [::]:111          [::]:*    users:((\"rpcbind\",pid=603,fd=6),(\"systemd\",pid=1,fd=90))\ntcp   LISTEN 0      128                *:80              *:*    users:((\"httpd\",pid=720,fd=4),(\"httpd\",pid=719,fd=4),(\"httpd\",pid=718,fd=4),(\"httpd\",pid=701,fd=4))\ntcp   LISTEN 0      128             [::]:22           [::]:*    users:((\"sshd\",pid=670,fd=6))\ntcp   LISTEN 0      100             [::]:25           [::]:*    users:((\"master\",pid=32765,fd=17))\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#servidor-ftp","title":"Servidor FTP","text":"<pre><code>sudo dnf install vsftpd\nsudo systemctl start vsftpd\n</code></pre> <p>Compruebo que est\u00e1 escuchando el puerto correctamente: <pre><code>[vagrant@hera ~]$ sudo ss -tulpn | grep LISTEN\ntcp   LISTEN 0      128          0.0.0.0:111       0.0.0.0:*    users:((\"rpcbind\",pid=603,fd=4),(\"systemd\",pid=1,fd=88))\ntcp   LISTEN 0      128          0.0.0.0:22        0.0.0.0:*    users:((\"sshd\",pid=670,fd=4))\ntcp   LISTEN 0      100          0.0.0.0:25        0.0.0.0:*    users:((\"master\",pid=32765,fd=16))\ntcp   LISTEN 0      128             [::]:111          [::]:*    users:((\"rpcbind\",pid=603,fd=6),(\"systemd\",pid=1,fd=90))\ntcp   LISTEN 0      128                *:80              *:*    users:((\"httpd\",pid=720,fd=4),(\"httpd\",pid=719,fd=4),(\"httpd\",pid=718,fd=4),(\"httpd\",pid=701,fd=4))\ntcp   LISTEN 0      32                 *:21              *:*    users:((\"vsftpd\",pid=32862,fd=3))\ntcp   LISTEN 0      128             [::]:22           [::]:*    users:((\"sshd\",pid=670,fd=6))\ntcp   LISTEN 0      100             [::]:25           [::]:*    users:((\"master\",pid=32765,fd=17))\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-21","title":"Parte 21","text":"<p>Permitir tr\u00e1fico exterior \u2192 Hera para Web-FTP</p> <p>La regla DNAT web ya la ten\u00eda previamente, as\u00ed que no hace falta a\u00f1adirla. La recuerdo: <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 80 -j DNAT --to-destination 172.16.0.200:80\n</code></pre></p> <p>A\u00f1ado la regla DNAT FTP: <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 21 -j DNAT --to-destination 172.16.0.200:21\n</code></pre></p> <p>Reglas forward web: <pre><code>sudo iptables -A FORWARD -i eth1 -d 172.16.0.200 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -s 172.16.0.200 -o eth1 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona el tr\u00e1fico http a Hera desde mi host: <pre><code>atlas@olympus:~$ telnet 172.22.0.213 80\nTrying 172.22.0.213...\nConnected to 172.22.0.213.\nEscape character is '^]'.\n</code></pre></p> <p>Reglas forward ftp: <pre><code>sudo iptables -A FORWARD -i eth1 -d 172.16.0.200 -p tcp --dport 21 -j ACCEPT\nsudo iptables -A FORWARD -s 172.16.0.200 -o eth1 -p tcp --sport 21 -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona el tr\u00e1fico ftp a Hera desde mi host: <pre><code>atlas@olympus:~$ telnet 172.22.0.213 21\nTrying 172.22.0.213...\nConnected to 172.22.0.213.\nEscape character is '^]'.\n220 (vsFTPd 3.0.3)\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-22","title":"Parte 22","text":"<p>Permitir tr\u00e1fico LAN \u2192 Hera para Web-FTP</p> <p>Reglas forward web: <pre><code>sudo iptables -A FORWARD -i eth3 -d 172.16.0.200 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -s 172.16.0.200 -o eth3 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona el tr\u00e1fico http a Hera desde Ares: <pre><code>vagrant@ares:~$ telnet 172.16.0.200 80\nTrying 172.16.0.200...\nConnected to 172.16.0.200.\nEscape character is '^]'.\n</code></pre></p> <p>Reglas forward ftp: <pre><code>sudo iptables -A FORWARD -i eth3 -d 172.16.0.200 -p tcp --dport 21 -j ACCEPT\nsudo iptables -A FORWARD -s 172.16.0.200 -o eth3 -p tcp --sport 21 -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona el tr\u00e1fico ftp a Hera desde Apolo: <pre><code>vagrant@apolo:~$ telnet 172.16.0.200 21\nTrying 172.16.0.200...\nConnected to 172.16.0.200.\nEscape character is '^]'.\n220 (vsFTPd 3.0.3)\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-23","title":"Parte 23","text":"<p>Permitir tr\u00e1fico LAN \u2192 Hera al servidor correo, pero no se podr\u00e1 acceder desde otro sitio</p> <pre><code>sudo iptables -A FORWARD -i eth3 -d 172.16.0.200 -p tcp --dport 25 -j ACCEPT\nsudo iptables -A FORWARD -s 172.16.0.200 -o eth3 -p tcp --sport 25 -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde Ares: <pre><code>vagrant@ares:~$ telnet 172.16.0.200 25\nTrying 172.16.0.200...\nConnected to 172.16.0.200.\nEscape character is '^]'.\n220 hera.localdomain ESMTP Postfix\n</code></pre></p> <p>Realmente no tendr\u00eda por qu\u00e9 hacerlo porque no influye, pero para que quede todo m\u00e1s limpio, eliminar\u00e9 la regla DNAT 25 que ten\u00edamos previamente por el escenario:</p> <p></p> <p>Desde el exterior igualmente no podr\u00edamos tener acceso al servidor de correos antiguo de Apolo porque aunque tengamos esa regla DNAT, no hemos hecho en ning\u00fan momento reglas forward hacia Apolo.</p> <p>La elimino: <pre><code>sudo iptables -t nat -D PREROUTING -i eth1 -p tcp --dport 25 -j DNAT --to-destination 10.0.1.102:25\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-24","title":"Parte 24","text":"<p>Permitir tr\u00e1fico DMZ \u2192 Ares al servidor mysql. No se podr\u00e1 acceder desde el exterior</p> <pre><code>sudo iptables -A FORWARD -i eth2 -d 10.0.1.101 -p tcp --dport 3306 -j ACCEPT\nsudo iptables -A FORWARD -s 10.0.1.101 -o eth2 -p tcp --sport 3306 -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde Hera: <pre><code>[vagrant@hera ~]$ sudo mysql -u root -h 10.0.1.101 -p\nEnter password:\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 45\nServer version: 10.3.31-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]&gt;\n</code></pre></p> <p>Desde el exterior no podremos acceder claramente, porque no existe una regla DNAT v\u00e1lida:</p> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-25","title":"Parte 25","text":"<p>Bloquear ICMP Flood limitando el n\u00famero de peticiones por segundo</p> <p>Desde el exterior y la LAN hemos bloqueado el tr\u00e1fico ICMP as\u00ed que no tenemos que preocuparnos por ataques de flood. Desde la DMZ s\u00ed tenemos permitido el tr\u00e1fico, as\u00ed que lo tenemos que limitar.</p> <p>Primero voy a realizar un ataque desde Hera a Zeus sin l\u00edmite de protecci\u00f3n y mostrar\u00e9 lo que suceder\u00eda.</p> <p>Este es el comando de ataque que ejecutar\u00e9 en Hera: <pre><code>sudo ping -f -s 56500 172.16.0.1\n</code></pre></p> <p>Hago el ataque, y as\u00ed se quedar\u00edan los contadores despu\u00e9s de varios segundos:</p> <p></p> <p>Borro la regla, y la vuelvo a a\u00f1adir con un l\u00edmite de protecci\u00f3n: <pre><code>sudo iptables -A INPUT -i eth2 -p icmp -m icmp --icmp-type echo-request -m limit --limit 1/s --limit-burst 1 -j ACCEPT\n</code></pre></p> <p>Vuelvo a lanzar el ataque, y veo c\u00f3mo se quedan los contadores despu\u00e9s de varios segundos:</p> <p></p> <p>4 paquetes, habiendo limitado el tr\u00e1fico a 1 por segundo significa que he lanzado el ataque por 4 segundos, pero s\u00f3lo 1 paquete se permiti\u00f3 gracias al l\u00edmite. Funciona correctamente.</p>"},{"location":"sad/perimetral-iptables-escenario/#parte-26","title":"Parte 26","text":"<p>Bloquear SYN Flood</p> <p>Necesitamos esta regla para limitar: <pre><code>sudo iptables -A INPUT -p tcp --syn -m limit --limit 1/s --limit-burst 3 -j ACCEPT\n</code></pre></p> <p>PERO en mi caso no la necesito, porque he comprobado que la pol\u00edtica por defecto DROP en INPUT bloquea el ataque de flood.</p> <p>Este es el comando de ataque que necesitamos, usando como ejemplo el puerto 80 (partiendo de que sabemos que est\u00e1 abierto y redirigido a Hera): <pre><code>sudo hping3 -p 80 --flood --rand-source 192.168.1.115\n</code></pre></p> <p>Borro los contadores para esta prueba, y lanzo el ataque durante varios segundos. Vemos que la pol\u00edtica DROP ha cortado el ataque:</p> <p></p> <p>Sabemos que esos paquetes son del ataque porque el contador estaba a 0 previamente, y me fij\u00e9 que no aumentase al no hacer nada por varios segundos. Tambi\u00e9n hay que tener en cuenta que esa cantidad de paquetes en varios segundos no es algo normal, teniendo en cuenta que durante la prueba el \u00fanico tr\u00e1fico que estaba llegando a Zeus era el ataque.</p>"},{"location":"sad/perimetral-iptables-escenario/#parte-27","title":"Parte 27","text":"<p>Bloquear escaneos de puertos a Zeus.</p>"},{"location":"sad/perimetral-iptables-escenario/#logica-base","title":"L\u00f3gica base","text":"<p>Seg\u00fan he investigado existen ciertas reglas que dicen bloquear los escaneos de puertos, pero al probarlas no funcionan.</p> <p>Despu\u00e9s de indagar he llegado a este post que dice algo bastante interesante:</p> <p>\"Lo l\u00f3gico es usar una pol\u00edtica DROP y s\u00f3lo permitir el tr\u00e1fico que queramos. No hay manera alguna de bloquear escaneos de puertos sin que se llegue a bloquear tr\u00e1fico leg\u00edtimo.\"</p> <p>Esto adem\u00e1s de interesante tiene mucho sentido, porque si bloque\u00e1ramos tr\u00e1fico a todos los puertos a su vez perder\u00edamos todo tipo de conexi\u00f3n que fuese leg\u00edtima. Evidentemente esto no es lo que queremos.</p> <p>Al final, esto se traduce a que cuando se use nmap se mostrar\u00e1n los puertos abiertos, pero ninguno m\u00e1s. Queda como tarea del administrador el que el tr\u00e1fico a esos puertos est\u00e9 correctamente protegido y dirigido.</p>"},{"location":"sad/perimetral-iptables-escenario/#prueba-1","title":"Prueba 1","text":"<p>Partiendo de la l\u00f3gica base que es casi cierta en su totalidad, realmente hay algunas medidas que podemos tomar.</p> <p>Intentaremos logear accesos a un puerto que sabemos que est\u00e1 cerrado. Si intentan acceder a \u00e9l, se puede entender que es un atacante porque alguien que quiera acceder leg\u00edtimamente sabr\u00eda qu\u00e9 puertos est\u00e1n abiertos.</p> <p>Regla: <pre><code>sudo iptables -A INPUT -p tcp -m tcp --dport 19 -j LOG --log-level 1 --log-prefix \"PortScan\"\n</code></pre></p> <p>Lanzamos nmap desde nuestro host a Zeus: <pre><code>atlas@olympus:~$ nmap 172.22.0.213 -Pn\nStarting Nmap 7.80 ( https://nmap.org ) at 2022-02-08 12:20 CET\nNmap scan report for 172.22.0.213\nHost is up (0.0011s latency).\nNot shown: 998 filtered ports\nPORT     STATE SERVICE\n22/tcp   open  ssh\n2222/tcp open  EtherNetIP-1\n\nNmap done: 1 IP address (1 host up) scanned in 8.15 seconds\n</code></pre></p> <p>Mostramos lo que ha aparecido en <code>/var/log/syslog</code>: <pre><code>Feb  8 11:20:47 zeus kernel: [  453.591450] PortScanIN=eth1 OUT= MAC=52:54:00:6d:6e:a7:06:68:af:97:62:7f:08:00 SRC=172.22.9.227 DST=172.22.0.213 LEN=60 TOS=0x00 PREC=0x00 TTL=64 ID=63993 DF PROTO=TCP SPT=35550 DPT=19 WINDOW=64240 RES=0x00 SYN URGP=0\n</code></pre></p> <p>Esto funciona, e incluso logea la IP de origen del atacante, pero no es una soluci\u00f3n. Esto simplemente es un log, no estamos bloqueando el ataque nmap y el atacante seguir\u00e1 teniendo una respuesta de los puertos abiertos.</p>"},{"location":"sad/perimetral-iptables-escenario/#solucion-1-bloquear-null-scan","title":"Soluci\u00f3n 1: Bloquear Null scan","text":"<p>Lanzo este ataque desde mi host a Zeus: <pre><code>atlas@olympus:~$ sudo nmap -sN 172.22.0.213\nStarting Nmap 7.80 ( https://nmap.org ) at 2022-02-09 08:48 CET\nStats: 0:00:14 elapsed; 0 hosts completed (1 up), 1 undergoing NULL Scan\nNULL Scan Timing: About 66.60% done; ETC: 08:48 (0:00:08 remaining)\nStats: 0:00:21 elapsed; 0 hosts completed (1 up), 1 undergoing NULL Scan\nNULL Scan Timing: About 99.99% done; ETC: 08:48 (0:00:00 remaining)\nNmap scan report for 172.22.0.213\nHost is up (0.00041s latency).\nAll 1000 scanned ports on 172.22.0.213 are open|filtered\nMAC Address: 52:54:00:6D:6E:A7 (QEMU virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 21.27 seconds\n</code></pre></p> <p>Gracias a las pol\u00edticas por defecto DROP de la tabla filter, este tipo de escaneo est\u00e1 fallando.</p> <p>Lo \u00faltimo que queda ser\u00eda logear el ataque y bloquear al atacante por IP: <pre><code>sudo iptables -A INPUT -p tcp --tcp-flags ALL NONE -m limit --limit 3/m --limit-burst 5 -j LOG --log-prefix \"Firewall&gt; Null scan \"\nsudo iptables -A INPUT -p tcp --tcp-flags ALL NONE -m recent --name blacklist_60 --set -m comment --comment \"Drop/Blacklist Null scan\" -j DROP\n</code></pre></p> <p>Compruebo <code>/var/log/syslog</code>:</p> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#solucion-2-bloquear-xmas-scan","title":"Soluci\u00f3n 2: Bloquear Xmas scan","text":"<p>Lanzo este ataque desde mi host a Zeus: <pre><code>atlas@olympus:~$ sudo nmap -sX 172.22.0.213\nStarting Nmap 7.80 ( https://nmap.org ) at 2022-02-09 09:08 CET\nNmap scan report for 172.22.0.213\nHost is up (0.00026s latency).\nAll 1000 scanned ports on 172.22.0.213 are open|filtered\nMAC Address: 52:54:00:6D:6E:A7 (QEMU virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 21.25 seconds\n</code></pre></p> <p>Gracias a las pol\u00edticas por defecto DROP de la tabla filter, este tipo de escaneo est\u00e1 fallando, no me aparece ninguna informaci\u00f3n sobre los puertos abiertos.</p> <p>Lo \u00faltimo que queda ser\u00eda logear el ataque y bloquear al atacante por IP: <pre><code>sudo iptables -A INPUT -p tcp --tcp-flags ALL FIN,PSH,URG -m limit --limit 3/m --limit-burst 5 -j LOG --log-prefix \"Firewall&gt; XMAS scan \"\nsudo iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -m limit --limit 3/m --limit-burst 5 -j LOG --log-prefix \"Firewall&gt; XMAS-PSH scan \"\nsudo iptables -A INPUT -p tcp --tcp-flags ALL ALL -m limit --limit 3/m --limit-burst 5 -j LOG --log-prefix \"Firewall&gt; XMAS-ALL scan \"\nsudo iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -m recent --name blacklist_60 --set  -m comment --comment \"Drop/Blacklist Xmas/PSH scan\" -j DROP\nsudo iptables -A INPUT -p tcp --tcp-flags ALL FIN,PSH,URG -m recent --name blacklist_60 --set  -m comment --comment \"Drop/Blacklist Xmas scan\" -j DROP\nsudo iptables -A INPUT -p tcp --tcp-flags ALL ALL -m recent --name blacklist_60 --set  -m comment --comment \"Drop/Blacklist Xmas/All scan\" -j DROP\n</code></pre></p> <p>Compruebo <code>/var/log/syslog</code>:</p> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#solucion-3-bloquear-fin-scan","title":"Soluci\u00f3n 3: Bloquear FIN scan","text":"<p>Lanzo este ataque desde mi host a Zeus: <pre><code>atlas@olympus:~$ sudo nmap -sF 172.22.0.213\nStarting Nmap 7.80 ( https://nmap.org ) at 2022-02-09 09:32 CET\nNmap scan report for 172.22.0.213\nHost is up (0.00017s latency).\nAll 1000 scanned ports on 172.22.0.213 are open|filtered\nMAC Address: 52:54:00:6D:6E:A7 (QEMU virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 21.20 seconds\n</code></pre></p> <p>Gracias a las pol\u00edticas por defecto DROP de la tabla filter, este tipo de escaneo est\u00e1 fallando, no me aparece ninguna informaci\u00f3n sobre los puertos abiertos.</p> <p>Lo \u00faltimo que queda ser\u00eda logear el ataque y bloquear al atacante por IP: <pre><code>sudo iptables -A INPUT -p tcp --tcp-flags ALL FIN -m limit --limit 3/m --limit-burst 5 -j LOG --log-prefix \"Firewall&gt; FIN scan \"\nsudo iptables -A INPUT -p tcp --tcp-flags ALL FIN -m recent --name blacklist_60 --set  -m comment --comment \"Drop/Blacklist FIN scan\" -j DROP\n</code></pre></p> <p>Compruebo <code>/var/log/syslog</code>:</p> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#solucion-4-bloquear-udp-scan","title":"Soluci\u00f3n 4: Bloquear UDP scan","text":"<p>Lanzo el scan desde mi host a Zeus: <pre><code>atlas@olympus:~$ sudo nmap -sU 172.22.0.213\nStarting Nmap 7.80 ( https://nmap.org ) at 2022-02-09 10:45 CET\nNmap scan report for 172.22.0.213\nHost is up (0.00016s latency).\nAll 1000 scanned ports on 172.22.0.213 are open|filtered\nMAC Address: 52:54:00:6D:6E:A7 (QEMU virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 21.19 seconds\natlas@olympus:~$\n</code></pre></p> <p>Gracias a las pol\u00edticas por defecto DROP de la tabla filter, este tipo de escaneo est\u00e1 fallando, no me aparece ninguna informaci\u00f3n sobre los puertos abiertos.</p> <p>Lo \u00faltimo que queda ser\u00eda logear el ataque y bloquear el tr\u00e1fico espec\u00edfico anormal: <pre><code>sudo iptables -A INPUT -p udp -m limit --limit 6/h --limit-burst 1 -m length --length 0:28 -j LOG --log-prefix \"Firewall&gt;0 length udp \"\nsudo iptables -A INPUT -p udp -m length --length 0:28 -m comment --comment \"Drop UDP packet with no content\" -j DROP\n</code></pre></p> <p>En syslog no me aparece nada porque no tengo tr\u00e1fico udp permitido.</p>"},{"location":"sad/perimetral-iptables-escenario/#parte-28","title":"Parte 28","text":"<p>Modificar el cortafuegos todo lo necesario para que los servicios antiguos sigan funcionando.</p>"},{"location":"sad/perimetral-iptables-escenario/#trafico-dns-externa-apolo","title":"Tr\u00e1fico DNS externa \u2192 Apolo","text":"<pre><code>sudo iptables -A FORWARD -i eth1 -d 10.0.1.102 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -s 10.0.1.102 -o eth1 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde mi host: <pre><code>atlas@olympus:~$ dig NS adrianj.gonzalonazareno.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; NS adrianj.gonzalonazareno.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 1376\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: 976da02d0426b93be97b71876204c09c9e25924aa113dc62 (good)\n;; QUESTION SECTION:\n;adrianj.gonzalonazareno.org.   IN  NS\n\n;; ANSWER SECTION:\nadrianj.gonzalonazareno.org. 86229 IN   NS  zeus.adrianj.gonzalonazareno.org.\n\n;; Query time: 0 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Thu Feb 10 08:36:59 CET 2022\n;; MSG SIZE  rcvd: 103\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#trafico-dns-apolo-externa","title":"Tr\u00e1fico DNS Apolo \u2192 externa","text":"<pre><code>sudo iptables -A FORWARD -s 10.0.1.102 -o eth1 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -d 10.0.1.102 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre> <p>Pruebo que funciona desde Apolo: <pre><code>vagrant@apolo:~$ dig @127.0.0.1 www.google.es\n\n; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; @127.0.0.1 www.google.es\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 9760\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: fc8dc3dfcf8ed8c7010000006204c5d28d2cd0f4696bab50 (good)\n;; QUESTION SECTION:\n;www.google.es.         IN  A\n\n;; ANSWER SECTION:\nwww.google.es.          300 IN  A   216.58.215.131\n\n;; Query time: 92 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Thu Feb 10 07:59:14 UTC 2022\n;; MSG SIZE  rcvd: 86\n</code></pre></p> <p>Pruebo que funciona desde Ares: <pre><code>vagrant@ares:~$ dig fp.josedomingo.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; fp.josedomingo.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45695\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 653a9b32ddd84ca8010000006204c6b054cab2e10d50bf35 (good)\n;; QUESTION SECTION:\n;fp.josedomingo.org.            IN  A\n\n;; ANSWER SECTION:\nfp.josedomingo.org. 900 IN  CNAME   endor.josedomingo.org.\nendor.josedomingo.org.  900 IN  A   37.187.119.60\n\n;; Query time: 2705 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Feb 10 08:03:32 UTC 2022\n;; MSG SIZE  rcvd: 111\n</code></pre> (funciona sin reglas adicionales porque Ares y Apolo est\u00e1n en la misma red)</p> <p>Para que Zeus pueda hacer consultas DNS usando Apolo, necesitamos reglas adicionales: <pre><code>sudo iptables -A OUTPUT -d 10.0.1.102 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A INPUT -s 10.0.1.102 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona desde Zeus: <pre><code>vagrant@zeus:~$ dig www.josedomingo.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; www.josedomingo.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 37724\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 1e95cdcc67defb84010000006204c9120b793d41bff868be (good)\n;; QUESTION SECTION:\n;www.josedomingo.org.           IN  A\n\n;; ANSWER SECTION:\nwww.josedomingo.org.    889 IN  CNAME   endor.josedomingo.org.\nendor.josedomingo.org.  290 IN  A   37.187.119.60\n\n;; Query time: 0 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Feb 10 08:13:06 UTC 2022\n;; MSG SIZE  rcvd: 112\n</code></pre></p> <p>Para que desde la DMZ se puedan hacer consultas DNS usando Apolo, necesitamos reglas adicionales: <pre><code>sudo iptables -A FORWARD -i eth2 -d 10.0.1.102 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -s 10.0.1.102 -o eth2 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT\n</code></pre></p> <p>Pruebo que funciona desde Hera: <pre><code>[vagrant@hera ~]$ dig stackoverflow.com\n\n; &lt;&lt;&gt;&gt; DiG 9.11.26-RedHat-9.11.26-6.el8 &lt;&lt;&gt;&gt; stackoverflow.com\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 64139\n;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: fcf5085ad3e0c20e010000006204cb4d63eb8fac5764ecd5 (good)\n;; QUESTION SECTION:\n;stackoverflow.com.         IN  A\n\n;; ANSWER SECTION:\nstackoverflow.com.  300 IN  A   151.101.1.69\nstackoverflow.com.  300 IN  A   151.101.193.69\nstackoverflow.com.  300 IN  A   151.101.129.69\nstackoverflow.com.  300 IN  A   151.101.65.69\n\n;; Query time: 1944 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Feb 10 08:22:36 UTC 2022\n;; MSG SIZE  rcvd: 138\n</code></pre></p>"},{"location":"sad/perimetral-iptables-escenario/#trafico-http-externa-hera","title":"Tr\u00e1fico http externa \u2192 Hera","text":"<p>La regla DNAT no hace falta a\u00f1adirla, porque ya la ten\u00edamos de antes:</p> <p></p> <p>Las reglas forward no hacen falta a\u00f1adirlas porque ya las hemos hecho durante esta pr\u00e1ctica:</p> <p></p> <p>Desde fuera, compruebo que puedo acceder a <code>www.adrianj.gonzalonazareno.org</code>:</p> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#trafico-correo-apolo-externa","title":"Tr\u00e1fico correo Apolo \u2192 externa","text":"<pre><code>sudo iptables -A FORWARD -s 10.0.1.102 -o eth1 -p tcp --dport 25 -j ACCEPT\nsudo iptables -A FORWARD -i eth1 -d 10.0.1.102 -p tcp --sport 25 -j ACCEPT\n</code></pre> <p>Env\u00edo un correo a mi gmail desde Apolo: <pre><code>vagrant@apolo:~$ mail -r vagrant@adrianj.gonzalonazareno.org adristudy@gmail.com\nCc:\nSubject: hola\nhola\n</code></pre></p> <p>Muestro que me ha llegado:</p> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#trafico-correo-externa-apolo","title":"Tr\u00e1fico correo externa \u2192 Apolo","text":"<p>Vuelvo a a\u00f1adir la regla DNAT que previamente elimin\u00e9: <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 25 -j DNAT --to-destination 10.0.1.102:25\n</code></pre></p> <p>Habilito el tr\u00e1fico de vuelta: <pre><code>sudo iptables -A FORWARD -i eth1 -d 10.0.1.102 -p tcp --dport 25 -j ACCEPT\n</code></pre></p> <p>Env\u00edo desde gmail un correo a Apolo:</p> <p></p> <p>Compruebo en Apolo que me haya llegado:</p> <p></p> <p>Muestro el contenido para que se vea que es el correo correcto:</p> <p></p>"},{"location":"sad/perimetral-iptables-escenario/#parte-29","title":"Parte 29","text":"<p>El cortafuegos tiene que funcionar despu\u00e9s de un reinicio</p> <p>Necesitamos el paquete <code>iptables-persistent</code>, que no tenemos que instalar porque ya se hizo en pr\u00e1cticas sobre el escenario anteriores.</p> <p>Teniendo el paquete instalado, para guardar las reglas ejecuto este comando: <pre><code>iptables-save &gt; /etc/iptables/rules.v4\n</code></pre> Se guardar\u00e1n en ese fichero, y eso las har\u00e1 persistentes en reinicios.</p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/","title":"Pr\u00e1ctica: Cifrado asim\u00e9trico con gpg y openssl","text":""},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#tarea-1-generacion-de-claves","title":"Tarea 1: Generaci\u00f3n de claves","text":""},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-0","title":"Ejercicio 0","text":"<p>Instalar gpg</p> <pre><code>sudo apt update\nsudo apt install gnupg\n</code></pre>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-1","title":"Ejercicio 1","text":"<p>Generar par de claves</p> <pre><code>gpg --gen-key\n</code></pre> <p></p> <p>En rojo, marco lo que yo he tenido que escribir.</p> <p>Cuando pide una passphrase, no le pongo ninguna.</p> <p>\u00bfEn qu\u00e9 directorio se guardan las claves de un usuario?</p> <p><code>/home/vagrant/.gnupg</code></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-2","title":"Ejercicio 2","text":"<p>Listar las claves p\u00fablicas</p> <p><pre><code>gpg --list-keys\n</code></pre> <pre><code>/home/vagrant/.gnupg/pubring.kbx\n--------------------------------\npub   rsa3072 2021-11-15 [SC] [expires: 2023-11-15]\n      5FAB740108563CA70D25EFA770B15EFFA5837AF8\nuid           [ultimate] Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2021-11-15 [E] [expires: 2023-11-15]\n</code></pre></p> <p>Explicar el output</p> <ul> <li><code>/home/vagrant/.gnupg/pubring.kbx</code>: anillo de claves</li> <li><code>pub</code>: indicador de clave p\u00fablica</li> <li><code>rsa3072</code>: tipo de clave rsa y tama\u00f1o en bits de 3072</li> <li><code>2021-11-15</code>: fecha de creaci\u00f3n</li> <li><code>[expires: 2023-11-15]</code>: fecha de expiraci\u00f3n</li> <li><code>5FAB740108563CA70D25EFA770B15EFFA5837AF8</code>: fingerprint de la clave</li> <li><code>uid</code>: identificadores de la clave</li> <li><code>sub</code>: indica una \"subkey\". Esto es un concepto un poco avanzado de gpg que no hemos visto, porque en realidad cada par de claves que creamos a su vez crean subpares de claves por debajo.</li> </ul> <p>\u00bfC\u00f3mo deber\u00edas haber generado las claves para indicar, por ejemplo, que tengan 1 mes de validez?</p> <pre><code>gpg --full-gen-key\n</code></pre> <p></p> <p>En rojo he marcado cuando:</p> <ul> <li>Defino 1 mes de validez</li> <li>Aparece la fecha de expiraci\u00f3n correcta en la clave</li> </ul>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-3","title":"Ejercicio 3","text":"<p>Listar las claves privadas</p> <p><pre><code>gpg --list-secret-keys\n</code></pre> <pre><code>/home/vagrant/.gnupg/pubring.kbx\n--------------------------------\nsec   rsa3072 2021-11-15 [SC] [expires: 2023-11-15]\n      5FAB740108563CA70D25EFA770B15EFFA5837AF8\nuid           [ultimate] Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\nssb   rsa3072 2021-11-15 [E] [expires: 2023-11-15]\n</code></pre></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#tarea-2-importar-exportar-clave-publica","title":"Tarea 2: Importar / exportar clave p\u00fablica","text":""},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-1_1","title":"Ejercicio 1","text":"<p>Exportar tu clave p\u00fablica en ASCII al fichero <code>adrian_jaramillo.asc</code></p> <pre><code>gpg --armor --output adrian_jaramillo.asc --export adristudy@gmail.com\n</code></pre> <p>Enviar <code>adrian_jaramillo.asc</code> a Carlos</p> <p>Enviado.</p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-2_1","title":"Ejercicio 2","text":"<p>Importar la clave p\u00fablica recibida de Carlos</p> <p>He recibido: <pre><code>-rw-r--r-- 1 vagrant vagrant 2476 Nov 15 09:18 carlos_rivero.asc\n</code></pre></p> <p>La importo: <pre><code>gpg --import carlos_rivero.asc\n</code></pre> <pre><code>gpg: key 69700115DE666C54: public key \"Carlos Rivero Mart\u00edn &lt;carlosrivero1988@gmail.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-3_1","title":"Ejercicio 3","text":"<p>Comprobar que la clave se ha incluido correctamente</p> <p><pre><code>gpg --list-keys\n</code></pre> <pre><code>/home/vagrant/.gnupg/pubring.kbx\n--------------------------------\npub   rsa3072 2021-11-15 [SC] [expires: 2023-11-15]\n      5FAB740108563CA70D25EFA770B15EFFA5837AF8\nuid           [ultimate] Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2021-11-15 [E] [expires: 2023-11-15]\n\npub   rsa3072 2021-11-15 [SC] [expires: 2023-11-15]\n      35AAEDB27BDF2918D11FB3B569700115DE666C54\nuid           [ unknown] Carlos Rivero Mart\u00edn &lt;carlosrivero1988@gmail.com&gt;\nsub   rsa3072 2021-11-15 [E] [expires: 2023-11-15]\n</code></pre></p> <p>Abajo tenemos la de Carlos.</p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#tarea-3-cifrado-asimetrico-con-claves-publicas","title":"Tarea 3: Cifrado asim\u00e9trico con claves p\u00fablicas","text":""},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-1_2","title":"Ejercicio 1","text":"<p>Cifrar un fichero con la clave p\u00fablica de Carlos</p> <p><pre><code>gpg --output para_carlos.txt.gpg --encrypt --recipient carlosrivero1988@gmail.com para_carlos.txt\n</code></pre> <pre><code>gpg: A226D42A5B0599A6: There is no assurance this key belongs to the named user\n\nsub  rsa3072/A226D42A5B0599A6 2021-11-15 Carlos Rivero Mart\u00edn &lt;carlosrivero1988@gmail.com&gt;\n Primary key fingerprint: 35AA EDB2 7BDF 2918 D11F  B3B5 6970 0115 DE66 6C54\n      Subkey fingerprint: 0FC1 7DA5 8FC3 9973 A4FA  5648 A226 D42A 5B05 99A6\n\nIt is NOT certain that the key belongs to the person named\nin the user ID.  If you *really* know what you are doing,\nyou may answer the next question with yes.\n\nUse this key anyway? (y/N) y\n</code></pre></p> <p>Fichero generado: <pre><code>-rw-r--r-- 1 vagrant vagrant  498 Nov 15 09:46 para_carlos.txt.gpg\n</code></pre></p> <p>Enviar el fichero cifrado a Carlos</p> <p>Enviado.</p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-2_2","title":"Ejercicio 2","text":"<p>Carlos nos enviar\u00e1 un fichero cifrado</p> <pre><code>-rw-r--r-- 1 vagrant vagrant  502 Nov 15 09:58 para_adrian.txt.gpg\n</code></pre>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-3_2","title":"Ejercicio 3","text":"<p>Descifrar <code>para_adrian.txt.gpg</code></p> <p><pre><code>gpg --output para_adrian.txt --decrypt para_adrian.txt.gpg\n</code></pre> <pre><code>gpg: encrypted with 3072-bit RSA key, ID ABA647DE60867CB5, created 2021-11-15\n      \"Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\"\n</code></pre> Se nos indica la clave p\u00fablica original con la que se encript\u00f3 el mensaje.</p> <p>Fichero desencriptado: <pre><code>-rw-r--r-- 1 vagrant vagrant   30 Nov 15 10:11 para_adrian.txt\n</code></pre></p> <p>Contenido: <pre><code>vagrant@practicacifradogpg:~$ cat para_adrian.txt\nMensaje cifrado para Adri\u00e1n.\n</code></pre></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-4","title":"Ejercicio 4","text":"<p>Enviar <code>para_carlos.txt.gpg</code> a Daniel Parrales</p> <p>Enviado.</p> <p>Comprobar que Daniel no puede descifrar <code>para_carlos.txt.gpg</code></p> <p>Si intenta hacer: <pre><code>gpg --output para_carlos.txt --decrypt para_carlos.txt.gpg\n</code></pre></p> <p>Le aparece: <pre><code>gpg: encrypted with RSA key, ID A226D42A5B0599A6\ngpg: decryption failed: No secret key\n</code></pre></p> <p>Esto sucede porque Daniel no tiene la clave privada asociada a la p\u00fablica con la que originalmente se encript\u00f3 el fichero.</p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-5","title":"Ejercicio 5","text":"<p>Borrar tu clave privada</p> <pre><code>gpg --delete-secret-key adristudy@gmail.com\n</code></pre> <p>Muestro que se ha borrado: <pre><code>vagrant@practicacifradogpg:~$ gpg --list-secret-keys\nvagrant@practicacifradogpg:~$\n</code></pre></p> <p>Borrar todas las claves p\u00fablicas</p> <pre><code>gpg --delete-key carlosrivero1988@gmail.com\ngpg --delete-key adristudy@gmail.com\n</code></pre> <p>Muestro que no queda ninguna: <pre><code>vagrant@practicacifradogpg:~$ gpg --list-keys\nvagrant@practicacifradogpg:~$\n</code></pre></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#tarea-4-exportar-clave-a-un-servidor-publico-de-claves-pgp","title":"Tarea 4: Exportar clave a un servidor p\u00fablico de claves PGP","text":""},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-1_3","title":"Ejercicio 1","text":"<p>Generar certificado de revocaci\u00f3n de tu clave p\u00fablica</p> <pre><code>gpg --output revoke_adrianj.asc --gen-revoke adristudy@gmail.com\n</code></pre> <p>Seguimos los pasos que se nos indican (en rojo, mis respuestas):</p> <p></p> <p>Fichero generado: <pre><code>-rw------- 1 vagrant vagrant  719 Nov 15 19:25 revoke_adrianj.asc\n</code></pre></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-2_3","title":"Ejercicio 2","text":"<p>Exportar tu clave p\u00fablica a <code>pgp.rediris.es</code></p> <p><pre><code>gpg --keyserver pgp.rediris.es --send-key 5FAB740108563CA70D25EFA770B15EFFA5837AF8\n</code></pre> <pre><code>gpg: sending key 70B15EFFA5837AF8 to hkp://pgp.rediris.es\n</code></pre></p> <p>Obligatorio indicar el \"key ID\" despu\u00e9s de <code>--send-key</code> (no funcionar\u00eda, por ejemplo, indicando un correo).</p> <p>Compruebo que se haya subido correctamente: <pre><code>gpg --keyserver pgp.rediris.es --search-key adristudy@gmail.com\n</code></pre></p> <p></p> <p>La n\u00famero 1 es la que acabo de subir (las dem\u00e1s claves son de otros a\u00f1os).</p> <p>La s\u00e9 identificar por:</p> <ul> <li>ID resumido (\u00faltimos 16 caracteres del ID original)</li> <li>Fecha de creaci\u00f3n</li> </ul>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-3_3","title":"Ejercicio 3","text":"<p>Borrar la clave p\u00fablica de Carlos</p> <p><pre><code>gpg --delete-keys carlosrivero1988@gmail.com\n</code></pre> <pre><code>gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\npub  rsa3072/69700115DE666C54 2021-11-15 Carlos Rivero Mart\u00edn &lt;carlosrivero1988@gmail.com&gt;\n\nDelete this key from the keyring? (y/N) y\n</code></pre></p> <p>Importarla desde <code>pgp.rediris.es</code></p> <p>Para importar su clave p\u00fablica de nuevo a mi keybox, primero, tengo que averiguar su ID.</p> <p><pre><code>gpg --keyserver pgp.rediris.es --search-key carlosrivero1988@gmail.com\n</code></pre> <pre><code>gpg: data source: http://130.206.1.8:11371\n(1) Carlos Rivero Mart\u00edn &lt;carlosrivero1988@gmail.com&gt;\n      3072 bit RSA key 69700115DE666C54, created: 2021-11-15, expires: 2023-11-15\n</code></pre></p> <p>Sabiendo su ID, <code>69700115DE666C54</code>, me bajo la clave: <pre><code>gpg --keyserver pgp.rediris.es --recv-key 69700115DE666C54\n</code></pre> <pre><code>gpg: key 69700115DE666C54: public key \"Carlos Rivero Mart\u00edn &lt;carlosrivero1988@gmail.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre></p> <p>Vuelvo a listar mis claves p\u00fablicas, y la tengo: <pre><code>vagrant@practicacifradogpg:~$ gpg --list-key\n/home/vagrant/.gnupg/pubring.kbx\n--------------------------------\npub   rsa3072 2021-11-15 [SC] [expires: 2023-11-15]\n      5FAB740108563CA70D25EFA770B15EFFA5837AF8\nuid           [ultimate] Adri\u00e1n Jaramillo Rodr\u00edguez &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2021-11-15 [E] [expires: 2023-11-15]\n\npub   rsa3072 2021-11-15 [SC] [expires: 2023-11-15]\n      35AAEDB27BDF2918D11FB3B569700115DE666C54\nuid           [ unknown] Carlos Rivero Mart\u00edn &lt;carlosrivero1988@gmail.com&gt;\nsub   rsa3072 2021-11-15 [E] [expires: 2023-11-15]\n</code></pre></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#tarea-5-cifrado-asimetrico-con-openssl","title":"Tarea 5: Cifrado asim\u00e9trico con openssl","text":""},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-1_4","title":"Ejercicio 1","text":"<p>Generar par de claves</p> <p><pre><code>openssl genrsa -des3 -out keypair.pem 2048\n</code></pre> <pre><code>Generating RSA private key, 2048 bit long modulus (2 primes)\n......................................................................................+++++\n....................................................................................................................+++++\ne is 65537 (0x010001)\nEnter pass phrase for keypair.pem:\nVerifying - Enter pass phrase for keypair.pem:\n</code></pre></p> <p>Passphrase: 1234</p> <p>Fichero resultante: <pre><code>-rw------- 1 vagrant vagrant 1743 Nov 15 22:56 keypair.pem\n</code></pre></p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-2_4","title":"Ejercicio 2","text":"<p>Enviar tu clave p\u00fablica a Carlos</p> <p>Exporto mi clave p\u00fablica del fichero <code>keypair.pem</code>: <pre><code>openssl rsa -in keypair.pem -outform PEM -pubout -out public_adrianj.pem\n</code></pre> <pre><code>Enter pass phrase for keypair.pem:\nwriting RSA key\n</code></pre></p> <p>Nos pregunta la passphrase, y nos genera: <pre><code>-rw-r--r-- 1 vagrant vagrant  451 Nov 15 23:15 public_adrianj.pem\n</code></pre></p> <p>Este fichero, es el que env\u00edo a Carlos.</p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-3_4","title":"Ejercicio 3","text":"<p>Recibir la clave p\u00fablica de Carlos</p> <pre><code>-rw-r--r-- 1 vagrant vagrant  451 Nov 16 00:08 public_crivero.pem\n</code></pre> <p>Utilizando esa clave, cifra un fichero de texto y env\u00edaselo</p> <pre><code>openssl rsautl -encrypt -inkey public_crivero.pem -pubin -in para_carlos_openssl.txt -out para_carlos_openssl.txt.enc\n</code></pre> <p>Nos genera este fichero cifrado: <pre><code>-rw-r--r-- 1 vagrant vagrant  256 Nov 16 00:24 para_carlos_openssl.txt.enc\n</code></pre></p> <p>Se lo env\u00edo.</p>"},{"location":"sad/practica-cifrado-asimetrico-gpg-openssl/#ejercicio-4_1","title":"Ejercicio 4","text":"<p>Recibe un fichero cifrado de Carlos</p> <pre><code>-rw-r--r-- 1 vagrant vagrant  256 Nov 16 00:35 para_adrian_openssl.txt.enc\n</code></pre> <p>Descifra el fichero</p> <p><pre><code>openssl rsautl -decrypt -inkey keypair.pem -in para_adrian_openssl.txt.enc &gt; para_adrian_openssl.txt\n</code></pre> <pre><code>Enter pass phrase for keypair.pem:\n</code></pre></p> <p>Introducimos la passphrase, y obtenemos el fichero: <pre><code>-rw-r--r-- 1 vagrant vagrant   58 Nov 16 00:43 para_adrian_openssl.txt\n</code></pre></p> <p>Con el contenido: <pre><code>vagrant@practicacifradogpg:~$ cat para_adrian_openssl.txt\nEste mensaje se cifrar\u00e1 con openssl.\n\nEs para Adri\u00e1n.\n</code></pre></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/","title":"Pr\u00e1ctica: Integridad, firmas y autenticaci\u00f3n","text":""},{"location":"sad/practica-integridad-firmas-autenticacion/#tarea-1-firmas-electronicas","title":"Tarea 1: Firmas electr\u00f3nicas","text":""},{"location":"sad/practica-integridad-firmas-autenticacion/#11","title":"1.1","text":"<p>Enviar un fichero y la firma del mismo a Carlos</p> <p>Enviar\u00e9:</p> <pre><code>-rw-r--r-- 1 vagrant vagrant 28 Apr 28 01:03 paracarlos.txt\n</code></pre> <p>Genero la firma:</p> <pre><code>gpg --detach-sign paracarlos.txt\n</code></pre> <p>Obtengo:</p> <pre><code>-rw-r--r-- 1 vagrant vagrant       438 Apr 28 01:12 paracarlos.txt.sig\n</code></pre> <p>Esta firma tambi\u00e9n la enviar\u00e9. Ambos ficheros enviados por scp.</p> <p>Verificar la firma recibida</p> <p>Recibo por scp:</p> <pre><code>-rw-r--r-- 1 vagrant vagrant        28 May 15 11:02 paraadrian.txt\n-rw-r--r-- 1 vagrant vagrant       438 May 15 11:02 paraadrian.txt.sig\n</code></pre> <p>Verifico la firma:</p> <pre><code>vagrant@practicafirmas:~$ gpg --verify paraadrian.txt.sig paraadrian.txt\ngpg: Signature made Sun May 15 10:44:25 2022 UTC\ngpg:                using RSA key 4E8FF10EDF312F43014B7AE13F6189C8E59B7714\ngpg: Good signature from \"Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\" [unknown]\ngpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\nPrimary key fingerprint: 4E8F F10E DF31 2F43 014B  7AE1 3F61 89C8 E59B 7714\n</code></pre> <p>La verificaci\u00f3n ha sido correcta.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#12","title":"1.2","text":"<p>\u00bfQu\u00e9 significa este mensaje al verificar la firma?</p> <pre><code> gpg: Firma correcta de \"Pepe D &lt;josedom24@gmail.com&gt;\" [desconocido]\n gpg: ATENCI\u00d3N: \u00a1Esta clave no est\u00e1 certificada por una firma de confianza!\n gpg:          No hay indicios de que la firma pertenezca al propietario.\n Huellas dactilares de la clave primaria: E8DD 5DA9 3B88 F08A DA1D  26BF 5141 3DDB 0C99 55FC\n</code></pre> <p>Significa que la clave p\u00fablica con la que se ha verificado la firma, no es una clave en la que yo conf\u00ede / haya firmado.</p> <p>Por ejemplo, puede suceder cuando la trust es \"unknown\", como ha sido el caso del apartado anterior.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#13","title":"1.3","text":"<p>En este apartado crearemos un anillo de confianza entre varios compa\u00f1eros.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#131","title":"1.3.1","text":"<p>Subir tu clave p\u00fablica a <code>pgp.rediris.es</code></p> <pre><code>vagrant@practicafirmas:~$ gpg --keyserver pgp.rediris.es --send-keys 69172731E9645F6ACB60CCBA0C3C966CD1DC1A62\ngpg: sending key 0C3C966CD1DC1A62 to hkp://pgp.rediris.es\n</code></pre> <p>Compruebo que se ha subido correctamente:</p> <pre><code>vagrant@practicafirmas:~$ gpg --keyserver pgp.rediris.es --search-keys 69172731E9645F6ACB60CCBA0C3C966CD1DC1A62\ngpg: data source: http://130.206.1.8:11371\n(1) Adrian Jaramillo &lt;adristudy@gmail.com&gt;\n      3072 bit RSA key 0C3C966CD1DC1A62, created: 2022-05-16, expires: 2024-05-15\nKeys 1-1 of 1 for \"69172731E9645F6ACB60CCBA0C3C966CD1DC1A62\".  Enter number(s), N)ext, or Q)uit &gt;\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#132","title":"1.3.2","text":"<p>Pasar el fingerprint de tu clave subida a tus compa\u00f1eros para que la puedan descargar</p> <p>Hecho.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#133","title":"1.3.3","text":"<p>Bajar y firmar tres claves p\u00fablicas de compa\u00f1eros</p> <p>Me bajo la de Carlos:</p> <pre><code>vagrant@practicafirmas:~$ gpg --keyserver pgp.rediris.es --receive-keys 3F6189C8E59B7714\ngpg: key 3F6189C8E59B7714: public key \"Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre> <p>La firmo:</p> <pre><code>vagrant@practicafirmas:~$ gpg --sign-key 3F6189C8E59B7714\n\npub  rsa3072/3F6189C8E59B7714\n     created: 2022-05-15  expires: 2024-05-14  usage: SC\n     trust: unknown       validity: unknown\nsub  rsa3072/1707D1A73D4578B2\n     created: 2022-05-15  expires: 2024-05-14  usage: E\n[ unknown] (1). Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\npub  rsa3072/3F6189C8E59B7714\n     created: 2022-05-15  expires: 2024-05-14  usage: SC\n     trust: unknown       validity: unknown\n Primary key fingerprint: 4E8F F10E DF31 2F43 014B  7AE1 3F61 89C8 E59B 7714\n     Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nThis key is due to expire on 2024-05-14.\nAre you sure that you want to sign this key with your\nkey \"Adrian Jaramillo &lt;adristudy@gmail.com&gt;\" (0C3C966CD1DC1A62)\nReally sign? (y/N) y\n</code></pre> <p>Muestro que se aplic\u00f3 correctamente:</p> <pre><code>vagrant@practicafirmas:~$ gpg --list-sig 4E8FF10EDF312F43014B7AE13F6189C8E59B7714\npub   rsa3072 2022-05-15 [SC] [expires: 2024-05-14]\n      4E8FF10EDF312F43014B7AE13F6189C8E59B7714\nuid           [  full  ] Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nsig 3        3F6189C8E59B7714 2022-05-15  Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nsig          0C3C966CD1DC1A62 2022-05-16  Adrian Jaramillo &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2022-05-15 [E] [expires: 2024-05-14]\nsig          3F6189C8E59B7714 2022-05-15  Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\n</code></pre> <p>Me bajo la de Daniel:</p> <pre><code>vagrant@practicafirmas:~$ gpg --keyserver pgp.rediris.es --receive-keys 82805738F5FF4457\ngpg: key 82805738F5FF4457: public key \"Daniel Parrales &lt;daniparrales1@gmail.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre> <p>La firmo:</p> <pre><code>vagrant@practicafirmas:~$ gpg --sign-key 82805738F5FF4457\n\npub  rsa3072/82805738F5FF4457\n     created: 2022-05-16  expires: 2024-05-15  usage: SC\n     trust: unknown       validity: unknown\nsub  rsa3072/408742D95A6657E5\n     created: 2022-05-16  expires: 2024-05-15  usage: E\n[ unknown] (1). Daniel Parrales &lt;daniparrales1@gmail.com&gt;\npub  rsa3072/82805738F5FF4457\n     created: 2022-05-16  expires: 2024-05-15  usage: SC\n     trust: unknown       validity: unknown\n Primary key fingerprint: 8595 30FB 6525 B22C 5F36  8117 8280 5738 F5FF 4457\n     Daniel Parrales &lt;daniparrales1@gmail.com&gt;\nThis key is due to expire on 2024-05-15.\nAre you sure that you want to sign this key with your\nkey \"Adrian Jaramillo &lt;adristudy@gmail.com&gt;\" (0C3C966CD1DC1A62)\nReally sign? (y/N) y\n</code></pre> <p>Muestro que se aplic\u00f3 correctamente:</p> <pre><code>vagrant@practicafirmas:~$ gpg --list-sig 82805738F5FF4457\npub   rsa3072 2022-05-16 [SC] [expires: 2024-05-15]\n      859530FB6525B22C5F36811782805738F5FF4457\nuid           [  full  ] Daniel Parrales &lt;daniparrales1@gmail.com&gt;\nsig 3        82805738F5FF4457 2022-05-16  Daniel Parrales &lt;daniparrales1@gmail.com&gt;\nsig          0C3C966CD1DC1A62 2022-06-07  Adrian Jaramillo &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2022-05-16 [E] [expires: 2024-05-15]\nsig          82805738F5FF4457 2022-05-16  Daniel Parrales &lt;daniparrales1@gmail.com&gt;\n</code></pre> <p>Me bajo la de Lara:</p> <pre><code>vagrant@practicafirmas:~$ gpg --keyserver pgp.rediris.es --receive-keys EB5FEF455BD986A0\ngpg: key EB5FEF455BD986A0: public key \"Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre> <p>La firmo:</p> <pre><code>vagrant@practicafirmas:~$ gpg --sign-key EB5FEF455BD986A0\n\npub  rsa3072/EB5FEF455BD986A0\n     created: 2022-06-07  expires: 2024-06-06  usage: SC\n     trust: unknown       validity: unknown\nsub  rsa3072/C1F92F5A0AEA093D\n     created: 2022-06-07  expires: 2024-06-06  usage: E\n[ unknown] (1). Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\npub  rsa3072/EB5FEF455BD986A0\n     created: 2022-06-07  expires: 2024-06-06  usage: SC\n     trust: unknown       validity: unknown\n Primary key fingerprint: 8317 2CA2 F8FC 2124 94CB  677D EB5F EF45 5BD9 86A0\n     Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\nThis key is due to expire on 2024-06-06.\nAre you sure that you want to sign this key with your\nkey \"Adrian Jaramillo &lt;adristudy@gmail.com&gt;\" (0C3C966CD1DC1A62)\nReally sign? (y/N) y\n</code></pre> <p>Muestro que se aplic\u00f3 correctamente:</p> <pre><code>vagrant@practicafirmas:~$ gpg --list-sig EB5FEF455BD986A0\npub   rsa3072 2022-06-07 [SC] [expires: 2024-06-06]\n      83172CA2F8FC212494CB677DEB5FEF455BD986A0\nuid           [  full  ] Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\nsig 3        EB5FEF455BD986A0 2022-06-07  Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\nsig          0C3C966CD1DC1A62 2022-06-07  Adrian Jaramillo &lt;adristudy@gmail.com&gt;\nsub   rsa3072 2022-06-07 [E] [expires: 2024-06-06]\nsig          EB5FEF455BD986A0 2022-06-07  Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#134","title":"1.3.4","text":"<p>Tu clave p\u00fablica tiene que tener 3 firmas</p> <pre><code>vagrant@practicafirmas:~$ gpg --list-sigs adristudy@gmail.com\npub   rsa3072 2022-05-16 [SC] [expires: 2024-05-15]\n      69172731E9645F6ACB60CCBA0C3C966CD1DC1A62\nuid           [ultimate] Adrian Jaramillo &lt;adristudy@gmail.com&gt;\nsig 3        0C3C966CD1DC1A62 2022-05-16  Adrian Jaramillo &lt;adristudy@gmail.com&gt;\nsig          3F6189C8E59B7714 2022-06-07  Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nsig          82805738F5FF4457 2022-06-07  Daniel Parrales &lt;daniparrales1@gmail.com&gt;\nsig          EB5FEF455BD986A0 2022-06-07  Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\nsub   rsa3072 2022-05-16 [E] [expires: 2024-05-15]\nsig          0C3C966CD1DC1A62 2022-05-16  Adrian Jaramillo &lt;adristudy@gmail.com&gt;\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#135","title":"1.3.5","text":"<p>Al firmar claves, devolverlas a su due\u00f1o</p> <p>Todas las exporto de esta manera:</p> <pre><code>gpg --export -a carlosrivero198@gmail.com &gt; publiccarlos.key\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#136","title":"1.3.6","text":"<p>Subir a <code>pgp.rediris.es</code> tu clave cuando tenga tres firmas</p> <pre><code>vagrant@practicafirmas:~$ gpg --keyserver pgp.rediris.es --send-key 69172731E9645F6ACB60CCBA0C3C966CD1DC1A62\ngpg: sending key 0C3C966CD1DC1A62 to hkp://pgp.rediris.es\n</code></pre> <p>Muestro las 3 firmas en el keyserver:</p> <p></p> <p>Rellenar datos de tu clave p\u00fablica aqu\u00ed</p> <p></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#137","title":"1.3.7","text":"<p>Bajar las claves p\u00fablicas de tus compa\u00f1eros con tres firmas</p> <p>Todas se bajar\u00e1n de la misma manera:</p> <pre><code>gpg --keyserver pgp.rediris.es --recv-key 3F6189C8E59B7714\n</code></pre> <p>IMPORTANTE: AL BAJAR DIRECTAMENTE LAS CLAVES DE ESTA MANERA LAS FIRMAS SE ELIMINAN, AS\u00cd QUE ES MEJOR IMPORTAR LAS CLAVES DESDE UN FICHERO Y AS\u00cd MANTENDREMOS LAS FIRMAS</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#14","title":"1.4","text":"<p>Mostrar las firmas de tu clave p\u00fablica</p> <pre><code>vagrant@practicafirmas:~$ gpg --list-sigs adristudy@gmail.com\npub   rsa3072 2022-05-16 [SC] [expires: 2024-05-15]\n      69172731E9645F6ACB60CCBA0C3C966CD1DC1A62\nuid           [ultimate] Adrian Jaramillo &lt;adristudy@gmail.com&gt;\nsig 3        0C3C966CD1DC1A62 2022-05-16  Adrian Jaramillo &lt;adristudy@gmail.com&gt;\nsig          3F6189C8E59B7714 2022-06-07  Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nsig          82805738F5FF4457 2022-06-07  Daniel Parrales &lt;daniparrales1@gmail.com&gt;\nsig          EB5FEF455BD986A0 2022-06-07  Lara Pruna Ternero &lt;laraprute@gmail.com&gt;\nsub   rsa3072 2022-05-16 [E] [expires: 2024-05-15]\nsig          0C3C966CD1DC1A62 2022-05-16  Adrian Jaramillo &lt;adristudy@gmail.com&gt;\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#15","title":"1.5","text":"<p>Comprobar que se puede verificar \"sin problemas\u201d la firma de Carlos, porque ya se conf\u00eda</p> <pre><code>vagrant@practicafirmas:~$ gpg --verify paraadrian.txt.sig paraadrian.txt\ngpg: Signature made Sun May 15 10:44:25 2022 UTC\ngpg:                using RSA key 4E8FF10EDF312F43014B7AE13F6189C8E59B7714\ngpg: Good signature from \"Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\" [full]\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#16","title":"1.6","text":"<p>Comprobar que puedes verificar con confianza una firma de una persona en la que no conf\u00edas, pero sin embargo si conf\u00eda otra persona en la que tu tienes confianza total</p> <p>En este apartado vamos a intentar verificar una firma de Miguel:</p> <pre><code>-rw-r--r-- 1 vagrant vagrant        16 Jun  8 06:17 paraadriandemiguel.txt\n-rw-r--r-- 1 vagrant vagrant       438 Jun  8 06:18 paraadriandemiguel.txt.sig\n</code></pre> <p>Tenemos su clave p\u00fablica firmada por Carlos (en el que confiamos), pero la propia clave de Miguel nosotros no la hemos firmado, por lo que no confiamos:</p> <pre><code>vagrant@practicafirmas:~$ gpg --list-sigs miguelcor.rrs@gmail.com\npub   rsa3072 2022-06-07 [SC] [expires: 2024-06-06]\n      5173B9123875E25C833A855307F879A05A4147C3\nuid           [  undef ] Miguel Cordoba &lt;miguelcor.rrs@gmail.com&gt;\nsig 3        07F879A05A4147C3 2022-06-07  Miguel Cordoba &lt;miguelcor.rrs@gmail.com&gt;\nsig          3F6189C8E59B7714 2022-06-07  Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nsub   rsa3072 2022-06-07 [E] [expires: 2024-06-06]\nsig          07F879A05A4147C3 2022-06-07  Miguel Cordoba &lt;miguelcor.rrs@gmail.com&gt;\n</code></pre> <p>Bien, si intentamos verificar la firma de Miguel, \u00bfdeber\u00eda de no haber errores verdad? Porque como dijimos, Carlos firm\u00f3 la de Miguel, y yo conf\u00edo en Carlos.</p> <p>Hagamos la prueba:</p> <pre><code>vagrant@practicafirmas:~$ gpg --verify paraadriandemiguel.txt.sig paraadriandemiguel.txt\ngpg: Signature made Wed Jun  8 06:15:58 2022 UTC\ngpg:                using RSA key 5173B9123875E25C833A855307F879A05A4147C3\ngpg: Good signature from \"Miguel Cordoba &lt;miguelcor.rrs@gmail.com&gt;\" [undefined]\ngpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\nPrimary key fingerprint: 5173 B912 3875 E25C 833A  8553 07F8 79A0 5A41 47C3\n</code></pre> <p>Error. \u00bfPor qu\u00e9 ha sucedido esto?</p> <p>Pues bien, debemos explicar antes 2 conceptos fundamentales, trust y validity:</p> <ul> <li>TRUST: la trust se configura manualmente. Describe si una clave puede firmar otras claves, y que se conf\u00eden en ellas aunque yo directamente no conf\u00ede (permite la confianza en terceros). Ej: Si se conf\u00eda completamente en una persona \"A\", y esa persona firma la clave de una persona \"B\", autom\u00e1ticamente veremos la clave de \"B\" como v\u00e1lida.</li> <li>VALIDITY: la validez en diferencia con la trust, s\u00ed puede ser autom\u00e1tica. Describe si una clave tiene las suficientes firmas para que se pruebe que es la clave correcta (cuando nosotros firmamos una clave, autom\u00e1ticamente la validez pasa a \"full\")</li> </ul> <p>Habiendo dicho esto, entonces lo que ha debido pasar es que no tenemos confianza en la clave de Carlos, aunque la validez est\u00e9 a full porque la firmamos en su momento. Es decir, sabemos que la clave de Carlos es de verdad de Carlos, pero no confiamos en que Carlos firme otras claves, y luego nos creamos que esas otras son verdaderas.</p> <p>Vamos a mostrar los datos de la clave de Carlos para comprobar lo ya dicho:</p> <pre><code>vagrant@practicafirmas:~$ gpg --edit-key carlosrivero198@gmail.com\ngpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\npub  rsa3072/3F6189C8E59B7714\n     created: 2022-05-15  expires: 2024-05-14  usage: SC\n     trust: unknown       validity: full\nsub  rsa3072/1707D1A73D4578B2\n     created: 2022-05-15  expires: 2024-05-14  usage: E\n[  full  ] (1). Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\ngpg&gt;\n</code></pre> <p>Est\u00e1 ocurriendo tal y como hemos explicado antes, la trust es \"unknown\" y la validity es \"full\". No estamos confiando en las firmas a terceros de Carlos.</p> <p>\u00bfEntonces qu\u00e9 debemos hacer?</p> <p>Cambiar la trust en la clave de Carlos para que confiemos en sus firmas a terceros. Debemos configurar el nivel de trust a 4, o full. Lo hacemos as\u00ed:</p> <pre><code>vagrant@practicafirmas:~$ gpg --edit-key 4E8FF10EDF312F43014B7AE13F6189C8E59B7714 trust\ngpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\npub  rsa3072/3F6189C8E59B7714\n     created: 2022-05-15  expires: 2024-05-14  usage: SC\n     trust: unknown       validity: full\nsub  rsa3072/1707D1A73D4578B2\n     created: 2022-05-15  expires: 2024-05-14  usage: E\n[  full  ] (1). Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\npub  rsa3072/3F6189C8E59B7714\n     created: 2022-05-15  expires: 2024-05-14  usage: SC\n     trust: unknown       validity: full\nsub  rsa3072/1707D1A73D4578B2\n     created: 2022-05-15  expires: 2024-05-14  usage: E\n[  full  ] (1). Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nPlease decide how far you trust this user to correctly verify other users' keys\n(by looking at passports, checking fingerprints from different sources, etc.)\n  1 = I don't know or won't say\n  2 = I do NOT trust\n  3 = I trust marginally\n  4 = I trust fully\n  5 = I trust ultimately\n  m = back to the main menu\nYour decision? 4\npub  rsa3072/3F6189C8E59B7714\n     created: 2022-05-15  expires: 2024-05-14  usage: SC\n     trust: full          validity: full\nsub  rsa3072/1707D1A73D4578B2\n     created: 2022-05-15  expires: 2024-05-14  usage: E\n[  full  ] (1). Carlos Rivero &lt;carlosrivero198@gmail.com&gt;\nPlease note that the shown key validity is not necessarily correct\nunless you restart the program.\ngpg&gt; quit\n</code></pre> <p>Ahora la trust est\u00e1 a full como podemos observar.</p> <p>Pues bien, ahora s\u00ed podremos verificar correctamente la firma de Miguel, porque ahora confiamos en las firmas de Carlos a terceros. Por esto, en nuestro listado de claves, ahora la clave de Miguel es confiada de forma full:</p> <pre><code>pub   rsa3072 2022-06-07 [SC] [expires: 2024-06-06]\n      5173B9123875E25C833A855307F879A05A4147C3\nuid           [  full  ] Miguel Cordoba &lt;miguelcor.rrs@gmail.com&gt;\nsub   rsa3072 2022-06-07 [E] [expires: 2024-06-06]\n</code></pre> <p>Podremos ahora verificar su firma correctamente:</p> <pre><code>vagrant@practicafirmas:~$ gpg --verify paraadriandemiguel.txt.sig paraadriandemiguel.txt\ngpg: Signature made Wed Jun  8 06:15:58 2022 UTC\ngpg:                using RSA key 5173B9123875E25C833A855307F879A05A4147C3\ngpg: Good signature from \"Miguel Cordoba &lt;miguelcor.rrs@gmail.com&gt;\" [full]\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#tarea-2-correo-seguro-con-evolution","title":"Tarea 2: Correo seguro con Evolution","text":""},{"location":"sad/practica-integridad-firmas-autenticacion/#21","title":"2.1","text":"<p>Configurar una cuenta de correo</p> <pre><code>sudo apt install evolution\n</code></pre> <p>Despu\u00e9s de instalarlo y configurarlo, muestro que funciona:</p> <p></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#22","title":"2.2","text":"<p>Configurar el firmado de correos con nuestra clave privada</p> <p>Primero tenemos que llegar al men\u00fa correspondiente:</p> <p></p> <p>Una vez ah\u00ed, indicamos el fingerprint del par de claves con el que queremos firmar:</p> <p></p> <p>Para que los correos de verdad se firmen al enviarse, tenemos que marcar la siguiente opci\u00f3n antes de enviarlos:</p> <p></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#23","title":"2.3","text":"<p>Configurar el cifrado de correos para otros destinatarios</p> <p>Para el cifrado no hace falta que configuremos en Evolution las claves p\u00fablicas, ya que las toma de nuestro keybox autom\u00e1ticamente seg\u00fan la direcci\u00f3n que escribamos en el \"To:\".</p> <p>Para que los correos de verdad se cifren al enviarse, tenemos que marcar la siguiente opci\u00f3n antes de enviarlos:</p> <p></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#24","title":"2.4","text":"<p>Enviar un correo firmado y cifrado a Carlos</p> <p>Este es el correo que enviar\u00e9:</p> <p></p> <p>Si yo lo intento abrir, no podr\u00e9 ver el contenido ya que no tengo la clave privada de Carlos para desencriptarlo:</p> <p></p> <p>Este es el correo que le ha llegado a Carlos, desde su punto de vista, y vemos que todo es correcto:</p> <p></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#25","title":"2.5","text":"<p>Recibir un correo firmado y cifrado de Carlos</p> <p>Vemos que todo es correcto:</p> <p></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#26","title":"2.6","text":"<p>Mandar a Ra\u00fal un correo cifrado y firmado</p> <p>Busco la clave p\u00fablica de Ra\u00fal en RedIRIS y me la bajo (se necesitar\u00e1 para encriptar):</p> <pre><code>atlas@olympus:~$ gpg --keyserver pgp.rediris.es --search-key rruizp@gmail.com\ngpg: data source: http://130.206.1.8:11371\n(1) Ra\u00fal Ruiz Padilla &lt;rruizp@gmail.com&gt;\n      3072 bit RSA key A036DF623D608DE0, created: 2021-11-10, expires: 2023-11-10\n(2) Ra\u00fal Ruiz (Claves para clase) &lt;rruizp@gmail.com&gt;\n      4096 bit RSA key 334BEE7E18D37DEA, created: 2017-12-16\n(3) Raul Ruiz Padilla (Clave para SAD 1617) &lt;rruizp@gmail.com&gt;\n      4096 bit RSA key F6C88DC57C2FA472, created: 2016-12-11, expires: 2018-12-10 (expired)\nKeys 1-3 of 3 for \"rruizp@gmail.com\".  Enter number(s), N)ext, or Q)uit &gt; 1\ngpg: key A036DF623D608DE0: public key \"Ra\u00fal Ruiz Padilla &lt;rruizp@gmail.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre> <p>Antes de enviar el correo es importante que dejemos marcada esta opci\u00f3n, para evitar el tener que firmar las claves p\u00fablicas de las personas a quienes queramos enviar:</p> <p></p> <p>Este es el correo que enviar\u00e9:</p> <p></p> <p>La parte marcada en rojo quiere decir que el correo se encriptar\u00e1 y firmar\u00e1.</p> <p>\u00bfQU\u00c9 TENDR\u00c1 QUE HACER RA\u00daL PARA LEER ESTE CORREO CORRECTAMENTE?</p> <p>Necesitar\u00e1 2 cosas:</p> <ul> <li>La clave privada correspondiente a la p\u00fablica con la que se encript\u00f3 el correo para descifrarlo correctamente.</li> <li>Mi clave p\u00fablica para poder verificar la firma. La podr\u00e1 obtener con el comando <code>gpg --keyserver pgp.rediris.es --search-key adristudy@gmail.com</code>, eligiendo la de fingerprint CA350E4C295E2EF4.</li> </ul>"},{"location":"sad/practica-integridad-firmas-autenticacion/#tarea-3-integridad-de-ficheros","title":"Tarea 3: Integridad de ficheros","text":""},{"location":"sad/practica-integridad-firmas-autenticacion/#31","title":"3.1","text":"<p>Descargar la ISO de Debian</p> <pre><code>wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.2.0-amd64-netinst.iso\n</code></pre> <p>Obtengo el fichero:</p> <pre><code>-rw-r--r-- 1 vagrant vagrant 396361728 Dec 18 13:24 debian-11.2.0-amd64-netinst.iso\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#32","title":"3.2","text":"<p>Comprobar la integridad de la ISO descargada usando <code>sha512sum</code></p> <p>En el fichero SHA512SUMS que nos proporciona Debian, nos encontramos el siguiente checksum para la ISO descargada:</p> <pre><code>c685b85cf9f248633ba3cd2b9f9e781fa03225587e0c332aef2063f6877a1f0622f56d44cf0690087b0ca36883147ecb5593e3da6f965968402cdbdf12f6dd74\n</code></pre> <p>Luego utilizo <code>sha512sum</code> sobre la ISO que me he descargado:</p> <pre><code>sha512sum debian-11.2.0-amd64-netinst.iso\n</code></pre> <pre><code>c685b85cf9f248633ba3cd2b9f9e781fa03225587e0c332aef2063f6877a1f0622f56d44cf0690087b0ca36883147ecb5593e3da6f965968402cdbdf12f6dd74  debian-11.2.0-amd64-netinst.iso\n</code></pre> <p>Ambos hashes coinciden, as\u00ed que nos hemos descargado el fichero correctamente.</p> <p>Igualmente, si queremos evitar errores, podemos usar una herramienta online para comparar strings:</p> <p></p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#33","title":"3.3","text":"<p>Verificar que <code>SHA512SUMS</code> no ha sido manipulado usando <code>SHA512SUMS.sign</code></p> <p>Primero descargo ambos ficheros:</p> <pre><code>wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA512SUMS\nwget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA512SUMS.sign\n</code></pre> <p>Muestro que los tengo:</p> <pre><code>-rw-r--r-- 1 vagrant vagrant       494 Dec 18 20:42 SHA512SUMS\n-rw-r--r-- 1 vagrant vagrant       833 Dec 18 20:45 SHA512SUMS.sign\n</code></pre> <p>Averiguo el fingerprint del par de claves que se us\u00f3 originalmente para crear la firma <code>SHA512SUMS.sign</code>:</p> <pre><code>gpg --verify SHA512SUMS.sign\n</code></pre> <p></p> <p>No se puede verificar la firma porque no tenemos la clave p\u00fablica de Debian en nuestro keybox, pero ya sabemos su fingerprint para descargarla:</p> <pre><code>gpg --keyserver keyring.debian.org --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B\n</code></pre> <pre><code>gpg: key DA87E80D6294BE9B: public key \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n</code></pre> <p>Finalmente, podemos verificar la firma:</p> <pre><code>gpg --verify SHA512SUMS.sign SHA512SUMS\n</code></pre> <pre><code>gpg: Signature made Sat Dec 18 20:45:36 2021 UTC\ngpg:                using RSA key DF9B9C49EAA9298432589D76DA87E80D6294BE9B\ngpg: Good signature from \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" [unknown]\ngpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\nPrimary key fingerprint: DF9B 9C49 EAA9 2984 3258  9D76 DA87 E80D 6294 BE9B\n</code></pre> <p>Se ha podido verificar correctamente, <code>SHA512SUMS</code> es leg\u00edtimo.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#tarea-4-integridad-y-autenticidad-apt-secure","title":"Tarea 4: Integridad y autenticidad (apt-secure)","text":""},{"location":"sad/practica-integridad-firmas-autenticacion/#41","title":"4.1","text":"<p>\u00bfQu\u00e9 herramienta utiliza apt-secure para firmar y verificar firmas?</p> <p>GPG.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#42","title":"4.2","text":"<p>\u00bfPara qu\u00e9 sirve <code>apt-key</code>?</p> <p>Se usa para gestionar la lista de claves que mantiene apt para autenticar paquetes.  </p> <p>Los paquetes que sean autenticados usando estas claves se considerar\u00e1n \"trusted\".</p> <p>\u00bfQu\u00e9 muestra el comando <code>apt-key list</code>?</p> <p>Lista las claves p\u00fablicas en las que confiamos.  </p> <p>Muestro mi output de <code>apt-key list</code>:</p> <pre><code>Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).\n/etc/apt/trusted.gpg.d/debian-archive-bullseye-automatic.gpg\n------------------------------------------------------------\npub   rsa4096 2021-01-17 [SC] [expires: 2029-01-15]\n      1F89 983E 0081 FDE0 18F3  CC96 73A4 F27B 8DD4 7936\nuid           [ unknown] Debian Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;\nsub   rsa4096 2021-01-17 [S] [expires: 2029-01-15]\n/etc/apt/trusted.gpg.d/debian-archive-bullseye-security-automatic.gpg\n---------------------------------------------------------------------\npub   rsa4096 2021-01-17 [SC] [expires: 2029-01-15]\n      AC53 0D52 0F2F 3269 F5E9  8313 A484 4904 4AAD 5C5D\nuid           [ unknown] Debian Security Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;\nsub   rsa4096 2021-01-17 [S] [expires: 2029-01-15]\n/etc/apt/trusted.gpg.d/debian-archive-bullseye-stable.gpg\n---------------------------------------------------------\npub   rsa4096 2021-02-13 [SC] [expires: 2029-02-11]\n      A428 5295 FC7B 1A81 6000  62A9 605C 66F0 0D6C 9793\nuid           [ unknown] Debian Stable Release Key (11/bullseye) &lt;debian-release@lists.debian.org&gt;\n/etc/apt/trusted.gpg.d/debian-archive-buster-automatic.gpg\n----------------------------------------------------------\npub   rsa4096 2019-04-14 [SC] [expires: 2027-04-12]\n      80D1 5823 B7FD 1561 F9F7  BCDD DC30 D7C2 3CBB ABEE\nuid           [ unknown] Debian Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;\nsub   rsa4096 2019-04-14 [S] [expires: 2027-04-12]\n/etc/apt/trusted.gpg.d/debian-archive-buster-security-automatic.gpg\n-------------------------------------------------------------------\npub   rsa4096 2019-04-14 [SC] [expires: 2027-04-12]\n      5E61 B217 265D A980 7A23  C5FF 4DFA B270 CAA9 6DFA\nuid           [ unknown] Debian Security Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;\nsub   rsa4096 2019-04-14 [S] [expires: 2027-04-12]\n/etc/apt/trusted.gpg.d/debian-archive-buster-stable.gpg\n-------------------------------------------------------\npub   rsa4096 2019-02-05 [SC] [expires: 2027-02-03]\n      6D33 866E DD8F FA41 C014  3AED DCC9 EFBF 77E1 1517\nuid           [ unknown] Debian Stable Release Key (10/buster) &lt;debian-release@lists.debian.org&gt;\n/etc/apt/trusted.gpg.d/debian-archive-stretch-automatic.gpg\n-----------------------------------------------------------\npub   rsa4096 2017-05-22 [SC] [expires: 2025-05-20]\n      E1CF 20DD FFE4 B89E 8026  58F1 E0B1 1894 F66A EC98\nuid           [ unknown] Debian Archive Automatic Signing Key (9/stretch) &lt;ftpmaster@debian.org&gt;\nsub   rsa4096 2017-05-22 [S] [expires: 2025-05-20]\n/etc/apt/trusted.gpg.d/debian-archive-stretch-security-automatic.gpg\n--------------------------------------------------------------------\npub   rsa4096 2017-05-22 [SC] [expires: 2025-05-20]\n      6ED6 F5CB 5FA6 FB2F 460A  E88E EDA0 D238 8AE2 2BA9\nuid           [ unknown] Debian Security Archive Automatic Signing Key (9/stretch) &lt;ftpmaster@debian.org&gt;\nsub   rsa4096 2017-05-22 [S] [expires: 2025-05-20]\n/etc/apt/trusted.gpg.d/debian-archive-stretch-stable.gpg\n--------------------------------------------------------\npub   rsa4096 2017-05-20 [SC] [expires: 2025-05-18]\n      067E 3C45 6BAE 240A CEE8  8F6F EF0F 382A 1A7B 6500\nuid           [ unknown] Debian Stable Release Key (9/stretch) &lt;debian-release@lists.debian.org&gt;\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#43","title":"4.3","text":"<p>\u00bfD\u00f3nde se encuentran los distintos keyrings que usa <code>apt-key</code>?</p> <p>En <code>/etc/apt/trusted.gpg.d/</code>.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#44","title":"4.4","text":"<p>\u00bfQu\u00e9 contiene el fichero <code>Release</code> de un repositorio?</p> <p>En otros datos, contiene los checksums de los ficheros que hay en el repositorio.</p> <p>Ejemplo: http://ftp.debian.org/debian/dists/Debian11.2/Release</p> <p>\u00bfY <code>Release.gpg</code>?</p> <p>Contiene la firma detached ascii-armored del fichero <code>Release</code>.</p> <p>Ejemplo: http://ftp.debian.org/debian/dists/Debian11.2/Release.gpg</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#45","title":"4.5","text":"<p>Explicar el proceso por el cual apt nos asegura que los ficheros que estamos descargando son leg\u00edtimos</p> <ol> <li>Se descargan los ficheros <code>Release</code>, <code>Release.gpg</code>, y el fichero <code>Packages</code> que corresponda.</li> <li>Se comprueba usando la firma <code>Release.gpg</code> m\u00e1s la clave p\u00fablica correspondiente, que el fichero <code>Release</code> es leg\u00edtimo. A partir de aqu\u00ed, apt ya conf\u00eda en todos sus checksums.</li> <li>Apt compara el checksum del fichero <code>Packages</code> con el que encuentra en el fichero <code>Release</code>; si coinciden, quiere decir que se descarg\u00f3 el fichero correcto.</li> <li>Al descargarnos un paquete individual se compara su checksum con el que aparece en <code>Packages</code>; si coinciden, quiere decir que se descarg\u00f3 el paquete correcto.</li> </ol>"},{"location":"sad/practica-integridad-firmas-autenticacion/#46","title":"4.6","text":"<p>A\u00f1adir el repositorio de VirtualBox</p> <p>A\u00f1ado las claves gpg necesarias:</p> <pre><code>wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add -\nwget -q https://www.virtualbox.org/download/oracle_vbox.asc -O- | sudo apt-key add -\n</code></pre> <p>A\u00f1ado el repositorio:</p> <pre><code>echo \"deb [arch=amd64] http://download.virtualbox.org/virtualbox/debian bullseye contrib\" | sudo tee /etc/apt/sources.list.d/virtualbox.list\n</code></pre>"},{"location":"sad/practica-integridad-firmas-autenticacion/#tarea-5-autenticacion-en-ssh","title":"Tarea 5: Autenticaci\u00f3n en SSH","text":""},{"location":"sad/practica-integridad-firmas-autenticacion/#51","title":"5.1","text":"<p>Explicar qu\u00e9 sucede entre el cliente y el servidor para que se cifre la comunicaci\u00f3n</p> <p>Una sesi\u00f3n SSH tiene 2 fases antes de que se pueda cifrar la comunicaci\u00f3n. Las explicar\u00e9 a continuaci\u00f3n.</p> <ol> <li>CONEXI\u00d3N<ol> <li>El cliente establece una conexi\u00f3n TCP con el servidor, y este responde con las versiones del protocolo que soporta.</li> <li>Si el cliente usa una versi\u00f3n del protocolo que coincida con las que acepta el servidor, la conexi\u00f3n contin\u00faa.</li> <li>El servidor comparte su clave p\u00fablica con el cliente, para que este compruebe si efectivamente es la m\u00e1quina a la que quer\u00eda conectarse.</li> <li>A partir de ahora, ambas partes est\u00e1n preparadas para la negociaci\u00f3n de una clave de sesi\u00f3n usando Diffie-Hellman.</li> </ol> </li> <li>NEGOCIACI\u00d3N DE LA ENCRIPTACI\u00d3N PARA LA SESI\u00d3N<ol> <li>Ambas partes se ponen de acuerdo en un n\u00famero primo alto, que servir\u00e1 como \"seed value\".</li> <li>Ambas partes se ponen de acuerdo en un tipo de cifrado (normalmente AES).</li> <li>Ambas partes generan otro n\u00famero primo por separado, que mantienen en secreto de la otra parte. Se usar\u00e1 como clave privada durante esta fase de negociaci\u00f3n (esta clave privada NO es la misma que se usa para la autenticaci\u00f3n).</li> <li>La clave privada generada + el tipo de cifrado + el n\u00famero primo compartido, se usar\u00e1n para generar una clave p\u00fablica que estar\u00e1 derivada de la clave privada.</li> <li>Ambas partes intercambian sus claves p\u00fablicas generadas (estas claves p\u00fablicas NO son las mismas que se usan para la autenticaci\u00f3n).</li> <li>Cada parte usar\u00e1 su clave privada + la clave p\u00fablica de la otra parte + el n\u00famero primo compartido original, para calcular una clave compartida \"shared secret\". Aunque este proceso lo realiza cada parte por separado, mientras se usen claves p\u00fablicas y privadas opuestas, se llegar\u00e1 al mismo \"shared secret\".</li> <li>Este \"shared secret\" se usar\u00e1 para encriptar toda comunicaci\u00f3n a partir de ahora. Es una clave sim\u00e9trica.</li> </ol> </li> </ol> <p>\u00bfPara qu\u00e9 se utiliza la criptograf\u00eda sim\u00e9trica?</p> <p>Para encriptar las conexiones, mediante el uso de una clave secreta.</p> <p>Esta se genera a trav\u00e9s de un proceso llamado \"key exchange algorithm\", y es \u00fanica por sesi\u00f3n. En cuanto ambas partes la sepan, el resto de la sesi\u00f3n se encriptar\u00e1 usando esta clave.</p> <p>\u00bfY la asim\u00e9trica?</p> <p>Se usa:</p> <ul> <li>Durante el intercambio de clave para la encriptaci\u00f3n sim\u00e9trica. Ambas partes generan un par de claves temporal e intercambian la clave p\u00fablica para poder generar el \"shared secret\" (clave sim\u00e9trica) que se usar\u00e1 posteriormente.</li> <li>En la autenticaci\u00f3n del cliente con el servidor.</li> </ul>"},{"location":"sad/practica-integridad-firmas-autenticacion/#52","title":"5.2","text":"<p>Explicar los dos m\u00e9todos de autenticaci\u00f3n que existen.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#con-contrasena","title":"Con contrase\u00f1a","text":"<p>Es el m\u00e9todo m\u00e1s simple. Funciona as\u00ed:</p> <ol> <li>El servidor pide al cliente que introduzca la contrase\u00f1a del usuario con el que se est\u00e1n intentando conectar.</li> <li>Esta contrase\u00f1a se env\u00eda usando la encriptaci\u00f3n previamente negociada, para que se mantenga en secreto frente a terceros.</li> </ol>"},{"location":"sad/practica-integridad-firmas-autenticacion/#con-par-de-claves","title":"Con par de claves","text":"<p>Es el m\u00e9todo m\u00e1s popular y recomendado. Funciona as\u00ed:</p> <ol> <li>El cliente env\u00eda el ID del par de claves con el que se quiere autenticar ante el servidor.</li> <li>El servidor comprueba el fichero <code>authorized_keys</code> del usuario al que el cliente est\u00e1 intentando conectarse, para comprobar si existe la clave correspondiente al ID que envi\u00f3 el cliente en el paso anterior.</li> <li>Si se encuentra una clave p\u00fablica que corresponda con el ID enviado, el servidor genera un n\u00famero aleatorio y usa esa clave p\u00fablica para encriptarlo.</li> <li>El servidor env\u00eda al cliente este n\u00famero encriptado.</li> <li>Si el cliente tiene la clave privada asociada, podr\u00e1 desencriptar este mensaje y revelar el n\u00famero original.</li> <li>El cliente combina el n\u00famero desencriptado con la clave compartida de sesi\u00f3n que se est\u00e1 usando para encriptar la comunicaci\u00f3n, y calcula el hash MD5 de este valor.</li> <li>El cliente env\u00eda este hash de vuelta al servidor como respuesta al mensaje del n\u00famero encriptado.</li> <li>El servidor usa la misma clave compartida de sesi\u00f3n junto con el n\u00famero original que envi\u00f3 al cliente, y calcula el hash MD5 \u00e9l tambi\u00e9n.</li> <li>El servidor compara el hash que \u00e9l mismo gener\u00f3 con el que el cliente le envi\u00f3. Si estos valores son iguales, se prueba que el cliente tiene la clave privada correcta y finalmente, este cliente es autenticado correctamente.</li> </ol>"},{"location":"sad/practica-integridad-firmas-autenticacion/#53","title":"5.3","text":"<p>Explicar la funci\u00f3n del fichero <code>~/.ssh/known_hosts</code></p> <p>Es un fichero de cliente que contiene todas las claves p\u00fablicas de los servidores a los que nos conectamos.</p> <p>El cliente SSH usa este fichero para autenticar los servidores a los que se conecta.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#54","title":"5.4","text":"<p>Explicar el significado del siguiente mensaje que aparece la primera vez que nos conectamos a un servidor</p> <pre><code>$ ssh debian@172.22.200.74\nThe authenticity of host '172.22.200.74 (172.22.200.74)' can't be established.\nECDSA key fingerprint is SHA256:7ZoNZPCbQTnDso1meVSNoKszn38ZwUI4i6saebbfL4M.\nAre you sure you want to continue connecting (yes/no)?\n</code></pre> <p>Nos indica que, al ser la primera vez que nos estamos conectando a este servidor, a\u00fan no tenemos su clave p\u00fablica almacenada en el fichero <code>~/.ssh/known_hosts</code>. Por lo tanto, a\u00fan \"no podemos\" verificar la autenticidad del mismo.</p> <p>Si estamos seguros de su autenticidad, diremos que s\u00ed, y eso almacenar\u00e1 su clave p\u00fablica en <code>~/.ssh/known_hosts</code>.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#55","title":"5.5","text":"<p>\u00bfQu\u00e9 significa el siguiente mensaje que aparece cuando reutilizamos una ip?</p> <pre><code> $ ssh debian@172.22.200.74\n @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\n Someone could be eavesdropping on you right now (man-in-the-middle attack)!\n It is also possible that a host key has just been changed.\n The fingerprint for the ECDSA key sent by the remote host is\n SHA256:W05RrybmcnJxD3fbwJOgSNNWATkVftsQl7EzfeKJgNc.\n Please contact your system administrator.\n Add correct host key in /home/jose/.ssh/known_hosts to get rid of this message.\n Offending ECDSA key in /home/jose/.ssh/known_hosts:103\n   remove with:\n   ssh-keygen -f \"/home/jose/.ssh/known_hosts\" -R \"172.22.200.74\"\n ECDSA host key for 172.22.200.74 has changed and you have requested strict checking.\n</code></pre> <p>Este mensaje simplemente indica que la clave p\u00fablica del servidor al que nos estamos intentando conectar ha cambiado con respecto a la clave que ten\u00edamos guardada para esa IP en nuestro <code>known_hosts</code> previamente.</p> <p>Se nos avisa porque es una forma de ataque man-in-the-middle, pero si estamos seguros de que somos nosotros mismos reutilizando una IP, simplemente borraremos la l\u00ednea correspondiente en nuestro <code>known_hosts</code> sobre la antigua conexi\u00f3n y volveremos a conectarnos.</p>"},{"location":"sad/practica-integridad-firmas-autenticacion/#56","title":"5.6","text":"<p>\u00bfQu\u00e9 guardamos y para qu\u00e9 sirve el fichero en el servidor <code>~/.ssh/authorized_keys</code>?</p> <p>Este es un fichero de servidor, diferente por cada usuario del sistema, y guarda todas las claves p\u00fablicas de clientes permitidos para conectarse.</p> <p>Sirve para que el servidor verifique que los clientes conect\u00e1ndose sean leg\u00edtimos (que tengan la clave privada correspondiente).</p>"},{"location":"sad/practica-vpn-sad/","title":"Pr\u00e1ctica: VPN","text":""},{"location":"sad/practica-vpn-sad/#parte-1-acceso-remoto-openvpn","title":"Parte 1: acceso remoto OpenVPN","text":""},{"location":"sad/practica-vpn-sad/#escenario","title":"Escenario","text":"<p><code>Vagrantfile</code>: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.provider :libvirt do |libvirt|\n    libvirt.cpus = 1\n    libvirt.memory = 512\n  end\n\n  config.vm.define :clientevpn do |clientevpn|\n    clientevpn.vm.box = \"debian/bullseye64\"\n    clientevpn.vm.hostname = \"clientevpn\"\n    clientevpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"externa-vpn\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.11\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :servervpn do |servervpn|\n    servervpn.vm.box = \"debian/bullseye64\"\n    servervpn.vm.hostname = \"servervpn\"\n    servervpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"externa-vpn\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.10\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    servervpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"interna-vpn\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :clientenormal do |clientenormal|\n    clientenormal.vm.box = \"debian/bullseye64\"\n    clientenormal.vm.hostname = \"clientenormal\"\n    clientenormal.vm.network :private_network,\n      :libvirt__network_name =&gt; \"interna-vpn\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.5\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-servervpn","title":"En servervpn","text":""},{"location":"sad/practica-vpn-sad/#instalar-openvpn","title":"Instalar OpenVPN","text":"<pre><code>sudo apt update\nsudo apt install openvpn\n</code></pre>"},{"location":"sad/practica-vpn-sad/#habilitar-forwarding","title":"Habilitar forwarding","text":"<pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n</code></pre>"},{"location":"sad/practica-vpn-sad/#crear-infraestructura-de-clave-publica","title":"Crear infraestructura de clave p\u00fablica","text":"<p>Seg\u00fan la gu\u00eda que estoy siguiendo es necesario copiar la configuraci\u00f3n de <code>/usr/share/easy-rsa</code> a <code>/etc/openvpn</code> antes de continuar, para prevenir que futuras actualizaciones del paquete OpenVPN modifiquen las configuraciones que hagamos.</p> <p>En nuestro caso esta posibilidad nunca llegar\u00eda a hacerse realidad, puesto que lo que estamos haciendo es simplemente una pr\u00e1ctica, que se extiende durante un periodo de tiempo relativamente corto.</p> <p>A\u00fan as\u00ed, lo hago por razones de organizaci\u00f3n, ya que todas las configuraciones manuales deben estar bajo <code>/etc</code>.</p> <pre><code>sudo cp -r /usr/share/easy-rsa /etc/openvpn\ncd /etc/openvpn/easy-rsa\n</code></pre> <p>Inicializamos la PKI: <pre><code>sudo ./easyrsa init-pki\n</code></pre> <pre><code>init-pki complete; you may now create a CA or requests.\nYour newly created PKI dir is: /etc/openvpn/easy-rsa/pki\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#generar-certificado-clave-privada-de-la-ca","title":"Generar certificado + clave privada de la CA","text":"<p>En este paso obtendremos el par de claves necesario de la Autoridad Certificadora (CA).</p> <p>Posteriormente, es esta clave privada la que se usar\u00e1 para firmar los certificados tanto del servidor como del cliente.</p> <p><pre><code>sudo ./easyrsa build-ca\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\n\nEnter New CA Key Passphrase:\nRe-Enter New CA Key Passphrase:\nGenerating RSA private key, 2048 bit long modulus (2 primes)\n........................................................................................+++++\n.......................................+++++\ne is 65537 (0x010001)\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [Easy-RSA CA]:Adrianj CA\n\nCA creation complete and you may now import and sign cert requests.\nYour new CA certificate file for publishing is at:\n/etc/openvpn/easy-rsa/pki/ca.crt\n</code></pre> Passphrase: 1234</p> <p>Certificado generado: <code>/etc/openvpn/easy-rsa/pki/ca.crt</code> Clave privada generada: <code>/etc/openvpn/easy-rsa/pki/private/ca.key</code></p>"},{"location":"sad/practica-vpn-sad/#generar-certificado-clave-privada-del-servidor-vpn","title":"Generar certificado + clave privada del servidor VPN","text":"<p><pre><code>sudo ./easyrsa build-server-full server nopass\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\nGenerating a RSA private key\n.......+++++\n............................+++++\nwriting new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-2389.Tqf1G1/tmp.Ow20MK'\n-----\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-2389.Tqf1G1/tmp.5Exl9Q\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'server'\nCertificate is to be certified until Mar 18 08:30:09 2024 GMT (825 days)\n\nWrite out database with 1 new entries\nData Base Updated\n</code></pre></p> <p>Certificado generado: <code>/etc/openvpn/easy-rsa/pki/issued/server.crt</code> Clave privada generada: <code>/etc/openvpn/easy-rsa/pki/private/server.key</code></p>"},{"location":"sad/practica-vpn-sad/#generar-parametros-diffiehellman","title":"Generar par\u00e1metros Diffie\u2013Hellman","text":"<p><pre><code>sudo ./easyrsa gen-dh\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\nGenerating DH parameters, 2048 bit long safe prime, generator 2\nThis is going to take a long time\n.......................+.....................+..............................................................+......................+................................................................................+...................................................................................................................................................+....................+....................................................................+..................+.......+..............................................................+...........................................................................+................................................................................................................................+.....................................+...........................................................................................................................................................................+................................................................................................................................................................................................................+.+.............................+.........................+..............................................................................................................................................................................................................................+..............+......................................................................+................................+.................................+......................................................................................................+............................................................................................+...........................................................................................................................................................................................+........................................+.............................................................................+....................................................................................................+...........+...........................................................+.....................................................................+...............................................................................................................................................+...........................................................................................................................................+.....................................+........................................................................................+...................+.............+.......................+.......................................................................................+.........................................................+...........................................................................+...............................................................................................................................................................+.......................................+........................................................+..........................................+................................................................................................................+.........+.............................+..........................................................................+...............................................+............................................................................................................+.......+...............................................................................................................+............................................+................+..................................................+...............+..............................................................................+.......................................................................+.................................+..+.+.+..............................................................................................+.............................................................................+...................................................................................................................................................................................................+...........+................................................................................+............................................................................................................................................................................................................+............................+..+......................................................................................................................................................................................+..............................................................................................+......................................................................................................................................................................................................................................................................................................................................................................................................+........................................+......................+...............................+...........................+...............................................................................................+..........................................................................................................................+.......................................................................+.................................................................................+....................................................................+................................+.++*++*++*++*\n\nDH parameters of size 2048 created at /etc/openvpn/easy-rsa/pki/dh.pem\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#generar-certificado-clave-privada-del-cliente-vpn","title":"Generar certificado + clave privada del cliente VPN","text":"<p><pre><code>sudo ./easyrsa build-client-full clientevpn nopass\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\nGenerating a RSA private key\n..............+++++\n................................+++++\nwriting new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-2541.yaiUd0/tmp.WePx19'\n-----\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-2541.yaiUd0/tmp.GMaG7k\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'clientevpn'\nCertificate is to be certified until Mar 18 08:49:43 2024 GMT (825 days)\n\nWrite out database with 1 new entries\nData Base Updated\n</code></pre></p> <p>Certificado generado: <code>/etc/openvpn/easy-rsa/pki/issued/clientevpn.crt</code> Clave privada generada: <code>/etc/openvpn/easy-rsa/pki/private/clientevpn.key</code></p>"},{"location":"sad/practica-vpn-sad/#pasar-ficheros-necesarios-al-cliente-vpn","title":"Pasar ficheros necesarios al cliente VPN","text":"<pre><code>sudo cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/clientevpn.crt,private/clientevpn.key} ~\nsudo chown vagrant: ~/{ca.crt,clientevpn.crt,clientevpn.key}\nscp ~/{ca.crt,clientevpn.crt,clientevpn.key} vagrant@192.88.99.11:/home/vagrant\n</code></pre>"},{"location":"sad/practica-vpn-sad/#configurar-el-servidor-vpn","title":"Configurar el servidor VPN","text":"<p>Copio la plantilla oficial de configuraci\u00f3n para servidores openvpn, para partir de ella: <pre><code>sudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/servidor.conf\n</code></pre></p> <p>Modifico <code>/etc/openvpn/server/servidor.conf</code>: <pre><code>port 1194\nproto udp\ndev tun\n\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\ndh /etc/openvpn/easy-rsa/pki/dh.pem\n\ntopology subnet\n\n# DIRECCIONAMIENTO PARA EL T\u00daNEL\n#\n# El servidor ser\u00e1: 10.99.99.1\n# El resto de IPs estar\u00e1n disponibles para los clientes\nserver 10.99.99.0 255.255.255.0\nifconfig-pool-persist /var/log/openvpn/ipp.txt\n\npush \"route 192.168.0.0 255.255.255.0\"\n\nkeepalive 10 120\ncipher AES-256-CBC\npersist-key\npersist-tun\nstatus /var/log/openvpn/openvpn-status.log\nverb 3\nexplicit-exit-notify 1\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#iniciar-el-servidor","title":"Iniciar el servidor","text":"<pre><code>sudo systemctl enable --now openvpn-server@servidor\n</code></pre> <p>Verifico que est\u00e1 funcionando: <pre><code>sudo systemctl status openvpn-server@servidor\n</code></pre> <pre><code>\u25cf openvpn-server@servidor.service - OpenVPN service for servidor\n     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; vendor preset: enabled)\n     Active: active (running) since Tue 2021-12-14 09:16:30 UTC; 35s ago\n       Docs: man:openvpn(8)\n             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage\n             https://community.openvpn.net/openvpn/wiki/HOWTO\n   Main PID: 2800 (openvpn)\n     Status: \"Initialization Sequence Completed\"\n      Tasks: 1 (limit: 528)\n     Memory: 1.0M\n        CPU: 9ms\n     CGroup: /system.slice/system-openvpn\\x2dserver.slice/openvpn-server@servidor.service\n             \u2514\u25002800 /usr/sbin/openvpn --status /run/openvpn-server/status-servidor.log --status-version 2 --suppress-timestamps --config servidor.conf\n\nDec 14 09:16:30 servervpn openvpn[2800]: net_iface_up: set tun0 up\nDec 14 09:16:30 servervpn openvpn[2800]: net_addr_v4_add: 10.99.99.1/24 dev tun0\nDec 14 09:16:30 servervpn openvpn[2800]: Could not determine IPv4/IPv6 protocol. Using AF_INET\nDec 14 09:16:30 servervpn openvpn[2800]: Socket Buffers: R=[212992-&gt;212992] S=[212992-&gt;212992]\nDec 14 09:16:30 servervpn openvpn[2800]: UDPv4 link local (bound): [AF_INET][undef]:1194\nDec 14 09:16:30 servervpn openvpn[2800]: UDPv4 link remote: [AF_UNSPEC]\nDec 14 09:16:30 servervpn openvpn[2800]: MULTI: multi_init called, r=256 v=256\nDec 14 09:16:30 servervpn openvpn[2800]: IFCONFIG POOL IPv4: base=10.99.99.2 size=252\nDec 14 09:16:30 servervpn openvpn[2800]: IFCONFIG POOL LIST\nDec 14 09:16:30 servervpn openvpn[2800]: Initialization Sequence Completed\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-clientevpn","title":"En clientevpn","text":""},{"location":"sad/practica-vpn-sad/#instalar-openvpn_1","title":"Instalar OpenVPN","text":"<pre><code>sudo apt update\nsudo apt install openvpn\n</code></pre>"},{"location":"sad/practica-vpn-sad/#mover-ficheros-a-la-ruta-adecuada","title":"Mover ficheros a la ruta adecuada","text":"<pre><code>sudo mv ~/{ca.crt,clientevpn.crt,clientevpn.key} /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n</code></pre> <p><code>/etc/openvpn/client</code> queda as\u00ed: <pre><code>vagrant@clientevpn:/etc/openvpn/client$ ls -la\ntotal 24\ndrwxr-xr-x 2 root root 4096 Dec 14 09:31 .\ndrwxr-xr-x 4 root root 4096 Dec 14 09:30 ..\n-rw------- 1 root root 1200 Dec 14 09:01 ca.crt\n-rw------- 1 root root 4498 Dec 14 09:01 clientevpn.crt\n-rw------- 1 root root 1704 Dec 14 09:01 clientevpn.key\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#configurar-el-cliente-vpn","title":"Configurar el cliente VPN","text":"<p>Copio la plantilla oficial de configuraci\u00f3n para clientes openvpn, para partir de ella: <pre><code>sudo cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf /etc/openvpn/client/cliente.conf\n</code></pre></p> <p>Modifico <code>/etc/openvpn/client/cliente.conf</code>: <pre><code>client\ndev tun\nproto udp\n\nremote 192.88.99.10 1194\nresolv-retry infinite\nnobind\n\npersist-key\npersist-tun\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\nremote-cert-tls server\ncipher AES-256-CBC\nverb 3\n</code></pre></p> <p>Habilito el servicio: <pre><code>sudo systemctl enable --now openvpn-client@cliente\n</code></pre></p> <p>Verifico que funciona: <pre><code>sudo systemctl status openvpn-client@cliente\n</code></pre> <pre><code>\u25cf openvpn-client@cliente.service - OpenVPN tunnel for cliente\n     Loaded: loaded (/lib/systemd/system/openvpn-client@.service; enabled; vendor preset: enabled)\n     Active: active (running) since Tue 2021-12-14 09:43:44 UTC; 5s ago\n       Docs: man:openvpn(8)\n             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage\n             https://community.openvpn.net/openvpn/wiki/HOWTO\n   Main PID: 12859 (openvpn)\n     Status: \"Initialization Sequence Completed\"\n      Tasks: 1 (limit: 528)\n     Memory: 1.9M\n        CPU: 17ms\n     CGroup: /system.slice/system-openvpn\\x2dclient.slice/openvpn-client@cliente.service\n             \u2514\u250012859 /usr/sbin/openvpn --suppress-timestamps --nobind --config cliente.conf\n\nDec 14 09:43:44 clientevpn openvpn[12859]: net_route_v4_best_gw query: dst 0.0.0.0\nDec 14 09:43:44 clientevpn openvpn[12859]: net_route_v4_best_gw result: via 192.168.121.1 dev eth0\nDec 14 09:43:44 clientevpn openvpn[12859]: ROUTE_GATEWAY 192.168.121.1/255.255.255.0 IFACE=eth0 HWADD&gt;\nDec 14 09:43:44 clientevpn openvpn[12859]: TUN/TAP device tun0 opened\nDec 14 09:43:44 clientevpn openvpn[12859]: net_iface_mtu_set: mtu 1500 for tun0\nDec 14 09:43:44 clientevpn openvpn[12859]: net_iface_up: set tun0 up\nDec 14 09:43:44 clientevpn openvpn[12859]: net_addr_v4_add: 10.99.99.2/24 dev tun0\nDec 14 09:43:44 clientevpn openvpn[12859]: net_route_v4_add: 192.168.0.0/24 via 10.99.99.1 dev [NULL]&gt;\nDec 14 09:43:44 clientevpn openvpn[12859]: WARNING: this configuration may cache passwords in memory &gt;\nDec 14 09:43:44 clientevpn openvpn[12859]: Initialization Sequence Completed\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-clientenormal","title":"En clientenormal","text":""},{"location":"sad/practica-vpn-sad/#cambiar-ruta-por-defecto","title":"Cambiar ruta por defecto","text":"<pre><code>sudo ip route del default\nsudo ip route add default via 192.168.0.1\n</code></pre>"},{"location":"sad/practica-vpn-sad/#pruebas-de-funcionamiento","title":"Pruebas de funcionamiento","text":"<p>(todas estar\u00e1n hechas desde clientevpn)</p> <p>Ping al otro extremo del t\u00fanel (servervpn): <pre><code>vagrant@clientevpn:/etc/openvpn/client$ ping 10.99.99.1\nPING 10.99.99.1 (10.99.99.1) 56(84) bytes of data.\n64 bytes from 10.99.99.1: icmp_seq=1 ttl=64 time=0.412 ms\n64 bytes from 10.99.99.1: icmp_seq=2 ttl=64 time=0.696 ms\n64 bytes from 10.99.99.1: icmp_seq=3 ttl=64 time=0.455 ms\n^C\n--- 10.99.99.1 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2048ms\nrtt min/avg/max/mdev = 0.412/0.521/0.696/0.124 ms\n</code></pre></p> <p>Ping a clientenormal: <pre><code>vagrant@clientevpn:/etc/openvpn/client$ ping 192.168.0.5\nPING 192.168.0.5 (192.168.0.5) 56(84) bytes of data.\n64 bytes from 192.168.0.5: icmp_seq=1 ttl=63 time=0.849 ms\n64 bytes from 192.168.0.5: icmp_seq=2 ttl=63 time=0.839 ms\n^C\n--- 192.168.0.5 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 0.839/0.844/0.849/0.005 ms\n</code></pre></p> <p>Traceroute a clientenormal (para que se vea claro la utilizaci\u00f3n del t\u00fanel VPN): <pre><code>vagrant@clientevpn:/etc/openvpn/client$ traceroute 192.168.0.5\ntraceroute to 192.168.0.5 (192.168.0.5), 30 hops max, 60 byte packets\n 1  10.99.99.1 (10.99.99.1)  0.446 ms  0.364 ms  0.331 ms\n 2  192.168.0.5 (192.168.0.5)  0.553 ms  0.612 ms  0.581 ms\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#parte-2-sitio-a-sitio-openvpn","title":"Parte 2: sitio a sitio OpenVPN","text":""},{"location":"sad/practica-vpn-sad/#escenario_1","title":"Escenario","text":"<p><code>Vagrantfile</code>: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.provider :libvirt do |libvirt|\n    libvirt.cpus = 1\n    libvirt.memory = 512\n  end\n\n  config.vm.define :clientenormal1 do |clientenormal1|\n    clientenormal1.vm.box = \"debian/bullseye64\"\n    clientenormal1.vm.hostname = \"clientenormal1\"\n    clientenormal1.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada1-vpn2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :clientevpn do |clientevpn|\n    clientevpn.vm.box = \"debian/bullseye64\"\n    clientevpn.vm.hostname = \"clientevpn\"\n    clientevpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada1-vpn2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    clientevpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"internet-vpn2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.11\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :servervpn do |servervpn|\n    servervpn.vm.box = \"debian/bullseye64\"\n    servervpn.vm.hostname = \"servervpn\"\n    servervpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"internet-vpn2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.10\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    servervpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada2-vpn2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.1.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :clientenormal2 do |clientenormal2|\n    clientenormal2.vm.box = \"debian/bullseye64\"\n    clientenormal2.vm.hostname = \"clientenormal2\"\n    clientenormal2.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada2-vpn2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.1.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-servervpn_1","title":"En servervpn","text":""},{"location":"sad/practica-vpn-sad/#instalar-openvpn_2","title":"Instalar OpenVPN","text":"<pre><code>sudo apt update\nsudo apt install openvpn\n</code></pre>"},{"location":"sad/practica-vpn-sad/#habilitar-forwarding_1","title":"Habilitar forwarding","text":"<pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n</code></pre>"},{"location":"sad/practica-vpn-sad/#crear-pki","title":"Crear PKI","text":"<p><pre><code>sudo cp -r /usr/share/easy-rsa /etc/openvpn\ncd /etc/openvpn/easy-rsa\nsudo ./easyrsa init-pki\n</code></pre> <pre><code>init-pki complete; you may now create a CA or requests.\nYour newly created PKI dir is: /etc/openvpn/easy-rsa/pki\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#generar-certificado-clave-privada-de-la-ca_1","title":"Generar certificado + clave privada de la CA","text":"<p><pre><code>sudo ./easyrsa build-ca\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\n\nEnter New CA Key Passphrase:\nRe-Enter New CA Key Passphrase:\nGenerating RSA private key, 2048 bit long modulus (2 primes)\n..................+++++\n..................................+++++\ne is 65537 (0x010001)\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [Easy-RSA CA]:Adrianj CA\n\nCA creation complete and you may now import and sign cert requests.\nYour new CA certificate file for publishing is at:\n/etc/openvpn/easy-rsa/pki/ca.crt\n</code></pre> Passphrase: 1234</p>"},{"location":"sad/practica-vpn-sad/#generar-certificado-clave-privada-del-servidor-vpn_1","title":"Generar certificado + clave privada del servidor VPN","text":"<p><pre><code>sudo ./easyrsa build-server-full server nopass\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\nGenerating a RSA private key\n..............................................................+++++\n........................................................................................................................+++++\nwriting new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-2046.nRVdyM/tmp.6vm2xf'\n-----\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-2046.nRVdyM/tmp.3Nm9uS\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'server'\nCertificate is to be certified until Apr  3 09:13:11 2024 GMT (825 days)\n\nWrite out database with 1 new entries\nData Base Updated\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#generar-parametros-diffiehellman_1","title":"Generar par\u00e1metros Diffie\u2013Hellman","text":"<p><pre><code>sudo ./easyrsa gen-dh\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\nGenerating DH parameters, 2048 bit long safe prime, generator 2\nThis is going to take a long time\n...................................+....................+..........................+....................................................................................................................................................................................................................+.....................+.....................................................................................................................................................................................................................................+...........+.................................................................................................................................+.................................................+....................................................+.........................................................................................................................................................................................................................+.............................+.............................................+..................................................................................................................................................................+............................................................................................................................................................................................................................................................................+..............................................................................................................................+.........................................................................................................+.......................................................................+................................................................................................................................................................+.......................................................................................................................................................+........................................................................................................................................................................................+...................................................................................+............................................................................+....................................+...............................................................+...............................................................................................................+.....................................................................................................................................................................................................................................+.....................+...................................+..................................................................................................+.............................................................................................+.......................................................................+..................................+......................................................................................................................................+....................................................+........................................................................................................................................................................................................................................................+........................................................................................................................................+...................................................................................................................................+....................................+....................+.....................................................................................................+..+...............................+..................................+...........................+.....................................................................................................................+...............................................................................................................................................................................................+................+...+.........................................................+..+.........+....+...+................................................................................................+...............................................................................................................................................................................................................................................................................................................................................+..................................................................+...............................................................................................................................+.....................................................................................................+............+...................................+.............................................................................................................................................+...............................................................................................+.........+.................+...........................................................................................................................................+....+........................................................................................+................+........+................................................................................................................................................................................................................................................+.......................................................................................................+.............................................................................................................................................................................................................................................+................................................................+...........................................................................................................................................................................+..................+..................................+...................................................................................................................................................................................................................................+....................................................................................................+.......................................................................................................................................................................................+..................................++*++*++*++*\n\nDH parameters of size 2048 created at /etc/openvpn/easy-rsa/pki/dh.pem\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#generar-certificado-clave-privada-del-cliente-vpn_1","title":"Generar certificado + clave privada del cliente VPN","text":"<p><pre><code>sudo ./easyrsa build-client-full clientevpn nopass\n</code></pre> <pre><code>Using SSL: openssl OpenSSL 1.1.1k  25 Mar 2021\nGenerating a RSA private key\n.......................................................................+++++\n................................+++++\nwriting new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-2162.MUtxW0/tmp.cwHjMI'\n-----\nUsing configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-2162.MUtxW0/tmp.tJCZID\nEnter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'clientevpn'\nCertificate is to be certified until Apr  3 09:28:02 2024 GMT (825 days)\n\nWrite out database with 1 new entries\nData Base Updated\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#pasar-ficheros-necesarios-al-cliente-vpn_1","title":"Pasar ficheros necesarios al cliente VPN","text":"<pre><code>sudo cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/clientevpn.crt,private/clientevpn.key} ~\nsudo chown vagrant: ~/{ca.crt,clientevpn.crt,clientevpn.key}\nscp ~/{ca.crt,clientevpn.crt,clientevpn.key} vagrant@192.88.99.11:/home/vagrant\n</code></pre>"},{"location":"sad/practica-vpn-sad/#configurar-el-servidor-vpn_1","title":"Configurar el servidor VPN","text":"<p>Creo el <code>client-config-dir</code> junto con un fichero con informaci\u00f3n sobre <code>clientevpn</code>: <pre><code>cd /etc/openvpn\nsudo mkdir ccd\ncd ccd\nsudo touch clientevpn\necho iroute 192.168.0.0 255.255.255.0 &gt; /etc/openvpn/ccd/clientevpn\n</code></pre></p> <p>Creo el fichero de configuraci\u00f3n partiendo de una plantilla: <pre><code>sudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/servidor.conf\n</code></pre></p> <p>Modifico <code>/etc/openvpn/server/servidor.conf</code>: <pre><code>port 1194\nproto udp\ndev tun\n\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\ndh /etc/openvpn/easy-rsa/pki/dh.pem\n\ntopology subnet\n\nserver 10.99.99.0 255.255.255.0\nifconfig-pool-persist /var/log/openvpn/ipp.txt\n\npush \"route 192.168.1.0 255.255.255.0\"\n\nclient-config-dir /etc/openvpn/ccd\nroute 192.168.0.0 255.255.255.0\n\nkeepalive 10 120\ncipher AES-256-CBC\npersist-key\npersist-tun\nstatus /var/log/openvpn/openvpn-status.log\nverb 3\nexplicit-exit-notify 1\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#iniciar-el-servidor_1","title":"Iniciar el servidor","text":"<pre><code>sudo systemctl enable --now openvpn-server@servidor\n</code></pre> <p>Verifico que est\u00e1 funcionando: <pre><code>sudo systemctl status openvpn-server@servidor\n</code></pre> <pre><code>\u25cf openvpn-server@servidor.service - OpenVPN service for servidor\n     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; vendor preset: enabled)\n     Active: active (running) since Thu 2021-12-30 09:47:53 UTC; 12s ago\n       Docs: man:openvpn(8)\n             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage\n             https://community.openvpn.net/openvpn/wiki/HOWTO\n   Main PID: 2291 (openvpn)\n     Status: \"Initialization Sequence Completed\"\n      Tasks: 1 (limit: 528)\n     Memory: 1020.0K\n        CPU: 7ms\n     CGroup: /system.slice/system-openvpn\\x2dserver.slice/openvpn-server@servidor.service\n             \u2514\u25002291 /usr/sbin/openvpn --status /run/openvpn-server/status-servidor.log --status-vers&gt;\n\nDec 30 09:47:53 servervpn openvpn[2291]: net_addr_v4_add: 10.99.99.1/24 dev tun0\nDec 30 09:47:53 servervpn openvpn[2291]: net_route_v4_add: 192.168.0.0/24 via 10.99.99.2 dev [NULL] &gt;\nDec 30 09:47:53 servervpn openvpn[2291]: Could not determine IPv4/IPv6 protocol. Using AF_INET\nDec 30 09:47:53 servervpn openvpn[2291]: Socket Buffers: R=[212992-&gt;212992] S=[212992-&gt;212992]\nDec 30 09:47:53 servervpn openvpn[2291]: UDPv4 link local (bound): [AF_INET][undef]:1194\nDec 30 09:47:53 servervpn openvpn[2291]: UDPv4 link remote: [AF_UNSPEC]\nDec 30 09:47:53 servervpn openvpn[2291]: MULTI: multi_init called, r=256 v=256\nDec 30 09:47:53 servervpn openvpn[2291]: IFCONFIG POOL IPv4: base=10.99.99.2 size=252\nDec 30 09:47:53 servervpn openvpn[2291]: IFCONFIG POOL LIST\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-clientevpn_1","title":"En clientevpn","text":""},{"location":"sad/practica-vpn-sad/#instalar-openvpn_3","title":"Instalar OpenVPN","text":"<pre><code>sudo apt update\nsudo apt install openvpn\n</code></pre>"},{"location":"sad/practica-vpn-sad/#habilitar-forwarding_2","title":"Habilitar forwarding","text":"<pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n</code></pre>"},{"location":"sad/practica-vpn-sad/#mover-ficheros-a-la-ruta-adecuada_1","title":"Mover ficheros a la ruta adecuada","text":"<pre><code>sudo mv ~/{ca.crt,clientevpn.crt,clientevpn.key} /etc/openvpn/client\nsudo chown root: /etc/openvpn/client/*\n</code></pre>"},{"location":"sad/practica-vpn-sad/#configurar-el-cliente-vpn_1","title":"Configurar el cliente VPN","text":"<p>Copio la plantilla oficial de configuraci\u00f3n para clientes openvpn, para partir de ella: <pre><code>sudo cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf /etc/openvpn/client/cliente.conf\n</code></pre></p> <p>Modifico <code>/etc/openvpn/client/cliente.conf</code>: <pre><code>client\ndev tun\nproto udp\n\nremote 192.88.99.10 1194\nresolv-retry infinite\nnobind\n\npersist-key\npersist-tun\n\nca /etc/openvpn/client/ca.crt\ncert /etc/openvpn/client/clientevpn.crt\nkey /etc/openvpn/client/clientevpn.key\n\nremote-cert-tls server\ncipher AES-256-CBC\nverb 3\n</code></pre></p> <p>Habilito el servicio: <pre><code>sudo systemctl enable --now openvpn-client@cliente\n</code></pre></p> <p>Verifico que funciona: <pre><code>sudo systemctl status openvpn-client@cliente\n</code></pre> <pre><code>\u25cf openvpn-client@cliente.service - OpenVPN tunnel for cliente\n     Loaded: loaded (/lib/systemd/system/openvpn-client@.service; enabled; vendor preset: enabled)\n     Active: active (running) since Thu 2021-12-30 10:20:45 UTC; 39s ago\n       Docs: man:openvpn(8)\n             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage\n             https://community.openvpn.net/openvpn/wiki/HOWTO\n   Main PID: 10909 (openvpn)\n     Status: \"Initialization Sequence Completed\"\n      Tasks: 1 (limit: 528)\n     Memory: 1.4M\n        CPU: 11ms\n     CGroup: /system.slice/system-openvpn\\x2dclient.slice/openvpn-client@cliente.service\n             \u2514\u250010909 /usr/sbin/openvpn --suppress-timestamps --nobind --config cliente.conf\n\nDec 30 10:20:45 clientevpn openvpn[10909]: net_route_v4_best_gw query: dst 0.0.0.0\nDec 30 10:20:45 clientevpn openvpn[10909]: net_route_v4_best_gw result: via 192.168.121.1 dev eth0\nDec 30 10:20:45 clientevpn openvpn[10909]: ROUTE_GATEWAY 192.168.121.1/255.255.255.0 IFACE=eth0 HWADDR=52:54:00:&gt;\nDec 30 10:20:45 clientevpn openvpn[10909]: TUN/TAP device tun0 opened\nDec 30 10:20:45 clientevpn openvpn[10909]: net_iface_mtu_set: mtu 1500 for tun0\nDec 30 10:20:45 clientevpn openvpn[10909]: net_iface_up: set tun0 up\nDec 30 10:20:45 clientevpn openvpn[10909]: net_addr_v4_add: 10.99.99.2/24 dev tun0\nDec 30 10:20:45 clientevpn openvpn[10909]: net_route_v4_add: 192.168.1.0/24 via 10.99.99.1 dev [NULL] table 0 me&gt;\nDec 30 10:20:45 clientevpn openvpn[10909]: WARNING: this configuration may cache passwords in memory -- use the &gt;\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-clientenormal1","title":"En clientenormal1","text":""},{"location":"sad/practica-vpn-sad/#cambiar-ruta-por-defecto_1","title":"Cambiar ruta por defecto","text":"<pre><code>sudo ip route del default\nsudo ip route add default via 192.168.0.1\n</code></pre>"},{"location":"sad/practica-vpn-sad/#en-clientenormal2","title":"En clientenormal2","text":""},{"location":"sad/practica-vpn-sad/#cambiar-ruta-por-defecto_2","title":"Cambiar ruta por defecto","text":"<pre><code>sudo ip route del default\nsudo ip route add default via 192.168.1.1\n</code></pre>"},{"location":"sad/practica-vpn-sad/#pruebas-de-funcionamiento_1","title":"Pruebas de funcionamiento","text":"<p>Ping desde <code>clientenormal1</code> a <code>clientenormal2</code>: <pre><code>vagrant@clientenormal1:~$ ping 192.168.1.2\nPING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.\n64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=4.45 ms\n64 bytes from 192.168.1.2: icmp_seq=2 ttl=62 time=2.30 ms\n^C\n--- 192.168.1.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 2.301/3.376/4.451/1.075 ms\n</code></pre></p> <p>Ping desde <code>clientenormal2</code> a <code>clientenormal1</code>: <pre><code>vagrant@clientenormal2:~$ ping 192.168.0.2\nPING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.\n64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=2.26 ms\n64 bytes from 192.168.0.2: icmp_seq=2 ttl=62 time=2.24 ms\n64 bytes from 192.168.0.2: icmp_seq=3 ttl=62 time=2.19 ms\n^C\n--- 192.168.0.2 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 2.188/2.229/2.264/0.031 ms\n</code></pre></p> <p>Traceroute desde <code>clientenormal1</code> a <code>clientenormal2</code>: <pre><code>vagrant@clientenormal1:~$ traceroute 192.168.1.2\ntraceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets\n 1  192.168.0.1 (192.168.0.1)  0.521 ms  0.438 ms  0.433 ms\n 2  10.99.99.1 (10.99.99.1)  2.229 ms  2.196 ms  2.177 ms\n 3  192.168.1.2 (192.168.1.2)  2.129 ms  2.082 ms  2.035 ms\n</code></pre></p> <p>Traceroute desde <code>clientenormal2</code> a <code>clientenormal1</code>: <pre><code>vagrant@clientenormal2:~$ traceroute 192.168.0.2\ntraceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets\n 1  192.168.1.1 (192.168.1.1)  0.613 ms  0.538 ms  0.507 ms\n 2  10.99.99.2 (10.99.99.2)  2.864 ms  2.828 ms  2.812 ms\n 3  192.168.0.2 (192.168.0.2)  2.824 ms  2.778 ms  3.276 ms\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#parte-3-acceso-remoto-wireguard","title":"Parte 3: acceso remoto WireGuard","text":""},{"location":"sad/practica-vpn-sad/#escenario_2","title":"Escenario","text":"<p><code>Vagrantfile</code>: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.provider :libvirt do |libvirt|\n    libvirt.cpus = 1\n    libvirt.memory = 512\n  end\n\n  config.vm.define :clientevpn do |clientevpn|\n    clientevpn.vm.box = \"debian/bullseye64\"\n    clientevpn.vm.hostname = \"clientevpn\"\n    clientevpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"internet-vpn3\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.11\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :servervpn do |servervpn|\n    servervpn.vm.box = \"debian/bullseye64\"\n    servervpn.vm.hostname = \"servervpn\"\n    servervpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"internet-vpn3\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.10\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    servervpn.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada-vpn3\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :clientenormal do |clientenormal|\n    clientenormal.vm.box = \"debian/bullseye64\"\n    clientenormal.vm.hostname = \"clientenormal\"\n    clientenormal.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada-vpn3\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-servervpn_2","title":"En servervpn","text":""},{"location":"sad/practica-vpn-sad/#instalar-wireguard","title":"Instalar WireGuard","text":"<pre><code>sudo apt update\nsudo apt install wireguard\n</code></pre>"},{"location":"sad/practica-vpn-sad/#generar-par-de-claves","title":"Generar par de claves","text":"<pre><code>wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key\n</code></pre>"},{"location":"sad/practica-vpn-sad/#configurar","title":"Configurar","text":"<p>Creo el fichero de configuraci\u00f3n (wg0 ser\u00e1 el nombre de la interfaz): <pre><code>sudo touch /etc/wireguard/wg0.conf\n</code></pre></p> <p>Lo modifico: <pre><code>[Interface]\nAddress = 10.99.99.1/24\nListenPort = 51820\nPrivateKey = wPO8E5rUB9hFCwJMQYsLwDtNV7eX9SZmL9h/VO+NwFY=\n\n# IP forwarding\nPreUp = sysctl -w net.ipv4.ip_forward=1\n\n[Peer]\nPublicKey = GLJ8rEoPu22e+t2xPP54TJoGCoq09+HiOuiwBV3TzSw=\nAllowedIPs = 10.99.99.2/32\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#modificar-permisos","title":"Modificar permisos","text":"<pre><code>sudo chmod 600 /etc/wireguard/ -R\n</code></pre>"},{"location":"sad/practica-vpn-sad/#iniciar-wireguard","title":"Iniciar WireGuard","text":"<p><pre><code>sudo wg-quick up /etc/wireguard/wg0.conf\n</code></pre> <pre><code>[#] sysctl -w net.ipv4.ip_forward=1\nnet.ipv4.ip_forward = 1\n[#] ip link add wg0 type wireguard\n[#] wg setconf wg0 /dev/fd/63\n[#] ip -4 address add 10.99.99.1/24 dev wg0\n[#] ip link set mtu 1420 up dev wg0\n</code></pre></p> <p>Se nos crea la interfaz: <pre><code>5: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/none\n    inet 10.99.99.1/24 scope global wg0\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>Y la ruta: <pre><code>10.99.99.0/24 dev wg0 proto kernel scope link src 10.99.99.1\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-clientevpn-debian-11","title":"En clientevpn (debian 11)","text":""},{"location":"sad/practica-vpn-sad/#instalar-wireguard_1","title":"Instalar WireGuard","text":"<pre><code>sudo apt update\nsudo apt install wireguard\n</code></pre>"},{"location":"sad/practica-vpn-sad/#generar-par-de-claves_1","title":"Generar par de claves","text":"<pre><code>wg genkey | sudo tee /etc/wireguard/client_private.key | wg pubkey | sudo tee /etc/wireguard/client_public.key\n</code></pre>"},{"location":"sad/practica-vpn-sad/#configurar_1","title":"Configurar","text":"<p>Creo el fichero de configuraci\u00f3n (wg-client0 ser\u00e1 el nombre de la interfaz): <pre><code>sudo touch /etc/wireguard/wg-client0.conf\n</code></pre></p> <p>Lo modifico: <pre><code>[Interface]\nAddress = 10.99.99.2/24\nPrivateKey = iO5lDgbhB6cGsJL6Udw0SP+9x4N0FHrRj2irMiNM93Y=\n\n[Peer]\nPublicKey = K7noXpmRF60rW7BjqGTHTF8PaOVLASb1UJJF62YsFw8=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 192.88.99.10:51820\nPersistentKeepalive = 25\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#modificar-permisos_1","title":"Modificar permisos","text":"<pre><code>sudo chmod 600 /etc/wireguard/ -R\n</code></pre>"},{"location":"sad/practica-vpn-sad/#iniciar-wireguard_1","title":"Iniciar WireGuard","text":"<p><pre><code>sudo wg-quick up /etc/wireguard/wg-client0.conf\n</code></pre> <pre><code>[#] ip link add wg-client0 type wireguard\n[#] wg setconf wg-client0 /dev/fd/63\n[#] ip -4 address add 10.99.99.2/24 dev wg-client0\n[#] ip link set mtu 1420 up dev wg-client0\n[#] wg set wg-client0 fwmark 51820\n[#] ip -4 route add 0.0.0.0/0 dev wg-client0 table 51820\n[#] ip -4 rule add not fwmark 51820 table 51820\n[#] ip -4 rule add table main suppress_prefixlength 0\n[#] sysctl -q net.ipv4.conf.all.src_valid_mark=1\n[#] nft -f /dev/fd/63\n</code></pre></p> <p>Se nos crea la interfaz: <pre><code>4: wg-client0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/none\n    inet 10.99.99.2/24 scope global wg-client0\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>Y la ruta: <pre><code>10.99.99.0/24 dev wg-client0 proto kernel scope link src 10.99.99.2\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-clientenormal_1","title":"En clientenormal","text":""},{"location":"sad/practica-vpn-sad/#cambiar-ruta-por-defecto_3","title":"Cambiar ruta por defecto","text":"<pre><code>sudo ip route del default\nsudo ip route add default via 192.168.0.1\n</code></pre>"},{"location":"sad/practica-vpn-sad/#pruebas-de-funcionamiento_2","title":"Pruebas de funcionamiento","text":"<p>(todas hechas desde clientevpn)</p> <p>Ping al otro extremo del t\u00fanel: <pre><code>vagrant@clientevpn:~$ ping 10.99.99.1\nPING 10.99.99.1 (10.99.99.1) 56(84) bytes of data.\n64 bytes from 10.99.99.1: icmp_seq=1 ttl=64 time=2.43 ms\n64 bytes from 10.99.99.1: icmp_seq=2 ttl=64 time=0.232 ms\n^C\n--- 10.99.99.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 0.232/1.328/2.425/1.096 ms\n</code></pre></p> <p>Ping a clientenormal: <pre><code>vagrant@clientevpn:~$ ping 192.168.0.2\nPING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.\n64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=1.56 ms\n64 bytes from 192.168.0.2: icmp_seq=2 ttl=63 time=0.360 ms\n^C\n--- 192.168.0.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 0.360/0.959/1.559/0.599 ms\n</code></pre></p> <p>Traceroute a clientenormal: <pre><code>vagrant@clientevpn:~$ traceroute 192.168.0.2\ntraceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets\n 1  10.99.99.1 (10.99.99.1)  0.734 ms  0.275 ms  0.242 ms\n 2  192.168.0.2 (192.168.0.2)  0.712 ms  0.664 ms  0.617 ms\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#extra-cliente-vpn-windows","title":"Extra: cliente VPN Windows","text":""},{"location":"sad/practica-vpn-sad/#conectar-cliente","title":"Conectar cliente","text":"<p>Conecto la VM a la red <code>internet-vpn3</code>:</p> <p></p> <p>Configuro est\u00e1ticamente la interfaz:</p> <pre><code>netsh interface ip set address name=\"Ethernet\" static 192.88.99.12 255.255.255.0 192.88.99.10\n</code></pre> <p>Compruebo que la configuraci\u00f3n se aplic\u00f3 correctamente:</p> <p></p> <p>Compruebo que tengo conectividad con servervpn:</p> <p></p>"},{"location":"sad/practica-vpn-sad/#configurar-cliente","title":"Configurar cliente","text":"<p>Descargo e instalo Wireguard:</p> <p></p> <p>Compruebo que funciona el programa:</p> <p></p> <p>Creo un nuevo t\u00fanel en blanco:</p> <p></p> <p>Como nos podemos dar cuenta, la generaci\u00f3n de claves ha sido autom\u00e1tica:</p> <p></p> <p>Completo la configuraci\u00f3n y nombro el t\u00fanel:</p> <p></p> <p>Verifico que se ha creado correctamente:</p> <p></p> <p>Nos damos cuenta de que est\u00e1 inactivo (por ahora).</p>"},{"location":"sad/practica-vpn-sad/#modificar-el-servidor","title":"Modificar el servidor","text":"<p>Tengo que a\u00f1adir el nuevo peer a <code>wg0.conf</code>. El fichero se quedar\u00eda as\u00ed: <pre><code>[Interface]\nAddress = 10.99.99.1/24\nListenPort = 51820\nPrivateKey = wPO8E5rUB9hFCwJMQYsLwDtNV7eX9SZmL9h/VO+NwFY=\n\n# IP forwarding\nPreUp = sysctl -w net.ipv4.ip_forward=1\n\n[Peer]\nPublicKey = GLJ8rEoPu22e+t2xPP54TJoGCoq09+HiOuiwBV3TzSw=\nAllowedIPs = 10.99.99.2/32\n\n[Peer]\nPublicKey = 3CNoT/Zae2eXK+yW0wm13qFWOEOwUcfCQrcIGttUPyk=\nAllowedIPs = 10.99.99.3/32\n</code></pre></p> <p>Reinicio el servidor para que los cambios tomen efecto: <pre><code>sudo wg-quick down /etc/wireguard/wg0.conf\nsudo wg-quick up /etc/wireguard/wg0.conf\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#activar-cliente","title":"Activar cliente","text":"<p>Vemos que se nos crea la interfaz de t\u00fanel:</p> <p></p>"},{"location":"sad/practica-vpn-sad/#pruebas-de-funcionamiento_3","title":"Pruebas de funcionamiento","text":"<p>Ping al otro extremo del t\u00fanel:</p> <p></p> <p>Ping a clientenormal:</p> <p></p> <p>Tracert a clientenormal:</p> <p></p>"},{"location":"sad/practica-vpn-sad/#extra-cliente-vpn-android","title":"Extra: cliente VPN Android","text":""},{"location":"sad/practica-vpn-sad/#conectar-cliente_1","title":"Conectar cliente","text":"<p>Conecto la VM a la red <code>internet-vpn3</code>:</p> <p></p> <p>Configuro est\u00e1ticamente la interfaz:</p> <pre><code>ifconfig wlan0 192.88.99.13 netmask 255.255.255.0 up\n</code></pre> <p>Compruebo que la configuraci\u00f3n se aplic\u00f3 correctamente:</p> <p></p> <p>Compruebo que tengo conectividad con servervpn:</p> <p></p>"},{"location":"sad/practica-vpn-sad/#configurar-cliente_1","title":"Configurar cliente","text":"<p>Instalo Wireguard:</p> <p></p> <p>Compruebo que funciona el programa:</p> <p></p> <p>Creo un nuevo t\u00fanel en blanco:</p> <p></p> <p>Genero un par de claves:</p> <p></p> <p>Completo la configuraci\u00f3n:</p> <p></p> <p></p> <p>Verifico que se ha creado correctamente el t\u00fanel:</p> <p></p> <p>Est\u00e1 inactivo (por ahora).</p>"},{"location":"sad/practica-vpn-sad/#modificar-el-servidor_1","title":"Modificar el servidor","text":"<p>Tengo que a\u00f1adir el nuevo peer a <code>wg0.conf</code>. El fichero se quedar\u00eda as\u00ed: <pre><code>[Interface]\nAddress = 10.99.99.1/24\nListenPort = 51820\nPrivateKey = wPO8E5rUB9hFCwJMQYsLwDtNV7eX9SZmL9h/VO+NwFY=\n\n# IP forwarding\nPreUp = sysctl -w net.ipv4.ip_forward=1\n\n[Peer]\nPublicKey = GLJ8rEoPu22e+t2xPP54TJoGCoq09+HiOuiwBV3TzSw=\nAllowedIPs = 10.99.99.2/32\n\n[Peer]\nPublicKey = 3CNoT/Zae2eXK+yW0wm13qFWOEOwUcfCQrcIGttUPyk=\nAllowedIPs = 10.99.99.3/32\n\n[Peer]\nPublicKey = DJusByULiqhbzBhSCDdVJZAjH6mNEUVE9qlyYc/CylM=\nAllowedIPs = 10.99.99.4/32\n</code></pre></p> <p>Reinicio el servidor para que los cambios tomen efecto: <pre><code>sudo wg-quick down /etc/wireguard/wg0.conf\nsudo wg-quick up /etc/wireguard/wg0.conf\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#activar-cliente_1","title":"Activar cliente","text":"<p>Vemos que se nos crea la interfaz de t\u00fanel:</p> <p></p>"},{"location":"sad/practica-vpn-sad/#pruebas-de-funcionamiento_4","title":"Pruebas de funcionamiento","text":"<p>Ping al otro extremo del t\u00fanel:</p> <p></p> <p>Ping a clientenormal:</p> <p></p> <p>Traceroute a clientenormal:</p> <p></p>"},{"location":"sad/practica-vpn-sad/#conclusiones","title":"Conclusiones","text":"<p>Aqu\u00ed expondr\u00e9 las conclusiones a las que he llegado tras comparar el acceso remoto de WireGuard con el de OpenVPN.</p> <ul> <li> <p>Con WireGuard no existe realmente el concepto de cliente-servidor, sino el de peer-to-peer. Aunque en la pr\u00e1ctica, se distingue f\u00e1cilmente cu\u00e1l es el \"servidor\" porque es en el que abrimos un puerto espec\u00edfico durante la configuraci\u00f3n.</p> </li> <li> <p>La autenticaci\u00f3n es mucho m\u00e1s sencilla con WireGuard, ya que se usa un par de claves y no certificados. Conceptualmente ambos mecanismos son casi iguales, pero en la pr\u00e1ctica es mucho m\u00e1s c\u00f3modo trabajar con un par de claves porque nos ahorramos el tener que crear una Autoridad Certificadora, el firmado de certificados...etc. Es muy parecido, por no decir casi igual, a como se trabaja con SSH.</p> </li> <li> <p>Los ficheros de configuraci\u00f3n son notoriamente m\u00e1s cortos y sencillos en WireGuard.</p> </li> <li> <p>WireGuard nos proporciona la herramienta <code>wg-quick</code> para controlar el servicio, lo cual es mucho m\u00e1s sencillo que trabajar con systemd.</p> </li> </ul>"},{"location":"sad/practica-vpn-sad/#parte-4-sitio-a-sitio-wireguard","title":"Parte 4: sitio a sitio WireGuard","text":""},{"location":"sad/practica-vpn-sad/#escenario_3","title":"Escenario","text":"<p><code>Vagrantfile</code>: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.provider :libvirt do |libvirt|\n    libvirt.cpus = 1\n    libvirt.memory = 512\n  end\n\n  config.vm.define :clientenormal1 do |clientenormal1|\n    clientenormal1.vm.box = \"debian/bullseye64\"\n    clientenormal1.vm.hostname = \"clientenormal1\"\n    clientenormal1.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada1-vpn4\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :peervpn1 do |peervpn1|\n    peervpn1.vm.box = \"debian/bullseye64\"\n    peervpn1.vm.hostname = \"peervpn1\"\n    peervpn1.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada1-vpn4\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    peervpn1.vm.network :private_network,\n      :libvirt__network_name =&gt; \"internet-vpn4\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.11\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :peervpn2 do |peervpn2|\n    peervpn2.vm.box = \"debian/bullseye64\"\n    peervpn2.vm.hostname = \"peervpn2\"\n    peervpn2.vm.network :private_network,\n      :libvirt__network_name =&gt; \"internet-vpn4\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.88.99.10\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    peervpn2.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada2-vpn4\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.1.1\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :clientenormal2 do |clientenormal2|\n    clientenormal2.vm.box = \"debian/bullseye64\"\n    clientenormal2.vm.hostname = \"clientenormal2\"\n    clientenormal2.vm.network :private_network,\n      :libvirt__network_name =&gt; \"privada2-vpn4\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.1.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-peervpn1","title":"En peervpn1","text":""},{"location":"sad/practica-vpn-sad/#instalar-wireguard_2","title":"Instalar WireGuard","text":"<pre><code>sudo apt update\nsudo apt install wireguard\n</code></pre>"},{"location":"sad/practica-vpn-sad/#generar-par-de-claves_2","title":"Generar par de claves","text":"<pre><code>wg genkey | sudo tee /etc/wireguard/peervpn1_private.key | wg pubkey | sudo tee /etc/wireguard/peervpn1_public.key\n</code></pre>"},{"location":"sad/practica-vpn-sad/#configurar_2","title":"Configurar","text":"<p>Creo el fichero de configuraci\u00f3n: <pre><code>sudo touch /etc/wireguard/wg0.conf\n</code></pre></p> <p>Lo modifico: <pre><code>[Interface]\nAddress = 10.99.99.1/32\nListenPort = 51820\nPrivateKey = 4FMOxWlQLSGHlfgjFKBkmPDeURsHh7RBeCAoYMd/vGw=\n\n# IP forwarding\nPreUp = sysctl -w net.ipv4.ip_forward=1\n\n[Peer]\nEndpoint = 192.88.99.10:51820\nAllowedIPs = 10.99.99.2/32, 192.168.1.0/24\nPublicKey = FMJMI1Cg7jOLPTZj49DP/KE7RVK9/J8X5l3KG4LVf2Q=\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#modificar-permisos_2","title":"Modificar permisos","text":"<pre><code>sudo chmod 600 /etc/wireguard/ -R\n</code></pre>"},{"location":"sad/practica-vpn-sad/#iniciar-wireguard_2","title":"Iniciar WireGuard","text":"<p><pre><code>sudo wg-quick up /etc/wireguard/wg0.conf\n</code></pre> <pre><code>[#] sysctl -w net.ipv4.ip_forward=1\nnet.ipv4.ip_forward = 1\n[#] ip link add wg0 type wireguard\n[#] wg setconf wg0 /dev/fd/63\n[#] ip -4 address add 10.99.99.1/32 dev wg0\n[#] ip link set mtu 1420 up dev wg0\n[#] ip -4 route add 10.99.99.2/32 dev wg0\n[#] ip -4 route add 192.168.1.0/24 dev wg0\n</code></pre></p> <p>Se crea la interfaz: <pre><code>7: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/none\n    inet 10.99.99.1/32 scope global wg0\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>Y las rutas: <pre><code>10.99.99.2 dev wg0 scope link\n192.168.1.0/24 dev wg0 scope link\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-peervpn2","title":"En peervpn2","text":""},{"location":"sad/practica-vpn-sad/#instalar-wireguard_3","title":"Instalar WireGuard","text":"<pre><code>sudo apt update\nsudo apt install wireguard\n</code></pre>"},{"location":"sad/practica-vpn-sad/#generar-par-de-claves_3","title":"Generar par de claves","text":"<pre><code>wg genkey | sudo tee /etc/wireguard/peervpn2_private.key | wg pubkey | sudo tee /etc/wireguard/peervpn2_public.key\n</code></pre>"},{"location":"sad/practica-vpn-sad/#configurar_3","title":"Configurar","text":"<p>Creo el fichero de configuraci\u00f3n: <pre><code>sudo touch /etc/wireguard/wg0.conf\n</code></pre></p> <p>Lo modifico: <pre><code>[Interface]\nAddress = 10.99.99.2/32\nListenPort = 51820\nPrivateKey = UP7xLuRK2JtsFxUwWqHxeREAwKPQPO9mvYfI+neNd3E=\n\n# IP forwarding\nPreUp = sysctl -w net.ipv4.ip_forward=1\n\n[Peer]\nEndpoint = 192.88.99.11:51820\nAllowedIPs = 10.99.99.1/32, 192.168.0.0/24\nPublicKey = nN/tik1TNOkFuupFVlNOaEO5hwQFKlsUWoKYsSCutzA=\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#modificar-permisos_3","title":"Modificar permisos","text":"<pre><code>sudo chmod 600 /etc/wireguard/ -R\n</code></pre>"},{"location":"sad/practica-vpn-sad/#iniciar-wireguard_3","title":"Iniciar WireGuard","text":"<p><pre><code>sudo wg-quick up /etc/wireguard/wg0.conf\n</code></pre> <pre><code>[#] sysctl -w net.ipv4.ip_forward=1\nnet.ipv4.ip_forward = 1\n[#] ip link add wg0 type wireguard\n[#] wg setconf wg0 /dev/fd/63\n[#] ip -4 address add 10.99.99.2/32 dev wg0\n[#] ip link set mtu 1420 up dev wg0\n[#] ip -4 route add 10.99.99.1/32 dev wg0\n[#] ip -4 route add 192.168.0.0/24 dev wg0\n</code></pre></p> <p>Se nos crea la interfaz: <pre><code>7: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/none\n    inet 10.99.99.2/32 scope global wg0\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>Y las rutas: <pre><code>10.99.99.1 dev wg0 scope link\n192.168.0.0/24 dev wg0 scope link\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#en-clientenormal1_1","title":"En clientenormal1","text":""},{"location":"sad/practica-vpn-sad/#cambiar-ruta-por-defecto_4","title":"Cambiar ruta por defecto","text":"<pre><code>sudo ip route del default\nsudo ip route add default via 192.168.0.1\n</code></pre>"},{"location":"sad/practica-vpn-sad/#en-clientenormal2_1","title":"En clientenormal2","text":""},{"location":"sad/practica-vpn-sad/#cambiar-ruta-por-defecto_5","title":"Cambiar ruta por defecto","text":"<pre><code>sudo ip route del default\nsudo ip route add default via 192.168.1.1\n</code></pre>"},{"location":"sad/practica-vpn-sad/#pruebas-de-funcionamiento_5","title":"Pruebas de funcionamiento","text":"<p>Ping desde <code>clientenormal1</code> a <code>clientenormal2</code>: <pre><code>vagrant@clientenormal1:~$ ping 192.168.1.2\nPING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.\n64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=2.77 ms\n64 bytes from 192.168.1.2: icmp_seq=2 ttl=62 time=0.958 ms\n^C\n--- 192.168.1.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 0.958/1.865/2.772/0.907 ms\n</code></pre></p> <p>Ping desde <code>clientenormal2</code> a <code>clientenormal1</code>: <pre><code>vagrant@clientenormal2:~$ ping 192.168.0.2\nPING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.\n64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=1.26 ms\n64 bytes from 192.168.0.2: icmp_seq=2 ttl=62 time=0.721 ms\n^C\n--- 192.168.0.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 0.721/0.992/1.264/0.271 ms\n</code></pre></p> <p>Traceroute desde <code>clientenormal1</code> a <code>clientenormal2</code>: <pre><code>vagrant@clientenormal1:~$ traceroute 192.168.1.2\ntraceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets\n 1  192.168.0.1 (192.168.0.1)  0.264 ms  0.244 ms  0.228 ms\n 2  10.99.99.2 (10.99.99.2)  0.558 ms  0.540 ms  0.495 ms\n 3  192.168.1.2 (192.168.1.2)  0.748 ms  0.700 ms  0.685 ms\n</code></pre></p> <p>Traceroute desde <code>clientenormal2</code> a <code>clientenormal1</code>: <pre><code>vagrant@clientenormal2:~$ traceroute 192.168.0.2\ntraceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets\n 1  192.168.1.1 (192.168.1.1)  0.800 ms  0.774 ms  0.764 ms\n 2  10.99.99.1 (10.99.99.1)  1.665 ms  1.653 ms  1.760 ms\n 3  192.168.0.2 (192.168.0.2)  2.553 ms  2.544 ms  2.535 ms\n</code></pre></p>"},{"location":"sad/practica-vpn-sad/#conclusiones_1","title":"Conclusiones","text":"<p>Aqu\u00ed expondr\u00e9 las conclusiones a las que he llegado tras comparar el sitio a sitio de WireGuard con el de OpenVPN.  </p> <p>Adem\u00e1s de las ya mencionadas en el anterior apartado de conclusiones, s\u00f3lo quedar\u00eda una m\u00e1s por destacar, y que s\u00f3lo ha sucedido con la configuraci\u00f3n de sitio a sitio:</p> <ul> <li>El manejo de rutas es mucho m\u00e1s sencillo con WireGuard, ya que s\u00f3lo nos tenemos que preocupar de que el par\u00e1metro <code>AllowedIPs</code> est\u00e9 correctamente relleno con las rutas que necesitamos en cada peer. Con OpenVPN influyen los <code>ccd</code>, \"complicando\" un poco la configuraci\u00f3n.</li> </ul>"},{"location":"sad/practica-vpn-sad/#bibliografia","title":"Bibliograf\u00eda","text":"<p>PARTE 1:</p> <p>https://kifarunix.com/install-openvpn-server-on-debian-11-debian-10/</p> <p>PARTE 2:</p> <p>https://medium.com/@bjammal/site-to-site-vpn-on-a-single-host-using-openvpn-e9c5cdb22f92 https://www.matoski.com/article/site-to-site-openvpn-firewalld-debian/ https://openvpn.net/community-resources/how-to/#scope (secci\u00f3n Including multiple machines on the client side when using a routed VPN (dev tun))</p> <p>PARTE 3:</p> <p>https://www.linuxbabe.com/debian/wireguard-vpn-server-debian https://www.makeuseof.com/how-to-set-up-wireguard-windows/</p> <p>PARTE 4:</p> <p>https://www.procustodibus.com/blog/2020/12/wireguard-site-to-site-config/</p>"},{"location":"sri/ej1-instalar-configurar-bind9/","title":"Ejercicio 1: Instalaci\u00f3n y configuraci\u00f3n del servidor bind9 en nuestra red local","text":""},{"location":"sri/ej1-instalar-configurar-bind9/#entrega","title":"Entrega","text":""},{"location":"sri/ej1-instalar-configurar-bind9/#parte-1","title":"Parte 1","text":"<p>Configurar <code>/etc/resolv.conf</code> en cliente apuntando a nuestro DNS</p> <pre><code>vagrant@cliente:~$ cat /etc/resolv.conf\nnameserver 10.0.0.2\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-bind9/#parte-2","title":"Parte 2","text":"<p>Entregar definici\u00f3n de zonas en <code>/etc/bind/named.conf.local</code></p> <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\ninclude \"/etc/bind/zones.rfc1918\";\n\nzone \"iesgn.org\" {\n    type master;\n    file \"/etc/bind/db.iesgn.org\";\n};\n\nzone \"0.0.10.in-addr.arpa\" {\n    type master;\n    file \"/etc/bind/db.10.0.0\";\n};\n</code></pre> <p>Entregar zona directa <code>db.iesgn.org</code></p> <pre><code>$ORIGIN iesgn.org.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      adrianj.iesgn.org.\n@              IN    MX  10  correo.iesgn.org.\n\nadrianj        IN    A       10.0.0.2\ncorreo         IN    A       10.0.0.200\nftp            IN    A       10.0.0.201\n\ncliente1       IN    A       10.0.0.3\ncliente2       IN    A       10.0.0.4\ncliente3       IN    A       10.0.0.5\n\nwww            IN    CNAME   adrianj\ndepartamentos  IN    CNAME   adrianj\n</code></pre> <p>Entregar zona inversa <code>db.10.0.0</code></p> <pre><code>$ORIGIN 0.0.10.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@     IN     NS     adrianj.iesgn.org.\n\n2     IN     PTR    adrianj.iesgn.org.\n200   IN     PTR    correo.iesgn.org.\n201   IN     PTR    ftp.iesgn.org.\n\n3     IN     PTR    cliente1.iesgn.org.\n4     IN     PTR    cliente2.iesgn.org.\n5     IN     PTR    cliente3.iesgn.org.\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-bind9/#parte-3","title":"Parte 3","text":"<p>Realizar consultas DNS desde cliente</p> <p><pre><code>dig adrianj.iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; adrianj.iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 15723\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: cb6d28d55ed4ee5f0100000061943df81878244ad357cd14 (good)\n;; QUESTION SECTION:\n;adrianj.iesgn.org.     IN  A\n\n;; ANSWER SECTION:\nadrianj.iesgn.org.  86400   IN  A   10.0.0.2\n\n;; Query time: 4 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Tue Nov 16 23:25:44 UTC 2021\n;; MSG SIZE  rcvd: 90\n</code></pre></p> <p><pre><code>dig www.iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; www.iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 12016\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 3d295ae1abc12a8e0100000061943e403a6b9d7c17e6de01 (good)\n;; QUESTION SECTION:\n;www.iesgn.org.         IN  A\n\n;; ANSWER SECTION:\nwww.iesgn.org.      86400   IN  CNAME   adrianj.iesgn.org.\nadrianj.iesgn.org.  86400   IN  A   10.0.0.2\n\n;; Query time: 0 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Tue Nov 16 23:26:56 UTC 2021\n;; MSG SIZE  rcvd: 108\n</code></pre></p> <p><pre><code>dig ftp.iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; ftp.iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 58577\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: cffc03df6e9131a00100000061943e7b8644c93e1bbe2730 (good)\n;; QUESTION SECTION:\n;ftp.iesgn.org.         IN  A\n\n;; ANSWER SECTION:\nftp.iesgn.org.      86400   IN  A   10.0.0.201\n\n;; Query time: 0 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Tue Nov 16 23:27:55 UTC 2021\n;; MSG SIZE  rcvd: 86\n</code></pre></p> <p><pre><code>dig NS iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; NS iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 19235\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: f8e47d8761996cfe0100000061943eb5c98b7df98b471892 (good)\n;; QUESTION SECTION:\n;iesgn.org.         IN  NS\n\n;; ANSWER SECTION:\niesgn.org.      86400   IN  NS  adrianj.iesgn.org.\n\n;; ADDITIONAL SECTION:\nadrianj.iesgn.org.  86400   IN  A   10.0.0.2\n\n;; Query time: 0 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Tue Nov 16 23:28:53 UTC 2021\n;; MSG SIZE  rcvd: 104\n</code></pre></p> <p><pre><code>dig MX iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; MX iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 22032\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 01b2ad2987fc1e2d0100000061943efe0b5bff60f70d13d1 (good)\n;; QUESTION SECTION:\n;iesgn.org.         IN  MX\n\n;; ANSWER SECTION:\niesgn.org.      86400   IN  MX  10 correo.iesgn.org.\n\n;; ADDITIONAL SECTION:\ncorreo.iesgn.org.   86400   IN  A   10.0.0.200\n\n;; Query time: 0 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Tue Nov 16 23:30:06 UTC 2021\n;; MSG SIZE  rcvd: 105\n</code></pre></p> <p><pre><code>dig www.josedomingo.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; www.josedomingo.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 9813\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: ef95496b3df04c9a0100000061943f350ccd2fde7ab6eda8 (good)\n;; QUESTION SECTION:\n;www.josedomingo.org.       IN  A\n\n;; ANSWER SECTION:\nwww.josedomingo.org.    900 IN  CNAME   endor.josedomingo.org.\nendor.josedomingo.org.  900 IN  A   37.187.119.60\n\n;; Query time: 1136 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Tue Nov 16 23:31:01 UTC 2021\n;; MSG SIZE  rcvd: 112\n</code></pre></p> <p><pre><code>dig -x 10.0.0.2\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; -x 10.0.0.2\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 51481\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: ec34bd720d4b97710100000061943f724de5cec28b58d9ab (good)\n;; QUESTION SECTION:\n;2.0.0.10.in-addr.arpa.     IN  PTR\n\n;; ANSWER SECTION:\n2.0.0.10.in-addr.arpa.  86400   IN  PTR adrianj.iesgn.org.\n\n;; Query time: 0 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Tue Nov 16 23:32:02 UTC 2021\n;; MSG SIZE  rcvd: 109\n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-bind9/#escenario","title":"Escenario","text":""},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear el escenario</p> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :server do |server|\n    server.vm.box = \"debian/bullseye64\"\n    server.vm.hostname = \"server\"\n    server.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :cliente do |cliente|\n    cliente.vm.box = \"debian/bullseye64\"\n    cliente.vm.hostname = \"cliente\"\n    cliente.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.3\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-2","title":"Ejercicio 2","text":"<p>En <code>server</code>:</p> <ul> <li>Instalar Apache</li> <li>2 VirtualHosts<ul> <li><code>www.iesgn.org</code></li> <li><code>departamentos.iesgn.org</code></li> </ul> </li> </ul> <pre><code>sudo apt update\nsudo apt install apache2\n</code></pre> <p>En <code>www.iesgn.org.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n\n    ServerName www.iesgn.org\n\n    DocumentRoot /var/www/www\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>En <code>departamentos.iesgn.org.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n\n    ServerName departamentos.iesgn.org\n\n    DocumentRoot /var/www/departamentos\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Los habilito y reinicio: <pre><code>sudo a2ensite www.iesgn.org.conf departamentos.iesgn.org.conf\nsudo systemctl restart apache2\n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-3","title":"Ejercicio 3","text":"<p>En <code>server</code>, instalar <code>bind9</code></p> <pre><code>sudo apt install bind9\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-4","title":"Ejercicio 4","text":"<p>Cambiar el hostname de <code>server</code> a: <code>adrianj.iesgn.org</code></p> <p>Modifico <code>/etc/hostname</code>: <pre><code>vagrant@server:~$ cat /etc/hostname\nadrianj\n</code></pre></p> <p>Hago que el cambio de hostname tome efecto ahora: <pre><code>sudo hostname adrianj\n</code></pre></p> <p>Verifico: <pre><code>vagrant@server:~$ hostname\nadrianj\n</code></pre></p> <p>Actualizo el prompt: <pre><code>vagrant@server:~$ bash\nvagrant@adrianj:~$\n</code></pre></p> <p>Modifico <code>/etc/hosts</code>: <pre><code>127.0.0.1   localhost\n127.0.0.2   bullseye\n\n::1     localhost ip6-localhost ip6-loopback\nff02::1     ip6-allnodes\nff02::2     ip6-allrouters\n\n127.0.1.1 adrianj.iesgn.org adrianj\n</code></pre></p> <p>Compruebo nombre largo: <pre><code>vagrant@adrianj:~$ hostname -f\nadrianj.iesgn.org\n</code></pre></p> <p>Compruebo nombre corto: <pre><code>vagrant@adrianj:~$ ping adrianj -c 1\nPING adrianj.iesgn.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from adrianj.iesgn.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.056 ms\n\n--- adrianj.iesgn.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.056/0.056/0.056/0.000 ms\n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-bind9/#servidor-bind9","title":"Servidor bind9","text":""},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-1_1","title":"Ejercicio 1","text":"<p>Definici\u00f3n de zonas en <code>/etc/bind/named.conf.local</code></p> <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\ninclude \"/etc/bind/zones.rfc1918\";\n\nzone \"iesgn.org\" {\n    type master;\n    file \"/etc/bind/db.iesgn.org\";\n};\n\nzone \"0.0.10.in-addr.arpa\" {\n    type master;\n    file \"/etc/bind/db.10.0.0\";\n};\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-2_1","title":"Ejercicio 2","text":"<p>Zona directa <code>db.iesgn.org</code></p> <pre><code>$ORIGIN iesgn.org.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      adrianj.iesgn.org.\n@              IN    MX  10  correo.iesgn.org.\n\nadrianj        IN    A       10.0.0.2\ncorreo         IN    A       10.0.0.200\nftp            IN    A       10.0.0.201\n\ncliente1       IN    A       10.0.0.3\ncliente2       IN    A       10.0.0.4\ncliente3       IN    A       10.0.0.5\n\nwww            IN    CNAME   adrianj\ndepartamentos  IN    CNAME   adrianj\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-3_1","title":"Ejercicio 3","text":"<p>Zona inversa <code>db.10.0.0</code></p> <pre><code>$ORIGIN 0.0.10.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@     IN     NS     adrianj.iesgn.org.\n\n2     IN     PTR    adrianj.iesgn.org.\n200   IN     PTR    correo.iesgn.org.\n201   IN     PTR    ftp.iesgn.org.\n\n3     IN     PTR    cliente1.iesgn.org.\n4     IN     PTR    cliente2.iesgn.org.\n5     IN     PTR    cliente3.iesgn.org.\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-bind9/#ejercicio-4_1","title":"Ejercicio 4","text":"<p>Comprobar configuraciones y reiniciar el servidor</p> <p>Verifico la zona directa: <pre><code>sudo named-checkzone iesgn.org db.iesgn.org\n</code></pre> <pre><code>zone iesgn.org/IN: loaded serial 2001062501\nOK\n</code></pre></p> <p>Verifico la zona inversa: <pre><code>sudo named-checkzone 0.0.10.in-addr.arpa db.10.0.0\n</code></pre> <pre><code>zone 0.0.10.in-addr.arpa/IN: loaded serial 2001062501\nOK\n</code></pre></p> <p>Reinicio: <pre><code>sudo systemctl restart bind9\n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-dhcp/","title":"Ejercicio 1: Instalaci\u00f3n y configuraci\u00f3n DHCP","text":""},{"location":"sri/ej1-instalar-configurar-dhcp/#entrega","title":"ENTREGA","text":""},{"location":"sri/ej1-instalar-configurar-dhcp/#parte-1","title":"Parte 1","text":"<p>Configuraci\u00f3n de <code>isc-dhcp-server</code></p> <pre><code>sudo apt update &amp;&amp; sudo apt install isc-dhcp-server\n</code></pre> <p>En <code>/etc/default/isc-dhcp-server</code>:</p> <ul> <li>Descomentar la l\u00ednea: <code>DHCPDv4_CONF=/etc/dhcp/dhcpd.conf</code></li> <li>Especificar por qu\u00e9 interfaz escuchar\u00e1 y servir\u00e1 IPs: <code>INTERFACESv4=\"eth1\"</code> </li> </ul> <p>En <code>/etc/dhcp/dhcpd.conf</code>: <pre><code>subnet 192.168.0.0 netmask 255.255.255.0 {\n  range 192.168.0.100 192.168.0.110;\n  option subnet-mask 255.255.255.0;\n  option routers 192.168.0.1;\n  option domain-name-servers 8.8.8.8, 8.8.4.4;\n  max-lease-time 3600;\n}\n</code></pre></p> <p>Reiniciar el servicio: <pre><code>sudo systemctl restart isc-dhcp-server\n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-dhcp/#parte-2","title":"Parte 2","text":"<p>Mostrar lista de concesiones DHCP</p> <p><pre><code>sudo dhcp-lease-list --lease\n</code></pre> <pre><code>To get manufacturer names please download http://standards.ieee.org/regauth/oui/oui.txt to /usr/local/etc/oui.txt\nUse of uninitialized value $db_cand in -r at /usr/sbin/dhcp-lease-list line 77.\nReading leases from /var/lib/dhcp/dhcpd.leases\nMAC                IP              hostname       valid until         manufacturer        \n===============================================================================================\n52:54:00:ac:7b:64  192.168.0.101   cliente        2021-10-18 18:21:40 -NA-    \n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-dhcp/#parte-3","title":"Parte 3","text":"<p>Configurar el cliente por DHCP  </p> <p>En <code>/etc/network/interfaces</code> configurar <code>eth1</code> de la siguiente manera: <pre><code>auto eth1\niface eth1 inet dhcp\n</code></pre></p> <p>Pedimos configuraci\u00f3n DHCP por <code>eth1</code>: <pre><code>sudo dhclient eth1\n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-dhcp/#parte-4","title":"Parte 4","text":"<p>Hacer un <code>ip a</code> en cliente</p> <pre><code>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:b9:cb:6d brd ff:ff:ff:ff:ff:ff\n    altname enp0s5\n    altname ens5\n    inet 192.168.121.68/24 brd 192.168.121.255 scope global dynamic eth0\n       valid_lft 3534sec preferred_lft 3534sec\n    inet6 fe80::5054:ff:feb9:cb6d/64 scope link\n       valid_lft forever preferred_lft forever\n3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:ac:7b:64 brd ff:ff:ff:ff:ff:ff\n    altname enp0s6\n    altname ens6\n    inet 192.168.0.101/24 brd 192.168.0.255 scope global dynamic eth1\n       valid_lft 3147sec preferred_lft 3147sec\n    inet6 fe80::5054:ff:feac:7b64/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre>"},{"location":"sri/ej1-instalar-configurar-dhcp/#parte-5","title":"Parte 5","text":"<p>Servidor DHCP tiene que actuar como router NAT  </p> <pre><code>echo \"1\" &gt; /proc/sys/net/ipv4/ip_forward\nsudo modprobe iptable_nat\nsudo iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE\n</code></pre> <p>Comprobaci\u00f3n de resoluci\u00f3n DNS en el cliente.</p> <p>Mediante ping: <pre><code>vagrant@cliente:~$ ping www.example.org\nPING www.example.org (93.184.216.34) 56(84) bytes of data.\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=1 ttl=52 time=120 ms\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=2 ttl=52 time=121 ms\n^C\n--- www.example.org ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 120.205/120.573/120.941/0.368 ms\n</code></pre></p> <p>Mediante dig: <pre><code>dig www.example.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; www.example.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6677\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 512\n;; QUESTION SECTION:\n;www.example.org.       IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    16060   IN  A   93.184.216.34\n\n;; Query time: 24 msec\n;; SERVER: 8.8.8.8#53(8.8.8.8)\n;; WHEN: Mon Oct 18 19:07:53 UTC 2021\n;; MSG SIZE  rcvd: 60\n</code></pre> Cuando dig se usa sin especificar un DNS, hace la query con nuestro primer nameserver por defecto. Utiliza <code>8.8.8.8</code>, por lo que es una manera de comprobar si nuestra configuraci\u00f3n DNS dada por el DHCP es correcta.  </p>"},{"location":"sri/ej1-instalar-configurar-dhcp/#escenario","title":"Escenario","text":"<ul> <li>Servidor DHCP</li> <li>Cliente</li> </ul> <p>Vagrantfile: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :servidor do |servidor|\n    servidor.vm.box = \"debian/bullseye64\"\n    servidor.vm.hostname = \"servidor\"\n    servidor.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1-dhcp\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.0.1\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :cliente do |cliente|\n    cliente.vm.box = \"debian/bullseye64\"\n    cliente.vm.hostname = \"cliente\"\n    cliente.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1-dhcp\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"sri/ej1-instalar-configurar-dhcp/#realizacion","title":"Realizaci\u00f3n","text":"<p>Comprobar la configuraci\u00f3n de red del cliente</p> <pre><code>3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:ac:7b:64 brd ff:ff:ff:ff:ff:ff\n    altname enp0s6\n    altname ens6\n    inet 192.168.0.101/24 brd 192.168.0.255 scope global dynamic eth1\n       valid_lft 2910sec preferred_lft 2910sec\n    inet6 fe80::5054:ff:feac:7b64/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre> <p>Vemos que son correctos los par\u00e1metros:</p> <ul> <li>Rango de IP</li> <li>M\u00e1scara</li> <li>Tiempo de concesi\u00f3n (ha pasado un rato desde que ped\u00ed configuraci\u00f3n hasta que hice el copypaste, por eso el lifetime ha bajado)</li> </ul> <pre><code>vagrant@cliente:~$ ip r\ndefault via 192.168.0.1 dev eth1\n192.168.0.0/24 dev eth1 proto kernel scope link src 192.168.0.101\n192.168.121.0/24 dev eth0 proto kernel scope link src 192.168.121.68\n</code></pre> <p>Vemos que ha surtido efecto el par\u00e1metro <code>option routers</code></p> <pre><code>vagrant@cliente:~$ cat /etc/resolv.conf\nnameserver 8.8.8.8\nnameserver 8.8.4.4\n</code></pre> <p>Vemos que ha surtido efecto el par\u00e1metro <code>option domain-name-servers</code></p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/","title":"Ejercicio 1: Mapear URL a ubicaciones de un sistema de ficheros","text":""},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#entrega","title":"ENTREGA","text":""},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#parte-1","title":"Parte 1","text":"<p>Mostrar configuraci\u00f3n completa del virtualhost</p> <pre><code>&lt;VirtualHost *:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n\n        ServerName www.mapeo.com\n        DocumentRoot /srv/mapeo\n\n        RedirectMatch ^/$ /principal\n\n        &lt;Directory /srv/mapeo/principal&gt;\n          Options -Indexes\n          Options -FollowSymLinks\n          Options -MultiViews\n        &lt;/Directory&gt;\n\n        Alias /principal/documentos /home/vagrant/doc\n        &lt;Directory /home/vagrant/doc&gt;\n          Options Indexes SymLinksIfOwnerMatch\n          Require all granted\n        &lt;/Directory&gt;\n\n        ErrorDocument 404 \"/error/404.html\"\n        ErrorDocument 403 \"/error/403.html\"        \n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#parte-2","title":"Parte 2","text":"<p>Con F12 de firefox, entrega screenshot para mostrar el redireccionamiento de <code>www.mapeo.com</code> a <code>principal</code></p> <p></p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#parte-3","title":"Parte 3","text":"<p>Mostrar screenshot en <code>www.mapeo.com/principal/documentos</code></p> <p></p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#parte-4","title":"Parte 4","text":"<p>Mostrar screenshot de 404 custom</p> <p></p> <p>Mostrar screenshot de 403 custom</p> <p></p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#ejercicios","title":"EJERCICIOS","text":""},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#ejercicio-0","title":"Ejercicio 0","text":"<p>Crear virtualhost www.mapeo.com con DocumentRoot /srv/mapeo</p> <p>Creo <code>/etc/apache2/sites-available/mapeo.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n        # The ServerName directive sets the request scheme, hostname and port that\n        # the server uses to identify itself. This is used when creating\n        # redirection URLs. In the context of virtual hosts, the ServerName\n        # specifies what hostname must appear in the request's Host: header to\n        # match this virtual host. For the default virtual host (this file) this\n        # value is not decisive as it is used as a last resort host regardless.\n        # However, you must set it for any further virtual host explicitly.\n\n        ServerName www.mapeo.com  \n        DocumentRoot /srv/mapeo    \n\n        # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n        # error, crit, alert, emerg.\n        # It is also possible to configure the loglevel for particular\n        # modules, e.g.\n        #LogLevel info ssl:warn\n\n        ErrorLog ${APACHE_LOG_DIR}/error.log\n        CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n        # For most configuration files from conf-available/, which are\n        # enabled or disabled at a global level, it is possible to\n        # include a line for only one particular virtual host. For example the\n        # following line enables the CGI configuration for this host only\n        # after it has been globally disabled with \"a2disconf\".\n        #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre></p> <p>En <code>/etc/apache2/apache2.conf</code> descomento: <pre><code>&lt;Directory /srv/&gt;\n        Options Indexes FollowSymLinks\n        AllowOverride None\n        Require all granted\n&lt;/Directory&gt;\n</code></pre></p> <p>Habilito el nuevo VirtualHost: <pre><code>sudo a2ensite mapeo.conf\n</code></pre></p> <p>Reinicio apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>En mi m\u00e1quina a\u00f1ado a <code>/etc/hosts</code> lo siguiente: <pre><code># ej1mapeourls resolutions\n192.168.121.8 www.mapeo.com\n</code></pre></p> <p>Veo que funciona con un <code>index.html</code> de prueba: </p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#ejercicio-1","title":"Ejercicio 1","text":"<p>Redireccionar www.mapeo.com a www.mapeo.com/principal, con mensaje de bienvenida</p> <p>En <code>/etc/apache2/sites-available/mapeo.conf</code> a\u00f1ado: <pre><code>RedirectMatch ^/$ /principal\n</code></pre></p> <p>Reinicio apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Compruebo que la redirecci\u00f3n funciona: </p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#ejercicio-2","title":"Ejercicio 2","text":"<p>En www.mapeo.com/principal se deniega:</p> <ul> <li>Listado de contenidos</li> <li>Enlaces simb\u00f3licos</li> <li>Negociaci\u00f3n de contenidos</li> </ul> <p>La configuraci\u00f3n a\u00f1adida en <code>/etc/apache2/sites-available/mapeo.conf</code> ser\u00eda: <pre><code>&lt;Directory /srv/mapeo/principal&gt;\n  Options -Indexes\n  Options -FollowSymLinks\n  Options -MultiViews\n&lt;/Directory&gt;\n</code></pre></p> <p>Reinicio apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#denegacion-de-listado-de-contenidos","title":"Denegaci\u00f3n de listado de contenidos","text":"<p>Modifico el nombre del <code>index.html</code> en <code>/srv/mapeo/principal</code> a otro cualquiera. Hago esto porque <code>Indexes</code> primero busca un <code>index.html</code> en el directorio, y si no lo encuentra, intenta listar el contenido.</p> <p>Muestro que deniega el listado:</p> <p></p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#denegacion-de-enlaces-simbolicos","title":"Denegaci\u00f3n de enlaces simb\u00f3licos","text":"<p>Creo uno de prueba: <pre><code>sudo ln -s ~/test.txt test.txt\n</code></pre></p> <p>Muestro que deniega el acceso: </p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#denegacion-de-negociacion-de-contenidos","title":"Denegaci\u00f3n de negociaci\u00f3n de contenidos","text":"<p>Creo 2 <code>index.html</code> de prueba, uno en espa\u00f1ol y otro en ingl\u00e9s: <pre><code>-rw-r--r-- 1 root root  378 Oct 24 17:45 index.html.en\n-rw-r--r-- 1 root root  383 Oct 24 17:44 index.html.es\n</code></pre></p> <p>Muestro que deniega el acceso: </p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#ejercicio-3","title":"Ejercicio 3","text":"<p>Hacer Alias de <code>www.mapeo.com/principal/documentos</code> a <code>/home/vagrant/doc</code> </p> <p>Se permitir\u00e1:</p> <ul> <li>Indexes</li> <li>SymLinksIfOwnerMatch</li> </ul> <p>En <code>/home/vagrant/doc</code> he creado la siguiente estructura de pruebas: <pre><code>lrwxrwxrwx 1 vagrant vagrant   23 Oct 24 18:17 dummy.pdf -&gt; /home/vagrant/dummy.pdf\n-rw-r--r-- 1 vagrant vagrant 3028 Feb 24  2017 sample.pdf\n</code></pre></p> <p>Vemos que <code>dummy.pdf</code> mantiene el mismo owner que el enlace simb\u00f3lico en el fichero original: <pre><code>vagrant@ej1mapeourls:~$ ls -la\ntotal 56\ndrwxr-xr-x 5 vagrant vagrant  4096 Oct 24 18:15 .\ndrwxr-xr-x 3 root    root     4096 Aug 29 17:07 ..\n-rw-r--r-- 1 vagrant vagrant   220 Aug  4 20:25 .bash_logout\n-rw-r--r-- 1 vagrant vagrant  3526 Aug  4 20:25 .bashrc\ndrwxr-xr-x 3 vagrant vagrant  4096 Oct 22 11:55 .local\n-rw-r--r-- 1 vagrant vagrant   807 Aug  4 20:25 .profile\ndrwx------ 2 vagrant vagrant  4096 Oct 22 11:46 .ssh\n-rw-r--r-- 1 vagrant vagrant   216 Oct 24 18:15 .wget-hsts\ndrwxr-xr-x 2 vagrant vagrant  4096 Oct 24 18:17 doc\n-rw-r--r-- 1 vagrant vagrant 13264 Aug 27  2007 dummy.pdf\n-rw-r--r-- 1 vagrant vagrant     7 Oct 24 17:27 test.txt\n</code></pre></p> <p>A\u00f1ado lo siguiente a <code>/etc/apache2/sites-available/mapeo.conf</code> para la configuraci\u00f3n del Alias: <pre><code>Alias /principal/documentos /home/vagrant/doc\n&lt;Directory /home/vagrant/doc&gt;\n  Options Indexes SymLinksIfOwnerMatch\n  Require all granted\n&lt;/Directory&gt;\n</code></pre></p> <p>Reinicio apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Muestro que funciona:</p> <p></p> <p>En caso de que el owner entre enlace simb\u00f3lico y fichero original difiriese, simplemente har\u00eda que no se nos mostrase en ese listado, aunque el fichero existiera.</p> <p>El hecho de que <code>dummy.pdf</code> se muestre, es prueba de que <code>SymLinksIfOwnerMatch</code> est\u00e1 funcionando.</p>"},{"location":"sri/ej1-mapeo-urls-al-sistema-ficheros/#ejercicio-4","title":"Ejercicio 4","text":"<p>Crear <code>/srv/mapeo/error</code></p> <pre><code>sudo mkdir /srv/mapeo/error\n</code></pre> <p>Crear en ese directorio 2 html de error custom</p> <pre><code>-rw-r--r-- 1 root root 2599 Oct 24 22:52 403.html\n-rw-r--r-- 1 root root 1367 Oct 24 22:43 404.html\n</code></pre> <p>A\u00f1adir a <code>/etc/apache2/sites-available/mapeo.conf</code> lo siguiente:</p> <pre><code>ErrorDocument 404 \"/error/404.html\"\nErrorDocument 403 \"/error/403.html\"\n</code></pre> <p>Reiniciar apache:</p> <pre><code>sudo systemctl restart apache2\n</code></pre> <p>Entro con una URL inventada para probar el 404</p> <p></p> <p>Entro a <code>www.mapeo.com/principal</code> para probar el 403, ya que ten\u00eda el Indexes y el MultiViews prohibido</p> <p></p>"},{"location":"sri/ej1-playbook-sencillo/","title":"Parte 1","text":"<p>Prepara una m\u00e1quina virtual en KVM que es la que vamos a configurar de forma autom\u00e1tica con ansible.</p> <p>Ya la tengo, hecha en Vagrant con libvirt.</p>"},{"location":"sri/ej1-playbook-sencillo/#parte-2","title":"Parte 2","text":"<p>Crea un playbook que realice las siguientes tareas de forma autom\u00e1tica. Se usan m\u00f3dulos espec\u00edficos para cada una de ellas.</p>"},{"location":"sri/ej1-playbook-sencillo/#tarea-1","title":"Tarea 1","text":"<p>Crear un usuario \"adrianj\" en el servidor remoto</p> <pre><code>- name: Creando usuario adrianj...\n  user:\n    name: adrianj\n    password: '$6$Rjn7CUlYJXM8Fvrk$4r/qu2Q6Abiq4iGJjOW2RtclK14AyB9/3va/ZWu3oPIjIo10sNPgoyM6/sthvocwux.7hXFk/O8QpNNUW3Xsr1'\n    # He usado mkpasswd --method=sha-512\n    # en plano: 1234\n</code></pre>"},{"location":"sri/ej1-playbook-sencillo/#tarea-2","title":"Tarea 2","text":"<p>Descarga el fichero https://wordpress.org/latest.zip</p> <pre><code>- name: Descargando Wordpress...\n  get_url:\n    url: https://wordpress.org/latest.zip\n    dest: /tmp\n</code></pre>"},{"location":"sri/ej1-playbook-sencillo/#tarea-3","title":"Tarea 3","text":"<p>Descomprime ese fichero en el home del usuario \"adrianj\"</p> <pre><code>- name: Descompresi\u00f3n\n  block:\n   - name: Instalando unzip...\n     become_user: root\n     apt:\n       pkg:\n       - unzip\n   - name: Descomprimiendo Wordpress en el home de adrianj...\n     unarchive:\n       src: /tmp/wordpress-5.8.1.zip\n       dest: /home/adrianj\n       remote_src: yes\n</code></pre>"},{"location":"sri/ej1-playbook-sencillo/#tarea-4","title":"Tarea 4","text":"<p>Instala mariadb</p> <pre><code>- name: Instalando MariaDB...\n  apt:\n    pkg:\n    - mariadb-server\n</code></pre>"},{"location":"sri/ej1-playbook-sencillo/#tarea-5","title":"Tarea 5","text":"<p>Crea una base de datos que se llame adrian_wordpress</p> <pre><code>- name: Instalar python3-pip + pymysql + crear BD\n  block:\n   - name: Instalando python3-pip...\n     apt:\n       pkg:\n       - python3-pip\n   - name: Instalando pymysql...\n     pip:\n       name: pymysql\n   - name: Creando la base de datos adrian_wordpress...\n     mysql_db:\n       login_unix_socket: /var/run/mysqld/mysqld.sock\n       name: adrian_wordpress\n       state: present\n</code></pre>"},{"location":"sri/ej1-playbook-sencillo/#tarea-6","title":"Tarea 6","text":"<p>Crea el usuario \"adrian_jaramillo\" con privilegios sobre la base de datos \"adrian_wordpress\"</p> <pre><code>- name: Creando usuario con privilegios sobre adrian_wordpress...\n  mysql_user:\n    login_unix_socket: /var/run/mysqld/mysqld.sock\n    name: adrian_jaramillo\n    password: '1234'\n    priv: 'adrian_wordpress.*:ALL'\n    state: present\n</code></pre>"},{"location":"sri/ej1-playbook-sencillo/#tarea-7","title":"Tarea 7","text":"<p>Clonar repositorio https://github.com/josedom24/ansible_ejemplos.git en el home del usuario \"adrianj\"</p> <pre><code>- name: Git + directorio vac\u00edo + repo\n  block:\n   - name: Instalando git...\n     apt:\n       pkg:\n       - git\n   - name: Creando un directorio vac\u00edo para el repo...\n     file:\n       path: /home/adrianj/repo\n       state: directory\n   - name: Clonando repo al home de adrianj...\n     git:\n       repo: https://github.com/josedom24/ansible_ejemplos.git\n       dest: /home/adrianj/repo\n</code></pre>"},{"location":"sri/ej1-playbook-sencillo/#parte-3","title":"Parte 3","text":"<p>Entrega la url del repositorio donde has guardado el playbook</p> <p>https://github.com/adriasir123/ej1-playbook-sencillo</p> <p>Muestra la ejecuci\u00f3n del playbook</p> <pre><code>PLAY [nodo1] ********************************************************************************\n\nTASK [Gathering Facts] **********************************************************************\nok: [nodo1]\n\nTASK [Creando usuario adrianj...] ***********************************************************\nok: [nodo1]\n\nTASK [Descargando Wordpress...] *************************************************************\nok: [nodo1]\n\nTASK [Instalando unzip...] ******************************************************************\nok: [nodo1]\n\nTASK [Descomprimiendo Wordpress en el home de adrianj...] ***********************************\nok: [nodo1]\n\nTASK [Instalando MariaDB...] ****************************************************************\nok: [nodo1]\n\nTASK [Instalando python3-pip...] ************************************************************\nok: [nodo1]\n\nTASK [Instalando pymysql...] ****************************************************************\nok: [nodo1]\n\nTASK [Creando la base de datos adrian_wordpress...] *****************************************\nok: [nodo1]\n\nTASK [Creando usuario con privilegios sobre adrian_wordpress...] ****************************\nok: [nodo1]\n\nTASK [Instalando git...] ********************************************************************\nok: [nodo1]\n\nTASK [Creando un directorio vac\u00edo para el repo...] ******************************************\nok: [nodo1]\n\nTASK [Clonando repo al home de adrianj...] **************************************************\nok: [nodo1]\n\nPLAY RECAP **********************************************************************************\nnodo1                      : ok=13   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n</code></pre>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/","title":"Ejercicio 2: Control de acceso, autenticaci\u00f3n y autorizaci\u00f3n","text":""},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#entrega","title":"ENTREGA","text":""},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#parte-1","title":"Parte 1","text":"<p>Captura accediendo a <code>departamentos.iesgn.org/intranet</code> desde nuestro host</p> <p></p> <p>Captura accediendo a <code>departamentos.iesgn.org/intranet</code> desde cliente</p> <p></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#parte-2","title":"Parte 2","text":"<p>Captura accediendo a <code>departamentos.iesgn.org/internet</code> desde nuestro host</p> <p></p> <p>Captura accediendo a <code>departamentos.iesgn.org/internet</code> desde cliente</p> <p></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#parte-3","title":"Parte 3","text":"<p>Mostrar que la autenticaci\u00f3n b\u00e1sica funciona</p> <p></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#parte-4","title":"Parte 4","text":"<p>Captura con las cabeceras HTTP donde se vea la autenticaci\u00f3n b\u00e1sica</p> <p></p> <p>Se manda una cabecera <code>Authorization</code> en la petici\u00f3n, con el mensaje <code>dmlwOnZpcA==</code> en texto plano.</p> <p>Con cualquier decodificador online de Base64 podemos averiguar lo que significa:</p> <p></p> <p>Pues bien, ah\u00ed tenemos el usuario y la contrase\u00f1a que he introducido durante la autenticaci\u00f3n b\u00e1sica.</p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#parte-5","title":"Parte 5","text":"<p>Mostrar que la autenticaci\u00f3n digest funciona</p> <p>Pruebo el acceso con <code>nodirectivo1</code>:</p> <p></p> <p>Pruebo el acceso con <code>directivo1</code>:</p> <p></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#parte-6","title":"Parte 6","text":"<p>Captura con las cabeceras HTTP donde se vea la autenticaci\u00f3n digest</p> <p></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#parte-7","title":"Parte 7","text":"<p>Mostrar el funcionamiento del ejercicio 4</p> <p>Prueba de acceso desde cliente:</p> <p></p> <p>Prueba de acceso desde mi m\u00e1quina:</p> <p></p> <p>Entregar la configuraci\u00f3n realizada</p> <p>Modifico <code>/etc/apache2/sites-available/departamentos.conf</code>: <pre><code>&lt;Directory \"/var/www/departamentos/secreto\"&gt;\n  &lt;RequireAny&gt;\n    &lt;RequireAll&gt;\n      Require ip 10.0.0\n    &lt;/RequireAll&gt;\n    &lt;RequireAll&gt;\n      Require ip 192.168.121\n      AuthType Digest\n      AuthName \"directivos\"\n      AuthUserFile /etc/apache2/.htpasswd\n      Require valid-user  \n    &lt;/RequireAll&gt;\n  &lt;/RequireAny&gt;\n&lt;/Directory&gt;\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#preliminares","title":"Preliminares","text":""},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#control-de-acceso","title":"Control de acceso","text":"<p>\u00bfControl de acceso por defecto de 000-default?</p> <p>En <code>000-default.conf</code> no hay control de acceso definido, pero como el DocumentRoot est\u00e1 en <code>/var/www/html</code>, le afecta la siguiente directiva de <code>apache2.conf</code>: <pre><code>&lt;Directory /var/www/&gt;\n        Options Indexes FollowSymLinks\n        AllowOverride None\n        Require all granted\n&lt;/Directory&gt;\n</code></pre></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#ejercicios","title":"EJERCICIOS","text":""},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#ejercicio-0","title":"Ejercicio 0","text":"<p>Definir escenario Vagrant:</p> <ul> <li>Servidor:<ul> <li>Interfaz eth0 (NAT) actuando como p\u00fablica</li> <li>Interfaz privada (veryisolated)</li> </ul> </li> <li>Cliente conectado a la red privada</li> </ul> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :ej2controlacceso do |ej2controlacceso|\n    ej2controlacceso.vm.box = \"debian/bullseye64\"\n    ej2controlacceso.vm.hostname = \"ej2controlacceso\"\n    ej2controlacceso.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej2controlaccesonet\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :cliente do |cliente|\n    cliente.vm.box = \"debian/bullseye64\"\n    cliente.vm.hostname = \"cliente\"\n    cliente.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej2controlaccesonet\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.3\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre> <p>Crear VirtualHost <code>departamentos.iesgn.org</code></p> <pre><code>&lt;VirtualHost *:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n\n    ServerName departamentos.iesgn.org\n    DocumentRoot /var/www/departamentos\n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#ejercicio-1","title":"Ejercicio 1","text":"<p>A <code>departamentos.iesgn.org/intranet</code>:</p> <ul> <li>Se permite acceso desde cliente</li> <li>Se deniega acceso desde nuestra m\u00e1quina</li> </ul> <p>Modificar <code>/etc/apache2/sites-available/departamentos.conf</code>: <pre><code>&lt;Directory /var/www/departamentos/intranet&gt;\n  Require ip 10.0.0\n&lt;/Directory&gt;\n</code></pre></p> <p>Reiniciar Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> <p>Prueba de acceso desde mi m\u00e1quina:</p> <p></p> <p>Prueba de acceso desde cliente:</p> <p></p> <p>He usado \"lynx\".</p> <p>A <code>departamentos.iesgn.org/internet</code>:</p> <ul> <li>Se permite acceso desde nuestra m\u00e1quina</li> <li>Se deniega acceso desde cliente</li> </ul> <p>Modificar <code>/etc/apache2/sites-available/departamentos.conf</code>: <pre><code>&lt;Directory /var/www/departamentos/internet&gt;\n  Require ip 192.168.121       \n&lt;/Directory&gt;\n</code></pre></p> <p>Reiniciar Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> <p>Prueba de acceso desde mi m\u00e1quina:</p> <p></p> <p>Prueba de acceso desde cliente:</p> <p></p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#ejercicio-2","title":"Ejercicio 2","text":"<p>Autenticaci\u00f3n b\u00e1sica en <code>departamentos.iesgn.org/secreto</code></p> <p>Creo el fichero <code>htpasswd</code>: <pre><code>sudo htpasswd -c /etc/apache2/.htpasswd vip\n</code></pre></p> <p>He a\u00f1adido un usuario \"vip\" con contrase\u00f1a \"vip\".</p> <p>Comprobamos que se ha creado <code>htpasswd</code> y sus contenidos: <pre><code>vagrant@ej2controlacceso:/etc/apache2$ cat .htpasswd\nvip:$apr1$p6ga61LF$dl2YMKRkVM7GW8AuRUsIN/\n</code></pre></p> <p>Modifico <code>/etc/apache2/sites-available/departamentos.conf</code>: <pre><code>&lt;Directory \"/var/www/departamentos/secreto\"&gt;\n  AuthType Basic\n  AuthName \"Acceso para VIPs\"\n  AuthUserFile /etc/apache2/.htpasswd\n  Require valid-user\n&lt;/Directory&gt;\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> <p>Pruebo que funciona:</p> <p></p> <p>Comprobar las cabeceras HTTP durante la autenticaci\u00f3n b\u00e1sica \u00bfC\u00f3mo se manda la contrase\u00f1a entre el cliente y el servidor?</p> <p></p> <p>Se manda una cabecera <code>Authorization</code> en la petici\u00f3n, con el mensaje <code>dmlwOnZpcA==</code> en texto plano.</p> <p>Con cualquier decodificador online de Base64 podemos averiguar lo que significa:</p> <p></p> <p>Pues bien, ah\u00ed tenemos el usuario y la contrase\u00f1a que he introducido durante la autenticaci\u00f3n b\u00e1sica.</p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#ejercicio-3","title":"Ejercicio 3","text":"<p>Modificar la autenticaci\u00f3n a tipo digest, y hacer que <code>departamentos.iesgn.org/secreto</code> s\u00f3lo sea accesible por usuarios del grupo directivos</p> <p>Sobreescribo el antiguo fichero <code>htpasswd</code> a\u00f1adiendo un usuario directivo: <pre><code>sudo htdigest -c /etc/apache2/.htpasswd directivos directivo1\n</code></pre></p> <p>A\u00f1ado tambi\u00e9n un usuario no directivo: <pre><code>sudo htdigest /etc/apache2/.htpasswd nodirectivos nodirectivo1\n</code></pre></p> <p>Ambos usuarios tienen como contrase\u00f1a \"1234\".</p> <p>Ahora el fichero <code>.htpasswd</code> luce de la siguiente manera: <pre><code>directivo1:directivos:4fdd1584741ce8cc0d722a82af5d2a1f\nnodirectivo1:nodirectivos:305a303414ab365e1637a8f26f2c30cc\n</code></pre></p> <p>Habilito el m\u00f3dulo necesario: <pre><code>sudo a2enmod auth_digest\n</code></pre></p> <p>Modifico <code>/etc/apache2/sites-available/departamentos.conf</code>: <pre><code>&lt;Directory \"/var/www/departamentos/secreto\"&gt;\n  AuthType Digest\n  AuthName \"directivos\"\n  AuthUserFile /etc/apache2/.htpasswd\n  Require valid-user\n&lt;/Directory&gt;\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> <p>Pruebo el acceso con <code>nodirectivo1</code>:</p> <p></p> <p>Pruebo el acceso con <code>directivo1</code>:</p> <p></p> <p>Comprobar las cabeceras HTTP durante la autenticaci\u00f3n digest \u00bfC\u00f3mo funciona esta autenticaci\u00f3n?</p> <p></p> <p>Ahora en la cabecera <code>Authorization</code> de la petici\u00f3n, se manda un campo <code>response</code> que contiene las credenciales enviadas encriptadas.</p> <p>No hay manera de sacar la contrase\u00f1a en texto plano a partir de ese mensaje encriptado, ya que el sistema se hizo as\u00ed intencionamente para que no fuese posible.</p>"},{"location":"sri/ej2-control-acceso-autenticacion-autorizacion/#ejercicio-4","title":"Ejercicio 4","text":"<p>Para acceder a <code>departamentos.iesgn.org/secreto</code>:</p> <ul> <li>No pide autenticaci\u00f3n desde la intranet</li> <li>Pide autenticaci\u00f3n desde nuestro host</li> </ul> <p>Modifico <code>/etc/apache2/sites-available/departamentos.conf</code>: <pre><code>&lt;Directory \"/var/www/departamentos/secreto\"&gt;\n  &lt;RequireAny&gt;\n    &lt;RequireAll&gt;\n      Require ip 10.0.0\n    &lt;/RequireAll&gt;\n    &lt;RequireAll&gt;\n      Require ip 192.168.121\n      AuthType Digest\n      AuthName \"directivos\"\n      AuthUserFile /etc/apache2/.htpasswd\n      Require valid-user  \n    &lt;/RequireAll&gt;\n  &lt;/RequireAny&gt;\n&lt;/Directory&gt;\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2.service\n</code></pre></p> <p>Prueba de acceso desde cliente:</p> <p></p> <p>Prueba de acceso desde mi m\u00e1quina:</p> <p></p>"},{"location":"sri/ej2-instalar-configurar-slave/","title":"Ejercicio 2: Instalaci\u00f3n y configuraci\u00f3n de un servidor DNS esclavo","text":""},{"location":"sri/ej2-instalar-configurar-slave/#entrega","title":"Entrega","text":""},{"location":"sri/ej2-instalar-configurar-slave/#parte-1","title":"Parte 1","text":"<p>Mostrar la definici\u00f3n de zonas en maestro</p> <p><code>/etc/bind/named.conf.local</code>: <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\ninclude \"/etc/bind/zones.rfc1918\";\n\nzone \"iesgn.org\" {\n    type master;\n    file \"/etc/bind/db.iesgn.org\";\n    allow-transfer { 10.0.0.10; };\n    also-notify { 10.0.0.10; };\n};\n\nzone \"0.0.10.in-addr.arpa\" {\n    type master;\n    file \"/etc/bind/db.10.0.0\";\n    allow-transfer { 10.0.0.10; };\n    also-notify { 10.0.0.10; };\n};\n</code></pre></p> <p>Mostrar la zona directa en maestro</p> <p><code>/etc/bind/db.iesgn.org</code>: <pre><code>$ORIGIN iesgn.org.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      adrianj.iesgn.org.\n@              IN    NS      jaramillor.iesgn.org.\n@              IN    MX  10  correo.iesgn.org.\n\nadrianj        IN    A       10.0.0.2\njaramillor     IN    A       10.0.0.10\ncorreo         IN    A       10.0.0.200\nftp            IN    A       10.0.0.201\n\ncliente1       IN    A       10.0.0.3\ncliente2       IN    A       10.0.0.4\ncliente3       IN    A       10.0.0.5\n\nwww            IN    CNAME   adrianj\ndepartamentos  IN    CNAME   adrianj\n</code></pre></p> <p>Mostrar la zona inversa en maestro</p> <p><code>/etc/bind/db.10.0.0</code>: <pre><code>$ORIGIN 0.0.10.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@     IN     NS     adrianj.iesgn.org.\n@     IN     NS     jaramillor.iesgn.org.\n\n2     IN     PTR    adrianj.iesgn.org.\n10    IN     PTR    jaramillor.iesgn.org.\n200   IN     PTR    correo.iesgn.org.\n201   IN     PTR    ftp.iesgn.org.\n\n3     IN     PTR    cliente1.iesgn.org.\n4     IN     PTR    cliente2.iesgn.org.\n5     IN     PTR    cliente3.iesgn.org.\n</code></pre></p> <p>Mostrar la definici\u00f3n de zonas en esclavo</p> <p><code>/etc/bind/named.conf.local</code>: <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\ninclude \"/etc/bind/zones.rfc1918\";\n\nzone \"iesgn.org\" {\n    type slave;\n    file \"/var/cache/bind/db.iesgn.org\";\n    masters { 10.0.0.2; };\n};\n\nzone \"0.0.10.in-addr.arpa\" {\n    type slave;\n    file \"/var/cache/bind/db.10.0.0\";\n    masters { 10.0.0.2; };\n};\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-2","title":"Parte 2","text":"<p>Mostrar si los ficheros de zona del maestro tienen errores</p> <p>Verifico la zona directa: <pre><code>sudo named-checkzone iesgn.org db.iesgn.org\n</code></pre> <pre><code>zone iesgn.org/IN: loaded serial 2001062501\nOK\n</code></pre></p> <p>Verifico la zona inversa: <pre><code>sudo named-checkzone 0.0.10.in-addr.arpa db.10.0.0\n</code></pre> <pre><code>zone 0.0.10.in-addr.arpa/IN: loaded serial 2001062501\nOK\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-3","title":"Parte 3","text":"<p>Comprobar si <code>named.conf</code> tiene errores tanto en maestro como en esclavo</p> <p>En maestro: <pre><code>sudo named-checkconf named.conf\n</code></pre></p> <p>En esclavo: <pre><code>sudo named-checkconf named.conf\n</code></pre></p> <p>No me devuelve output en ambos casos, significa que no hay errores.</p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-4","title":"Parte 4","text":"<p>Mostrar en <code>/var/log/syslog</code> la transferencia de zonas</p> <p>Comando: <pre><code>sudo cat /var/log/syslog | grep named | grep transfer\n</code></pre></p> <p>Transferencia de zona directa: <pre><code>Nov 18 00:43:58 bullseye named[2538]: transfer of 'iesgn.org/IN' from 10.0.0.2#53: connected using 10.0.0.10#58761\nNov 18 00:43:58 bullseye named[2538]: zone iesgn.org/IN: transferred serial 2001062504\nNov 18 00:43:58 bullseye named[2538]: transfer of 'iesgn.org/IN' from 10.0.0.2#53: Transfer status: success\nNov 18 00:43:58 bullseye named[2538]: transfer of 'iesgn.org/IN' from 10.0.0.2#53: Transfer completed: 1 messages, 14 records, 364 bytes, 0.004 secs (91000 bytes/sec) (serial 2001062504)\n</code></pre></p> <p>Transferencia de zona inversa: <pre><code>Nov 18 00:53:00 bullseye named[2538]: transfer of '0.0.10.in-addr.arpa/IN' from 10.0.0.2#53: connected using 10.0.0.10#58699\nNov 18 00:53:00 bullseye named[2538]: zone 0.0.10.in-addr.arpa/IN: transferred serial 2001062502\nNov 18 00:53:00 bullseye named[2538]: transfer of '0.0.10.in-addr.arpa/IN' from 10.0.0.2#53: Transfer status: success\nNov 18 00:53:00 bullseye named[2538]: transfer of '0.0.10.in-addr.arpa/IN' from 10.0.0.2#53: Transfer completed: 1 messages, 11 records, 326 bytes, 0.004 secs (81500 bytes/sec) (serial 2001062502)\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-5","title":"Parte 5","text":"<p>Entregar la configuraci\u00f3n DNS de cliente</p> <p><code>/etc/resolv.conf</code>: <pre><code>nameserver 10.0.0.2\nnameserver 10.0.0.10\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-6","title":"Parte 6","text":"<p>Realizar una consulta dig a maestro y esclavo para comprobar que las respuestas son con autoridad</p> <p>Al maestro:</p> <p></p> <p>Al esclavo:</p> <p></p> <p>Buscamos esa flag \"aa\", que quiere decir \"Authoritative Answer\". Nos devolver\u00e1 esa flag siempre que hagamos consultas sobre zonas en las que los servidores tengan autoridad.</p> <p>La RFC 1035 dice lo siguiente:</p> <p></p> <p>Si por ejemplo hiciese una consulta en una zona sobre la que mi servidor NO TIENE autoridad, pasar\u00eda lo siguiente:</p> <p></p> <p>No aparece la flag \"aa\".</p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-7","title":"Parte 7","text":"<p>Solicitar copia completa de una zona desde cliente \u00bfqu\u00e9 tiene que ocurrir?</p> <p><pre><code>dig @10.0.0.2 iesgn.org axfr\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; @10.0.0.2 iesgn.org axfr\n; (1 server found)\n;; global options: +cmd\n; Transfer failed.\n</code></pre> No permite la transferencia.</p> <p>Solicitar copia completa de una zona desde esclavo \u00bfqu\u00e9 tiene que ocurrir?</p> <p><pre><code>dig @10.0.0.2 iesgn.org axfr\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; @10.0.0.2 iesgn.org axfr\n; (1 server found)\n;; global options: +cmd\niesgn.org.      86400   IN  SOA adrianj.iesgn.org. admin.iesgn.org. 2001062503 21600 3600 604800 86400\niesgn.org.      86400   IN  NS  adrianj.iesgn.org.\niesgn.org.      86400   IN  NS  jaramillor.iesgn.org.\niesgn.org.      86400   IN  MX  10 correo.iesgn.org.\nadrianj.iesgn.org.  86400   IN  A   10.0.0.2\ncliente1.iesgn.org. 86400   IN  A   10.0.0.3\ncliente2.iesgn.org. 86400   IN  A   10.0.0.4\ncliente3.iesgn.org. 86400   IN  A   10.0.0.5\ncorreo.iesgn.org.   86400   IN  A   10.0.0.200\ndepartamentos.iesgn.org. 86400  IN  CNAME   adrianj.iesgn.org.\nftp.iesgn.org.      86400   IN  A   10.0.0.201\njaramillor.iesgn.org.   86400   IN  A   10.0.0.10\nwww.iesgn.org.      86400   IN  CNAME   adrianj.iesgn.org.\niesgn.org.      86400   IN  SOA adrianj.iesgn.org. admin.iesgn.org. 2001062503 21600 3600 604800 86400\n;; Query time: 0 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Wed Nov 17 23:50:34 UTC 2021\n;; XFR size: 14 records (messages 1, bytes 403)\n</code></pre> Permite la transferencia.</p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-8","title":"Parte 8","text":"<p>Realizar consulta desde cliente y comprobar qu\u00e9 servidor responde</p> <p></p> <p>Seg\u00fan nuestro orden en <code>resolv.conf</code>, siempre nos responder\u00e1 el maestro, salvo que \u00e9ste falle.</p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-9","title":"Parte 9","text":"<p>Apagar maestro y hacer consulta desde cliente \u00bfqui\u00e9n responde?</p> <p></p> <p>Responde el esclavo.</p>"},{"location":"sri/ej2-instalar-configurar-slave/#realizacion","title":"Realizaci\u00f3n","text":""},{"location":"sri/ej2-instalar-configurar-slave/#ejercicio-1","title":"Ejercicio 1","text":"<p>Instalar un servidor DNS como esclavo del DNS configurado en el ejercicio 1.</p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-1_1","title":"Parte 1","text":"<p>A\u00f1adir otra m\u00e1quina al escenario del ej1, para instalar el esclavo ah\u00ed</p> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :server do |server|\n    server.vm.box = \"debian/bullseye64\"\n    server.vm.hostname = \"server\"\n    server.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :cliente do |cliente|\n    cliente.vm.box = \"debian/bullseye64\"\n    cliente.vm.hostname = \"cliente\"\n    cliente.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.3\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :slavedns do |slavedns|\n    slavedns.vm.box = \"debian/bullseye64\"\n    slavedns.vm.hostname = \"slavedns\"\n    slavedns.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.10\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-2_1","title":"Parte 2","text":"<p>Cambiar el hostname de <code>slavedns</code> a: <code>jaramillor.iesgn.org</code></p> <p>Modifico <code>/etc/hostname</code>: <pre><code>vagrant@slavedns:~$ cat /etc/hostname\njaramillor\n</code></pre></p> <p>Hago que el cambio de hostname tome efecto ahora: <pre><code>sudo hostname jaramillor\n</code></pre></p> <p>Verifico: <pre><code>vagrant@slavedns:~$ hostname\njaramillor\n</code></pre></p> <p>Actualizo el prompt: <pre><code>vagrant@slavedns:~$ bash\nvagrant@jaramillor:~$\n</code></pre></p> <p>Modifico <code>/etc/hosts</code>: <pre><code>127.0.0.1   localhost\n127.0.0.2   bullseye\n::1     localhost ip6-localhost ip6-loopback\nff02::1     ip6-allnodes\nff02::2     ip6-allrouters\n\n127.0.1.1 jaramillor.iesgn.org jaramillor\n</code></pre></p> <p>Compruebo nombre largo: <pre><code>vagrant@jaramillor:~$ hostname -f\njaramillor.iesgn.org\n</code></pre></p> <p>Compruebo nombre corto: <pre><code>vagrant@jaramillor:~$ ping jaramillor -c 1\nPING jaramillor.iesgn.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from jaramillor.iesgn.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.089 ms\n\n--- jaramillor.iesgn.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.089/0.089/0.089/0.000 ms\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-3_1","title":"Parte 3","text":"<p>Instalar <code>bind9</code></p> <pre><code>sudo apt update\nsudo apt install bind9\n</code></pre>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-4_1","title":"Parte 4","text":"<p>Modificar la definici\u00f3n de zonas del maestro para habilitar transferencia al esclavo</p> <p><code>/etc/bind/named.conf.local</code>: <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\ninclude \"/etc/bind/zones.rfc1918\";\n\nzone \"iesgn.org\" {\n    type master;\n    file \"/etc/bind/db.iesgn.org\";\n    allow-transfer { 10.0.0.10; };\n    also-notify { 10.0.0.10; };\n};\n\nzone \"0.0.10.in-addr.arpa\" {\n    type master;\n    file \"/etc/bind/db.10.0.0\";\n    allow-transfer { 10.0.0.10; };\n    also-notify { 10.0.0.10; };\n};\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-5_1","title":"Parte 5","text":"<p>Modificar la zona directa con el nuevo esclavo</p> <p><code>/etc/bind/db.iesgn.org</code>: <pre><code>$ORIGIN iesgn.org.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      adrianj.iesgn.org.\n@              IN    NS      jaramillor.iesgn.org.\n@              IN    MX  10  correo.iesgn.org.\n\nadrianj        IN    A       10.0.0.2\njaramillor     IN    A       10.0.0.10\ncorreo         IN    A       10.0.0.200\nftp            IN    A       10.0.0.201\n\ncliente1       IN    A       10.0.0.3\ncliente2       IN    A       10.0.0.4\ncliente3       IN    A       10.0.0.5\n\nwww            IN    CNAME   adrianj\ndepartamentos  IN    CNAME   adrianj\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-6_1","title":"Parte 6","text":"<p>Modificar la zona inversa con el nuevo esclavo</p> <p><code>/etc/bind/db.10.0.0</code>: <pre><code>$ORIGIN 0.0.10.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@     IN     NS     adrianj.iesgn.org.\n@     IN     NS     jaramillor.iesgn.org.\n\n2     IN     PTR    adrianj.iesgn.org.\n10    IN     PTR    jaramillor.iesgn.org.\n200   IN     PTR    correo.iesgn.org.\n201   IN     PTR    ftp.iesgn.org.\n\n3     IN     PTR    cliente1.iesgn.org.\n4     IN     PTR    cliente2.iesgn.org.\n5     IN     PTR    cliente3.iesgn.org.\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-7_1","title":"Parte 7","text":"<p>Reiniciar DNS maestro</p> <pre><code>sudo systemctl restart bind9\n</code></pre>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-8_1","title":"Parte 8","text":"<p>Modificar la definici\u00f3n de zonas del esclavo</p> <p><code>/etc/bind/named.conf.local</code>: <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\ninclude \"/etc/bind/zones.rfc1918\";\n\nzone \"iesgn.org\" {\n    type slave;\n    file \"/var/cache/bind/db.iesgn.org\";\n    masters { 10.0.0.2; };\n};\n\nzone \"0.0.10.in-addr.arpa\" {\n    type slave;\n    file \"/var/cache/bind/db.10.0.0\";\n    masters { 10.0.0.2; };\n};\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#parte-9_1","title":"Parte 9","text":"<p>Reiniciar DNS esclavo</p> <pre><code>sudo systemctl restart bind9\n</code></pre>"},{"location":"sri/ej2-instalar-configurar-slave/#ejercicio-2","title":"Ejercicio 2","text":"<p>Comprobar si los ficheros de zona del maestro tienen errores</p> <p>Verifico la zona directa: <pre><code>sudo named-checkzone iesgn.org db.iesgn.org\n</code></pre> <pre><code>zone iesgn.org/IN: loaded serial 2001062501\nOK\n</code></pre></p> <p>Verifico la zona inversa: <pre><code>sudo named-checkzone 0.0.10.in-addr.arpa db.10.0.0\n</code></pre> <pre><code>zone 0.0.10.in-addr.arpa/IN: loaded serial 2001062501\nOK\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#ejercicio-3","title":"Ejercicio 3","text":"<p>Comprobar si <code>named.conf</code> tiene errores tanto en maestro como en esclavo</p> <p>En maestro: <pre><code>sudo named-checkconf named.conf\n</code></pre></p> <p>En esclavo: <pre><code>sudo named-checkconf named.conf\n</code></pre></p>"},{"location":"sri/ej2-instalar-configurar-slave/#ejercicio-4","title":"Ejercicio 4","text":"<p>Reiniciar ambos servidores DNS</p> <pre><code>sudo systemctl restart bind9\n</code></pre> <p>Comprobar en <code>/var/log/syslog</code> si hay alg\u00fan error (incrementar n\u00famero de serie en SOA si se modifican zonas en el maestro)</p> <pre><code>sudo cat /var/log/syslog | grep named\n</code></pre> <p>No hay errores.</p>"},{"location":"sri/ej2-instalar-configurar-slave/#ejercicio-5","title":"Ejercicio 5","text":"<p>Configurar cliente para utilizar maestro y esclavo como servidores DNS</p> <p><code>/etc/resolv.conf</code>: <pre><code>nameserver 10.0.0.2\nnameserver 10.0.0.10\n</code></pre></p>"},{"location":"sri/ej2-reserva-dhcp/","title":"Ejercicio 2: Reserva DHCP","text":""},{"location":"sri/ej2-reserva-dhcp/#entrega","title":"ENTREGA","text":""},{"location":"sri/ej2-reserva-dhcp/#parte-1","title":"Parte 1","text":"<p>Crear una reserva en 192.168.0.105 para cliente2</p> <p>A\u00f1adir a <code>/etc/dhcp/dhcpd.conf</code> el siguiente bloque: <pre><code>host cliente2 {\n  hardware ethernet 52:54:00:78:7e:d7;\n  fixed-address 192.168.0.105;\n}\n</code></pre></p> <p>Hay 2 \u00fanicos campos importantes:</p> <ul> <li><code>hardware ethernet</code>: MAC de la interfaz en cliente2 a recibir la IP fija</li> <li><code>fixed-address</code>: IP fija que recibir\u00e1 cliente2</li> </ul> <p>Reiniciamos el servicio <pre><code>sudo systemctl restart isc-dhcp-server.service\n</code></pre></p>"},{"location":"sri/ej2-reserva-dhcp/#parte-2","title":"Parte 2","text":"<p>Hacer <code>ip a</code> en cliente2</p> <pre><code>3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:78:7e:d7 brd ff:ff:ff:ff:ff:ff\n    altname enp0s6\n    altname ens6\n    inet 192.168.0.105/24 brd 192.168.0.255 scope global dynamic eth1\n       valid_lft 3568sec preferred_lft 3568sec\n    inet6 fe80::5054:ff:fe78:7ed7/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre>"},{"location":"sri/ej2-reserva-dhcp/#parte-3","title":"Parte 3","text":"<p>\u00bfSe guarda una concesi\u00f3n en <code>/var/lib/dhcp/dhcpd.leases</code> para la reserva hecha?</p> <p>Como mostrar\u00e9 a continuaci\u00f3n en mi fichero: no, no se guarda. <pre><code>cat /var/lib/dhcp/dhcpd.leases\n</code></pre> <pre><code># The format of this file is documented in the dhcpd.leases(5) manual page.\n# This lease file was written by isc-dhcp-4.4.1\n\n# authoring-byte-order entry is generated, DO NOT DELETE\nauthoring-byte-order little-endian;\n\nlease 192.168.0.100 {\n  starts 1 2021/10/18 16:15:09;\n  ends 1 2021/10/18 16:28:50;\n  tstp 1 2021/10/18 16:28:50;\n  cltt 1 2021/10/18 16:15:09;\n  binding state free;\n  hardware ethernet 52:54:00:ac:7b:64;\n  uid \"\\377\\000\\254{d\\000\\001\\000\\001)\\000I\\365RT\\000\\254{d\";\n}\nlease 192.168.0.102 {\n  starts 1 2021/10/18 21:54:59;\n  ends 1 2021/10/18 22:54:59;\n  tstp 1 2021/10/18 22:54:59;\n  cltt 1 2021/10/18 21:54:59;\n  binding state active;\n  next binding state free;\n  rewind binding state free;\n  hardware ethernet 52:54:00:78:7e:d7;\n  uid \"\\377\\000x~\\327\\000\\001\\000\\001)\\000\\251\\262RT\\000x~\\327\";\n  client-hostname \"cliente2\";\n}\nlease 192.168.0.101 {\n  starts 1 2021/10/18 22:00:32;\n  ends 1 2021/10/18 23:00:32;\n  tstp 1 2021/10/18 23:00:32;\n  cltt 1 2021/10/18 22:00:32;\n  binding state active;\n  next binding state free;\n  rewind binding state free;\n  hardware ethernet 52:54:00:ac:7b:64;\n  client-hostname \"cliente\";\n}\nserver-duid \"\\000\\001\\000\\001)\\000\\255.RT\\000V\\3362\";\n\nlease 192.168.0.102 {\n  starts 1 2021/10/18 21:54:59;\n  ends 1 2021/10/18 22:24:37;\n  tstp 1 2021/10/18 22:24:37;\n  cltt 1 2021/10/18 21:54:59;\n  binding state free;\n  hardware ethernet 52:54:00:78:7e:d7;\n  uid \"\\377\\000x~\\327\\000\\001\\000\\001)\\000\\251\\262RT\\000x~\\327\";\n}\nlease 192.168.0.101 {\n  starts 1 2021/10/18 22:27:03;\n  ends 1 2021/10/18 23:27:03;\n  cltt 1 2021/10/18 22:27:03;\n  binding state active;\n  next binding state free;\n  rewind binding state free;\n  hardware ethernet 52:54:00:ac:7b:64;\n  client-hostname \"cliente\";\n}\n</code></pre></p> <p>La raz\u00f3n es que este fichero s\u00f3lo almacena las \"dynamic leases\", no las reservas.</p>"},{"location":"sri/ej2-reserva-dhcp/#escenario","title":"Escenario","text":"<p>Cambios en Vagrantfile con respecto al escenario anterior en \"ejercicio 1 DHCP\": <pre><code>config.vm.define :cliente2 do |cliente2|\n  cliente2.vm.box = \"debian/bullseye64\"\n  cliente2.vm.hostname = \"cliente2\"\n  cliente2.vm.network :private_network,\n    :libvirt__network_name =&gt; \"ej1-dhcp\",\n    :libvirt__dhcp_enabled =&gt; false,\n    :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n</code></pre></p>"},{"location":"sri/ej2-reserva-dhcp/#realizacion","title":"Realizaci\u00f3n","text":"<p>Pedir nueva configuraci\u00f3n DHCP en cliente2</p> <pre><code>sudo dhclient -r eth1\nsudo dhclient eth1\n</code></pre>"},{"location":"sri/ej2-router-nat-vagrant/","title":"ENUNCIADO","text":"<p>El escenario a crear con Vagrant debe ser el siguiente:</p> <ul> <li> <p>Router: red p\u00fablica (conectada a br0) + red privada (veryisolated). IP 10.0.0.1 en red privada.</p> </li> <li> <p>Cliente: interfaz en la misma red privada que router, IP 10.0.0.2.</p> </li> </ul>"},{"location":"sri/ej2-router-nat-vagrant/#realizacion","title":"REALIZACI\u00d3N","text":""},{"location":"sri/ej2-router-nat-vagrant/#configuracion-de-la-red-publica-kvm","title":"Configuraci\u00f3n de la red p\u00fablica KVM","text":"<p>Creaci\u00f3n del bridge, y enlace de la interfaz f\u00edsica al mismo <pre><code>sudo ip link add br0 type bridge\nsudo ip link set enp4s0 master br0\n</code></pre></p> <p>Cambios en <code>/etc/network/interfaces</code> <pre><code>###\n# Changes due to br0 public network config\n###\n\n# Specify that the physical interface that should be connected to the bridge\n# should be configured manually, to avoid conflicts with NetworkManager\n\niface enp4s0 inet manual\n\n# The br0 bridge settings\niface br0 inet dhcp\n   bridge_ports enp4s0\n</code></pre></p> <p>Levantamos el bridge <pre><code>sudo ifup br0\n</code></pre></p> <p>Estos son los cambios necesarios en el host. En el Vagrantfile a\u00f1adimos lo siguiente para que \"Router\" tenga una interfaz conectada a nuestro bridge (creando as\u00ed la interfaz p\u00fablica) <pre><code>router.vm.network :public_network,\n  :dev =&gt; \"br0\",\n  :mode =&gt; \"bridge\",\n  :type =&gt; \"bridge\"\n</code></pre></p> <p>Despu\u00e9s de hacer todo esto, deber\u00edamos tener una interfaz en \"Router\" con IP de nuestra red real. Si no consigui\u00e9ramos tener IP de la red real, tendr\u00edamos que hacer lo siguiente...</p> <ul> <li>En vagrant (una de las 2 opciones): <pre><code>vagrant destroy router\nvagrant reload router\n</code></pre></li> <li>En nuestro host <pre><code>sudo systemctl restart networking\n</code></pre></li> </ul>"},{"location":"sri/ej2-router-nat-vagrant/#entrega","title":"ENTREGA","text":""},{"location":"sri/ej2-router-nat-vagrant/#vagrantfile","title":"Vagrantfile","text":"<pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :router do |router|\n    router.vm.box = \"debian/bullseye64\"\n    router.vm.hostname = \"router\"\n    router.vm.network :public_network,\n      :dev =&gt; \"br0\",\n      :mode =&gt; \"bridge\",\n      :type =&gt; \"bridge\"\n    router.vm.network :private_network,\n      :libvirt__network_name =&gt; \"interna\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.1\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :cliente do |cliente|\n    cliente.vm.box = \"debian/bullseye64\"\n    cliente.vm.hostname = \"cliente\"\n    cliente.vm.network :private_network,\n      :libvirt__network_name =&gt; \"interna\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre>"},{"location":"sri/ej2-router-nat-vagrant/#screenshot-con-ping-cliente-router","title":"Screenshot con ping cliente -&gt; router","text":"<p>Si queremos estar incluso m\u00e1s seguros de que el enlace funciona como deber\u00eda, hacemos lo siguiente </p> <p>As\u00ed nos aseguramos de que llegamos al destino por donde deber\u00eda, y no siguiendo un camino alternativo.</p>"},{"location":"sri/ej3-apache-.htaccess/","title":"Ejercicio 3: Configuraci\u00f3n de Apache mediante .htaccess","text":""},{"location":"sri/ej3-apache-.htaccess/#entrega","title":"ENTREGA","text":""},{"location":"sri/ej3-apache-.htaccess/#parte-1","title":"Parte 1","text":"<p>Captura del acceso a <code>ej3-apache-htaccess.x10host.com/nas</code></p> <p></p>"},{"location":"sri/ej3-apache-.htaccess/#parte-2","title":"Parte 2","text":"<p>Entregar captura donde se muestre la redirecci\u00f3n de <code>ej3-apache-htaccess.x10host.com/google</code> a <code>www.google.es</code></p> <p></p>"},{"location":"sri/ej3-apache-.htaccess/#parte-3","title":"Parte 3","text":"<p>Mostrar que funciona la autenticaci\u00f3n en <code>ej3-apache-htaccess.x10host.com/prohibido</code></p> <p></p>"},{"location":"sri/ej3-apache-.htaccess/#ejercicios","title":"EJERCICIOS","text":""},{"location":"sri/ej3-apache-.htaccess/#ejercicio-0","title":"Ejercicio 0","text":"<p>Si necesitamos configurar el servidor web del hosting, \u00bfqu\u00e9 podemos hacer?</p> <p>Usar ficheros <code>.htaccess</code> donde los necesitemos (se pueden usar varios en un mismo VirtualHost, pero siempre 1 s\u00f3lo por directorio).</p> <p>\u00bfPara qu\u00e9 sirve la directiva AllowOverride de Apache?</p> <p>Permite el uso de ficheros <code>.htaccess</code> para sobreescribir la configuraci\u00f3n de Apache a partir de un directorio espec\u00edfico.</p>"},{"location":"sri/ej3-apache-.htaccess/#ejercicio-1","title":"Ejercicio 1","text":"<p>Habilitar Indexes en la URL <code>ej3-apache-htaccess.x10host.com/nas</code></p> <p>Creo el fichero <code>/domains/ej3-apache-htaccess.x10host.com/public_html/nas/.htaccess</code> con el contenido: <pre><code>Options +Indexes\n</code></pre></p> <p>Muestro que funciona:</p> <p></p>"},{"location":"sri/ej3-apache-.htaccess/#ejercicio-2","title":"Ejercicio 2","text":"<p>Crear una redirecci\u00f3n permanente para <code>ej3-apache-htaccess.x10host.com/google</code> a <code>www.google.es</code></p> <p>Creo el fichero <code>/domains/ej3-apache-htaccess.x10host.com/public_html/.htaccess</code> con el contenido: <pre><code>RedirectPermanent /google https://www.google.es/\n</code></pre></p> <p>Muestro que funciona:</p> <p></p>"},{"location":"sri/ej3-apache-.htaccess/#ejercicio-3","title":"Ejercicio 3","text":"<p>Pedir autenticaci\u00f3n en <code>ej3-apache-htaccess.x10host.com/prohibido</code></p> <p>Creo el fichero <code>/domains/ej3-apache-htaccess.x10host.com/public_html/prohibido/.htpasswd</code>: <pre><code>admin:$apr1$qh75ojvl$AhjZXOFVsd.5.zRlmVGDj0\n</code></pre></p> <p>El contenido est\u00e1 generado con https://hostingcanada.org/htpasswd-generator/.  </p> <p>Importante usar el modo \"Apache specific salted MD5\", los m\u00e1s avanzados no funcionan con x10hosting.</p> <p>Las credenciales de acceso que he creado son:</p> <ul> <li>Username: admin</li> <li>Password: admin</li> </ul> <p>Creo el fichero <code>/domains/ej3-apache-htaccess.x10host.com/public_html/prohibido/.htaccess</code> con el contenido: <pre><code>AuthType Basic\nAuthName \"Access restricted\"\nAuthUserFile .htpasswd\nRequire valid-user\n</code></pre></p> <p>Muestro que funciona:</p> <p></p>"},{"location":"sri/ej3-config-escenario-router-nat/","title":"EJ3: Configuraci\u00f3n del escenario router-nat","text":""},{"location":"sri/ej3-config-escenario-router-nat/#entrega","title":"ENTREGA","text":""},{"location":"sri/ej3-config-escenario-router-nat/#parte-1","title":"Parte 1","text":"<p>Desde cliente hacer traceroute a nombre de una web</p> <pre><code>vagrant@cliente:~$ traceroute www.example.org\ntraceroute to www.example.org (93.184.216.34), 30 hops max, 60 byte packets\n 1  10.0.0.1 (10.0.0.1)  0.542 ms  0.459 ms  0.499 ms\n 2  Livebox (192.168.1.1)  14.445 ms  14.415 ms  16.238 ms\n 3  90.163.182.30 (90.163.182.30)  22.066 ms  22.038 ms  24.943 ms\n 4  10.255.120.1 (10.255.120.1)  33.108 ms  33.069 ms  29.791 ms\n 5  10.34.142.58 (10.34.142.58)  32.956 ms 10.34.142.62 (10.34.142.62)  40.640 ms  40.567 ms\n 6  10.34.149.130 (10.34.149.130)  45.527 ms  17.344 ms 10.34.149.134 (10.34.149.134)  19.203 ms\n 7  10.34.206.61 (10.34.206.61)  17.103 ms  25.263 ms  25.178 ms\n 8  bundle-ether101-14.madtr6.madrid.opentransit.net (193.251.249.1)  32.250 ms bundle-ether104-14.madtr5.madrid.opentransit.net (193.251.247.13)  37.302 ms  32.108 ms\n 9  telia-8.gw.opentransit.net (193.251.150.76)  32.050 ms\n 193.251.129.16 (193.251.129.16)  39.332 ms telia-8.gw.opentransit.net (193.251.150.76)  37.063 ms\n10  prs-bb2-link.ip.twelve99.net (62.115.123.220)  131.479 ms  135.389 ms  137.604 ms\n11  prs-bb2-link.ip.twelve99.net (62.115.123.220)  139.376 ms  143.863 ms ash-bb2-link.ip.twelve99.net (62.115.112.242)  120.468 ms\n12  rest-bb1-link.ip.twelve99.net (62.115.122.159)  112.756 ms ash-b2-link.ip.twelve99.net (62.115.123.125)  135.059 ms ash-b2-link.ip.twelve99.net (62.115.123.123)  114.004 ms\n13  ash-b2-link.ip.twelve99.net (62.115.123.125)  125.977 ms ash-b2-link.ip.twelve99.net (62.115.123.123)  118.836 ms verizon-ic342246-ash-b2.ip.twelve99-cust.net (62.115.175.71)  125.925 ms\n14  verizon-ic-315152-ash-b1.ip.twelve99-cust.net (213.248.83.119)  128.754 ms  128.715 ms ae-66.core1.dcb.edgecastcdn.net (152.195.65.129)  128.692 ms\n15  ae-65.core1.dcb.edgecastcdn.net (152.195.64.129)  135.092 ms ae-66.core1.dcb.edgecastcdn.net (152.195.65.129)  134.537 ms  128.926 ms\n16  www.example.org (93.184.216.34)  134.311 ms  146.229 ms  139.666 ms\n</code></pre>"},{"location":"sri/ej3-config-escenario-router-nat/#parte-2","title":"Parte 2","text":"<p>Screenshot accediendo por ssh a las dos m\u00e1quinas con las condiciones:</p> <ul> <li>Nunca por eth0</li> <li>Configurar las conexiones directas en ~/.ssh/config</li> </ul> <p>Elijo la manera de acceso a\u00f1adiendo mi clave ssh p\u00fablica personal a ambas m\u00e1quinas.</p> <p>He escrito lo siguiente en <code>~/.ssh/config</code> <pre><code># Conexiones ej3 config escenario router nat\nHost router\n    HostName 192.168.1.132\n    User vagrant\n\nHost cliente\n  HostName 10.0.0.2\n  User vagrant\n  ProxyJump router\n</code></pre></p> <p>Accedo a router: </p> <p>Accedo a cliente: </p>"},{"location":"sri/ej3-config-escenario-router-nat/#parte-3","title":"Parte 3","text":"<p>Integrar el playbook de ansible en vagrant. Ense\u00f1ar funcionamiento a profesor.</p> <p>En el Vagrantfile, he a\u00f1adido lo siguiente: <pre><code>config.vm.provision \"ansible\" do |ansible|\n  ansible.playbook = \"/home/atlas/Desktop/servicios/ud1-vagrant-ansible/ej3-config-escenario-router-nat/site.yaml\"\nend\n</code></pre></p>"},{"location":"sri/ej3-config-escenario-router-nat/#realizacion","title":"REALIZACI\u00d3N","text":"<p>Crear playbook en ansible con los roles...</p>"},{"location":"sri/ej3-config-escenario-router-nat/#common","title":"Common","text":"<p>Actualizar paquetes en ambos nodos</p> <pre><code>- name: Actualizando paquetes...\n  become: yes\n  apt: update_cache=yes upgrade=yes\n</code></pre>"},{"location":"sri/ej3-config-escenario-router-nat/#router","title":"Router","text":"<p>Convertir en router-nat y cambiar salida por eth1. Ambas configuraciones deben ser persistentes.</p> <pre><code>###\n# Parte router-nat\n###\n\n# M\u00f3dulo iptable_nat\n\n- name: Cargando el m\u00f3dulo iptable_nat...\n  modprobe:\n    name: iptable_nat\n    state: present\n\n- name: Haciendo iptable_nat persistente...\n  lineinfile:\n    path: /etc/modules\n    line: iptable_nat\n\n# Forwarding\n#\n# Necesario instalar plugin:\n# ansible-galaxy collection install ansible.posix\n\n- name: Habilitando ipv4 forwarding (persistente)...\n  ansible.posix.sysctl:\n    name: net.ipv4.ip_forward\n    value: '1'\n    sysctl_set: yes\n\n# Esta acci\u00f3n a\u00f1ade un 1 al fichero\n# /proc/sys/net/ipv4/ip_forward\n#\n# Tambi\u00e9n modifica el fichero\n# /etc/sysctl.conf\n#\n# y as\u00ed los cambios son persistentes\n\n# Iptables\n\n- name: A\u00f1adiendo regla iptable SNAT...\n  command: iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o eth1 -j MASQUERADE\n\n- name: Instalando iptables-persistent...\n  apt:\n    name: iptables-persistent\n\n# Las reglas que hubiera, se guardan en /etc/iptables/rules.v4\n# Este fichero se carga autom\u00e1ticamente en boot\n\n###\n# Parte rutas\n###\n\n- name: Borrando ruta por defecto...\n  command: ip route del default\n\n- name: A\u00f1adiendo nueva ruta por defecto...\n  command: ip route add default via 192.168.1.1\n\n- name: Haciendo la ruta por defecto persistente...\n  copy:\n    src: interfaces-router\n    dest: /etc/network/interfaces\n    owner: root\n    group: root\n    mode: u=rw,g=r,o=r\n</code></pre>"},{"location":"sri/ej3-config-escenario-router-nat/#cliente","title":"Cliente","text":"<p>Cambiar salida por eth1 y que sea persistente</p> <pre><code>- name: Borrando ruta por defecto...\n  command: ip route del default\n\n- name: A\u00f1adiendo nueva ruta por defecto...\n  command: ip route add default via 10.0.0.1\n\n- name: Haciendo la ruta por defecto persistente...\n  copy:\n    src: interfaces-cliente\n    dest: /etc/network/interfaces\n    owner: root\n    group: root\n    mode: u=rw,g=r,o=r\n</code></pre>"},{"location":"sri/ej3-delegacion-subdominio-bind9/","title":"Ejercicio 3: Delegaci\u00f3n de subdominios con bind9","text":""},{"location":"sri/ej3-delegacion-subdominio-bind9/#entrega","title":"Entrega","text":"<p>Realizar las siguientes consultas desde cliente.</p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#parte-1","title":"Parte 1","text":"<p><pre><code>dig www.informatica.iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; www.informatica.iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45194\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 4b05b345b807917401000000619ad9b4073217deccc47a09 (good)\n;; QUESTION SECTION:\n;www.informatica.iesgn.org. IN  A\n\n;; ANSWER SECTION:\nwww.informatica.iesgn.org. 86400 IN CNAME   sweb.informatica.iesgn.org.\nsweb.informatica.iesgn.org. 86400 IN    A   10.0.0.52\n\n;; Query time: 96 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Sun Nov 21 23:43:48 UTC 2021\n;; MSG SIZE  rcvd: 117\n</code></pre></p> <p><pre><code>dig ftp.informatica.iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; ftp.informatica.iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 31505\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 7897922eed5f0acb01000000619ada1198bb5211fb4cf940 (good)\n;; QUESTION SECTION:\n;ftp.informatica.iesgn.org. IN  A\n\n;; ANSWER SECTION:\nftp.informatica.iesgn.org. 86400 IN CNAME   sweb.informatica.iesgn.org.\nsweb.informatica.iesgn.org. 86307 IN    A   10.0.0.52\n\n;; Query time: 4 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Sun Nov 21 23:45:21 UTC 2021\n;; MSG SIZE  rcvd: 117\n</code></pre></p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#parte-2","title":"Parte 2","text":"<p><pre><code>dig NS informatica.iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; NS informatica.iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 48818\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 0056b02be3bb838301000000619adae91b06c7f48ca54b49 (good)\n;; QUESTION SECTION:\n;informatica.iesgn.org.     IN  NS\n\n;; ANSWER SECTION:\ninformatica.iesgn.org.  86400   IN  NS  adrianj-ns.informatica.iesgn.org.\n\n;; Query time: 4 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Sun Nov 21 23:48:57 UTC 2021\n;; MSG SIZE  rcvd: 103\n</code></pre></p> <p>\u00bfEs el mismo que el servidor DNS con autoridad para la zona <code>iesgn.org</code>?</p> <p><pre><code>dig NS iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; NS iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 36865\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 3\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 7a0344b5113fcb0b01000000619adb55de76d31d7232e8de (good)\n;; QUESTION SECTION:\n;iesgn.org.         IN  NS\n\n;; ANSWER SECTION:\niesgn.org.      86400   IN  NS  adrianj.iesgn.org.\niesgn.org.      86400   IN  NS  jaramillor.iesgn.org.\n\n;; ADDITIONAL SECTION:\nadrianj.iesgn.org.  86400   IN  A   10.0.0.2\njaramillor.iesgn.org.   86400   IN  A   10.0.0.10\n\n;; Query time: 0 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Sun Nov 21 23:50:45 UTC 2021\n;; MSG SIZE  rcvd: 145\n</code></pre></p> <p>No, no son los mismos servidores DNS.</p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#parte-3","title":"Parte 3","text":"<p><pre><code>dig MX informatica.iesgn.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; MX informatica.iesgn.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 22488\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 838d443349ddf15a01000000619adbeb9351de6157a5e8fa (good)\n;; QUESTION SECTION:\n;informatica.iesgn.org.     IN  MX\n\n;; ANSWER SECTION:\ninformatica.iesgn.org.  86400   IN  MX  10 correo.informatica.iesgn.org.\n\n;; Query time: 4 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Sun Nov 21 23:53:15 UTC 2021\n;; MSG SIZE  rcvd: 101\n</code></pre></p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#realizacion","title":"Realizaci\u00f3n","text":"<p>Este ejercicio parte del escenario usado en Ejercicio 2: Slave DNS.</p> <p>Se delegar\u00e1 el subdominio <code>informatica.iesgn.org</code> a <code>adrianj-ns.informatica.iesgn.org</code> (se encuentra en otra m\u00e1quina)</p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#ejercicio-1","title":"Ejercicio 1","text":"<p>A\u00f1adir otra m\u00e1quina al escenario del ej2, para instalar ah\u00ed el DNS al que delegaremos el subdominio</p> <p><code>Vagrantfile</code>: <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :server do |server|\n    server.vm.box = \"debian/bullseye64\"\n    server.vm.hostname = \"server\"\n    server.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :cliente do |cliente|\n    cliente.vm.box = \"debian/bullseye64\"\n    cliente.vm.hostname = \"cliente\"\n    cliente.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.3\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :slavedns do |slavedns|\n    slavedns.vm.box = \"debian/bullseye64\"\n    slavedns.vm.hostname = \"slavedns\"\n    slavedns.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.10\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :subdominio do |subdominio|\n    subdominio.vm.box = \"debian/bullseye64\"\n    subdominio.vm.hostname = \"subdominio\"\n    subdominio.vm.network :private_network,\n      :libvirt__network_name =&gt; \"ej1bind9\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.50\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre></p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#ejercicio-2","title":"Ejercicio 2","text":"<p>Cambiar el hostname de <code>subdominio</code> a: <code>adrianj-ns.informatica.iesgn.org</code></p> <p>Modifico <code>/etc/hostname</code>: <pre><code>vagrant@subdominio:~$ cat /etc/hostname\nadrianj-ns\n</code></pre></p> <p>Hago que el cambio de hostname tome efecto ahora: <pre><code>sudo hostname adrianj-ns\n</code></pre></p> <p>Verifico: <pre><code>vagrant@subdominio:~$ hostname\nadrianj-ns\n</code></pre></p> <p>Actualizo el prompt: <pre><code>vagrant@subdominio:~$ bash\nvagrant@adrianj-ns:~$\n</code></pre></p> <p>Modifico <code>/etc/hosts</code>: <pre><code>127.0.0.1   localhost\n127.0.0.2   bullseye\n::1     localhost ip6-localhost ip6-loopback\nff02::1     ip6-allnodes\nff02::2     ip6-allrouters\n\n127.0.1.1 adrianj-ns.informatica.iesgn.org adrianj-ns\n</code></pre></p> <p>Compruebo nombre largo: <pre><code>vagrant@adrianj-ns:~$ hostname -f\nadrianj-ns.informatica.iesgn.org\n</code></pre></p> <p>Compruebo nombre corto: <pre><code>vagrant@adrianj-ns:~$ ping adrianj-ns -c 1\nPING adrianj-ns.informatica.iesgn.org (127.0.1.1) 56(84) bytes of data.\n64 bytes from adrianj-ns.informatica.iesgn.org (127.0.1.1): icmp_seq=1 ttl=64 time=0.015 ms\n\n--- adrianj-ns.informatica.iesgn.org ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.015/0.015/0.015/0.000 ms\n</code></pre></p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#ejercicio-3","title":"Ejercicio 3","text":"<p>Instalar <code>bind9</code></p> <pre><code>sudo apt update\nsudo apt install bind9\n</code></pre>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#ejercicio-4","title":"Ejercicio 4","text":"<p>A\u00f1adir la delegaci\u00f3n de <code>informatica.iesgn.org</code> en <code>adrianj.iesgn.org</code></p> <p><code>db.iesgn.org</code>: <pre><code>$ORIGIN iesgn.org.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062505 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      adrianj.iesgn.org.\n@              IN    NS      jaramillor.iesgn.org.\n@              IN    MX  10  correo.iesgn.org.\n\nadrianj        IN    A       10.0.0.2\njaramillor     IN    A       10.0.0.10\ncorreo         IN    A       10.0.0.200\nftp            IN    A       10.0.0.201\n\ncliente1       IN    A       10.0.0.3\ncliente2       IN    A       10.0.0.4\ncliente3       IN    A       10.0.0.6\ncliente4       IN    A       10.0.0.7\n\nwww            IN    CNAME   adrianj\ndepartamentos  IN    CNAME   adrianj\n\n; Definici\u00f3n de subdominio\n\n$ORIGIN informatica.iesgn.org.\n@              IN    NS      adrianj-ns.informatica.iesgn.org.\nadrianj-ns     IN    A       10.0.0.50 ; glue record\n</code></pre></p> <p>Reinicio: <pre><code>sudo systemctl restart bind9\n</code></pre></p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#ejercicio-5","title":"Ejercicio 5","text":"<p>Definir la zona <code>informatica.iesgn.org</code> en <code>adrianj-ns</code></p> <p><code>named.conf.local</code>: <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\n// include \"/etc/bind/zones.rfc1918\";\n\nzone \"informatica.iesgn.org\" {\n    type master;\n    file \"/etc/bind/db.informatica.iesgn.org\";\n};\n</code></pre></p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#ejercicio-6","title":"Ejercicio 6","text":"<p>Definir zona directa para <code>informatica.iesgn.org</code></p> <p><code>db.informatica.iesgn.org</code>: <pre><code>$ORIGIN informatica.iesgn.org.\n$TTL 86400\n@     IN     SOA    adrianj-ns.informatica.iesgn.org.     admin.informatica.iesgn.org. (\n                    2001062505 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      adrianj-ns.informatica.iesgn.org.\n@              IN    MX  10  correo.informatica.iesgn.org.\n\nadrianj-ns     IN    A       10.0.0.50\ncorreo         IN    A       10.0.0.51\nsweb           IN    A       10.0.0.52\n\nwww            IN    CNAME   sweb\nftp            IN    CNAME   sweb\n</code></pre></p> <p>Reinicio: <pre><code>sudo systemctl restart bind9\n</code></pre></p>"},{"location":"sri/ej3-delegacion-subdominio-bind9/#ejercicio-7","title":"Ejercicio 7","text":"<p>Actualizar la zona inversa en <code>adrianj.iesgn.org</code> con las nuevas m\u00e1quinas del subdominio</p> <p><code>db.10.0.0</code>: <pre><code>$ORIGIN 0.0.10.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    adrianj.iesgn.org.     admin.iesgn.org. (\n                    2001062502 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@     IN     NS     adrianj.iesgn.org.\n@     IN     NS     jaramillor.iesgn.org.\n\n2     IN     PTR    adrianj.iesgn.org.\n10    IN     PTR    jaramillor.iesgn.org.\n200   IN     PTR    correo.iesgn.org.\n201   IN     PTR    ftp.iesgn.org.\n\n3     IN     PTR    cliente1.iesgn.org.\n4     IN     PTR    cliente2.iesgn.org.\n6     IN     PTR    cliente3.iesgn.org.\n\n; M\u00e1quinas del subdominio\n\n50    IN     PTR    adrianj-ns.informatica.iesgn.org.\n51    IN     PTR    correo.informatica.iesgn.org.\n52    IN     PTR    sweb.informatica.iesgn.org.\n</code></pre></p> <p>Reinicio: <pre><code>sudo systemctl restart bind9\n</code></pre></p>"},{"location":"sri/ej4-modulos-apache/","title":"Ejercicio 4: M\u00f3dulos en Apache","text":""},{"location":"sri/ej4-modulos-apache/#mod_userdir","title":"mod_userdir","text":"<p>Este m\u00f3dulo permite que cada usuario aloje su web en un directorio (<code>public_html</code> por defecto).</p>"},{"location":"sri/ej4-modulos-apache/#entrega","title":"Entrega","text":""},{"location":"sri/ej4-modulos-apache/#parte-1","title":"Parte 1","text":"<p>Mostrar la configuraci\u00f3n de <code>mod_userdir</code> donde se vea el cambio de nombre del directorio <code>public_html</code> por <code>sitio_web</code></p> <p>Modifico <code>/etc/apache2/mods-available/userdir.conf</code>: <pre><code>&lt;IfModule mod_userdir.c&gt;\n    UserDir sitio_web\n    UserDir disabled root\n\n    &lt;Directory /home/*/sitio_web&gt;\n        AllowOverride FileInfo AuthConfig Limit Indexes\n        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec\n        Require method GET POST OPTIONS\n    &lt;/Directory&gt;\n&lt;/IfModule&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre></p>"},{"location":"sri/ej4-modulos-apache/#parte-2","title":"Parte 2","text":"<p>Captura donde se vea el acceso a la p\u00e1gina personal de <code>vagrant</code></p> <p></p>"},{"location":"sri/ej4-modulos-apache/#ejercicios","title":"Ejercicios","text":""},{"location":"sri/ej4-modulos-apache/#ejercicio-1","title":"Ejercicio 1","text":"<p>Activar el m\u00f3dulo</p> <pre><code>sudo a2enmod userdir\n</code></pre> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Comprobar su funcionamiento</p> <p>Creo el directorio necesario para el usuario <code>vagrant</code>: <pre><code>mkdir ~/public_html\n</code></pre></p> <p>Me bajo un <code>index.html</code> de prueba en ese directorio: <pre><code>wget https://gist.githubusercontent.com/chrisvfritz/bc010e6ed25b802da7eb/raw/18eaa48addae7e3021f6bcea03b7a6557e3f0132/index.html\n</code></pre></p> <p>Lo edito un poco para que se adapte a mi escenario.</p> <p>Muestro que puedo acceder:</p> <p></p>"},{"location":"sri/ej4-modulos-apache/#ejercicio-2","title":"Ejercicio 2","text":"<p>Mostrar la configuraci\u00f3n por defecto de <code>mod_userdir</code></p> <p><code>/etc/apache2/mods-available/userdir.conf</code>: <pre><code>&lt;IfModule mod_userdir.c&gt;\n    UserDir public_html\n    UserDir disabled root\n\n    &lt;Directory /home/*/public_html&gt;\n        AllowOverride FileInfo AuthConfig Limit Indexes\n        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec\n        Require method GET POST OPTIONS\n    &lt;/Directory&gt;\n&lt;/IfModule&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre></p>"},{"location":"sri/ej4-modulos-apache/#ejercicio-3","title":"Ejercicio 3","text":"<p>Cambiar el nombre de directorio <code>public_html</code> por <code>sitio_web</code></p> <p>Modifico <code>/etc/apache2/mods-available/userdir.conf</code>: <pre><code>&lt;IfModule mod_userdir.c&gt;\n    UserDir sitio_web\n    UserDir disabled root\n\n    &lt;Directory /home/*/sitio_web&gt;\n        AllowOverride FileInfo AuthConfig Limit Indexes\n        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec\n        Require method GET POST OPTIONS\n    &lt;/Directory&gt;\n&lt;/IfModule&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre></p> <p>Renombro el antiguo directorio con el nuevo nombre: <pre><code>mv public_html/ sitio_web\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p>"},{"location":"sri/ej4-modulos-apache/#ejercicio-4","title":"Ejercicio 4","text":"<p>Mostrar que la web sigue funcionando despu\u00e9s del cambio de nombre al directorio</p> <p></p>"},{"location":"sri/ej4-modulos-apache/#mod_rewrite","title":"mod_rewrite","text":""},{"location":"sri/ej4-modulos-apache/#entrega_1","title":"Entrega","text":""},{"location":"sri/ej4-modulos-apache/#parte-1_1","title":"Parte 1","text":"<p>Entregar la regla de reescritura configurada</p> <p>Creo el fichero <code>/var/www/html/php/.htaccess</code> con el siguiente contenido: <pre><code>Options FollowSymLinks\nRewriteEngine On\nRewriteBase /php/\nRewriteRule ^([A-Za-z]+)/([0-9]+)$ index.php?monto=$2&amp;pais=$1\n</code></pre></p>"},{"location":"sri/ej4-modulos-apache/#parte-2_1","title":"Parte 2","text":"<p>Captura donde se vea el acceso a <code>www.conversordemoneda.com/php/moneda/cantidad</code></p> <p></p>"},{"location":"sri/ej4-modulos-apache/#ejercicios_1","title":"Ejercicios","text":""},{"location":"sri/ej4-modulos-apache/#ejercicio-1_1","title":"Ejercicio 1","text":"<p>Crear directorio <code>php</code> en el <code>DocumentRoot</code> por defecto</p> <pre><code>sudo mkdir /var/www/html/php\n</code></pre>"},{"location":"sri/ej4-modulos-apache/#ejercicio-2_1","title":"Ejercicio 2","text":"<p>A\u00f1adir el conversor de monedas al directorio <code>php</code></p> <p>Creo <code>/var/www/html/php/index.php</code> con el siguiente contenido: <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"es\"&gt;  \n  &lt;head&gt;    \n    &lt;title&gt;Conversor de Monedas&lt;/title&gt;    \n    &lt;meta charset=\"UTF-8\"&gt;\n  &lt;/head&gt;  \n  &lt;body&gt;    \n    &lt;form action=\"index.php\" method=\"get\"&gt;\n        &lt;input type=\"text\" size=\"30\" name=\"monto\" /&gt;&lt;br/&gt;\n        &lt;select name=\"pais\"&gt;\n            &lt;option name=\"Dolar\"&gt;Dolar&lt;/option&gt;\n            &lt;option name=\"Libra\"&gt;Libra&lt;/option&gt;\n            &lt;option name=\"Yen\"&gt;Yen&lt;/option&gt;\n        &lt;/select&gt;\n        &lt;input type=\"submit\" value=\"convertir\" /&gt;\n       &lt;/form&gt;\n    &lt;?php\n        // averiguamos si se ha introducido un dinero\n        if (isset($_GET['monto'])) {\n          define (\"cantidad\", $_GET['monto']);\n        } else {\n          define (\"cantidad\", 0);\n        }\n        if($_GET){\n        // definimos los pa\u00edses\n        $tasacambios = array (\"Libra\"=&gt;0.86,\"Dolar\"=&gt;1.34,\"Yen\"=&gt;103.56);\n        // imprimimos el monto ingresado\n        echo \"&lt;b&gt;\".cantidad.\" euros&lt;/b&gt;&lt;br/&gt; \".$_GET[\"pais\"].\" = \".cantidad*$tasacambios[$_GET[\"pais\"]];\n        }\n       ?&gt;\n    &lt;/body&gt;\n    &lt;/html&gt;\n</code></pre></p>"},{"location":"sri/ej4-modulos-apache/#ejercicio-3_1","title":"Ejercicio 3","text":"<p>Modificar el VirtualHost por defecto para que se acceda por nombre</p> <p>Modifico <code>/etc/apache2/sites-available/000-default.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n\n    ServerName www.conversordemoneda.com\n    DocumentRoot /var/www/html\n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Modifico mi <code>/etc/hosts</code>: <pre><code># ej4-modulos-apache\n192.168.121.204 www.conversordemoneda.com\n</code></pre></p>"},{"location":"sri/ej4-modulos-apache/#ejercicio-4_1","title":"Ejercicio 4","text":"<p>Hacer que Apache funcione con php</p> <pre><code>sudo apt install php\n</code></pre>"},{"location":"sri/ej4-modulos-apache/#ejercicio-5","title":"Ejercicio 5","text":"<p>Probar que el conversor funciona, primero, sin utilizar rewrite</p> <p>Hago la prueba con: <code>www.conversordemoneda.com/php/index.php?monto=100&amp;pais=Libra</code>:</p> <p></p>"},{"location":"sri/ej4-modulos-apache/#ejercicio-6","title":"Ejercicio 6","text":"<p>Configurar <code>mod_rewrite</code> para que modificando un <code>.htaccess</code>, se pueda acceder a <code>www.conversordemoneda.com/php/moneda/cantidad</code> (moneda=Dolar,Libra,Yen cantidad=euros a convertir)</p> <p>Activo el m\u00f3dulo: <pre><code>sudo a2enmod rewrite\n</code></pre></p> <p>Habilitar ficheros <code>.htaccess</code> en <code>/etc/apache2/apache2.conf</code> para el VirtualHost por defecto: <pre><code>&lt;Directory /var/www/&gt;\n        Options Indexes FollowSymLinks\n        AllowOverride All\n        Require all granted\n&lt;/Directory&gt;\n</code></pre></p> <p>Creo el fichero <code>/var/www/html/php/.htaccess</code> con el siguiente contenido: <pre><code>Options FollowSymLinks\nRewriteEngine On\nRewriteBase /php/\nRewriteRule ^([A-Za-z]+)/([0-9]+)$ index.php?monto=$2&amp;pais=$1\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Muestro que funciona:</p> <p></p>"},{"location":"sri/ej5-vps/","title":"Ejercicio 5: Contrataci\u00f3n y configuraci\u00f3n de un VPS","text":""},{"location":"sri/ej5-vps/#entrega","title":"ENTREGA","text":"<p>Nombre completo de la m\u00e1quina, para que se pueda acceder con el usuario profesor</p> <pre><code>kampe.adrianjaramillo.tk\n</code></pre>"},{"location":"sri/ej5-vps/#configuracion-del-vps","title":"CONFIGURACI\u00d3N DEL VPS","text":""},{"location":"sri/ej5-vps/#paso-1","title":"Paso 1","text":"<p>Modificar hostname</p> <p>Editamos el fichero <code>/etc/hostname</code>: <pre><code>root@localhost:~# cat /etc/hostname\nkampe\n</code></pre></p> <p>Este cambio tomar\u00e1 lugar al reiniciar, pero si no queremos hacerlo, ejecutamos: <pre><code>sudo hostname kampe\n</code></pre></p> <p>Este comando es temporal, lo que hace el cambio permanente realmente es haber editado previamente el fichero <code>/etc/hostname</code>.</p> <p>Verificamos que el cambio ha surtido efecto: <pre><code>root@localhost:~# hostname\nkampe\n</code></pre></p> <p>El hostname ha cambiado pero nuestro prompt no. Esto se debe a que la shell en la que nos encontramos se encuentra \"desactualizada\" por as\u00ed decirlo.</p> <p>Para arreglar esto, simplemente abrimos una nueva shell y ya deber\u00edamos de tener nuestro hostname actualizado en el prompt: <pre><code>root@localhost:~# bash\nroot@kampe:~#\n</code></pre></p> <p>Cambiar FQDN de la m\u00e1quina a <code>kampe.adrianjaramillo.tk</code></p> <p>Modifico <code>/etc/hosts</code> de la siguiente manera: <pre><code>127.0.0.1       localhost.localdomain localhost\n\n87.106.228.149 kampe.adrianjaramillo.tk kampe\n\n# The following lines are desirable for IPv6 capable hosts\n::1     localhost ip6-localhost ip6-loopback\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n</code></pre></p> <p>Comprobar el funcionamiento haciendo <code>hostname -f</code></p> <pre><code>root@kampe:~# hostname -f\nkampe.adrianjaramillo.tk\n</code></pre> <p>Compruebo el nombre corto</p> <pre><code>blackmamba@kampe:~$ ping kampe\nPING kampe.adrianjaramillo.tk (87.106.228.149) 56(84) bytes of data.\n64 bytes from kampe.adrianjaramillo.tk (87.106.228.149): icmp_seq=1 ttl=64 time=0.021 ms\n64 bytes from kampe.adrianjaramillo.tk (87.106.228.149): icmp_seq=2 ttl=64 time=0.040 ms\n^C\n--- kampe.adrianjaramillo.tk ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1010ms\nrtt min/avg/max/mdev = 0.021/0.030/0.040/0.009 ms\n</code></pre>"},{"location":"sri/ej5-vps/#paso-2","title":"Paso 2","text":"<p>Crear usuario normal, con contrase\u00f1a robusta</p> <pre><code>adduser blackmamba\n</code></pre> <p>Su password es: <code>?UdLbQ?*3'd6)@C3</code></p> <p>Habilitar sudo para <code>blackmamba</code></p> <pre><code>usermod -aG sudo blackmamba\n</code></pre> <p>Habilitar sudo sin contrase\u00f1a para <code>blackmamba</code></p> <p>A\u00f1adir lo siguiente en <code>/etc/sudoers</code>: <pre><code>blackmamba     ALL=(ALL) NOPASSWD:ALL\n</code></pre></p> <p>Importante que se a\u00f1ada al final del fichero.</p> <p>Pasar mi clave p\u00fablica SSH a <code>blackmamba</code></p> <pre><code>ssh-copy-id blackmamba@kampe.adrianjaramillo.tk\n</code></pre> <p>Cambiar los siguientes par\u00e1metros en <code>/etc/ssh/sshd_config</code></p> <pre><code>ChallengeResponseAuthentication no\nPasswordAuthentication no\nUsePAM no\nPermitRootLogin no\nPermitRootLogin prohibit-password\n</code></pre> <p>Reiniciar ssh</p> <pre><code>sudo systemctl restart ssh\n</code></pre> <p>Comprobar que no se puede acceder como root</p> <pre><code>atlas@olympus:~$ ssh root@kampe.adrianjaramillo.tk\nroot@kampe.adrianjaramillo.tk: Permission denied (publickey).\n</code></pre>"},{"location":"sri/ej5-vps/#paso-3","title":"Paso 3","text":"<p>Crear registro DNS tipo A con el nombre de la m\u00e1quina y la IP p\u00fablica asociada</p> <p></p> <p>Comprobar que la resoluci\u00f3n funciona</p> <p><pre><code>dig kampe.adrianjaramillo.tk\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; kampe.adrianjaramillo.tk\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 43729\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 9\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n; COOKIE: 5a78a81a29a907cc4f5f5213617bcc35d6b26dd93853c9e2 (good)\n;; QUESTION SECTION:\n;kampe.adrianjaramillo.tk.  IN  A\n\n;; ANSWER SECTION:\nkampe.adrianjaramillo.tk. 3083  IN  A   87.106.228.149\n\n;; AUTHORITY SECTION:\ntk.         172283  IN  NS  b.ns.tk.\ntk.         172283  IN  NS  a.ns.tk.\ntk.         172283  IN  NS  c.ns.tk.\ntk.         172283  IN  NS  d.ns.tk.\n\n;; ADDITIONAL SECTION:\na.ns.tk.        172283  IN  A   194.0.38.1\nb.ns.tk.        172283  IN  A   194.0.39.1\nc.ns.tk.        172283  IN  A   194.0.40.1\nd.ns.tk.        172283  IN  A   194.0.41.1\na.ns.tk.        172283  IN  AAAA    2001:678:50::1\nb.ns.tk.        172283  IN  AAAA    2001:678:54::1\nc.ns.tk.        172283  IN  AAAA    2001:678:58::1\nd.ns.tk.        172283  IN  AAAA    2001:678:5c::1\n\n;; Query time: 4 msec\n;; SERVER: 192.168.202.2#53(192.168.202.2)\n;; WHEN: Fri Oct 29 12:25:57 CEST 2021\n;; MSG SIZE  rcvd: 340\n</code></pre></p>"},{"location":"sri/ej5-vps/#paso-4","title":"Paso 4","text":"<p>Crear usuario profesor, con contrase\u00f1a robusta</p> <pre><code>sudo adduser profesor\n</code></pre> <p>Su password es: <code>?UdLbQ?*3'd6)@C4</code></p> <p>Habilitar sudo para <code>profesor</code></p> <pre><code>sudo usermod -aG sudo profesor\n</code></pre> <p>Habilitar sudo sin contrase\u00f1a para <code>profesor</code></p> <p>A\u00f1adir lo siguiente en <code>/etc/sudoers</code>: <pre><code>profesor     ALL=(ALL) NOPASSWD:ALL\n</code></pre></p> <p>Importante que se a\u00f1ada al final del fichero</p> <p>A\u00f1adir clave p\u00fablica SSH de josedom a <code>profesor</code></p> <p>Tras descargar su clave, la paso a mi VPS: <pre><code>scp Downloads/josedom-ssh.pub blackmamba@kampe.adrianjaramillo.tk:/home/blackmamba\n</code></pre></p> <p>A\u00f1ado esa clave ssh p\u00fablica al usuario profesor: <pre><code>mkdir /home/profesor/.ssh &amp;&amp; touch /home/profesor/.ssh/authorized_keys &amp;&amp; cat /home/blackmamba/josedom-ssh.pub &gt; /home/profesor/.ssh/authorized_keys\n</code></pre></p>"},{"location":"sri/ej6-apache-proxy-inverso/","title":"Ejercicio 6: Apache2 como proxy inverso","text":""},{"location":"sri/ej6-apache-proxy-inverso/#entrega","title":"Entrega","text":""},{"location":"sri/ej6-apache-proxy-inverso/#parte-1","title":"Parte 1","text":"<p>Entregar configuraci\u00f3n de la manera 1</p> <p>Activo el m\u00f3dulo: <pre><code>sudo a2enmod proxy_http\n</code></pre></p> <p>Creo 2 VirtualHosts con las siguientes configuraciones: <pre><code>&lt;VirtualHost *:80&gt;\n\n    ServerName www.app1.org\n\n    ProxyPass \"/\"  \"http://interno.example1.org/\"\n\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:80&gt;\n\n    ServerName www.app2.org\n\n    ProxyPass \"/\"  \"http://interno.example2.org/\"\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Los habilito: <pre><code>sudo a2ensite app1.conf app2.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p>"},{"location":"sri/ej6-apache-proxy-inverso/#parte-2","title":"Parte 2","text":"<p>Entregar resoluci\u00f3n est\u00e1tica para acceder a las p\u00e1ginas de la manera 1</p> <p>Modifico <code>/etc/hosts</code>: <pre><code># ej6-apache-proxy-inverso\n192.168.121.65 www.app1.org www.app2.org\n</code></pre> Los 2 nombres apuntan a la IP de <code>proxy</code>.</p>"},{"location":"sri/ej6-apache-proxy-inverso/#parte-3","title":"Parte 3","text":"<p>Capturas del acceso a las p\u00e1ginas como se indica en la manera 1</p> <p>Muestro que <code>www.app1.org</code> funciona:</p> <p></p> <p>Muestro que <code>www.app2.org</code> funciona:</p> <p></p>"},{"location":"sri/ej6-apache-proxy-inverso/#parte-4","title":"Parte 4","text":"<p>Entregar configuraci\u00f3n de la manera 2</p> <p>Creo 1 VirtualHost con la siguiente configuraci\u00f3n: <pre><code>&lt;VirtualHost *:80&gt;\n\n    ServerName www.servidor.org\n\n    ProxyPass \"/app1\"  \"http://interno.example1.org/\"\n    ProxyPass \"/app2\"  \"http://interno.example2.org/\"\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Lo habilito: <pre><code>sudo a2ensite servidor.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p>"},{"location":"sri/ej6-apache-proxy-inverso/#parte-5","title":"Parte 5","text":"<p>Entregar resoluci\u00f3n est\u00e1tica para acceder a las p\u00e1ginas de la manera 2</p> <p>Modifico <code>/etc/hosts</code>: <pre><code># ej6-apache-proxy-inverso\n192.168.121.65 www.servidor.org\n</code></pre> Ese nombre apunta a la IP de <code>proxy</code>.</p>"},{"location":"sri/ej6-apache-proxy-inverso/#parte-6","title":"Parte 6","text":"<p>Capturas del acceso a las p\u00e1ginas como se indica en la manera 2</p> <p>Muestro que <code>www.servidor.org/app1</code> funciona:</p> <p></p> <p>Muestro que <code>www.servidor.org/app2</code> funciona:</p> <p></p>"},{"location":"sri/ej6-apache-proxy-inverso/#ejercicios","title":"Ejercicios","text":""},{"location":"sri/ej6-apache-proxy-inverso/#ejercicio-1","title":"Ejercicio 1","text":"<p>Descargar <code>ejercicio_proxy.zip</code>. Contiene el <code>Vagrantfile</code> y el ansible para configurar el escenario.</p> <pre><code>wget https://fp.josedomingo.org/sri2122/u03/doc/ejercicio_proxy/ejercicio_proxy.zip\nunzip ejercicio_proxy.zip\n</code></pre> <p>Muestro la estructura que ha dejado ese zip: <pre><code>atlas@olympus:~/vagrant/ej6-apache-proxy-inverso$ tree\n.\n\u251c\u2500\u2500 ansible\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ansible.cfg\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 group_vars\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 all\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hosts\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 roles\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 apache2\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 files\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 index_vhost1.html\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 index_vhost2.html\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 handlers\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.yaml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tasks\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.yaml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 templates\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 etc\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 apache2\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 sites-available\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 vhost.j2\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 commons\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 tasks\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 main.yaml\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 site.yaml\n\u2514\u2500\u2500 Vagrantfile\n\n13 directories, 11 files\n</code></pre></p>"},{"location":"sri/ej6-apache-proxy-inverso/#ejercicio-2","title":"Ejercicio 2","text":"<p>Mostrar el escenario:</p> <ul> <li>\u201cproxy\u201d:<ul> <li>Interfaz eth0 actuando como p\u00fablica</li> <li>Interfaz en red privada veryisolated</li> </ul> </li> <li>\u201cservidorweb\u201d:<ul> <li>Interfaz conectada a la misma red privada que proxy</li> </ul> </li> </ul> <p>Muestro el <code>Vagrantfile</code> descargado: <pre><code># -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n  config.vm.define :proxy do |proxy|\n      proxy.vm.box = \"debian/bullseye64\"\n      proxy.vm.hostname = \"proxy\"\n      proxy.vm.synced_folder \".\", \"/vagrant\", disabled: true\n      proxy.vm.network :private_network,\n          :libvirt__network_name =&gt; \"red_privada1\",\n          :libvirt__dhcp_enabled =&gt; false,\n          :ip =&gt; \"10.0.0.10\",\n          :libvirt__forward_mode =&gt; \"veryisolated\"\n      proxy.vm.provision \"shell\", run: \"always\", inline: &lt;&lt;-SHELL\n        apt-get update &amp;&amp; apt upgrade -y\n        sysctl -w net.ipv4.ip_forward=1\n        iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -j MASQUERADE\n        echo \"10.0.0.6 interno.example1.org interno.example2.org\" &gt;&gt; /etc/hosts\n      SHELL\n    end\n    config.vm.define :servidorweb do |servidorweb|\n      servidorweb.vm.box = \"debian/bullseye64\"\n      servidorweb.vm.hostname = \"servidorweb\"\n      servidorweb.vm.synced_folder \".\", \"/vagrant\", disabled: true\n      servidorweb.vm.network :private_network,\n          :libvirt__network_name =&gt; \"red_privada1\",\n          :libvirt__dhcp_enabled =&gt; false,\n          :ip =&gt; \"10.0.0.6\",\n          :libvirt__forward_mode =&gt; \"veryisolated\"\n      servidorweb.vm.provision \"shell\", run: \"always\", inline: &lt;&lt;-SHELL\n          ip r del default\n          ip r add default via 10.0.0.10\n      SHELL\n    end\n\n  end\n</code></pre></p>"},{"location":"sri/ej6-apache-proxy-inverso/#ejercicio-3","title":"Ejercicio 3","text":"<p>Crear el escenario vagrant</p> <pre><code>vagrant up\n</code></pre>"},{"location":"sri/ej6-apache-proxy-inverso/#ejercicio-4","title":"Ejercicio 4","text":"<p>Ejecutar el ansible para configurar \u201cservidorweb\u201d</p> <p>Modifico el fichero <code>hosts</code> con la IP actual de mi \u201cservidorweb\u201d: <pre><code>all:\n  children:\n    grupo_sw:\n      hosts:\n        servidor_web:\n          ansible_ssh_host: 192.168.121.73\n          ansible_ssh_user: vagrant\n          ansible_ssh_private_key_file: ../.vagrant/machines/servidorweb/libvirt/private_key\n</code></pre></p> <p>Ejecuto el playbook: <pre><code>ansible-playbook site.yaml\n</code></pre></p> <p>Este ansible, en la m\u00e1quina \u201cservidorweb\u201d:</p> <ul> <li>Instala Apache</li> <li>Configura 2 VirtualHosts</li> </ul>"},{"location":"sri/ej6-apache-proxy-inverso/#ejercicio-5","title":"Ejercicio 5","text":"<p>Instalar Apache en \"proxy\"</p> <pre><code>sudo apt install apache2\n</code></pre>"},{"location":"sri/ej6-apache-proxy-inverso/#ejercicio-6","title":"Ejercicio 6","text":"<p>Configurar \"proxy\" para acceder a las p\u00e1ginas de \u201cservidorweb\u201d...</p> <ul> <li>Manera 1: acceder a la primera en <code>www.app1.org</code> y a la segunda en <code>www.app2.org</code></li> </ul>"},{"location":"sri/ej6-apache-proxy-inverso/#en-mi-maquina","title":"En mi m\u00e1quina","text":"<p>Modifico <code>/etc/hosts</code>: <pre><code># ej6-apache-proxy-inverso\n192.168.121.65 www.app1.org www.app2.org\n</code></pre> Los 2 nombres apuntan a la IP de <code>proxy</code>.</p>"},{"location":"sri/ej6-apache-proxy-inverso/#en-proxy","title":"En proxy","text":"<p>Activo el m\u00f3dulo: <pre><code>sudo a2enmod proxy_http\n</code></pre></p> <p>Creo 2 VirtualHosts con las siguientes configuraciones: <pre><code>&lt;VirtualHost *:80&gt;\n\n    ServerName www.app1.org\n\n    ProxyPass \"/\"  \"http://interno.example1.org/\"\n\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:80&gt;\n\n    ServerName www.app2.org\n\n    ProxyPass \"/\"  \"http://interno.example2.org/\"\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Los habilito: <pre><code>sudo a2ensite app1.conf app2.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Muestro que <code>www.app1.org</code> funciona:</p> <p></p> <p>Muestro que <code>www.app2.org</code> funciona:</p> <p></p>"},{"location":"sri/ej6-apache-proxy-inverso/#ejercicio-7","title":"Ejercicio 7","text":"<p>Configurar \"proxy\" para acceder a las p\u00e1ginas de \u201cservidorweb\u201d...</p> <ul> <li>Manera 2: acceder a la primera en <code>www.servidor.org/app1</code> y a la segunda en <code>www.servidor.org/app2</code></li> </ul>"},{"location":"sri/ej6-apache-proxy-inverso/#en-mi-maquina_1","title":"En mi m\u00e1quina","text":"<p>Modifico <code>/etc/hosts</code>: <pre><code># ej6-apache-proxy-inverso\n192.168.121.65 www.servidor.org\n</code></pre> Ese nombre apunta a la IP de <code>proxy</code>.</p>"},{"location":"sri/ej6-apache-proxy-inverso/#en-proxy_1","title":"En proxy","text":"<p>Creo 1 VirtualHost con la siguiente configuraci\u00f3n: <pre><code>&lt;VirtualHost *:80&gt;\n\n    ServerName www.servidor.org\n\n    ProxyPass \"/app1\"  \"http://interno.example1.org/\"\n    ProxyPass \"/app2\"  \"http://interno.example2.org/\"\n\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>Lo habilito: <pre><code>sudo a2ensite servidor.conf\n</code></pre></p> <p>Reinicio Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></p> <p>Muestro que <code>www.servidor.org/app1</code> funciona:</p> <p></p> <p>Muestro que <code>www.servidor.org/app2</code> funciona:</p> <p></p>"},{"location":"sri/ejercicios-correo/","title":"Ejercicios correo en escenario libvirt","text":""},{"location":"sri/ejercicios-correo/#ejercicio-1-usuarios-del-mismo-servidor","title":"Ejercicio 1: Usuarios del mismo servidor","text":""},{"location":"sri/ejercicios-correo/#parte-1","title":"Parte 1","text":"<p>Instalar <code>postfix</code> en apolo</p> <pre><code>sudo apt install postfix\n</code></pre> <p>Selecciono \"Internet Site\":</p> <p></p> <p>Escribo mi nombre de dominio. Se tomar\u00e1 como dominio origen de los correos que se env\u00eden desde apolo:</p> <p></p>"},{"location":"sri/ejercicios-correo/#parte-2","title":"Parte 2","text":"<p>Instalar <code>mailutils</code></p> <pre><code>sudo apt install mailutils\n</code></pre>"},{"location":"sri/ejercicios-correo/#parte-3","title":"Parte 3","text":"<p>Usar <code>mail</code> para enviar un correo desde el usuario <code>vagrant</code> al usuario <code>profesor</code></p> <p><pre><code>vagrant@apolo:~$ mail profesor@localhost\nCc:\nSubject: Correo para profesor\nCorreo de prueba\n</code></pre> (para que este correo se env\u00ede, es necesario estar en una nueva l\u00ednea del cuerpo y pulsar Ctrl+D)</p>"},{"location":"sri/ejercicios-correo/#parte-4","title":"Parte 4","text":"<p>Leer el correo enviado usando <code>mail</code> en el usuario <code>profesor</code></p> <pre><code>profesor@apolo:~$ mail\n\"/var/mail/profesor\": 1 message 1 new\n&gt;N   1 vagrant@apolo.adri Tue Jan 18 09:38  13/528   Correo para profesor\n? 1\nReturn-Path: &lt;vagrant@apolo.adrianj.gonzalonazareno.org&gt;\nX-Original-To: profesor@localhost\nDelivered-To: profesor@localhost\nReceived: by apolo.adrianj.gonzalonazareno.org (Postfix, from userid 1000)\n    id C5521C02CA; Tue, 18 Jan 2022 09:38:24 +0000 (UTC)\nTo: &lt;profesor@localhost&gt;\nSubject: Correo para profesor\nX-Mailer: mail (GNU Mailutils 3.10)\nMessage-Id: &lt;20220118093824.C5521C02CA@apolo.adrianj.gonzalonazareno.org&gt;\nDate: Tue, 18 Jan 2022 09:38:24 +0000 (UTC)\nFrom: vagrant@apolo.adrianj.gonzalonazareno.org\n\nCorreo de prueba\n?\n</code></pre>"},{"location":"sri/ejercicios-correo/#ejercicio-2-usuarios-del-servidor-a-correos-de-internet","title":"Ejercicio 2: Usuarios del servidor a correos de internet","text":""},{"location":"sri/ejercicios-correo/#parte-1_1","title":"Parte 1","text":"<p>A\u00f1adir <code>babuino-smtp.gonzalonazareno.org</code> como relayhost en postfix</p> <p>Modifico <code>/etc/postfix/main.cf</code>: <pre><code>relayhost = babuino-smtp.gonzalonazareno.org\n</code></pre></p> <p>Modifico los <code>nameserver</code> en apolo de la siguiente manera en <code>/etc/dhcp/dhclient.conf</code>: <pre><code>supersede domain-name-servers 192.168.202.2,127.0.0.1;\n</code></pre> (he colocado la ip de <code>papion-dns</code> en primer orden para que al hacer relay se resuelva <code>babuino-smtp.gonzalonazareno.org</code> desde nuestra red y no desde Internet. Esto sucede porque apolo no tiene la zona <code>gonzalonazareno.org</code> y por ende acaba preguntando recursivamente)</p>"},{"location":"sri/ejercicios-correo/#parte-2_1","title":"Parte 2","text":"<p>Enviar un correo a adristudy@gmail.com con <code>mail</code></p> <p><pre><code>vagrant@apolo:~$ mail -r vagrant@adrianj.gonzalonazareno.org adristudy@gmail.com\nCc:\nSubject: Correo externo\nPrueba de correo a gmail\n</code></pre> (es necesario a\u00f1adir con <code>-r</code> la direcci\u00f3n de origen. As\u00ed evitamos que <code>mail</code> use el hostname completo de la m\u00e1quina como dominio de origen, lo cual ser\u00eda incorrecto)</p>"},{"location":"sri/ejercicios-correo/#parte-3_1","title":"Parte 3","text":"<p>Mostrar <code>/var/log/mail.log</code> para verificar que el correo se ha enviado correctamente</p> <p>Muestro la l\u00ednea relevante: <pre><code>Jan 19 09:21:16 apolo postfix/smtp[2764]: 3EA6BC0D9E: to=&lt;adristudy@gmail.com&gt;, relay=babuino-smtp.gonzalonazareno.org[192.168.203.3]:25, delay=0.16, delays=0.06/0.03/0.06/0.01, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as 571FBFF778)\n</code></pre></p>"},{"location":"sri/ejercicios-correo/#parte-4_1","title":"Parte 4","text":"<p>Mostrar el correo en gmail</p> <p></p>"},{"location":"sri/ejercicios-correo/#parte-5","title":"Parte 5","text":"<p>\u00bfC\u00f3mo podemos ver el correo original (en bruto)?</p> <p></p>"},{"location":"sri/ejercicios-correo/#parte-6","title":"Parte 6","text":"<p>Indicar en las cabeceras la ruta de servidores SMTP tomada por el correo desde apolo a gmail</p> <p></p> <p>(los apartados \"Received\" se leen inversamente)</p>"},{"location":"sri/ejercicios-correo/#ejercicio-3-correos-desde-internet-a-usuarios-del-servidor","title":"Ejercicio 3: correos desde internet a usuarios del servidor","text":""},{"location":"sri/ejercicios-correo/#parte-1_2","title":"Parte 1","text":"<p>A\u00f1adir registro MX a la vista externa de bind</p> <p>Modifico <code>db.externa.adrianj.gonzalonazareno.org</code>: <pre><code>$ORIGIN adrianj.gonzalonazareno.org.\n$TTL 86400\n@     IN     SOA    zeus.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      zeus.adrianj.gonzalonazareno.org.\n@              IN    MX      10 zeus.adrianj.gonzalonazareno.org.\n\nzeus           IN    A       172.22.0.213 ; clase\n; zeus           IN    A       192.168.1.106 ; casa-eth\nwww            IN    CNAME   zeus\npython         IN    CNAME   zeus\n</code></pre></p> <p>Reinicio bind <pre><code>sudo systemctl restart bind9\n</code></pre></p>"},{"location":"sri/ejercicios-correo/#parte-2_2","title":"Parte 2","text":"<p>DNAT en zeus redirigiendo el puerto 25 a apolo</p> <pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 25 -j DNAT --to-destination 10.0.1.102:25\n</code></pre> <p>Guardo la regla: <pre><code>iptables-save &gt; /etc/iptables/rules.v4\n</code></pre></p>"},{"location":"sri/ejercicios-correo/#parte-3_2","title":"Parte 3","text":"<p>Responder desde gmail al correo recibido en el ejercicio anterior</p> <p>Muestro mi respuesta:</p> <p></p>"},{"location":"sri/ejercicios-correo/#parte-4_2","title":"Parte 4","text":"<p>Comprobar en apolo que se ha recibido correctamente el correo mirando <code>/var/log/mail.log</code></p> <pre><code>Jan 19 09:55:10 apolo postfix/smtpd[2896]: connect from babuino-smtp.gonzalonazareno.org[192.168.203.3]\nJan 19 09:55:10 apolo postfix/smtpd[2896]: CACBDC0D97: client=babuino-smtp.gonzalonazareno.org[192.168.203.3]\nJan 19 09:55:10 apolo postfix/cleanup[2900]: CACBDC0D97: message-id=&lt;CAG5uPReLQZ4YoD=8YG+JrvE6SYUjseL0M-NyD83KNoGHHbmzEw@mail.gmail.com&gt;\nJan 19 09:55:10 apolo postfix/qmgr[2654]: CACBDC0D97: from=&lt;adristudy@gmail.com&gt;, size=3692, nrcpt=1 (queue active)\nJan 19 09:55:10 apolo postfix/smtpd[2896]: disconnect from babuino-smtp.gonzalonazareno.org[192.168.203.3] ehlo=2 starttls=1 mail=1 rcpt=1 data=1 quit=1 commands=7\nJan 19 09:55:10 apolo postfix/local[2901]: CACBDC0D97: to=&lt;vagrant@adrianj.gonzalonazareno.org&gt;, relay=local, delay=0.03, delays=0.02/0.01/0/0, dsn=2.0.0, status=sent (delivered to mailbox)\nJan 19 09:55:10 apolo postfix/qmgr[2654]: CACBDC0D97: removed\n</code></pre> <p>Muestro el correo recibido: <pre><code>vagrant@apolo:~$ mail\n\"/var/mail/vagrant\": 5 messages 5 new\n&gt;N   1 adristudy          Wed Jan 19 09:41  72/3840  Re: Correo externo\n N   2 adristudy          Wed Jan 19 09:42  70/3685  Re: Correo externo\n N   3 adristudy          Wed Jan 19 09:42  71/3760  Re: Correo externo\n N   4 adristudy          Wed Jan 19 09:47  70/3733  Re: Correo externo\n N   5 adristudy          Wed Jan 19 09:55  71/3760  Re: Correo externo\n? 5\nReturn-Path: &lt;adristudy@gmail.com&gt;\nX-Original-To: vagrant@adrianj.gonzalonazareno.org\nDelivered-To: vagrant@adrianj.gonzalonazareno.org\nReceived: from babuino-smtp.gonzalonazareno.org (babuino-smtp.gonzalonazareno.org [192.168.203.3])\n    by apolo.adrianj.gonzalonazareno.org (Postfix) with ESMTPS id CACBDC0D97\n    for &lt;vagrant@adrianj.gonzalonazareno.org&gt;; Wed, 19 Jan 2022 09:55:10 +0000 (UTC)\nReceived: from mail-pf1-f179.google.com (mail-pf1-f179.google.com [209.85.210.179])\n    by babuino-smtp.gonzalonazareno.org (Postfix) with ESMTPS id A2EDAFF779\n    for &lt;vagrant@adrianj.gonzalonazareno.org&gt;; Wed, 19 Jan 2022 09:55:10 +0000 (UTC)\nReceived: by mail-pf1-f179.google.com with SMTP id i17so2054870pfk.11\n        for &lt;vagrant@adrianj.gonzalonazareno.org&gt;; Wed, 19 Jan 2022 01:55:10 -0800 (PST)\nDKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=gmail.com; s=20210112;\n        h=mime-version:references:in-reply-to:from:date:message-id:subject:to;\n        bh=UBRzoQFstQM7RXR6pMZdQeQN69KQeIge6p3HzfH8Cnw=;\n        b=SBed1/6ifJBmc3cotOM2KN5vYhx3Emlvd0snQssj4+19q2o0LEwG4yrLoDdmdoGCGk\n         7akg1xd+ldFO9NFUDRRra5c7y/P0rZ/lOX8TILS7HRYVNnOtn3ko1e540sKhXYFzLeTR\n         MBTBO0f/ru8+6zgQEMRHixsA7FGJldQLLv7TgJEzWSAFORcLg9VmHouXTH5e9+H/44E0\n         zmkZI7WKS8vcjkVCaCt6Dfh/cjzI2NmQeMXGZzjVN30pLzu4YqcWyPjtjUv30SXSloLt\n         Uz94rZ7Regq/geNg5GyzsYHWBuRINEjDHHbdN7TI9oOWEOt852gu2OgPLVw7Ls+8htyH\n         gktA==\nX-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=1e100.net; s=20210112;\n        h=x-gm-message-state:mime-version:references:in-reply-to:from:date\n         :message-id:subject:to;\n        bh=UBRzoQFstQM7RXR6pMZdQeQN69KQeIge6p3HzfH8Cnw=;\n        b=32Kq/nf+UvzvxQJ6ik5lUXbV7vsSA/vYiuKrf3UMopF8/xpmUziglRPbV6YKT77Klj\n         00L/lqWR03204+B/rMc2fJuZgvL9mF1K7bhU5tUajx7K681EUyEfsb3SoHtFo5rACvpN\n         faB5tspK0JGZpJrzlje+kOn2cMTTmA0fmbG9H1ZaZpbHqS8I88gUe5hTFd6g9b8Duo6D\n         sLhcEt/PDaqpklT20i1dYq9PliJwrfV4w8Fphd1QB8JX6Q+LrfhrD59aLYNxgEXzb4+D\n         le8cMo/T9FBRm1CGwOI4rikgOU7I7gAGk3lfdj7kz2z4WsgZbzNnhi10011eOzZkfWlJ\n         CUSA==\nX-Gm-Message-State: AOAM532fkZWJWnHiaF36A5Nc+fDMpsESW9z6MSRbA510wCRAVfpBggip\n    Q1wcux1gIM2rqaJXsGRIiqgfjOexLLwBjtgCxx9vw/Rd2Ic=\nX-Google-Smtp-Source: ABdhPJwFZl8S+5mmB9d4DO93QwZgmwFk0vh06sVosKBDr2J4J3PVhfQWB1g22JvwPa0VNnRtPizZaX37r8W8+b/Q3Yc=\nX-Received: by 2002:a63:7c10:: with SMTP id x16mr26938561pgc.128.1642586106377;\n Wed, 19 Jan 2022 01:55:06 -0800 (PST)\nMIME-Version: 1.0\nReferences: &lt;20220119092116.3EA6BC0D9E@apolo.adrianj.gonzalonazareno.org&gt;\nIn-Reply-To: &lt;20220119092116.3EA6BC0D9E@apolo.adrianj.gonzalonazareno.org&gt;\nFrom: adristudy &lt;adristudy@gmail.com&gt;\nDate: Wed, 19 Jan 2022 10:54:55 +0100\nMessage-ID: &lt;CAG5uPReLQZ4YoD=8YG+JrvE6SYUjseL0M-NyD83KNoGHHbmzEw@mail.gmail.com&gt;\nSubject: Re: Correo externo\nTo: vagrant@adrianj.gonzalonazareno.org\nContent-Type: multipart/alternative; boundary=\"0000000000006238fe05d5ec61c4\"\n\n--0000000000006238fe05d5ec61c4\nContent-Type: text/plain; charset=\"UTF-8\"\n\nrespuesta para apolo\n\nOn Wed, 19 Jan 2022 at 10:21, &lt;vagrant@adrianj.gonzalonazareno.org&gt; wrote:\n\n&gt; Prueba de correo a gmail\n&gt;\n\n--0000000000006238fe05d5ec61c4\nContent-Type: text/html; charset=\"UTF-8\"\nContent-Transfer-Encoding: quoted-printable\n\n&lt;div dir=3D\"ltr\"&gt;&lt;div dir=3D\"ltr\"&gt;&lt;div dir=3D\"ltr\"&gt;respuesta para apolo&lt;/di=\nv&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div class=3D\"gmail_quote\"&gt;&lt;div dir=3D\"ltr\" class=3D\"gmai=\nl_attr\"&gt;On Wed, 19 Jan 2022 at 10:21, &amp;lt;&lt;a href=3D\"mailto:vagrant@adrianj=\n.gonzalonazareno.org\"&gt;vagrant@adrianj.gonzalonazareno.org&lt;/a&gt;&amp;gt; wrote:&lt;br=\n&gt;&lt;/div&gt;&lt;blockquote class=3D\"gmail_quote\" style=3D\"margin:0px 0px 0px 0.8ex;=\nborder-left:1px solid rgb(204,204,204);padding-left:1ex\"&gt;Prueba de correo a=\n gmail&lt;br&gt;\n&lt;/blockquote&gt;&lt;/div&gt;\n\n--0000000000006238fe05d5ec61c4--\n</code></pre> (escribo 5 porque es el \u00faltimo recibido)</p>"},{"location":"sri/practica-aumento-rendimiento-web/","title":"Pr\u00e1ctica: Aumento de rendimiento en servidores web","text":""},{"location":"sri/practica-aumento-rendimiento-web/#haproxy-balanceador-de-carga","title":"HAProxy: Balanceador de carga","text":""},{"location":"sri/practica-aumento-rendimiento-web/#parte-1","title":"Parte 1","text":"<p>Crear y configurar el escenario usando el repositorio vagrant_ansible_haproxy</p> <p>Clono el repo:</p> <pre><code>git clone https://github.com/josedom24/vagrant_ansible_haproxy.git\n</code></pre> <p>Creo las m\u00e1quinas:</p> <pre><code>vagrant up\n</code></pre> <p>Entro en cada una de ellas y apunto sus IPs:</p> <ul> <li>frontend: 192.168.121.61</li> <li>backend1: 192.168.121.196</li> <li>backend2: 192.168.121.20</li> </ul> <p>Modifico <code>ansible/hosts</code> con estas IPs:</p> <pre><code>[servidor_ha]\nfrontend ansible_ssh_host=192.168.121.61 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/frontend/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\n[servidores_web]\nbackend1 ansible_ssh_host=192.168.121.196 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/backend1/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\nbackend2 ansible_ssh_host=192.168.121.20 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/backend2/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\n</code></pre> <p>Ejecuto el playbook para configurar el escenario:</p> <pre><code>ansible-playbook site.yaml\n</code></pre> <p>Podemos llegar a encontrarnos con este fallo, y lo documento para que se sepa:</p> <p></p> <p>Para arreglarlo tendr\u00edamos que entrar en cada m\u00e1quina y cambiar los repositorios en <code>/etc/apt/sources.list</code> a https:</p> <p></p> <p>Una vez hecho esto, vuelvo a ejecutar el playbook y ya funcionar\u00eda:</p> <pre><code>atlas@olympus:~/vagrant/vagrant_ansible_haproxy/ansible$ ansible-playbook site.yaml\n\nPLAY [all] ************************************************************************************************************************************************\nTASK [Gathering Facts] ************************************************************************************************************************************\nok: [frontend]\nok: [backend1]\nok: [backend2]\nTASK [commons : Ensure system is updated] *****************************************************************************************************************\nok: [backend2]\nok: [backend1]\nok: [frontend]\nPLAY [servidor_ha] ****************************************************************************************************************************************\nTASK [Gathering Facts] ************************************************************************************************************************************\nok: [frontend]\nTASK [haproxy : install haproxy] **************************************************************************************************************************\nchanged: [frontend]\nPLAY [servidores_web] *************************************************************************************************************************************\nTASK [Gathering Facts] ************************************************************************************************************************************\nok: [backend2]\nok: [backend1]\nTASK [nginx : install nginx, php-fpm] *********************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nTASK [nginx : Copy info.php] ******************************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nTASK [nginx : Copy virtualhost default] *******************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nRUNNING HANDLER [nginx : restart nginx] *******************************************************************************************************************\nchanged: [backend2]\nchanged: [backend1]\nPLAY [servidores_web] *************************************************************************************************************************************\nTASK [Gathering Facts] ************************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nTASK [mariadb : ensure mariadb is installed] **************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nTASK [mariadb : ensure mariadb binds to internal interface] ***********************************************************************************************\nchanged: [backend2]\nchanged: [backend1]\nRUNNING HANDLER [mariadb : restart mariadb] ***************************************************************************************************************\nchanged: [backend2]\nchanged: [backend1]\nPLAY [servidores_web] *************************************************************************************************************************************\nTASK [Gathering Facts] ************************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nTASK [wordpress : install unzip] **************************************************************************************************************************\nchanged: [backend2]\nchanged: [backend1]\nTASK [wordpress : download wordpress] *********************************************************************************************************************\nchanged: [backend2]\nchanged: [backend1]\nTASK [wordpress : unzip wordpress] ************************************************************************************************************************\nchanged: [backend2]\nchanged: [backend1]\nTASK [wordpress : Copy wordpress.sql] *********************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nTASK [wordpress : create database wordpress] **************************************************************************************************************\nchanged: [backend2]\nchanged: [backend1]\nTASK [wordpress : create user mysql wordpress] ************************************************************************************************************\nchanged: [backend1] =&gt; (item=localhost)\nchanged: [backend2] =&gt; (item=localhost)\nTASK [wordpress : copy wp-config.php] *********************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nRUNNING HANDLER [wordpress : restart nginx] ***************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nPLAY RECAP ************************************************************************************************************************************************\nbackend1                   : ok=20   changed=15   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\nbackend2                   : ok=20   changed=15   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\nfrontend                   : ok=4    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#parte-2","title":"Parte 2","text":"<p>Configurar HAProxy en frontend</p> <p>Al final de <code>/etc/haproxy/haproxy.cfg</code> a\u00f1ado:</p> <pre><code>frontend servidores_web\n    bind *:80\n    mode http\n    stats enable\n    stats uri /ha_stats\n    stats auth  cda:cda\n    default_backend servidores_web_backend\nbackend servidores_web_backend\n    mode http\n    balance roundrobin\n    server backend1 10.0.0.10:80 check\n    server backend2 10.0.0.11:80 check\n</code></pre> <p>Reinicio HAProxy:</p> <pre><code>sudo systemctl restart haproxy\n</code></pre> <p>Compruebo que ha empezado a escuchar en el puerto 80:</p> <pre><code>vagrant@frontend:/etc/haproxy$ sudo lsof -i -P -n | grep LISTEN\nsshd       524    root    3u  IPv4  12470      0t0  TCP *:22 (LISTEN)\nsshd       524    root    4u  IPv6  12481      0t0  TCP *:22 (LISTEN)\nhaproxy  20027 haproxy    7u  IPv4  41481      0t0  TCP *:80 (LISTEN)\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#parte-3","title":"Parte 3","text":"<p>Configurar la resoluci\u00f3n est\u00e1tica y acceder a wordpress</p> <p><code>/etc/hosts</code>:</p> <pre><code># haproxy\n192.168.121.61 www.example.org\n</code></pre> <p></p> <p>En cada nodo tenemos un <code>info.php</code>, as\u00ed que podemos comprobar si el balanceo funciona mirando los hostnames:</p> <p></p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#parte-4","title":"Parte 4","text":"<p>Calcular el rendimiento haciendo 5 pruebas. Obtener la media de <code>Requests per second</code></p> <p>Hago una primera prueba con:</p> <pre><code>ab -t 10 -c 100 http://www.example.org/wordpress/\n</code></pre> <p>Estos son los resultados:</p> <pre><code>This is ApacheBench, Version 2.3 &lt;$Revision: 1879490 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\nBenchmarking www.example.org (be patient)\nFinished 917 requests\nServer Software:        nginx/1.18.0\nServer Hostname:        www.example.org\nServer Port:            80\nDocument Path:          /wordpress/\nDocument Length:        26892 bytes\nConcurrency Level:      100\nTime taken for tests:   10.009 seconds\nComplete requests:      917\nFailed requests:        508\n   (Connect: 0, Receive: 0, Length: 508, Exceptions: 0)\nTotal transferred:      24881439 bytes\nHTML transferred:       24672135 bytes\nRequests per second:    91.62 [#/sec] (mean)\nTime per request:       1091.467 [ms] (mean)\nTime per request:       10.915 [ms] (mean, across all concurrent requests)\nTransfer rate:          2427.70 [Kbytes/sec] received\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.5      0       2\nProcessing:    14  954 945.3    559    2454\nWaiting:       10  933 937.0    539    2427\nTotal:         14  954 945.2    559    2454\nPercentage of the requests served within a certain time (ms)\n  50%    556\n  66%   1356\n  75%   2086\n  80%   2279\n  90%   2389\n  95%   2399\n  98%   2418\n  99%   2436\n 100%   2454 (longest request)\n</code></pre> <p>La parte que nos importa:</p> <pre><code>Requests per second:    91.62 [#/sec] (mean)\n</code></pre> <p>Hago 4 pruebas m\u00e1s y saco una media:</p> <pre><code>Requests per second:    102.89 [#/sec] (mean)\nRequests per second:    101.58 [#/sec] (mean)\nRequests per second:    101.68 [#/sec] (mean)\nRequests per second:    99.28 [#/sec] (mean)\n</code></pre> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#parte-5","title":"Parte 5","text":""},{"location":"sri/practica-aumento-rendimiento-web/#51","title":"5.1","text":"<p>Instalar <code>hatop</code></p> <pre><code>sudo apt install hatop\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#52","title":"5.2","text":"<p>Acceder a las estad\u00edsticas/administraci\u00f3n</p> <pre><code>sudo hatop -s /run/haproxy/admin.sock\n</code></pre> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#53","title":"5.3","text":"<p>Deshabilitar el nodo backend1</p> <p>Pulso F10 encima del nodo para que entre en mantenimiento:</p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#54","title":"5.4","text":"<p>Volver a hacer las pruebas de rendimiento</p> <pre><code>Requests per second:    43.26 [#/sec] (mean)\nRequests per second:    38.94 [#/sec] (mean)\nRequests per second:    45.58 [#/sec] (mean)\nRequests per second:    45.73 [#/sec] (mean)\nRequests per second:    45.78 [#/sec] (mean)\n</code></pre> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#55","title":"5.5","text":"<p>\u00bfSe nota la diferencia entre balancear y no balancear?</p> <p>S\u00ed, b\u00e1sicamente porque al tener un solo nodo el rendimiento baja a la mitad (l\u00f3gicamente).</p>"},{"location":"sri/practica-aumento-rendimiento-web/#56","title":"5.6","text":"<p>Habilitar de nuevo el nodo backend1</p> <p>Hago lo mismo que para deshabilitarlo, pero esta vez pulso F9:</p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#parte-6","title":"Parte 6","text":"<p>A\u00f1adir un nuevo nodo backend3 donde se instale Wordpress.</p>"},{"location":"sri/practica-aumento-rendimiento-web/#61","title":"6.1","text":"<p>Modificar el Vagrantfile</p> <pre><code>    config.vm.define :backend3 do |backend3|\n      backend3.vm.box = \"debian/bullseye64\"\n      backend3.vm.hostname = \"backend3\"\n      backend3.vm.synced_folder \".\", \"/vagrant\", disabled: true\n      backend3.vm.network :private_network,\n        :libvirt__network_name =&gt; \"red1\",\n        :libvirt__dhcp_enabled =&gt; false,\n        :ip =&gt; \"10.0.0.12\",\n        :libvirt__forward_mode =&gt; \"veryisolated\"\n    end\n</code></pre> <p>Creo la m\u00e1quina:</p> <pre><code>vagrant up backend3\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#62","title":"6.2","text":"<p>Modificar el Ansible</p> <p><code>ansible/hosts</code>:</p> <pre><code>[servidor_ha]\nfrontend ansible_ssh_host=192.168.121.61 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/frontend/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\n[servidores_web]\nbackend1 ansible_ssh_host=192.168.121.196 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/backend1/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\nbackend2 ansible_ssh_host=192.168.121.20 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/backend2/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\nbackend3 ansible_ssh_host=192.168.121.236 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/backend3/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\n</code></pre> <p>Ejecuto el playbook de nuevo para configurar la nueva m\u00e1quina como las dem\u00e1s:</p> <pre><code>atlas@olympus:~/vagrant/vagrant_ansible_haproxy/ansible$ ansible-playbook site.yaml\n\nPLAY [all] *************************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [backend2]\nok: [frontend]\nok: [backend3]\nok: [backend1]\nTASK [commons : Ensure system is updated] ******************************************************************************************************************************\nok: [backend2]\nok: [backend1]\nok: [frontend]\nchanged: [backend3]\nPLAY [servidor_ha] *****************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [frontend]\nTASK [haproxy : install haproxy] ***************************************************************************************************************************************\nok: [frontend]\nPLAY [servidores_web] **************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [backend3]\nok: [backend1]\nok: [backend2]\nTASK [nginx : install nginx, php-fpm] **********************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nchanged: [backend3]\nTASK [nginx : Copy info.php] *******************************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nchanged: [backend3]\nTASK [nginx : Copy virtualhost default] ********************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nchanged: [backend3]\nRUNNING HANDLER [nginx : restart nginx] ********************************************************************************************************************************\nchanged: [backend3]\nPLAY [servidores_web] **************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nok: [backend3]\nTASK [mariadb : ensure mariadb is installed] ***************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nchanged: [backend3]\nTASK [mariadb : ensure mariadb binds to internal interface] ************************************************************************************************************\nok: [backend2]\nok: [backend1]\nchanged: [backend3]\nRUNNING HANDLER [mariadb : restart mariadb] ****************************************************************************************************************************\nchanged: [backend3]\nPLAY [servidores_web] **************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nok: [backend3]\nTASK [wordpress : install unzip] ***************************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nchanged: [backend3]\nTASK [wordpress : download wordpress] **********************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nchanged: [backend3]\nTASK [wordpress : unzip wordpress] *************************************************************************************************************************************\nchanged: [backend3]\nok: [backend1]\nok: [backend2]\nTASK [wordpress : Copy wordpress.sql] **********************************************************************************************************************************\nchanged: [backend1]\nchanged: [backend2]\nchanged: [backend3]\nTASK [wordpress : create database wordpress] ***************************************************************************************************************************\nchanged: [backend3]\nchanged: [backend2]\nchanged: [backend1]\nTASK [wordpress : create user mysql wordpress] *************************************************************************************************************************\nchanged: [backend3] =&gt; (item=localhost)\nok: [backend2] =&gt; (item=localhost)\nok: [backend1] =&gt; (item=localhost)\nTASK [wordpress : copy wp-config.php] **********************************************************************************************************************************\nok: [backend1]\nok: [backend2]\nchanged: [backend3]\nRUNNING HANDLER [wordpress : restart nginx] ****************************************************************************************************************************\nchanged: [backend3]\nPLAY RECAP *************************************************************************************************************************************************************\nbackend1                   : ok=17   changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\nbackend2                   : ok=17   changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\nbackend3                   : ok=20   changed=16   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\nfrontend                   : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#63","title":"6.3","text":"<p>A\u00f1adir backend3 a <code>/etc/haproxy/haproxy.cfg</code> para que se tome en cuenta para el balanceo</p> <pre><code>backend servidores_web_backend\n    mode http\n    balance roundrobin\n    server backend1 10.0.0.10:80 check\n    server backend2 10.0.0.11:80 check\n    server backend3 10.0.0.12:80 check\n</code></pre> <p>Reinicio HAProxy:</p> <pre><code>sudo systemctl restart haproxy\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#64","title":"6.4","text":"<p>Volver a hacer las pruebas de rendimiento</p> <pre><code>Requests per second:    130.12 [#/sec] (mean)\nRequests per second:    129.43 [#/sec] (mean)\nRequests per second:    129.21 [#/sec] (mean)\nRequests per second:    129.64 [#/sec] (mean)\nRequests per second:    130.01 [#/sec] (mean)\n</code></pre> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#65","title":"6.5","text":"<p>\u00bfSe nota la diferencia al balancear a\u00f1adiendo un nuevo nodo?</p> <p>L\u00f3gicamente s\u00ed. El rendimiento aumenta proporcionalmente.</p>"},{"location":"sri/practica-aumento-rendimiento-web/#memcached","title":"Memcached","text":""},{"location":"sri/practica-aumento-rendimiento-web/#21","title":"2.1","text":"<p>Crear y configurar el escenario vagrant_ansible_wordpress</p> <p>Clono el repo:</p> <pre><code>git clone https://github.com/josedom24/vagrant_ansible_wordpress.git\n</code></pre> <p>Creo la m\u00e1quina:</p> <pre><code>vagrant up\n</code></pre> <p>Entro en ella y apunto su IP: 192.168.121.239</p> <p>Modifico <code>ansible/hosts</code> con esta IP:</p> <pre><code>[servidores_web]\nservidor_web ansible_ssh_host=192.168.121.239 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/default/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\n</code></pre> <p>Ejecuto el playbook para configurar la m\u00e1quina:</p> <pre><code>atlas@olympus:~/vagrant/vagrant_ansible_wordpress/ansible$ ansible-playbook site.yaml\n[WARNING]: ansible.utils.display.initialize_locale has not been called, this may result in incorrectly calculated text widths that can cause Display to print incorrect\nline lengths\nPLAY [all] *************************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [servidor_web]\nTASK [commons : Ensure system is updated] ******************************************************************************************************************************\nchanged: [servidor_web]\nPLAY [servidores_web] **************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [servidor_web]\nTASK [nginx : install nginx, php-fpm] **********************************************************************************************************************************\nchanged: [servidor_web]\nTASK [nginx : Copy info.php] *******************************************************************************************************************************************\nchanged: [servidor_web]\nTASK [nginx : Copy virtualhost default] ********************************************************************************************************************************\nchanged: [servidor_web]\nRUNNING HANDLER [nginx : restart nginx] ********************************************************************************************************************************\nchanged: [servidor_web]\nPLAY [servidores_web] **************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [servidor_web]\nTASK [mariadb : ensure mariadb is installed] ***************************************************************************************************************************\nchanged: [servidor_web]\nTASK [mariadb : ensure mariadb binds to internal interface] ************************************************************************************************************\nchanged: [servidor_web]\nRUNNING HANDLER [mariadb : restart mariadb] ****************************************************************************************************************************\nchanged: [servidor_web]\nPLAY [servidores_web] **************************************************************************************************************************************************\nTASK [Gathering Facts] *************************************************************************************************************************************************\nok: [servidor_web]\nTASK [wordpress : install unzip] ***************************************************************************************************************************************\nchanged: [servidor_web]\nTASK [wordpress : download wordpress] **********************************************************************************************************************************\nchanged: [servidor_web]\nTASK [wordpress : unzip wordpress] *************************************************************************************************************************************\nchanged: [servidor_web]\nTASK [wordpress : Copy wordpress.sql] **********************************************************************************************************************************\nchanged: [servidor_web]\nTASK [wordpress : create database wordpress] ***************************************************************************************************************************\nchanged: [servidor_web]\nTASK [wordpress : create user mysql wordpress] *************************************************************************************************************************\nchanged: [servidor_web] =&gt; (item=localhost)\nTASK [wordpress : copy wp-config.php] **********************************************************************************************************************************\nchanged: [servidor_web]\nRUNNING HANDLER [wordpress : restart nginx] ****************************************************************************************************************************\nchanged: [servidor_web]\nPLAY RECAP *************************************************************************************************************************************************************\nservidor_web               : ok=20   changed=16   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#22","title":"2.2","text":"<p>Configurar la resoluci\u00f3n est\u00e1tica</p> <p><code>/etc/hosts</code>:</p> <pre><code># memcached\n192.168.121.239 www.example.org\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#23","title":"2.3","text":"<p>Instalar memcached. Comprobar en <code>info.php</code> que funciona.</p> <pre><code>sudo apt install php-memcached memcached\n</code></pre> <p>Si se instal\u00f3 correctamente, nos aparece esta secci\u00f3n:</p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#24","title":"2.4","text":"<p>Instalar y configurar W3 Total Cache en Wordpress para que se pueda comunicar con memcached</p> <p></p> <p>Comienzo la configuraci\u00f3n de forma manual:</p> <p></p> <p>En <code>General Settings</code> hay distintas cach\u00e9s y opciones que podemos activar y configurar con este plugin. Lo hago:</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>Guardo las configuraciones:</p> <p></p> <p>Reinicio Nginx:</p> <pre><code>sudo systemctl restart nginx\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#25","title":"2.5","text":"<p>Realizar el c\u00e1lculo de rendimiento y obtener la media</p> <pre><code>Requests per second:    1083.49 [#/sec] (mean)\nRequests per second:    991.49 [#/sec] (mean)\nRequests per second:    1075.94 [#/sec] (mean)\nRequests per second:    1089.48 [#/sec] (mean)\nRequests per second:    1088.40 [#/sec] (mean)\n</code></pre> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#26","title":"2.6","text":"<p>\u00bfSe ha aumentado el rendimiento de forma significativa?</p> <p>Bastante. Como he mostrado, hemos llegado a las mil peticiones por segundo.</p>"},{"location":"sri/practica-aumento-rendimiento-web/#varnish","title":"Varnish","text":""},{"location":"sri/practica-aumento-rendimiento-web/#31","title":"3.1","text":"<p>Reutilizar el escenario anterior</p> <p>Borro la m\u00e1quina y la creo de nuevo:</p> <pre><code>vagrant destroy\nvagrant up\n</code></pre> <p>Entro en ella y apunto su IP: 192.168.121.53</p> <p>Modifico <code>ansible/hosts</code> con esta IP:</p> <pre><code>[servidores_web]\nservidor_web ansible_ssh_host=192.168.121.53 ansible_ssh_user=vagrant ansible_ssh_private_key_file=../.vagrant/machines/default/libvirt/private_key ansible_python_interpreter=/usr/bin/python3\n</code></pre> <p>Ejecuto el playbook para configurar la m\u00e1quina:</p> <pre><code>ansible-playbook site.yaml\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#32","title":"3.2","text":"<p>Configurar la resoluci\u00f3n est\u00e1tica</p> <p><code>/etc/hosts</code>:</p> <pre><code># Varnish\n192.168.121.53 www.example.org\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#33","title":"3.3","text":"<p>Instalar Varnish</p> <pre><code>sudo apt install varnish\n</code></pre>"},{"location":"sri/practica-aumento-rendimiento-web/#34","title":"3.4","text":"<p>Cambiar Nginx al puerto 8080</p> <p><code>/etc/nginx/sites-available/default</code>:</p> <pre><code>server {\n        listen 8080 default_server;\n        listen [::]:8080 default_server;\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart nginx\n</code></pre> <p>Compruebo que ha cambiado:</p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#35","title":"3.5","text":"<p>Cambiar Varnish al puerto 80</p> <p>Seg\u00fan la documentaci\u00f3n oficial de varnish no hace falta modificar el fichero <code>/etc/default/varnish</code> en versiones recientes de Debian (ya que es legacy).</p> <p>En su lugar, modifico <code>/lib/systemd/system/varnish.service</code>:</p> <p></p> <p>Reinicio la configuraci\u00f3n de los daemon:</p> <pre><code>sudo systemctl daemon-reload\n</code></pre> <p>Reinicio Varnish:</p> <pre><code>sudo systemctl restart varnish\n</code></pre> <p>Compruebo que ha cambiado el puerto:</p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#36","title":"3.6","text":"<p>Comprobar que la secci\u00f3n backend en <code>/etc/varnish/default.vcl</code> que tenemos por defecto sea correcta</p> <p>Lo es:</p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#37","title":"3.7","text":"<p>Comprobar que se puede acceder a Wordpress normalmente tras los cambios</p> <p></p>"},{"location":"sri/practica-aumento-rendimiento-web/#38","title":"3.8","text":"<p>Realizar las pruebas de rendimiento</p> <pre><code>Requests per second:    5806.68 [#/sec] (mean)\nRequests per second:    5952.47 [#/sec] (mean)\nRequests per second:    5941.95 [#/sec] (mean)\nRequests per second:    5877.94 [#/sec] (mean)\nRequests per second:    5960.23 [#/sec] (mean)\n</code></pre> <p></p> <p>Casi llegamos a una media de 6.000 peticiones por segundo, as\u00ed que hemos aumentado el rendimiento considerablemente.</p>"},{"location":"sri/practica-aumento-rendimiento-web/#39","title":"3.9","text":"<p>\u00bfCu\u00e1ntas peticiones llegan realmente a Nginx?</p> <p><code>/var/log/nginx/access.log</code>:</p> <p></p> <p>Como vemos, fij\u00e1ndonos en la hora, Nginx s\u00f3lo ha servido 2 peticiones de las miles que se han hecho.</p>"},{"location":"sri/practica-cluster-ha/","title":"Pr\u00e1ctica: Cluster HA","text":""},{"location":"sri/practica-cluster-ha/#cluster-de-ha-activo-pasivo","title":"Cluster de HA activo-pasivo","text":""},{"location":"sri/practica-cluster-ha/#entrega","title":"Entrega","text":""},{"location":"sri/practica-cluster-ha/#parte-1","title":"Parte 1","text":"<p>Mostrar la salida de <code>sudo pcs status</code></p> <p>Ejecuto el comando, por ejemplo, en nodo1:</p> <pre><code>vagrant@nodo1:~$ sudo pcs status\nCluster name: mycluster\nCluster Summary:\n  * Stack: corosync\n  * Current DC: nodo2 (version 2.0.5-ba59be7122) - partition with quorum\n  * Last updated: Fri Feb 18 12:09:53 2022\n  * Last change:  Fri Feb 18 12:05:38 2022 by root via cibadmin on nodo1\n  * 2 nodes configured\n  * 5 resource instances configured\nNode List:\n  * Online: [ nodo1 nodo2 ]\nFull List of Resources:\n  * VirtualIP   (ocf::heartbeat:IPaddr2):    Started nodo1\n  * WebSite (ocf::heartbeat:apache):     Started nodo1\n  * Clone Set: WebData-clone [WebData] (promotable):\n    * Masters: [ nodo1 ]\n    * Slaves: [ nodo2 ]\n  * WebFS   (ocf::heartbeat:Filesystem):     Started nodo1\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n</code></pre>"},{"location":"sri/practica-cluster-ha/#parte-2","title":"Parte 2","text":""},{"location":"sri/practica-cluster-ha/#21","title":"2.1","text":"<p>Mostrar el acceso a <code>index.php</code> en nodo1)</p> <p></p>"},{"location":"sri/practica-cluster-ha/#22","title":"2.2","text":"<p>Apagar nodo1 y mostrar de nuevo el acceso a <code>index.php</code>. Comprobar que se accede a nodo2.</p> <p>Hago <code>vagrant halt nodo1</code> y muestro que realmente est\u00e1 apagado:</p> <pre><code>2+DRBD+GFS2/ansible/roles/bind/files$ vagrant status\nCurrent machine states:\nnodo1                     shutoff (libvirt)\nnodo2                     running (libvirt)\ndns                       running (libvirt)\nThis environment represents multiple VMs. The VMs are all listed\nabove with their current state. For more information about a specific\nVM, run `vagrant status NAME`.\n</code></pre> <p>Recargo la p\u00e1gina y veo que el nodo ha cambiado:</p> <p></p>"},{"location":"sri/practica-cluster-ha/#parte-3","title":"Parte 3","text":"<p>Comprobar que el cluster de Galera MariaDB tiene dos nodos</p> <p>Dentro de mariadb, en cualquiera de los nodos, ejecuto el siguiete comando:</p> <pre><code>show status like 'wsrep_%';\n</code></pre> <p>El valor en <code>wsrep_cluster_size</code> nos indica que existen 2 nodos:</p> <p></p>"},{"location":"sri/practica-cluster-ha/#parte-4","title":"Parte 4","text":"<p>Crear un post en Wordpress y mostrarlo</p> <p></p>"},{"location":"sri/practica-cluster-ha/#parte-5","title":"Parte 5","text":"<p>Demostrar al profesor que apagando un nodo, WordPress sigue funcionando</p> <p>Hecho y funciona.</p>"},{"location":"sri/practica-cluster-ha/#ejercicios","title":"Ejercicios","text":""},{"location":"sri/practica-cluster-ha/#ejercicio-1","title":"Ejercicio 1","text":"<p>Lanzar Vagrant y Ansible sobre el escenario <code>06-HA-IPFailover-Apache2+DRBD+GFS2</code></p> <pre><code>vagrant up\nansible-playbook site.yaml\n</code></pre>"},{"location":"sri/practica-cluster-ha/#ejercicio-2","title":"Ejercicio 2","text":"<p>Configurar el host para que use como servidor DNS primario el del escenario</p> <p>Modifico mi <code>/etc/resolv.conf</code>:</p> <pre><code># Generated by NetworkManager\nsearch gonzalonazareno.org 41011038.41.andared.ced.junta-andalucia.es\nnameserver 10.1.1.103\nnameserver 192.168.202.2\nnameserver 192.168.8.1\n</code></pre>"},{"location":"sri/practica-cluster-ha/#ejercicio-3","title":"Ejercicio 3","text":""},{"location":"sri/practica-cluster-ha/#31","title":"3.1","text":"<p>Configuraciones de Galera MariaDB comunes a ambos nodos</p> <p>Instalo mariadb:</p> <pre><code>sudo apt install mariadb-server\n</code></pre> <p>Comento la siguiente l\u00ednea de <code>/etc/mysql/mariadb.conf.d/50-server.cnf</code>:</p> <pre><code>#bind-address            = 127.0.0.1\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart mariadb\n</code></pre> <p>Compruebo que ahora mariadb acepta peticiones desde todas las IPs:</p> <p></p>"},{"location":"sri/practica-cluster-ha/#32","title":"3.2","text":"<p>Configuraciones de Galera MariaDB en nodo1</p> <p>Modifico <code>/etc/mysql/mariadb.conf.d/60-galera.cnf</code>:</p> <pre><code>[galera]\n# Mandatory settings\nwsrep_on                 = ON\nwsrep_cluster_name       = \"MariaDB Galera Cluster\"\nwsrep_provider           = /usr/lib/galera/libgalera_smm.so\nwsrep_cluster_address    = \"gcomm://nodo1,nodo2\"\nbinlog_format            = row\ndefault_storage_engine   = InnoDB\ninnodb_autoinc_lock_mode = 2\n# Allow server to accept connections on all interfaces.\nbind-address             = 0.0.0.0\nwsrep_node_address       = \"nodo1\"\n</code></pre> <p>Inicializo el cluster y reinicio:</p> <pre><code>sudo galera_new_cluster\nsudo systemctl restart mariadb\n</code></pre>"},{"location":"sri/practica-cluster-ha/#33","title":"3.3","text":"<p>Configuraciones de Galera MariaDB en nodo2</p> <p>Modifico <code>/etc/mysql/mariadb.conf.d/60-galera.cnf</code>:</p> <pre><code>[galera]\n# Mandatory settings\nwsrep_on                 = ON\nwsrep_cluster_name       = \"MariaDB Galera Cluster\"\nwsrep_provider           = /usr/lib/galera/libgalera_smm.so\nwsrep_cluster_address    = \"gcomm://nodo1,nodo2\"\nbinlog_format            = row\ndefault_storage_engine   = InnoDB\ninnodb_autoinc_lock_mode = 2\n# Allow server to accept connections on all interfaces.\nbind-address             = 0.0.0.0\nwsrep_node_address       = \"nodo2\"\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart mariadb\n</code></pre>"},{"location":"sri/practica-cluster-ha/#ejercicio-4","title":"Ejercicio 4","text":"<p>Tenemos que instalar Wordpress en el cluster.</p> <p>Esta instalaci\u00f3n ser\u00e1 id\u00e9ntica a la de un Wordpress sin cluster, s\u00f3lo que en este escenario el DocumentRoot se replicar\u00e1 al nodo2 en caso de fallo del nodo1.</p> <p>La base de datos se replica ya de por s\u00ed incluso sin fallos de nodo.</p>"},{"location":"sri/practica-cluster-ha/#41","title":"4.1","text":"<p>Configurar la BD</p> <p>La creo:</p> <pre><code>CREATE DATABASE WORDPRESS;\n</code></pre> <p>Creo el usuario:</p> <pre><code>CREATE USER 'WPUSER'@localhost IDENTIFIED BY '1234';\n</code></pre> <p>Asigno privilegios:</p> <pre><code>GRANT ALL PRIVILEGES ON WORDPRESS.* TO WPUSER@localhost IDENTIFIED BY '1234';\nFLUSH PRIVILEGES;\n</code></pre>"},{"location":"sri/practica-cluster-ha/#42","title":"4.2","text":"<p>Limpiar el DocumentRoot antiguo</p> <pre><code>sudo rm -r /var/www/html/*\n</code></pre>"},{"location":"sri/practica-cluster-ha/#43","title":"4.3","text":"<p>Descargar Wordpress</p> <p>Lo hago en <code>/tmp</code>:</p> <pre><code>wget https://wordpress.org/latest.zip\nunzip latest.zip\n</code></pre> <p>Muevo el contenido del directorio <code>wordpress</code> al DocumentRoot que ya ten\u00edamos funcionando:</p> <pre><code>sudo mv /tmp/wordpress/* /var/www/html/\n</code></pre> <p>Dejo los permisos correctamente:</p> <pre><code>sudo chown -R www-data:www-data /var/www/html/\n</code></pre>"},{"location":"sri/practica-cluster-ha/#44","title":"4.4","text":"<p>Instalar Wordpress</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p>"},{"location":"sri/practica-https-vps/","title":"Pr\u00e1ctica: Configuraci\u00f3n de HTTPS en el VPS","text":"<p>Se configurar\u00e1 para todos los VirtualHosts usando Let's Encrypt .</p>"},{"location":"sri/practica-https-vps/#parte-1","title":"Parte 1","text":"<p>Comprobar que Brave tiene el certificado de Let\u2019s Encrypt</p> <p>Antes de comprobar nada, es esencial entender su chain of trust:</p> <p></p> <p>Como vemos, existen muchas entidades certificadoras, pero las que nos interesan son <code>ISRG Root X1</code> y <code>R3</code>. \u00c9sta \u00faltima es la que suele firmar a los usuarios finales.</p> <p>Brave no tiene el certificado de <code>R3</code>, sino el de <code>ISRG Root X1</code>:</p> <p></p> <p>\u00bfPor qu\u00e9 esto es as\u00ed? Por la chain of trust que he mostrado arriba.</p> <p>Podemos hacer una prueba de esto, si accedemos a la web oficial de Let\u2019s Encrypt y mostramos la jerarqu\u00eda del certificado:</p> <p></p> <p>Directamente Brave \"no conf\u00eda\" en <code>R3</code>, porque no tiene su certificado y por lo cual no puede verificar su firma, pero s\u00ed tiene el certificado root de <code>ISRG Root X1</code> que firm\u00f3 a R3, entonces puede verificar esa firma en el certificado de <code>R3</code> y en consecuencia, confiar en \u00e9l.</p>"},{"location":"sri/practica-https-vps/#parte-2","title":"Parte 2","text":""},{"location":"sri/practica-https-vps/#preguntas","title":"Preguntas","text":"<p>\u00bfQu\u00e9 funci\u00f3n tiene el cliente ACME?</p> <p>Verificar que somos due\u00f1os del nombre de dominio, y emitirnos un certificado.</p> <p>Hay muchos clientes, pero el recomendado es Certbot.</p> <p>\u00bfQu\u00e9 configuraci\u00f3n se realiza en el servidor web?</p> <ol> <li>Solicitamos el certificado</li> <li>Configuramos los VirtualHosts con el certificado</li> </ol> <p>\u00bfQu\u00e9 pruebas realiza Let\u2019s Encrypt para asegurar que somos los administrados del sitio web?</p> <p>Let's Encrypt realiza \"challenges\", y hay varios tipos. Los m\u00e1s comunes son HTTP-01 y DNS-01.</p> <p>En mi caso, como querr\u00e9 obtener un certificado wildcard, tendr\u00e9 que hacer el DNS-01.</p> <p>Su funcionamiento es simple:</p> <ol> <li>Let\u2019s Encrypt nos proporciona un registro TXT que tendremos que crear en nuestro DNS bajo el nombre <code>_acme-challenge.adrianjaramillo.tk.</code></li> <li>Let\u2019s Encrypt hace una consulta a <code>_acme-challenge.adrianjaramillo.tk.</code></li> <li>Si la consulta resolvi\u00f3 el nombre correctamente con la cadena que se nos proporcion\u00f3, Let\u2019s Encrypt verifica que somos los due\u00f1os del dominio, y nos proporciona el certificado firmado.</li> </ol> <p>\u00bfSe puede usar el DNS para verificar que somos administradores del sitio?</p> <p>S\u00ed. De hecho, es el \u00fanico challenge permitido si queremos obtener un certificado wildcard.</p>"},{"location":"sri/practica-https-vps/#certificado-wildcard-adrianjaramillotk","title":"Certificado wildcard <code>*.adrianjaramillo.tk</code>","text":"<p>Instalo certbot y paquetes relacionados: <pre><code>sudo apt install letsencrypt\n</code></pre></p> <p>A\u00f1ado el siguiente registro a mi DNS:</p> <p></p> <p>Pido el certificado: <pre><code>sudo certbot certonly --manual --preferred-challenges dns -d *.adrianjaramillo.tk\n</code></pre> <pre><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator manual, Installer None\nRequesting a certificate for *.adrianjaramillo.tk\nPerforming the following challenges:\ndns-01 challenge for adrianjaramillo.tk\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPlease deploy a DNS TXT record under the name\n_acme-challenge.adrianjaramillo.tk with the following value:\n\nZjtt4Rws9cuSpcQ8yMGJ5cXGcMfhgWUPen36G2WOwSg\n\nBefore continuing, verify the record is deployed.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPress Enter to Continue\nWaiting for verification...\nCleaning up challenges\n\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at:\n   /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem\n   Your key file has been saved at:\n   /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem\n   Your certificate will expire on 2022-03-06. To obtain a new or\n   tweaked version of this certificate in the future, simply run\n   certbot again. To non-interactively renew *all* of your\n   certificates, run \"certbot renew\"\n - If you like Certbot, please consider supporting our work by:\n\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n</code></pre></p> <p>Verifico que tengo el certificado: <pre><code>sudo certbot certificates\n</code></pre> <pre><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nFound the following certs:\n  Certificate Name: adrianjaramillo.tk\n    Serial Number: 348d745d49f1968da5ccfce5d50d4b3018d\n    Key Type: RSA\n    Domains: *.adrianjaramillo.tk\n    Expiry Date: 2022-03-06 18:09:13+00:00 (VALID: 89 days)\n    Certificate Path: /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem\n    Private Key Path: /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n</code></pre></p>"},{"location":"sri/practica-https-vps/#parte-3","title":"Parte 3","text":"<p>Configurar 2 ficheros por VirtualHost (HTTP y HTTPS). Redirigir HTTP a HTTPS.</p> <p><code>django_http.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name django.adrianjaramillo.tk;\n\n    return 301 https://$host$request_uri;\n\n}\n</code></pre></p> <p><code>django_https.conf</code>: <pre><code>server {\n\n    listen 443 ssl;\n    server_name django.adrianjaramillo.tk;\n    root /home/blackmamba/django_tutorial;\n\n    ###################\n    # RSA certificate #\n    ###################\n\n    ssl_certificate /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n\n    #############\n    # Locations #\n    #############\n\n    location / {\n        proxy_pass http://localhost:8080;\n        include proxy_params;\n    }\n\n    location /static/polls {\n        alias /home/blackmamba/django_tutorial/polls/static/polls;\n    }\n\n    location /static/admin {\n        alias /home/blackmamba/venv/lib/python3.9/site-packages/django/contrib/admin/static/admin/;\n    }\n\n}\n</code></pre></p> <p><code>portal_http.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name portal.adrianjaramillo.tk;\n\n    return 301 https://$host$request_uri;\n\n}\n</code></pre></p> <p><code>portal_https.conf</code>: <pre><code>server {\n\n    listen 443 ssl;\n    server_name portal.adrianjaramillo.tk;\n    root /var/www/portal;\n\n    ###################\n    # RSA certificate #\n    ###################\n\n    ssl_certificate /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n\n    #############\n    # Locations #\n    #############\n\n    location / {\n        index index.php index.html index.htm;\n    }\n\n    location ~ \\.php$ {\n        include        fastcgi_params;\n        fastcgi_pass   unix:/run/php/php7.4-fpm.sock;\n        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    }\n\n}\n</code></pre></p> <p><code>www_http.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name www.adrianjaramillo.tk;\n\n    return 301 https://$host$request_uri;\n\n}\n</code></pre></p> <p><code>www_https.conf</code>: <pre><code>server {\n\n    ###########\n    # GENERAL #\n    ###########\n\n    listen 443 ssl;\n    server_name www.adrianjaramillo.tk;\n\n    root /var/www/www;\n    index index.html index.htm;\n\n    error_page 404 /error/404.html;\n    error_page 403 /error/403.html;\n\n    location ~ \\.php$ {\n        fastcgi_pass   unix:/run/php/php7.4-fpm.sock;\n        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n\n    ###################\n    # RSA certificate #\n    ###################\n\n    ssl_certificate /etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n\n    #############\n    # PRINCIPAL #\n    #############\n\n    rewrite ^/$ https://www.adrianjaramillo.tk/principal permanent;\n\n    location /principal {\n        autoindex off;\n        disable_symlinks on;\n    }\n\n    location /principal/documentos {\n        alias /srv/doc;\n        autoindex on;\n        disable_symlinks off;\n    }\n\n    location /secreto {\n        auth_basic \"Acceso restringido\";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n    }\n\n    #############\n    # NEXTCLOUD #\n    #############\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n\n    location ^~ /.well-known {\n        # The rules in this block are an adaptation of the rules\n        # in the Nextcloud `.htaccess` that concern `/.well-known`.\n\n        location = /.well-known/carddav { return 301 /cloud/remote.php/dav/; }\n        location = /.well-known/caldav  { return 301 /cloud/remote.php/dav/; }\n\n        location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }\n        location /.well-known/pki-validation    { try_files $uri $uri/ =404; }\n\n        # Let Nextcloud's API for `/.well-known` URIs handle all other\n        # requests by passing them to the front-end controller.\n        return 301 /cloud/index.php$request_uri;\n    }\n\n    location ^~ /cloud {\n        # set max upload size and increase upload timeout:\n        client_max_body_size 512M;\n        client_body_timeout 300s;\n        fastcgi_buffers 64 4K;\n\n        # Enable gzip but do not remove ETag headers\n        gzip on;\n        gzip_vary on;\n        gzip_comp_level 4;\n        gzip_min_length 256;\n        gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;\n        gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;\n\n        # Pagespeed is not supported by Nextcloud, so if your server is built\n        # with the `ngx_pagespeed` module, uncomment this line to disable it.\n        #pagespeed off;\n\n        # HTTP response headers borrowed from Nextcloud `.htaccess`\n        add_header Referrer-Policy                      \"no-referrer\"   always;\n        add_header X-Content-Type-Options               \"nosniff\"       always;\n        add_header X-Download-Options                   \"noopen\"        always;\n        add_header X-Frame-Options                      \"SAMEORIGIN\"    always;\n        add_header X-Permitted-Cross-Domain-Policies    \"none\"          always;\n        add_header X-Robots-Tag                         \"none\"          always;\n        add_header X-XSS-Protection                     \"1; mode=block\" always;\n\n        # Remove X-Powered-By, which is an information leak\n        fastcgi_hide_header X-Powered-By;\n\n        # Specify how to handle directories -- specifying `/nextcloud/index.php$request_uri`\n        # here as the fallback means that Nginx always exhibits the desired behaviour\n        # when a client requests a path that corresponds to a directory that exists\n        # on the server. In particular, if that directory contains an index.php file,\n        # that file is correctly served; if it doesn't, then the request is passed to\n        # the front-end controller. This consistent behaviour means that we don't need\n        # to specify custom rules for certain paths (e.g. images and other assets,\n        # `/updater`, `/ocm-provider`, `/ocs-provider`), and thus\n        # `try_files $uri $uri/ /nextcloud/index.php$request_uri`\n        # always provides the desired behaviour.\n        index index.php index.html /cloud/index.php$request_uri;\n\n        # Rule borrowed from `.htaccess` to handle Microsoft DAV clients\n        location = /cloud {\n            if ( $http_user_agent ~ ^DavClnt ) {\n                return 302 /cloud/remote.php/webdav/$is_args$args;\n            }\n        }\n\n        # Rules borrowed from `.htaccess` to hide certain paths from clients\n        location ~ ^/cloud/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)    { return 404; }\n        location ~ ^/cloud/(?:\\.|autotest|occ|issue|indie|db_|console)                  { return 404; }\n\n        # Ensure this block, which passes PHP files to the PHP process, is above the blocks\n        # which handle static assets (as seen below). If this block is not declared first,\n        # then Nginx will encounter an infinite rewriting loop when it prepends\n        # `/nextcloud/index.php` to the URI, resulting in a HTTP 500 error response.\n        location ~ \\.php(?:$|/) {\n            # Required for legacy support\n            rewrite ^/cloud/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v[12]|updater\\/.+|oc[ms]-provider\\/.+|.+\\/richdocumentscode\\/proxy) /cloud/index.php$request_uri;\n\n            fastcgi_split_path_info ^(.+?\\.php)(/.*)$;\n            set $path_info $fastcgi_path_info;\n\n            try_files $fastcgi_script_name =404;\n\n            include fastcgi_params;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param PATH_INFO $path_info;\n\n            fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice\n            fastcgi_param front_controller_active true;     # Enable pretty urls\n            fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;\n\n            fastcgi_intercept_errors on;\n            fastcgi_request_buffering off;\n        }\n\n        location ~ \\.(?:css|js|svg|gif|png|jpg|ico)$ {\n            try_files $uri /cloud/index.php$request_uri;\n            expires 6M;         # Cache-Control policy borrowed from `.htaccess`\n            access_log off;     # Optional: Don't log access to assets\n        }\n\n        location ~ \\.woff2?$ {\n            try_files $uri /cloud/index.php$request_uri;\n            expires 7d;         # Cache-Control policy borrowed from `.htaccess`\n            access_log off;     # Optional: Don't log access to assets\n        }\n\n        # Rule borrowed from `.htaccess`\n        location /cloud/remote {\n            return 301 /cloud/remote.php$request_uri;\n        }\n\n        location /cloud {\n            try_files $uri $uri/ /cloud/index.php$request_uri;\n        }\n    }\n}\n</code></pre></p>"},{"location":"sri/practica-https-vps/#parte-4","title":"Parte 4","text":"<p>Comprobar que se ha creado una tarea cron para renovar el certificado</p> <p><code>/etc/cron.d/certbot</code>: <pre><code># /etc/cron.d/certbot: crontab entries for the certbot package\n#\n# Upstream recommends attempting renewal twice a day\n#\n# Eventually, this will be an opportunity to validate certificates\n# haven't been revoked, etc.  Renewal will only occur if expiration\n# is within 30 days.\n#\n# Important Note!  This cronjob will NOT be executed if you are\n# running systemd as your init system.  If you are running systemd,\n# the cronjob.timer function takes precedence over this cronjob.  For\n# more details, see the systemd.timer manpage, or use systemctl show\n# certbot.timer.\nSHELL=/bin/sh\nPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n\n0 */12 * * * root test -x /usr/bin/certbot -a \\! -d /run/systemd/system &amp;&amp; perl -e 'sleep int(rand(43200))' &amp;&amp; certbot -q renew\n</code></pre></p> <p>La renovaci\u00f3n s\u00f3lo ocurrir\u00e1 si la expiraci\u00f3n es en 30 d\u00edas.</p> <p>Podemos usar herramientas online para entender la expresi\u00f3n cron:</p> <p></p> <p>Es decir, la tarea cron se ejecuta cada 12 horas.</p>"},{"location":"sri/practica-https-vps/#parte-5","title":"Parte 5","text":"<p>Comprobar que las p\u00e1ginas son accesibles por HTTPS y visualizar los detalles del certificado</p> <p>En todos los VirtualHosts, los detalles del certificado son los mismos:</p> <p></p> <p>Muestro el resto de VirtualHosts:</p> <p></p> <p></p> <p></p>"},{"location":"sri/practica-https-vps/#parte-6","title":"Parte 6","text":"<p>Modificar el cliente Nextcloud para que siga funcionando con HTTPS</p> <p>Desde que hemos configurado HTTPS, el cliente da errores:</p> <p></p> <p>Tenemos que borrar la conexi\u00f3n antigua, y crear una nueva HTTPS:</p> <p></p> <p>Una vez terminada la configuraci\u00f3n, vemos que sigue funcionando con HTTPS:</p> <p></p> <p>Adem\u00e1s, si queremos, el cliente de Nextcloud nos permite ver los detalles del certificado:</p> <p></p>"},{"location":"sri/practica-servidor-correo/","title":"Pr\u00e1ctica: Servidor de correos en VPS","text":""},{"location":"sri/practica-servidor-correo/#pasos-previos","title":"Pasos previos","text":"<p>Instalo postfix:</p> <pre><code>sudo apt update\nsudo apt install postfix\n</code></pre> <p>Selecciono \"Internet Site\":</p> <p></p> <p>Escribo mi nombre de dominio. Se tomar\u00e1 como dominio origen de los correos que se env\u00eden desde el vps (<code>myorigin = /etc/mailname</code>):</p> <p></p> <p>Instalo <code>mailutils</code>:</p> <pre><code>sudo apt install mailutils\n</code></pre>"},{"location":"sri/practica-servidor-correo/#gestion-de-correos-desde-el-servidor","title":"Gesti\u00f3n de correos desde el servidor","text":""},{"location":"sri/practica-servidor-correo/#tarea-1","title":"Tarea 1","text":""},{"location":"sri/practica-servidor-correo/#11","title":"1.1","text":"<p>Crear registro SPF en el DNS</p> <p></p>"},{"location":"sri/practica-servidor-correo/#12","title":"1.2","text":"<p>Enviar un correo desde la vps a gmail</p> <pre><code>blackmamba@kampe:~$ mail -r blackmamba@adrianjaramillo.tk adristudy@gmail.com\nCc:\nSubject: Correo con SPF\nMensaje\n</code></pre>"},{"location":"sri/practica-servidor-correo/#13","title":"1.3","text":"<p>Mostrar <code>/var/log/mail.log</code> para verificar que el correo se ha enviado correctamente</p> <p>L\u00ednea relevante:</p> <pre><code>Feb 14 16:20:33 kampe postfix/smtp[516217]: 242F742268: to=&lt;adristudy@gmail.com&gt;, relay=gmail-smtp-in.l.google.com[64.233.167.26]:25, delay=1.3, delays=0.03/0.01/0.29/0.95, dsn=2.0.0, status=sent (250 2.0.0 OK  1644855633 l11si9233120wms.107 - gsmtp)\n</code></pre>"},{"location":"sri/practica-servidor-correo/#14","title":"1.4","text":"<p>Mostrar el correo recibido en gmail</p> <p></p> <p>Para estar seguros de que este correo ha llegado con SPF v\u00e1lido, tenemos que mostrar el correo original:</p> <p></p> <p>Ha pasado el checkeo SPF, pero si queremos ver informaci\u00f3n a\u00fan m\u00e1s espec\u00edfica, podemos hacer scroll al contenido en bruto del correo recibido:</p> <p></p> <p>Al ver eso, queda totalmente claro que el checkeo SPF ha sido exitoso.</p>"},{"location":"sri/practica-servidor-correo/#tarea-2","title":"Tarea 2","text":""},{"location":"sri/practica-servidor-correo/#21","title":"2.1","text":"<p>Crear registro MX y CNAME correspondiente en el DNS</p> <p></p>"},{"location":"sri/practica-servidor-correo/#22","title":"2.2","text":"<p>Habilitar en el firewall del vps el tr\u00e1fico entrante al puerto 25</p> <p></p>"},{"location":"sri/practica-servidor-correo/#23","title":"2.3","text":"<p>Enviar un correo desde gmail a la vps</p> <p></p>"},{"location":"sri/practica-servidor-correo/#24","title":"2.4","text":"<p>Comprobar que la vps ha recibido correctamente el correo mirando <code>/var/log/mail.log</code></p> <p></p>"},{"location":"sri/practica-servidor-correo/#25","title":"2.5","text":"<p>Mostrar el correo recibido</p> <pre><code>blackmamba@kampe:~$ mail\n\"/var/mail/blackmamba\": 1 message 1 new\n&gt;N   1 adristudy          Mon Feb 14 18:17  52/2630  Correo para la VPS\n? 1\nReturn-Path: &lt;adristudy@gmail.com&gt;\nX-Original-To: blackmamba@adrianjaramillo.tk\nDelivered-To: blackmamba@adrianjaramillo.tk\nReceived: from mail-pl1-f176.google.com (mail-pl1-f176.google.com [209.85.214.176])\n    by kampe.adrianjaramillo.tk (Postfix) with ESMTPS id 4F393422CB\n    for &lt;blackmamba@adrianjaramillo.tk&gt;; Mon, 14 Feb 2022 18:17:40 +0000 (UTC)\nReceived: by mail-pl1-f176.google.com with SMTP id l8so5186364pls.7\n        for &lt;blackmamba@adrianjaramillo.tk&gt;; Mon, 14 Feb 2022 10:17:40 -0800 (PST)\nDKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=gmail.com; s=20210112;\n        h=mime-version:from:date:message-id:subject:to;\n        bh=MudV18FBtYjZJPFyKfQ5hC6U6ERmLoC4WY7BpsZqJUs=;\n        b=hpLYd8Radagaj5ilgByYq41SIVkdDFuM28I2tHi2qxE6yANOJnGC22x6FepMkW/ur3\n         2iqHhmlw72u8he4u1VNxYsP3xCORcgx77iI3nxCkAYG7l9Tx6L7cScNNBMmsgfzP0Xp2\n         ukKClt9Nc38F0xHSwF1qKrpie4OsxxB+blYUnUzx5SvUl18WtuHjfxLHM2cPpueYrYvc\n         Ls0dR/Hyt9pWXEthi9ueHnWTprlauAdxKANUJMnbYA1C5z6YH0F+i/6NnHa96ZQ2E2Dv\n         JrRzfqVYRwNwDzQAHa5ViqbgyepDPLmu9gnbytlfJCoQSrAs9diH/8gLU7b3ymnlkxQS\n         HkNg==\nX-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=1e100.net; s=20210112;\n        h=x-gm-message-state:mime-version:from:date:message-id:subject:to;\n        bh=MudV18FBtYjZJPFyKfQ5hC6U6ERmLoC4WY7BpsZqJUs=;\n        b=VUVBAkMaD/qnhm92cnmVBYhTFj0HuNxKqtgGNEVlEge780WB2QaXPMtaSMGSz77aHc\n         nC3VQvj18EtItjtccAywt/FLLqP4ucH2gcellCvn0UreOCFoP8v7RaZTMYG4RBYrCOMD\n         WKGXOXO2ay9fsCIQSNp429tQnRumifl3XaVMfy3jSZAbt1HUghtRP2VgE6Y/SLz5Lmkq\n         NKEFW1u4IHqk8aXvM1cBzD6szJvPs5LSJjkmNuq/k/P+kH1QWQhrvs85Lyxzfgo3RSj+\n         qIG6+H1TK4JI3bBMbhwEiiapEJOVYj2DsGmeSoDTvNChGryidxJMQqpDTdz3mZ+ZE37K\n         bWxA==\nX-Gm-Message-State: AOAM530YXJN7SPi6YOZ/UjMpMOMY71KTCE4ZLpC/AcW60wbzOkjuyN9M\n    fWHiGc3H9WbfeAMOAzOBkY8vtybUr+Pw96kZMXAREDN/\nX-Google-Smtp-Source: ABdhPJz6Vyx6fBNDRDGMOl88iRuxk0moB4G3eJTCNLmoXHc1ZDYlXFgmJdhK8aHYgutvtMLZmiO1TJ06tqf6XTu1iHA=\nX-Received: by 2002:a17:90a:2e0a:: with SMTP id q10mr1050878pjd.130.1644862658470;\n Mon, 14 Feb 2022 10:17:38 -0800 (PST)\nMIME-Version: 1.0\nFrom: adristudy &lt;adristudy@gmail.com&gt;\nDate: Mon, 14 Feb 2022 19:17:27 +0100\nMessage-ID: &lt;CAG5uPRccDy2iqjcOTT29ekY6tNCcnsgy0VsA5pXjzdm7KCcLgw@mail.gmail.com&gt;\nSubject: Correo para la VPS\nTo: blackmamba@adrianjaramillo.tk\nContent-Type: multipart/alternative; boundary=\"00000000000076676e05d7fe6ef6\"\n--00000000000076676e05d7fe6ef6\nContent-Type: text/plain; charset=\"UTF-8\"\nPrueba\n--00000000000076676e05d7fe6ef6\nContent-Type: text/html; charset=\"UTF-8\"\n&lt;div dir=\"ltr\"&gt;Prueba&lt;/div&gt;\n--00000000000076676e05d7fe6ef6--\n</code></pre>"},{"location":"sri/practica-servidor-correo/#tarea-3-uso-de-alias-y-redirecciones","title":"Tarea 3: Uso de alias y redirecciones","text":""},{"location":"sri/practica-servidor-correo/#31","title":"3.1","text":"<p>Crear tarea cron</p> <p>Abro la configuraci\u00f3n:</p> <pre><code>crontab -e\n</code></pre> <p>A\u00f1ado lo siguiente:</p> <pre><code>MAILTO = root\n* * * * * echo Prueba de mensajes crontab\n</code></pre> <p>Esta tarea ejecuta un echo cada minuto y env\u00eda un correo a root con el resultado. No vemos ese echo por terminal ni en la sesi\u00f3n de nuestro usuario ni en la de root, pero nos sirve para hacer pruebas.</p>"},{"location":"sri/practica-servidor-correo/#32","title":"3.2","text":"<p>Comprobar que llegan correos en root</p> <pre><code>root@kampe:~# mail\n\"/var/mail/root\": 64 messages 64 unread\n&gt;U   1 Cron Daemon        Mon Feb 14 21:20  23/788   Cron &lt;blackmamba@kampe&gt; echo Prueba de mensajes crontab\n U   2 Cron Daemon        Mon Feb 14 21:21  22/762   Cron &lt;blackmamba@kampe&gt; echo Prueba de mensajes crontab\n U   3 Cron Daemon        Mon Feb 14 21:22  22/762   Cron &lt;blackmamba@kampe&gt; echo Prueba de mensajes crontab\n U   4 Cron Daemon        Mon Feb 14 21:23  22/762   Cron &lt;blackmamba@kampe&gt; echo Prueba de mensajes crontab\n</code></pre> <p>Son todos iguales, as\u00ed que muestro uno de ellos:</p> <p></p> <p>La parte que nos interesa es la marcada, el \"From\" y el \"To\". Los correos los env\u00eda el daemon de Cron usando root, hacia el usuario root. En el cuerpo del correo est\u00e1 el resultado del echo.</p> <p>Seg\u00fan como est\u00e1 ahora configurado cron, no nos llegar\u00edan esos correos a nuestro usuario.</p>"},{"location":"sri/practica-servidor-correo/#33","title":"3.3","text":"<p>Crear un alias para que lleguen los correos a <code>blackmamba</code></p> <p>Modifico <code>/etc/aliases</code>:</p> <pre><code># See man 5 aliases for format\npostmaster: root\nroot: blackmamba\n</code></pre> <p>Para que este cambio tome efecto ejecuto:</p> <pre><code>sudo newaliases\n</code></pre>"},{"location":"sri/practica-servidor-correo/#34","title":"3.4","text":"<p>Comprobar que ya llegan los correos a <code>blackmamba</code></p> <pre><code>blackmamba@kampe:~$ mail\n\"/var/mail/blackmamba\": 1 message 1 new\n&gt;N   1 Cron Daemon        Mon Feb 14 22:59  20/743   Cron &lt;blackmamba@kampe&gt; echo Prueba de mensajes crontab\n?\n</code></pre> <p>Lo abro:</p> <pre><code>? 1\nReturn-Path: &lt;blackmamba@adrianjaramillo.tk&gt;\nX-Original-To: root\nDelivered-To: root@adrianjaramillo.tk\nReceived: by kampe.adrianjaramillo.tk (Postfix, from userid 1000)\n    id BC48442AC0; Mon, 14 Feb 2022 22:59:01 +0000 (UTC)\nFrom: root@adrianjaramillo.tk (Cron Daemon)\nTo: root@adrianjaramillo.tk\nSubject: Cron &lt;blackmamba@kampe&gt; echo Prueba de mensajes crontab\nMIME-Version: 1.0\nContent-Type: text/plain; charset=UTF-8\nContent-Transfer-Encoding: 8bit\nX-Cron-Env: &lt;MAILTO=root&gt;\nX-Cron-Env: &lt;SHELL=/bin/sh&gt;\nX-Cron-Env: &lt;HOME=/home/blackmamba&gt;\nX-Cron-Env: &lt;PATH=/usr/bin:/bin&gt;\nX-Cron-Env: &lt;LOGNAME=blackmamba&gt;\nMessage-Id: &lt;20220214225901.BC48442AC0@kampe.adrianjaramillo.tk&gt;\nDate: Mon, 14 Feb 2022 22:59:01 +0000 (UTC)\nPrueba de mensajes crontab\n?\n</code></pre> <p>He mostrado el contenido para que se vea el campo \"To:\", que apunta a root, pero el alias funciona as\u00ed que me llega a mi usuario principal <code>blackmamba</code>.</p>"},{"location":"sri/practica-servidor-correo/#35","title":"3.5","text":"<p>Crear una redirecci\u00f3n para enviar esos correos a gmail</p> <p>Creo <code>/home/blackmamba/.forward</code> con el siguiente contenido:</p> <pre><code>adristudy@gmail.com\n</code></pre> <p>Veo en gmail que me est\u00e1n llegando:</p> <p></p>"},{"location":"sri/practica-servidor-correo/#tarea-4-para-asegurar-el-envio-opcional","title":"Tarea 4: Para asegurar el env\u00edo (opcional)","text":"<p>Configurar postfix con opendkim para firmar los correos que env\u00eda.</p>"},{"location":"sri/practica-servidor-correo/#41-pasos-iniciales","title":"4.1 Pasos iniciales","text":"<p>Instalo los paquetes:</p> <pre><code>sudo apt install opendkim opendkim-tools\n</code></pre> <p>A\u00f1ado el usuario postfix al grupo opendkim:</p> <pre><code>sudo gpasswd -a postfix opendkim\n</code></pre>"},{"location":"sri/practica-servidor-correo/#42-configuracion-opendkim","title":"4.2 Configuraci\u00f3n OpenDKIM","text":"<p><code>/etc/opendkim.conf</code>:</p> <pre><code># This is a basic configuration for signing and verifying. It can easily be\n# adapted to suit a basic installation. See opendkim.conf(5) and\n# /usr/share/doc/opendkim/examples/opendkim.conf.sample for complete\n# documentation of available configuration parameters.\n\nSyslog                      yes\nSyslogSuccess           yes\n#LogWhy         no\n\n# Common signing and verification parameters. In Debian, the \"From\" header is\n# oversigned, because it is often the identity key used by reputation systems\n# and thus somewhat security sensitive.\nCanonicalization    relaxed/simple\nMode                        s\nSubDomains          no\nOversignHeaders From\n# Signing domain, selector, and key (required). For example, perform signing\n# for domain \"example.com\" with selector \"2020\" (2020._domainkey.example.com),\n# using the private key stored in /etc/dkimkeys/example.private. More granular\n# setup options can be found in /usr/share/doc/opendkim/README.opendkim.\n#Domain         example.com\n#Selector           2020\n#KeyFile            /etc/dkimkeys/example.private\n\n# In Debian, opendkim runs as user \"opendkim\". A umask of 007 is required when\n# using a local socket with MTAs that access the socket as a non-privileged\n# user (for example, Postfix). You may need to add user \"postfix\" to group\n# \"opendkim\" in that case.\nUserID                      opendkim\nUMask                       007\n# Socket for the MTA connection (required). If the MTA is inside a chroot jail,\n# it must be ensured that the socket is accessible. In Debian, Postfix runs in\n# a chroot in /var/spool/postfix, therefore a Unix socket would have to be\n# configured as shown on the last line below.\n#Socket         local:/run/opendkim/opendkim.sock\n#Socket         inet:8891@localhost\n#Socket         inet:8891\nSocket                      local:/var/spool/postfix/opendkim/opendkim.sock\nPidFile         /run/opendkim/opendkim.pid\n# Hosts for which to sign rather than verify, default is 127.0.0.1. See the\n# OPERATION section of opendkim(8) for more information.\n#InternalHosts          192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12\n\n# The trust anchor enables DNSSEC. In Debian, the trust anchor file is provided\n# by the package dns-root-data.\nTrustAnchorFile /usr/share/dns/root.key\n#Nameservers            127.0.0.1\n\n# Map domains in From addresses to keys used to sign messages\nKeyTable           refile:/etc/opendkim/key.table\nSigningTable       refile:/etc/opendkim/signing.table\n</code></pre>"},{"location":"sri/practica-servidor-correo/#43-creacion-de-signing-y-key-table","title":"4.3 Creaci\u00f3n de Signing y Key Table","text":"<p>Creo la estructura de directorios para las claves:</p> <pre><code>sudo mkdir -p /etc/opendkim/keys\n</code></pre> <p>Modifico propietarios y permisos:</p> <pre><code>sudo chown -R opendkim:opendkim /etc/opendkim\nsudo chmod go-rw /etc/opendkim/keys\n</code></pre> <p>Creo la signing table...</p> <pre><code>sudo touch /etc/opendkim/signing.table\n</code></pre> <p>...con el siguiente contenido:</p> <pre><code>*@adrianjaramillo.tk      default._domainkey.adrianjaramillo.tk\n</code></pre> <p>Creo la key table...</p> <pre><code>sudo touch /etc/opendkim/key.table\n</code></pre> <p>...con el siguiente contenido:</p> <pre><code>default._domainkey.adrianjaramillo.tk     adrianjaramillo.tk:default:/etc/opendkim/keys/adrianjaramillo.tk/default.private\n</code></pre>"},{"location":"sri/practica-servidor-correo/#44-generacion-de-claves","title":"4.4 Generaci\u00f3n de claves","text":"<p>Creo un directorio para las claves del dominio:</p> <pre><code>sudo mkdir /etc/opendkim/keys/adrianjaramillo.tk\n</code></pre> <p>Genero las claves...</p> <pre><code>sudo opendkim-genkey -b 2048 -d adrianjaramillo.tk -D /etc/opendkim/keys/adrianjaramillo.tk -s default -v\n</code></pre> <p>...y este es el output:</p> <pre><code>opendkim-genkey: generating private key\nopendkim-genkey: private key written to default.private\nopendkim-genkey: extracting public key\nopendkim-genkey: DNS TXT record written to default.txt\n</code></pre> <p>Cambio los propietarios de la clave privada:</p> <pre><code>sudo chown opendkim:opendkim /etc/opendkim/keys/adrianjaramillo.tk/default.private\n</code></pre> <p>Compruebo que los permisos de la clave privada son correctos:</p> <pre><code>-rw------- 1 opendkim opendkim 1679 Mar  7 19:57 /etc/opendkim/keys/adrianjaramillo.tk/default.private\n</code></pre>"},{"location":"sri/practica-servidor-correo/#45-publicacion-de-la-clave-publica-en-mi-dns","title":"4.5 Publicaci\u00f3n de la clave p\u00fablica en mi DNS","text":"<p>La clave p\u00fablica generada se encuentra en el fichero <code>/etc/opendkim/keys/adrianjaramillo.tk/default.txt</code>.:</p> <pre><code>default._domainkey  IN  TXT ( \"v=DKIM1; h=sha256; k=rsa; \"\n      \"p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA66vm0/BhAdiyHkYz/AcaWPkUbnTXOlxCxKZQP3skWmCI5fZSBfwJpndYg1C05UyiCh3qsVXXnOZsiRoKK09vzDobKFw2ngRA5y3vTPKufY/Va/VNfNRdXd8fhUjffnAbxQ231WyTqHNrb2XjXoTY8/QBy/2Hexg1f7zZ4PqcM5+L6kzCGtzPJ0m7MfWCL6HQCbg82JX0aywITl\"\n      \"sKhieEJg0WXHnzX/wYD4rreOxG05QCfIT7zWMamJdaDfEuua8qLMdPnb714MnTq1zPizBQ+YEDkFKwSDkaeKRq44CBYjjZ+ma9yI7PMwYQ+LEkA0kKtFm8IaQMoAyMQQcF0dzIwQIDAQAB\" )  ; ----- DKIM key default for adrianjaramillo.tk\n</code></pre> <p>La string que aparece despu\u00e9s de la p es mi clave p\u00fablica.</p> <p>\u00bfC\u00f3mo la publicamos?</p> <p>En nuestro DNS tenemos que crear un registro TXT con nombre <code>default._domainkey</code> y valor todo lo que haya entre par\u00e9ntesis del fichero que acabo de mostrar.</p> <p>IMPORTANTE: tenemos que eliminar todas las comillas dobles y espacios no necesarios. La string de la clave p\u00fablica por alguna raz\u00f3n la parte en 2, pero hay que unirla.</p> <p>Es decir, el valor final se nos quedar\u00eda as\u00ed:</p> <pre><code>v=DKIM1; h=sha256; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA66vm0/BhAdiyHkYz/AcaWPkUbnTXOlxCxKZQP3skWmCI5fZSBfwJpndYg1C05UyiCh3qsVXXnOZsiRoKK09vzDobKFw2ngRA5y3vTPKufY/Va/VNfNRdXd8fhUjffnAbxQ231WyTqHNrb2XjXoTY8/QBy/2Hexg1f7zZ4PqcM5+L6kzCGtzPJ0m7MfWCL6HQCbg82JX0aywITlsKhieEJg0WXHnzX/wYD4rreOxG05QCfIT7zWMamJdaDfEuua8qLMdPnb714MnTq1zPizBQ+YEDkFKwSDkaeKRq44CBYjjZ+ma9yI7PMwYQ+LEkA0kKtFm8IaQMoAyMQQcF0dzIwQIDAQAB\n</code></pre> <p>Muestro que he creado dicho registro en mi DNS:</p> <p></p>"},{"location":"sri/practica-servidor-correo/#46-testeo-de-la-clave-publica","title":"4.6 Testeo de la clave p\u00fablica","text":"<p>Uso el siguiente comando:</p> <pre><code>sudo opendkim-testkey -d adrianjaramillo.tk -s default -vvv\n</code></pre> <p>Si todo funciona, deber\u00edamos de obtener un \"Key OK\":</p> <pre><code>opendkim-testkey: using default configfile /etc/opendkim.conf\nopendkim-testkey: checking key 'default._domainkey.adrianjaramillo.tk'\nopendkim-testkey: key not secure\nopendkim-testkey: key OK\n</code></pre> <p>Este comando lo que hace realmente es una consulta DNS. Se compara la clave privada que tenemos configurada con la p\u00fablica que aparece en el DNS, y se verifica si efectivamente ambas claves son del mismo par.</p> <p>Aparece \"key not secure\" pero de esto no tenemos que preocuparnos, simplemente significa que no tenemos habilitado DNSSEC en nuestro dominio. Por lo que he investigado, freenom no lo soporta.</p> <p>Tambi\u00e9n podemos usar la web https://mxtoolbox.com/dkim.aspx para comprobar el registro DKIM. Importante que escribamos nuestro selector correctamente:</p> <p></p> <p>Vemos que el registro DKIM publicado en mi DNS es v\u00e1lido:</p> <p></p>"},{"location":"sri/practica-servidor-correo/#47-configuracion-de-postfix-con-opendkim","title":"4.7 Configuraci\u00f3n de Postfix con OpenDKIM","text":"<p>Creo el directorio donde se crear\u00e1 el socket de OpenDKIM:</p> <pre><code>sudo mkdir /var/spool/postfix/opendkim\n</code></pre> <p>Modifico los propietarios:</p> <pre><code>sudo chown opendkim:postfix /var/spool/postfix/opendkim\n</code></pre> <p>Modifico <code>/etc/opendkim.conf</code> para cambiar el socket que utiliza. Comento la l\u00ednea:</p> <pre><code>Socket                  local:/run/opendkim/opendkim.sock\n</code></pre> <p>Y descomento la l\u00ednea:</p> <pre><code>Socket                  local:/var/spool/postfix/opendkim/opendkim.sock\n</code></pre> <p>Por \u00faltimo, a\u00f1ado lo siguiente al final de <code>/etc/postfix/main.cf</code>:</p> <pre><code># Milter configuration\nsmtpd_milters = local:opendkim/opendkim.sock\nnon_smtpd_milters = $smtpd_milters\nmilter_default_action = accept\nmilter_protocol = 6\n</code></pre>"},{"location":"sri/practica-servidor-correo/#48-reinicio-de-servicios","title":"4.8 Reinicio de servicios","text":"<pre><code>sudo systemctl restart opendkim postfix\n</code></pre>"},{"location":"sri/practica-servidor-correo/#49-comprobaciones","title":"4.9 Comprobaciones","text":"<p>Tras haberme enviado un correo a gmail, muestro el original para ver que haya pasado el chequeo DKIM:</p> <p></p> <p>En el correo en crudo vemos que tenemos un campo de firma DKIM:</p> <p></p> <p>Tambi\u00e9n podemos mirar <code>/var/log/mail.log</code> filtrando por dkim para ver que se realiza la firma:</p> <p></p>"},{"location":"sri/practica-servidor-correo/#gestion-de-correos-desde-un-cliente","title":"Gesti\u00f3n de correos desde un cliente","text":""},{"location":"sri/practica-servidor-correo/#tarea-8","title":"Tarea 8","text":""},{"location":"sri/practica-servidor-correo/#81","title":"8.1","text":"<p>Borrar el fichero <code>.forward</code> anteriormente creado</p> <pre><code>rm .forward\n</code></pre> <p>Es obligatorio que borremos este fichero para que lo que hagamos durante esta tarea funcione, y los correos lleguen a <code>Maildir</code> correctamente.</p> <p>\u00bfPor qu\u00e9? El fichero <code>.forward</code> tiene el siguiente funcionamiento:</p> <p></p> <p>Es decir, si tenemos un fichero <code>.forward</code> no podremos recibir ning\u00fan correo en usuarios locales.</p>"},{"location":"sri/practica-servidor-correo/#82","title":"8.2","text":"<p>Configurar postfix con buz\u00f3n Maildir</p> <p>A\u00f1ado lo siguiente a <code>/etc/postfix/main.cf</code>:</p> <pre><code>home_mailbox = Maildir/\n</code></pre> <p>Reinicio postfix:</p> <pre><code>sudo systemctl restart postfix\n</code></pre>"},{"location":"sri/practica-servidor-correo/#83","title":"8.3","text":"<p>Enviar un correo a <code>blackmamba</code></p> <p>Hago la prueba:</p> <pre><code>blackmamba@kampe:~$ mail -r blackmamba@localhost blackmamba@localhost\nCc:\nSubject: Prueba Maildir\nMensaje\n</code></pre>"},{"location":"sri/practica-servidor-correo/#84","title":"8.4","text":"<p>Comprobar que el correo se ha guardado en el buz\u00f3n Maildir</p> <p>Primero compruebo <code>/var/log/mail.log</code> para ver que haya llegado correctamente:</p> <p></p> <p>\"delivered to maildir\" significa que ha funcionado correctamente.</p> <p>Lo siguiente a comprobar es la estructura de <code>Maildir</code> que se nos ha generado en el home:</p> <pre><code>blackmamba@kampe:~$ tree Maildir/\nMaildir/\n|-- cur\n|-- new\n|   `-- 1644944881.Vfe01I605c1M715492.kampe\n`-- tmp\n3 directories, 1 file\n</code></pre> <p>\u00a1Atenci\u00f3n! NO TENEMOS que crear esta estructura de directorios manualmente para que funcione, lo hace postfix.</p>"},{"location":"sri/practica-servidor-correo/#85","title":"8.5","text":"<p>Visualizar el correo recibido en <code>Maildir</code></p> <p>Podr\u00edamos perfectamente abrir manualmente los ficheros con <code>cat</code>, pero esto es rudimentario, usaremos la herramienta <code>mail</code>.</p> <p>Seg\u00fan se dice en la gu\u00eda de Jos\u00e9 Domingo, desde que usamos <code>Maildir</code> como buz\u00f3n ya no podremos visualizar los correos con <code>mail</code>. Esto es cierto si ejecutamos el comando sin argumentos:</p> <pre><code>blackmamba@kampe:~$ mail\nNo mail for blackmamba\n</code></pre> <p>PERO podemos hacer lo siguiente:</p> <pre><code>blackmamba@kampe:~$ mail -f Maildir\n\"/home/blackmamba/Maildir\": 1 message 1 new\n&gt;N   1 blackmamba@localho Tue Feb 15 17:08  13/459   Prueba Maildir\n? 1\nReturn-Path: &lt;blackmamba@localhost&gt;\nX-Original-To: blackmamba@localhost\nDelivered-To: blackmamba@localhost\nReceived: by kampe.adrianjaramillo.tk (Postfix, from userid 1000)\n    id A9FDB42CF6; Tue, 15 Feb 2022 17:08:01 +0000 (UTC)\nTo: &lt;blackmamba@localhost&gt;\nSubject: Prueba Maildir\nX-Mailer: mail (GNU Mailutils 3.10)\nMessage-Id: &lt;20220215170801.A9FDB42CF6@kampe.adrianjaramillo.tk&gt;\nDate: Tue, 15 Feb 2022 17:08:01 +0000 (UTC)\nFrom: blackmamba@localhost\nMensaje\n?\n</code></pre> <p>Indicando la ruta de <code>Maildir</code> con <code>mail -f</code> nos posibilita ver los correos perfectamente.</p> <p>Muestro el man de <code>mail</code> para un mejor entendimiento:</p> <p></p>"},{"location":"sri/practica-servidor-correo/#tarea-9","title":"Tarea 9","text":""},{"location":"sri/practica-servidor-correo/#91","title":"9.1","text":"<p>Instalar Dovecot para ofrecer el protocolo IMAPS</p> <pre><code>sudo apt install dovecot-imapd\n</code></pre> <p>Lo primero que podemos ver es que estar\u00e1 escuchando en el puerto que necesitamos:</p> <p></p> <p>Tenemos que permitir ese tr\u00e1fico en el firewall de la vps:</p> <p></p> <p>Hacemos una primera prueba de comunicaci\u00f3n con el puerto desde nuestro host:</p> <pre><code>atlas@olympus:~$ telnet 87.106.228.149 993\nTrying 87.106.228.149...\nConnected to 87.106.228.149.\nEscape character is '^]'.\n</code></pre>"},{"location":"sri/practica-servidor-correo/#92","title":"9.2","text":"<p>Configurar Dovecot para que use el buz\u00f3n Maildir</p> <p>Modifico <code>/etc/dovecot/conf.d/10-mail.conf</code>:</p> <pre><code>mail_location = maildir:~/Maildir\n</code></pre> <p>Reinicio dovecot:</p> <pre><code>sudo systemctl restart dovecot\n</code></pre>"},{"location":"sri/practica-servidor-correo/#93","title":"9.3","text":"<p>Configurar el cifrado de la comunicaci\u00f3n por IMAPS en Dovecot con certificado. Usar el wildcard <code>*.adrianjaramillo.tk</code> que ya ten\u00edamos.</p> <p>Modifico <code>/etc/dovecot/conf.d/10-ssl.conf</code>:</p> <pre><code>##\n## SSL settings\n##\n# SSL/TLS support: yes, no, required. &lt;doc/wiki/SSL.txt&gt;\nssl = yes\n# PEM encoded X.509 SSL/TLS certificate and private key. They're opened before\n# dropping root privileges, so keep the key file unreadable by anyone but\n# root. Included doc/mkcert.sh can be used to easily generate self-signed\n# certificate, just make sure to update the domains in dovecot-openssl.cnf\nssl_cert = &lt;/etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem\nssl_key = &lt;/etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem\n</code></pre> <p>S\u00f3lo muestro el principio del fichero, porque es lo que he modificado.</p> <p>Reinicio dovecot:</p> <pre><code>sudo systemctl restart dovecot\n</code></pre>"},{"location":"sri/practica-servidor-correo/#94","title":"9.4","text":"<p>Configurar evolution para recibir los correos del vps</p> <p>Abro la configuraci\u00f3n para una nueva cuenta de mail:</p> <p></p> <p>Indico mi cuenta de correo y un nombre (podr\u00e1 ser cualquiera, evolution s\u00f3lo lo usa para identificar la conexi\u00f3n):</p> <p></p> <p>Configuro la recepci\u00f3n de correos:</p> <p></p> <p>La autenticaci\u00f3n se va a realizar con usuarios del sistema, por eso escribo <code>blackmamba</code>. Para que funcione la autenticaci\u00f3n en Dovecot no he tenido que configurar nada, ya funciona por defecto.</p> <p>Mantengo las opciones de recepci\u00f3n por defecto:</p> <p></p> <p>Relleno las opciones de env\u00edo para que me deje terminar la configuraci\u00f3n, pero ESTE NO ES el objetivo de este apartado, as\u00ed que la configuraci\u00f3n estar\u00e1 incompleta y por supuesto, no funcional:</p> <p></p> <p>El env\u00edo se configurar\u00e1 en la tarea 11.</p> <p>Muestro el resumen final de la configuraci\u00f3n, y de nuevo ignoramos la parte referente al env\u00edo:</p> <p></p> <p>Por \u00faltimo se nos pregunta la contrase\u00f1a del usuario que hemos indicado anteriormente:</p> <p></p> <p>Compruebo que puedo leer el correo de <code>Maildir</code> que envi\u00e9 en la tarea anterior:</p> <p></p> <p>Evolution se sincroniza con Dovecot de forma live, as\u00ed que podr\u00edamos enviar un correo y Evolution lo recibir\u00eda autom\u00e1ticamente. Muestro la prueba:</p> <p></p>"},{"location":"sri/practica-servidor-correo/#tarea-11","title":"Tarea 11","text":""},{"location":"sri/practica-servidor-correo/#111","title":"11.1","text":"<p>Configurar postfix para ofrecer el protocolo SMTPS</p> <p>Descomento el siguiente bloque en <code>/etc/postfix/master.cf</code>:</p> <pre><code>smtps     inet  n       -       y       -       -       smtpd\n  -o syslog_name=postfix/smtps\n  -o smtpd_tls_wrappermode=yes\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_reject_unlisted_recipient=no\n  -o smtpd_client_restrictions=$mua_client_restrictions\n  -o smtpd_helo_restrictions=$mua_helo_restrictions\n  -o smtpd_sender_restrictions=$mua_sender_restrictions\n  -o smtpd_recipient_restrictions=\n  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject\n  -o milter_macro_daemon_name=ORIGINATING\n</code></pre> <p>Reinicio postfix:</p> <pre><code>sudo systemctl restart postfix\n</code></pre> <p>Compruebo que ahora funciona el puerto SMTPS 465:</p> <p></p> <p>Tenemos que permitir ese tr\u00e1fico en el firewall de la vps:</p> <p></p> <p>Hago una primera prueba de comunicaci\u00f3n con el puerto desde nuestro host:</p> <pre><code>atlas@olympus:~$ telnet 87.106.228.149 465\nTrying 87.106.228.149...\nConnected to 87.106.228.149.\nEscape character is '^]'.\n</code></pre>"},{"location":"sri/practica-servidor-correo/#112","title":"11.2","text":"<p>Usar certificados para cifrar el env\u00edo de correos</p> <p>Modifico lo siguiente en <code>/etc/postfix/main.cf</code>:</p> <pre><code>smtpd_tls_cert_file=/etc/letsencrypt/live/adrianjaramillo.tk/fullchain.pem\nsmtpd_tls_key_file=/etc/letsencrypt/live/adrianjaramillo.tk/privkey.pem\n</code></pre> <p>Reinicio postfix:</p> <pre><code>sudo systemctl restart postfix\n</code></pre>"},{"location":"sri/practica-servidor-correo/#113","title":"11.3","text":"<p>Configurar autenticaci\u00f3n SASL tanto en Postfix como en Dovecot</p> <p>A\u00f1ado lo siguiente a <code>/etc/postfix/main.cf</code>:</p> <pre><code># Authentication\n\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_sasl_auth_enable = yes\n</code></pre> <p>Reinicio postfix:</p> <pre><code>sudo systemctl restart postfix\n</code></pre> <p>Descomento el siguiente bloque en <code>/etc/dovecot/conf.d/10-master.conf</code>:</p> <pre><code>  # Postfix smtp-auth\n  unix_listener /var/spool/postfix/private/auth {\n    mode = 0666\n  }\n</code></pre> <p>Reinicio dovecot:</p> <pre><code>sudo systemctl restart dovecot\n</code></pre>"},{"location":"sri/practica-servidor-correo/#114","title":"11.4","text":"<p>Configurar evolution para enviar correos y mostrar una prueba de env\u00edo</p> <p>Borro la conexi\u00f3n anterior para poder crear una nueva:</p> <p></p> <p>Creo una nueva conexi\u00f3n, y muestro directamente la configuraci\u00f3n de env\u00edo:</p> <p></p> <p>En el resumen final compruebo que la informaci\u00f3n de env\u00edo sea correcta:</p> <p></p> <p>Env\u00edo un correo:</p> <p></p> <p>Antes de que se realice el env\u00edo, se pide autenticaci\u00f3n:</p> <p></p> <p>Compruebo que me ha llegado el correo a gmail:  </p> <p></p> <p>Si queremos estar incluso m\u00e1s seguros de que este correo efectivamente se ha enviado desde Evolution y alg\u00fan detalle m\u00e1s, podemos abrir el original y mostrar sus cabeceras:</p> <p></p>"},{"location":"sri/practica-servidor-correo/#tarea-13-comprobacion-final","title":"Tarea 13: comprobaci\u00f3n final","text":"<p>Enviar un correo a esta p\u00e1gina para obtener una puntuaci\u00f3n. Mostrar el resultado.</p> <p>Este es el correo que enviaremos:</p> <p></p> <p>Haz click aqu\u00ed para ver mis resultados.</p>"},{"location":"sri/practica-servidor-dhcp/","title":"Pr\u00e1ctica: Servidor DHCP","text":""},{"location":"sri/practica-servidor-dhcp/#tarea-1","title":"Tarea 1","text":"<p>Escenario:</p> <ul> <li>Servidor:<ul> <li>NAT para dar salida a Internet (la tratamos como si fuera una p\u00fablica)</li> <li>Privada1 (veryisolated)</li> <li>Privada2 (veryisolated)</li> </ul> </li> <li>nodo_lan1: cliente conectado a privada1</li> <li>nodo_lan2: cliente conectado a privada2</li> <li>nodowin10: cliente conectado a privada1</li> </ul> <pre><code>Vagrant.configure(\"2\") do |config|\n\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n  config.vm.define :servidor do |servidor|\n    servidor.vm.box = \"debian/bullseye64\"\n    servidor.vm.hostname = \"servidor\"\n    servidor.vm.network :private_network,\n      :libvirt__network_name =&gt; \"practica-dhcp-nat\",\n      :ip =&gt; \"192.168.0.2\"\n    servidor.vm.network :private_network,\n      :libvirt__network_name =&gt; \"practica-dhcp-privada1\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.100.1\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n    servidor.vm.network :private_network,\n      :libvirt__network_name =&gt; \"practica-dhcp-privada2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"192.168.200.1\",\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :nodolan1 do |nodolan1|\n    nodolan1.vm.box = \"debian/bullseye64\"\n    nodolan1.vm.hostname = \"nodolan1\"\n    nodolan1.vm.network :private_network,\n      :libvirt__network_name =&gt; \"practica-dhcp-privada1\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :nodolan2 do |nodolan2|\n    nodolan2.vm.box = \"debian/bullseye64\"\n    nodolan2.vm.hostname = \"nodolan2\"\n    nodolan2.vm.network :private_network,\n      :libvirt__network_name =&gt; \"practica-dhcp-privada2\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\n  config.vm.define :nodowin10 do |nodowin10|\n    nodowin10.vm.box = \"jborean93/WindowsServer2016\"\n    nodowin10.vm.guest = :windows\n    nodowin10.vm.hostname = \"nodowin10\"\n    nodowin10.vm.communicator = \"winrm\"\n    nodowin10.vm.network :private_network,\n      :libvirt__network_name =&gt; \"practica-dhcp-privada1\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :libvirt__forward_mode =&gt; \"veryisolated\"\n  end\n\nend\n</code></pre> <p>Para conectarnos a <code>nodowin10</code> hacemos: <pre><code>vagrant ssh nodowin10\n</code></pre></p>"},{"location":"sri/practica-servidor-dhcp/#tarea-2","title":"Tarea 2","text":"<p>Instalaci\u00f3n servidor DHCP</p> <pre><code>sudo apt update &amp;&amp; sudo apt install isc-dhcp-server\n</code></pre> <p>Configuraci\u00f3n DHCP</p> <p>En <code>/etc/default/isc-dhcp-server</code>:</p> <ul> <li>Descomentar la l\u00ednea: <code>DHCPDv4_CONF=/etc/dhcp/dhcpd.conf</code></li> <li>Especificar interfaces: <code>INTERFACESv4=\"eth2 eth3\"</code> </li> </ul> <p>En <code>/etc/dhcp/dhcpd.conf</code>: <pre><code>subnet 192.168.100.0 netmask 255.255.255.0 {\n  range 192.168.100.100 192.168.100.150;\n  option subnet-mask 255.255.255.0;\n  option routers 192.168.100.1;\n  option domain-name-servers 1.1.1.1, 1.0.0.1;\n  default-lease-time 43200;\n  max-lease-time 43200;\n}\n\nsubnet 192.168.200.0 netmask 255.255.255.0 {\n  range 192.168.200.100 192.168.200.150;\n  option subnet-mask 255.255.255.0;\n  option routers 192.168.200.1;\n  option domain-name-servers 1.1.1.1, 1.0.0.1;\n  default-lease-time 3600;\n  max-lease-time 3600;\n}\n</code></pre></p> <p>Reiniciar el servicio: <pre><code>sudo systemctl restart isc-dhcp-server\n</code></pre></p> <p>Listar concesiones y comprobaci\u00f3n</p> <p>Nodolan1 concesi\u00f3n: <pre><code>lease 192.168.100.101 {\n  starts 3 2021/10/20 06:40:30;\n  ends 3 2021/10/20 18:40:30;\n  cltt 3 2021/10/20 06:40:30;\n  binding state active;\n  next binding state free;\n  rewind binding state free;\n  hardware ethernet 52:54:00:57:5b:cf;\n  client-hostname \"nodolan1\";\n}\n</code></pre></p> <p>Nodolan1 comprobaci\u00f3n: <pre><code>3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:57:5b:cf brd ff:ff:ff:ff:ff:ff\n    altname enp0s6\n    altname ens6\n    inet 192.168.100.101/24 brd 192.168.100.255 scope global dynamic eth1\n       valid_lft 41316sec preferred_lft 41316sec\n    inet6 fe80::5054:ff:fe57:5bcf/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>Nodolan2 concesi\u00f3n: <pre><code>lease 192.168.200.101 {\n  starts 3 2021/10/20 07:15:53;\n  ends 3 2021/10/20 08:15:53;\n  cltt 3 2021/10/20 07:15:53;\n  binding state active;\n  next binding state free;\n  rewind binding state free;\n  hardware ethernet 52:54:00:eb:66:51;\n  client-hostname \"nodolan2\";\n}\n</code></pre></p> <p>Nodolan2 comprobaci\u00f3n: <pre><code>3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:eb:66:51 brd ff:ff:ff:ff:ff:ff\n    altname enp0s6\n    altname ens6\n    inet 192.168.200.101/24 brd 192.168.200.255 scope global dynamic eth1\n       valid_lft 3599sec preferred_lft 3599sec\n    inet6 fe80::5054:ff:feeb:6651/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>Nodowin10 concesi\u00f3n: <pre><code>lease 192.168.100.102 {\n  starts 3 2021/10/20 07:37:44;\n  ends 3 2021/10/20 19:37:44;\n  cltt 3 2021/10/20 07:37:44;\n  binding state active;\n  next binding state free;\n  rewind binding state free;\n  hardware ethernet 52:54:00:57:de:32;\n  uid \"\\001RT\\000W\\3362\";\n  set vendor-class-identifier = \"MSFT 5.0\";\n  client-hostname \"nodowin10\";\n}\n</code></pre></p> <p>Nodowin10 comprobaci\u00f3n: <pre><code>Ethernet adapter Ethernet 2:                                                                            \n\n   Connection-specific DNS Suffix  . :                                                                  \n   Description . . . . . . . . . . . : Red Hat VirtIO Ethernet Adapter #2                               \n   Physical Address. . . . . . . . . : 52-54-00-57-DE-32                                                \n   DHCP Enabled. . . . . . . . . . . : Yes                                                              \n   Autoconfiguration Enabled . . . . : Yes                                                              \n   Link-local IPv6 Address . . . . . : fe80::c1c4:20a1:511b:ecc8%2(Preferred)                           \n   IPv4 Address. . . . . . . . . . . : 192.168.100.102(Preferred)                                       \n   Subnet Mask . . . . . . . . . . . : 255.255.255.0                                                    \n   Lease Obtained. . . . . . . . . . : Wednesday, October 20, 2021 7:37:44 AM                           \n   Lease Expires . . . . . . . . . . : Wednesday, October 20, 2021 7:37:43 PM                           \n   Default Gateway . . . . . . . . . : 192.168.100.1                                                    \n   DHCP Server . . . . . . . . . . . : 192.168.100.1                                                    \n   DHCPv6 IAID . . . . . . . . . . . : 72504320                                                         \n   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-29-01-8E-B1-52-54-00-CE-85-A1                        \n   DNS Servers . . . . . . . . . . . : 1.1.1.1                                                          \n                                       1.0.0.1                                                          \n   NetBIOS over Tcpip. . . . . . . . : Enabled   \n</code></pre></p> <p>Cambios en clientes para configuraci\u00f3n DHCP</p> <p>En <code>nodolan1</code>:</p> <ul> <li>Cambiar <code>/etc/network/interfaces</code>:</li> </ul> <pre><code>allow-hotplug eth0\niface eth0 inet dhcp\n  post-up ip route del default dev $IFACE || true\n\nauto eth1\niface eth1 inet dhcp\n</code></pre> <ul> <li>Pedir configuraci\u00f3n:  </li> </ul> <pre><code>sudo dhclient eth1\n</code></pre> <p>En <code>nodolan2</code>:</p> <ul> <li>Cambiar <code>/etc/network/interfaces</code>:</li> </ul> <p><pre><code>allow-hotplug eth0\niface eth0 inet dhcp\n  post-up ip route del default dev $IFACE || true\n\nauto eth1\niface eth1 inet dhcp\n</code></pre> - Pedir configuraci\u00f3n:</p> <pre><code>sudo dhclient eth1\n</code></pre> <p>En <code>nodowin10</code>: <pre><code>ipconfig /renew \"Ethernet 2\"\n</code></pre></p>"},{"location":"sri/practica-servidor-dhcp/#tarea-3","title":"Tarea 3","text":"<p>Servidor DHCP como router-NAT para que los clientes tengan internet</p> <p>Hago router-nat y persistente: <pre><code>sudo modprobe iptable_nat\necho \"iptable_nat\" &gt;&gt; /etc/modules\n</code></pre> <pre><code>echo \"1\" &gt; /proc/sys/net/ipv4/ip_forward\necho \"net.ipv4.ip_forward=1\" &gt;&gt; /etc/sysctl.conf\n</code></pre> <pre><code>sudo iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE\nsudo apt install iptables-persistent\n</code></pre></p> <p>Cambio ruta por defecto para que el tr\u00e1fico salga por la interfaz NAT que hab\u00edamos definido: <pre><code>sudo ip route del default\nsudo ip route add default via 192.168.0.1\n</code></pre></p> <p>Hago este cambio persistente modificando <code>/etc/network/interfaces</code>: <pre><code>allow-hotplug eth0\niface eth0 inet dhcp\n   post-up ip route del default dev $IFACE\n\nauto eth1\niface eth1 inet static\n      address 192.168.0.2\n      netmask 255.255.255.0\n      gateway 192.168.0.1\n</code></pre> (muestro s\u00f3lo los fragmentos modificados)</p> <p>Mostrar rutas por defecto</p> <p>En <code>servidor</code> <pre><code>vagrant@servidor:~$ ip r\ndefault via 192.168.0.1 dev eth1 onlink\n192.168.0.0/24 dev eth1 proto kernel scope link src 192.168.0.2\n192.168.100.0/24 dev eth2 proto kernel scope link src 192.168.100.1\n192.168.121.0/24 dev eth0 proto kernel scope link src 192.168.121.164\n192.168.200.0/24 dev eth3 proto kernel scope link src 192.168.200.1\n</code></pre></p> <p>En <code>nodolan1</code> <pre><code>vagrant@nodolan1:~$ ip r\ndefault via 192.168.100.1 dev eth1\n192.168.100.0/24 dev eth1 proto kernel scope link src 192.168.100.100\n192.168.121.0/24 dev eth0 proto kernel scope link src 192.168.121.193\n</code></pre></p> <p>En <code>nodolan2</code> <pre><code>vagrant@nodolan2:~$ ip r\ndefault via 192.168.200.1 dev eth1\n192.168.121.0/24 dev eth0 proto kernel scope link src 192.168.121.97\n192.168.200.0/24 dev eth1 proto kernel scope link src 192.168.200.100\n</code></pre></p> <p>En <code>nodowin10</code> <pre><code>Ethernet adapter Ethernet 2:                                                                            \n\n   Connection-specific DNS Suffix  . :                                                                  \n   Link-local IPv6 Address . . . . . : fe80::c1c4:20a1:511b:ecc8%2                                      \n   IPv4 Address. . . . . . . . . . . : 192.168.100.102                                                  \n   Subnet Mask . . . . . . . . . . . : 255.255.255.0                                                    \n   Default Gateway . . . . . . . . . : 192.168.100.1    \n</code></pre></p> <p>Pruebas de acceso a Internet en clientes</p> <p>En <code>nodolan1</code>:</p> <ul> <li>ping</li> </ul> <pre><code>vagrant@nodolan1:~$ ping www.example.org\nPING www.example.org (93.184.216.34) 56(84) bytes of data.\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=1 ttl=52 time=142 ms\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=2 ttl=52 time=160 ms\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=3 ttl=52 time=185 ms\n^C\n--- www.example.org ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 142.480/162.336/184.700/17.327 ms\n</code></pre> <ul> <li>dig</li> </ul> <pre><code>vagrant@nodolan1:~$ dig www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; www.example.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 21798\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n;; QUESTION SECTION:\n;www.example.org.       IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    82705   IN  A   93.184.216.34\n\n;; Query time: 48 msec\n;; SERVER: 1.1.1.1#53(1.1.1.1)\n;; WHEN: Wed Oct 20 10:16:57 UTC 2021\n;; MSG SIZE  rcvd: 60\n</code></pre> <p>En <code>nodolan2</code>:</p> <ul> <li>ping</li> </ul> <pre><code>vagrant@nodolan2:~$ ping www.example.org\nPING www.example.org (93.184.216.34) 56(84) bytes of data.\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=1 ttl=52 time=143 ms\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=2 ttl=52 time=332 ms\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=3 ttl=52 time=193 ms\n\n64 bytes from 93.184.216.34 (93.184.216.34): icmp_seq=4 ttl=52 time=142 ms\n^C\n--- www.example.org ping statistics ---\n5 packets transmitted, 4 received, 20% packet loss, time 4000ms\nrtt min/avg/max/mdev = 142.189/202.596/332.117/77.558 ms\n</code></pre> <ul> <li>dig</li> </ul> <pre><code>vagrant@nodolan2:~$ dig www.example.org\n\n; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; www.example.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 4706\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n;; QUESTION SECTION:\n;www.example.org.       IN  A\n\n;; ANSWER SECTION:\nwww.example.org.    82395   IN  A   93.184.216.34\n\n;; Query time: 472 msec\n;; SERVER: 1.1.1.1#53(1.1.1.1)\n;; WHEN: Wed Oct 20 10:22:02 UTC 2021\n;; MSG SIZE  rcvd: 60\n</code></pre> <p>En <code>nodowin10</code>:</p> <ul> <li>ping</li> </ul> <pre><code>vagrant@NODOWIN10 C:\\Users\\vagrant&gt;ping www.example.org                                                 \n\nPinging www.example.org [93.184.216.34] with 32 bytes of data:                                          \nReply from 93.184.216.34: bytes=32 time=141ms TTL=52                                                    \nReply from 93.184.216.34: bytes=32 time=149ms TTL=52                                                    \nReply from 93.184.216.34: bytes=32 time=141ms TTL=52                                                    \nReply from 93.184.216.34: bytes=32 time=142ms TTL=52                                                    \n\nPing statistics for 93.184.216.34:                                                                      \n    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),                                                \nApproximate round trip times in milli-seconds:                                                          \n    Minimum = 141ms, Maximum = 149ms, Average = 143ms   \n</code></pre> <ul> <li>nslookup  </li> </ul> <p>Hay 2 interfaces con configuraci\u00f3n DNS, por lo que modifico la prioridad de interfaces. De esta manera me aseguro de que use los DNS que reparte nuestro servidor DHCP en las resoluciones.</p> <p>Averiguar el \"InterfaceIndex\" de \"Ethernet 2\": <pre><code>Get-NetIPInterface\n</code></pre> <pre><code>ifIndex InterfaceAlias                  AddressFamily NlMtu(Bytes) InterfaceMetric Dhcp     ConnectionS\n                                                                                            tate        \n------- --------------                  ------------- ------------ --------------- ----     -----------\n4       isatap.{05B72441-FF4C-475D-B... IPv6                  1280              75 Disabled Disconne...\n2       Ethernet 2                      IPv6                  1500              15 Enabled  Connected   \n5       Teredo Tunneling Pseudo-Inte... IPv6                  1280              75 Enabled  Connected   \n7       Ethernet                        IPv6                  1500              15 Enabled  Connected   \n3       isatap.{D6D1085A-1F02-4C69-A... IPv6                  1280              75 Disabled Disconne...\n1       Loopback Pseudo-Interface 1     IPv6            4294967295              75 Disabled Connected   \n2       Ethernet 2                      IPv4                  1500              15 Enabled  Connected   \n7       Ethernet                        IPv4                  1500              15 Enabled  Connected   \n1       Loopback Pseudo-Interface 1     IPv4            4294967295              75 Disabled Connected   \n</code></pre></p> <p>Modificamos su prioridad: <pre><code>Set-NetIPInterface -InterfaceIndex 2 -InterfaceMetric 10\n</code></pre></p> <p>Vemos que la prioridad ha cambiado: <pre><code>PS C:\\Users\\vagrant&gt; Get-NetIPInterface                                                                 \n\nifIndex InterfaceAlias                  AddressFamily NlMtu(Bytes) InterfaceMetric Dhcp     ConnectionS\n                                                                                            tate        \n------- --------------                  ------------- ------------ --------------- ----     -----------\n4       isatap.{05B72441-FF4C-475D-B... IPv6                  1280              75 Disabled Disconne...\n2       Ethernet 2                      IPv6                  1500              10 Enabled  Connected   \n5       Teredo Tunneling Pseudo-Inte... IPv6                  1280              75 Enabled  Connected   \n7       Ethernet                        IPv6                  1500              15 Enabled  Connected   \n3       isatap.{D6D1085A-1F02-4C69-A... IPv6                  1280              75 Disabled Disconne...\n1       Loopback Pseudo-Interface 1     IPv6            4294967295              75 Disabled Connected   \n2       Ethernet 2                      IPv4                  1500              10 Enabled  Connected   \n7       Ethernet                        IPv4                  1500              15 Enabled  Connected   \n1       Loopback Pseudo-Interface 1     IPv4            4294967295              75 Disabled Connected   \n</code></pre></p> <p>Hacemos la consulta DNS: <pre><code>PS C:\\Users\\vagrant&gt; nslookup www.example.org                                                           \nServer:  one.one.one.one                                                                                \nAddress:  1.1.1.1                                                                                       \n\nNon-authoritative answer:                                                                               \nName:    www.example.org                                                                                \nAddresses:  2606:2800:220:1:248:1893:25c8:1946                                                          \n          93.184.216.34   \n</code></pre></p>"},{"location":"sri/practica-servidor-dhcp/#tarea-4","title":"Tarea 4","text":"<p>Con los clientes configurados apagamos el servidor DHCP. \u00bfQu\u00e9 ocurrir\u00e1 tanto en Linux como en Windows?</p> <p>De ahora en adelante, <code>default-lease-time</code> y <code>max-lease-time</code> ser\u00e1n de 10 segundos para realizar esta tarea y la siguiente.</p> <p>As\u00ed queda: <pre><code>subnet 192.168.100.0 netmask 255.255.255.0 {\n  range 192.168.100.100 192.168.100.150;\n  option subnet-mask 255.255.255.0;\n  option routers 192.168.100.1;\n  option domain-name-servers 1.1.1.1, 1.0.0.1;\n  default-lease-time 10;\n  max-lease-time 10;\n}\n\nsubnet 192.168.200.0 netmask 255.255.255.0 {\n  range 192.168.200.100 192.168.200.150;\n  option subnet-mask 255.255.255.0;\n  option routers 192.168.200.1;\n  option domain-name-servers 1.1.1.1, 1.0.0.1;\n  default-lease-time 10;\n  max-lease-time 10;\n}\n</code></pre></p> <p>Tenemos que reiniciar el servicio para que se apliquen estos cambios: <pre><code>sudo systemctl restart isc-dhcp-server\n</code></pre></p> <p>Despu\u00e9s de esto los clientes no actualizar\u00e1n sus tiempos hasta que no pase el tiempo indicado, pero forzamos esto soltando el lease y pidiendo uno nuevo.</p> <p>En los clientes linux hacemos: <pre><code>sudo dhclient -r eth1\nsudo dhclient eth1\n</code></pre></p> <p>En el cliente Windows hacemos: <pre><code>ipconfig /release \"Ethernet 2\"\nipconfig /renew \"Ethernet 2\"\n</code></pre></p> <p>Ya teniendo los tiempos actualizados en todos los clientes, procedo a apagar el servidor.</p> <p>Los clientes linux pierden la configuraci\u00f3n por completo: <pre><code>3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:57:5b:cf brd ff:ff:ff:ff:ff:ff\n    altname enp0s6\n    altname ens6\n    inet6 fe80::5054:ff:fe57:5bcf/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>El cliente Windows pierde la configuraci\u00f3n y se autoconfigura con APIPA: <pre><code>Ethernet adapter Ethernet 2:                                                                  \n\n   Connection-specific DNS Suffix  . :                                                        \n   Description . . . . . . . . . . . : Red Hat VirtIO Ethernet Adapter #2                     \n   Physical Address. . . . . . . . . : 52-54-00-57-DE-32                                      \n   DHCP Enabled. . . . . . . . . . . : Yes                                                    \n   Autoconfiguration Enabled . . . . : Yes                                                    \n   Link-local IPv6 Address . . . . . : fe80::c1c4:20a1:511b:ecc8%2(Preferred)                 \n   Autoconfiguration IPv4 Address. . : 169.254.236.200(Preferred)                             \n   Subnet Mask . . . . . . . . . . . : 255.255.0.0                                            \n   Default Gateway . . . . . . . . . :                                                        \n   DHCPv6 IAID . . . . . . . . . . . : 72504320                                               \n   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-29-01-8E-B1-52-54-00-CE-85-A1              \n   DNS Servers . . . . . . . . . . . : fec0:0:0:ffff::1%1                                     \n                                       fec0:0:0:ffff::2%1                                     \n                                       fec0:0:0:ffff::3%1                                     \n   NetBIOS over Tcpip. . . . . . . . : Enabled    \n</code></pre></p>"},{"location":"sri/practica-servidor-dhcp/#tarea-5","title":"Tarea 5","text":"<p>Con los clientes configurados cambiamos la configuraci\u00f3n del servidor DHCP (rango). \u00bfQu\u00e9 ocurrir\u00e1 tanto en Linux como en Windows?</p> <p>Nuevos rangos: <pre><code>subnet 192.168.100.0 netmask 255.255.255.0 {\n  range 192.168.100.200 192.168.100.210;\n  option subnet-mask 255.255.255.0;\n  option routers 192.168.100.1;\n  option domain-name-servers 1.1.1.1, 1.0.0.1;\n  default-lease-time 10;\n  max-lease-time 10;\n}\n\nsubnet 192.168.200.0 netmask 255.255.255.0 {\n  range 192.168.200.200 192.168.200.210;\n  option subnet-mask 255.255.255.0;\n  option routers 192.168.200.1;\n  option domain-name-servers 1.1.1.1, 1.0.0.1;\n  default-lease-time 10;\n  max-lease-time 10;\n}\n</code></pre></p> <p>Tenemos que reiniciar el servicio para que se apliquen estos cambios: <pre><code>sudo systemctl restart isc-dhcp-server\n</code></pre></p> <p>Los clientes linux actualizan su configuraci\u00f3n sin problema: <pre><code>3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:57:5b:cf brd ff:ff:ff:ff:ff:ff\n    altname enp0s6\n    altname ens6\n    inet 192.168.100.200/24 brd 192.168.100.255 scope global dynamic eth1\n       valid_lft 9sec preferred_lft 9sec\n    inet6 fe80::5054:ff:fe57:5bcf/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre></p> <p>El cliente Windows actualiza su configuraci\u00f3n sin problema tambi\u00e9n: <pre><code>Ethernet adapter Ethernet 2:                                                                  \n\n   Connection-specific DNS Suffix  . :                                                        \n   Link-local IPv6 Address . . . . . : fe80::c1c4:20a1:511b:ecc8%2                            \n   IPv4 Address. . . . . . . . . . . : 192.168.100.201                                        \n   Subnet Mask . . . . . . . . . . . : 255.255.255.0                                          \n   Default Gateway . . . . . . . . . : 192.168.100.1   \n</code></pre></p>"},{"location":"sri/practica-servidor-dhcp/#tarea-6","title":"Tarea 6","text":"<p>Realizar un playbook en ansible que configure el servidor como:</p> <ul> <li>DHCP</li> <li>Router-NAT</li> </ul> <p>https://github.com/adriasir123/servidor-dhcp-ansible</p>"},{"location":"sri/practica-web-bd-dns-escenario/","title":"Pr\u00e1ctica: Servidores Web, Base de Datos y DNS en escenario","text":""},{"location":"sri/practica-web-bd-dns-escenario/#entrega","title":"Entrega","text":""},{"location":"sri/practica-web-bd-dns-escenario/#parte-1","title":"Parte 1","text":"<p>Entregar configuraci\u00f3n de cliente DNS en cada servidor</p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-zeus","title":"En zeus","text":"<p>A\u00f1ado a <code>/etc/dhcp/dhclient.conf</code>: <pre><code>#############\n# My config #\n#############\n\nsupersede domain-name \"adrianj.gonzalonazareno.org\";\nsupersede domain-search \"adrianj.gonzalonazareno.org\";\nsupersede domain-name-servers 10.0.1.102;\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-apolo","title":"En apolo","text":"<p>A\u00f1ado a <code>/etc/dhcp/dhclient.conf</code>: <pre><code>#############\n# My config #\n#############\n\nsupersede domain-name \"adrianj.gonzalonazareno.org\";\nsupersede domain-search \"adrianj.gonzalonazareno.org\";\nsupersede domain-name-servers 127.0.0.1;\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-ares","title":"En ares","text":"<p><code>/etc/netplan/01-netcfg.yaml</code>: <pre><code>network:\n  version: 2\n  renderer: networkd\n  ethernets:\n    eth0:\n      dhcp4: true\n      dhcp6: false\n      optional: true\n</code></pre> (elimino nameservers)</p> <p><code>/etc/systemd/resolved.conf</code>: <pre><code>#  This file is part of systemd.\n#\n#  systemd is free software; you can redistribute it and/or modify it\n#  under the terms of the GNU Lesser General Public License as published by\n#  the Free Software Foundation; either version 2.1 of the License, or\n#  (at your option) any later version.\n#\n# Entries in this file show the compile time defaults.\n# You can change settings by editing this file.\n# Defaults can be restored by simply deleting this file.\n#\n# See resolved.conf(5) for details\n\n[Resolve]\nDNS=10.0.1.102\nDomains=adrianj.gonzalonazareno.org\n\n#FallbackDNS=\n#LLMNR=no\n#MulticastDNS=no\n#DNSSEC=yes\n#DNSOverTLS=no\n#Cache=yes\nDNSStubListener=no\n#ReadEtcHosts=yes\n</code></pre> (este fichero modifica <code>/etc/resolv.conf</code>)</p> <p>Reinicio <code>systemd-resolved</code>: <pre><code>sudo systemctl restart systemd-resolved\n</code></pre> (esto actualiza <code>/etc/resolv.conf</code>)</p> <p>\u00a1Atenci\u00f3n! Por un error de systemd con <code>DNSStubListener=no</code> hay que actualizar manualmente el enlace simb\u00f3lico, porque no lo hace autom\u00e1ticamente: <pre><code>sudo rm /etc/resolv.conf\nsudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-hera","title":"En hera","text":"<p><code>/etc/NetworkManager/conf.d/90-dns-none.conf</code>: <pre><code>[main]\ndns=none\n</code></pre> (evito que NetworkManager modifique <code>/etc/resolv.conf</code>)</p> <p>Reinicio: <pre><code>sudo systemctl restart NetworkManager\n</code></pre></p> <p>Escribo mi configuraci\u00f3n en <code>/etc/resolv.conf</code>: <pre><code>domain adrianj.gonzalonazareno.org\nsearch adrianj.gonzalonazareno.org.\nnameserver 10.0.1.102\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-2","title":"Parte 2","text":"<p>Entregar definici\u00f3n de vistas y ficheros de zona</p> <p>A\u00f1adir a <code>named.conf.options</code>: <pre><code>allow-recursion { any; };\nrecursion yes;\nallow-query { any; };\n</code></pre></p> <p>Comentar en <code>named.conf</code>: <pre><code>// include \"/etc/bind/named.conf.default-zones\";\n</code></pre></p> <p>Comentar en <code>zones.rfc1918</code>: <pre><code>// zone \"16.172.in-addr.arpa\"  { type master; file \"/etc/bind/db.empty\"; };\n</code></pre></p> <p><code>named.conf.local</code>: <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\n\nview externa {\n\n    match-clients { 172.22.0.0/16; 192.168.202.2/32; 192.168.1.0/24; };\n\n    zone \"adrianj.gonzalonazareno.org\" {\n        type master;\n        file \"/etc/bind/db.externa.adrianj.gonzalonazareno.org\";\n    };\n\n};\n\nview dmz {\n\n    match-clients { 172.16.0.0/16; };\n\n    zone \"adrianj.gonzalonazareno.org\" {\n        type master;\n        file \"/etc/bind/db.dmz.adrianj.gonzalonazareno.org\";\n    };\n\n    zone \"16.172.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.172.16\";\n    };\n\n    zone \"1.0.10.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.10.0.1\";\n    };\n\n    include \"/etc/bind/zones.rfc1918\";\n    include \"/etc/bind/named.conf.default-zones\";\n\n};\n\nview interna {\n\n    match-clients { 10.0.1.0/24; 127.0.0.1/32; };\n\n    zone \"adrianj.gonzalonazareno.org\" {\n        type master;\n        file \"/etc/bind/db.interna.adrianj.gonzalonazareno.org\";\n    };\n\n    zone \"1.0.10.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.10.0.1\";\n    };\n\n    zone \"16.172.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.172.16\";\n    };\n\n    include \"/etc/bind/zones.rfc1918\";\n    include \"/etc/bind/named.conf.default-zones\";\n\n};\n</code></pre> (en la vista externa he a\u00f1adido la red de mi casa)</p> <p><code>db.externa.adrianj.gonzalonazareno.org</code>: <pre><code>$ORIGIN adrianj.gonzalonazareno.org.\n$TTL 86400\n@     IN     SOA    zeus.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      zeus.adrianj.gonzalonazareno.org.\n\n; zeus           IN    A       172.22.0.213 ; clase\nzeus           IN    A       192.168.1.106 ; casa-eth\nwww            IN    CNAME   zeus\n</code></pre> (la IP externa cambia seg\u00fan est\u00e9 en clase o en casa)</p> <p><code>db.dmz.adrianj.gonzalonazareno.org</code>: <pre><code>$ORIGIN adrianj.gonzalonazareno.org.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      apolo.adrianj.gonzalonazareno.org.\n\nzeus           IN    A       172.16.0.1\nhera           IN    A       172.16.0.200\napolo          IN    A       10.0.1.102\nares           IN    A       10.0.1.101\n\nwww            IN    CNAME   hera\nbd             IN    CNAME   ares\n</code></pre></p> <p><code>db.interna.adrianj.gonzalonazareno.org</code>: <pre><code>$ORIGIN adrianj.gonzalonazareno.org.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      apolo.adrianj.gonzalonazareno.org.\n\nzeus           IN    A       10.0.1.1\napolo          IN    A       10.0.1.102\nares           IN    A       10.0.1.101\nhera           IN    A       172.16.0.200\n\nwww            IN    CNAME   hera\nbd             IN    CNAME   ares\n</code></pre></p> <p><code>db.172.16</code>: <pre><code>$ORIGIN 16.172.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062502 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@                            IN     NS     apolo.adrianj.gonzalonazareno.org.\n\n1.0                          IN     PTR    zeus.adrianj.gonzalonazareno.org.\n200.0                        IN     PTR    hera.adrianj.gonzalonazareno.org.\n</code></pre></p> <p><code>db.10.0.1</code>: <pre><code>$ORIGIN 1.0.10.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@        IN     NS     apolo.adrianj.gonzalonazareno.org.\n\n1        IN     PTR    zeus.adrianj.gonzalonazareno.org.\n102      IN     PTR    apolo.adrianj.gonzalonazareno.org.\n101      IN     PTR    ares.adrianj.gonzalonazareno.org.\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-3","title":"Parte 3","text":"<p>Consultas desde un cliente externo</p> <p>(en estas consultas usar\u00e9 <code>@192.168.1.106</code> porque en mi casa no existe delegaci\u00f3n del dominio)</p> <p><pre><code>dig @192.168.1.106 NS adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.1.106 NS adrianj.gonzalonazareno.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 58348\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: e4468067cae8269e01000000619ff86a197a3852650fd14f (good)\n;; QUESTION SECTION:\n;adrianj.gonzalonazareno.org.   IN  NS\n\n;; ANSWER SECTION:\nadrianj.gonzalonazareno.org. 86400 IN   NS  zeus.adrianj.gonzalonazareno.org.\n\n;; ADDITIONAL SECTION:\nzeus.adrianj.gonzalonazareno.org. 86400 IN A    192.168.1.106\n\n;; Query time: 0 msec\n;; SERVER: 192.168.1.106#53(192.168.1.106)\n;; WHEN: Thu Nov 25 21:56:10 CET 2021\n;; MSG SIZE  rcvd: 119\n</code></pre></p> <p><pre><code>dig @192.168.1.106 zeus.adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.1.106 zeus.adrianj.gonzalonazareno.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 37293\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 84a54d72b820320701000000619ff98b8b9e767129e71df3 (good)\n;; QUESTION SECTION:\n;zeus.adrianj.gonzalonazareno.org. IN   A\n\n;; ANSWER SECTION:\nzeus.adrianj.gonzalonazareno.org. 86400 IN A    192.168.1.106\n\n;; Query time: 0 msec\n;; SERVER: 192.168.1.106#53(192.168.1.106)\n;; WHEN: Thu Nov 25 22:00:59 CET 2021\n;; MSG SIZE  rcvd: 105\n</code></pre></p> <p><pre><code>dig @192.168.1.106 www.adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.1.106 www.adrianj.gonzalonazareno.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 41074\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: e1cddf11d68022f801000000619ff9cf5d2b25377cbac1b2 (good)\n;; QUESTION SECTION:\n;www.adrianj.gonzalonazareno.org. IN    A\n\n;; ANSWER SECTION:\nwww.adrianj.gonzalonazareno.org. 86400 IN CNAME zeus.adrianj.gonzalonazareno.org.\nzeus.adrianj.gonzalonazareno.org. 86400 IN A    192.168.1.106\n\n;; Query time: 0 msec\n;; SERVER: 192.168.1.106#53(192.168.1.106)\n;; WHEN: Thu Nov 25 22:02:07 CET 2021\n;; MSG SIZE  rcvd: 123\n</code></pre></p> <p><pre><code>dig @192.168.1.106 bd.adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.1.106 bd.adrianj.gonzalonazareno.org\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 40461\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: a06ac8db7750971101000000619ffa4950b175b5a1d7d627 (good)\n;; QUESTION SECTION:\n;bd.adrianj.gonzalonazareno.org.    IN  A\n\n;; AUTHORITY SECTION:\nadrianj.gonzalonazareno.org. 86400 IN   SOA zeus.adrianj.gonzalonazareno.org. admin.adrianj.gonzalonazareno.org. 2001062501 21600 3600 604800 86400\n\n;; Query time: 4 msec\n;; SERVER: 192.168.1.106#53(192.168.1.106)\n;; WHEN: Thu Nov 25 22:04:09 CET 2021\n;; MSG SIZE  rcvd: 134\n</code></pre> (no hay respuesta porque bd no existe en la vista externa)</p> <p>Consultas desde un cliente interno</p> <p><pre><code>dig NS adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; NS adrianj.gonzalonazareno.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 17610\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 3f12cd4ba620cf1501000000619ffc618b1029d6fd6ee025 (good)\n;; QUESTION SECTION:\n;adrianj.gonzalonazareno.org.   IN  NS\n\n;; ANSWER SECTION:\nadrianj.gonzalonazareno.org. 86400 IN   NS  apolo.adrianj.gonzalonazareno.org.\n\n;; ADDITIONAL SECTION:\napolo.adrianj.gonzalonazareno.org. 86400 IN A   10.0.1.102\n\n;; Query time: 24 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Nov 25 21:13:05 UTC 2021\n;; MSG SIZE  rcvd: 120\n</code></pre></p> <p><pre><code>dig zeus.adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; zeus.adrianj.gonzalonazareno.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 15547\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 6268af10a08da00101000000619ffd1d5a37dcbdf9bcad63 (good)\n;; QUESTION SECTION:\n;zeus.adrianj.gonzalonazareno.org. IN   A\n\n;; ANSWER SECTION:\nzeus.adrianj.gonzalonazareno.org. 86400 IN A    10.0.1.1\n\n;; Query time: 4 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Nov 25 21:16:13 UTC 2021\n;; MSG SIZE  rcvd: 105\n</code></pre></p> <p><pre><code>dig www.adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; www.adrianj.gonzalonazareno.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35003\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: ddc4f5521915c21901000000619ffd8ec03f6e53f09e84af (good)\n;; QUESTION SECTION:\n;www.adrianj.gonzalonazareno.org. IN    A\n\n;; ANSWER SECTION:\nwww.adrianj.gonzalonazareno.org. 86400 IN CNAME hera.adrianj.gonzalonazareno.org.\nhera.adrianj.gonzalonazareno.org. 86400 IN A    172.16.0.200\n\n;; Query time: 0 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Nov 25 21:18:06 UTC 2021\n;; MSG SIZE  rcvd: 123\n</code></pre></p> <p><pre><code>dig bd.adrianj.gonzalonazareno.org\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; bd.adrianj.gonzalonazareno.org\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 3419\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 022009393ab949eb01000000619ffdec08dac774ea4bf941 (good)\n;; QUESTION SECTION:\n;bd.adrianj.gonzalonazareno.org.    IN  A\n\n;; ANSWER SECTION:\nbd.adrianj.gonzalonazareno.org. 86400 IN CNAME  ares.adrianj.gonzalonazareno.org.\nares.adrianj.gonzalonazareno.org. 86400 IN A    10.0.1.101\n\n;; Query time: 4 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Nov 25 21:19:40 UTC 2021\n;; MSG SIZE  rcvd: 122\n</code></pre></p> <p>Consultas inversas en cada una de las redes (interna+dmz+externa)</p> <p>En red interna: <pre><code>dig -x 10.0.1.1\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; -x 10.0.1.1\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 4421\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 0d9da3496030523401000000619fff3ccb3de97da07c83e9 (good)\n;; QUESTION SECTION:\n;1.1.0.10.in-addr.arpa.     IN  PTR\n\n;; ANSWER SECTION:\n1.1.0.10.in-addr.arpa.  86400   IN  PTR zeus.adrianj.gonzalonazareno.org.\n\n;; Query time: 8 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Nov 25 21:25:16 UTC 2021\n;; MSG SIZE  rcvd: 124\n</code></pre></p> <p>En red DMZ: <pre><code>dig -x 172.16.0.1\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.11.26-RedHat-9.11.26-6.el8 &lt;&lt;&gt;&gt; -x 172.16.0.1\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 58791\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: 7c0c4c54f5e88ddd01000000619fffb8fd24258dd7580093 (good)\n;; QUESTION SECTION:\n;1.0.16.172.in-addr.arpa.   IN  PTR\n\n;; ANSWER SECTION:\n1.0.16.172.in-addr.arpa. 86400  IN  PTR zeus.adrianj.gonzalonazareno.org.\n\n;; Query time: 3 msec\n;; SERVER: 10.0.1.102#53(10.0.1.102)\n;; WHEN: Thu Nov 25 21:27:20 UTC 2021\n;; MSG SIZE  rcvd: 126\n</code></pre></p> <p>En red externa: <pre><code>dig @192.168.1.106 -x 10.0.1.101\n</code></pre> <pre><code>; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.1.106 -x 10.0.1.101\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 27352\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n; COOKIE: c10440dae46509270100000061a00236623d14bb17cbdef9 (good)\n;; QUESTION SECTION:\n;101.1.0.10.in-addr.arpa.   IN  PTR\n\n;; AUTHORITY SECTION:\n10.IN-ADDR.ARPA.    86400   IN  SOA 10.IN-ADDR.ARPA. . 0 28800 7200 604800 86400\n\n;; Query time: 0 msec\n;; SERVER: 192.168.1.106#53(192.168.1.106)\n;; WHEN: Thu Nov 25 22:37:58 CET 2021\n;; MSG SIZE  rcvd: 130\n</code></pre> (no responde porque en la vista externa no existen zonas de resoluci\u00f3n inversa)</p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-4","title":"Parte 4","text":"<p>Captura de <code>www.adrianj.gonzalonazareno.org/info.php</code></p> <p></p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-5","title":"Parte 5","text":"<p>Entregar conexi\u00f3n a MariaDB desde hera</p> <p></p>"},{"location":"sri/practica-web-bd-dns-escenario/#servidor-dns-apolo","title":"Servidor DNS (apolo)","text":""},{"location":"sri/practica-web-bd-dns-escenario/#parte-1_1","title":"Parte 1","text":"<p>DNAT en zeus redirigiendo puerto 53 a apolo</p> <p><pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p udp --dport 53 -j DNAT --to-destination 10.0.1.102:53\n</code></pre> (regla para clase)</p> <p>DNAT en zeus redirigiendo puerto 80 a hera</p> <p><pre><code>sudo iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 80 -j DNAT --to-destination 172.16.0.200:80\n</code></pre> (regla para clase)</p> <p>Guardar reglas</p> <pre><code>iptables-save &gt; /etc/iptables/rules.v4\n</code></pre>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-2_1","title":"Parte 2","text":"<p>Configurar todos los servidores para resolver con apolo</p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-zeus_1","title":"En zeus","text":"<p>A\u00f1ado a <code>/etc/dhcp/dhclient.conf</code>: <pre><code>#############\n# My config #\n#############\n\nsupersede domain-name \"adrianj.gonzalonazareno.org\";\nsupersede domain-search \"adrianj.gonzalonazareno.org\";\nsupersede domain-name-servers 10.0.1.102;\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-apolo_1","title":"En apolo","text":"<p>A\u00f1ado a <code>/etc/dhcp/dhclient.conf</code>: <pre><code>#############\n# My config #\n#############\n\nsupersede domain-name \"adrianj.gonzalonazareno.org\";\nsupersede domain-search \"adrianj.gonzalonazareno.org\";\nsupersede domain-name-servers 127.0.0.1;\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-ares_1","title":"En ares","text":"<p><code>/etc/netplan/01-netcfg.yaml</code>: <pre><code>network:\n  version: 2\n  renderer: networkd\n  ethernets:\n    eth0:\n      dhcp4: true\n      dhcp6: false\n      optional: true\n</code></pre> (elimino nameservers)</p> <p><code>/etc/systemd/resolved.conf</code>: <pre><code>#  This file is part of systemd.\n#\n#  systemd is free software; you can redistribute it and/or modify it\n#  under the terms of the GNU Lesser General Public License as published by\n#  the Free Software Foundation; either version 2.1 of the License, or\n#  (at your option) any later version.\n#\n# Entries in this file show the compile time defaults.\n# You can change settings by editing this file.\n# Defaults can be restored by simply deleting this file.\n#\n# See resolved.conf(5) for details\n\n[Resolve]\nDNS=10.0.1.102\nDomains=adrianj.gonzalonazareno.org\n\n#FallbackDNS=\n#LLMNR=no\n#MulticastDNS=no\n#DNSSEC=yes\n#DNSOverTLS=no\n#Cache=yes\nDNSStubListener=no\n#ReadEtcHosts=yes\n</code></pre> (este fichero modifica <code>/etc/resolv.conf</code>)</p> <p>Reinicio <code>systemd-resolved</code>: <pre><code>sudo systemctl restart systemd-resolved\n</code></pre> (esto actualiza <code>/etc/resolv.conf</code>)</p> <p>\u00a1Atenci\u00f3n! Por un error de systemd con <code>DNSStubListener=no</code> hay que actualizar manualmente el enlace simb\u00f3lico, porque no lo hace autom\u00e1ticamente: <pre><code>sudo rm /etc/resolv.conf\nsudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#en-hera_1","title":"En hera","text":"<p><code>/etc/NetworkManager/conf.d/90-dns-none.conf</code>: <pre><code>[main]\ndns=none\n</code></pre> (evito que NetworkManager modifique <code>/etc/resolv.conf</code>)</p> <p>Reinicio: <pre><code>sudo systemctl restart NetworkManager\n</code></pre></p> <p>Escribo mi configuraci\u00f3n en <code>/etc/resolv.conf</code>: <pre><code>domain adrianj.gonzalonazareno.org\nsearch adrianj.gonzalonazareno.org.\nnameserver 10.0.1.102\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-3_1","title":"Parte 3","text":"<p>Configurar bind9</p> <p>A\u00f1adir a <code>named.conf.options</code>: <pre><code>allow-recursion { any; };\nrecursion yes;\nallow-query { any; };\n</code></pre></p> <p>Comentar en <code>named.conf</code>: <pre><code>// include \"/etc/bind/named.conf.default-zones\";\n</code></pre></p> <p>Comentar en <code>zones.rfc1918</code>: <pre><code>// zone \"16.172.in-addr.arpa\"  { type master; file \"/etc/bind/db.empty\"; };\n</code></pre></p> <p><code>named.conf.local</code>: <pre><code>//\n// Do any local configuration here\n//\n\n// Consider adding the 1918 zones here, if they are not used in your\n// organization\n\nview externa {\n\n    match-clients { 172.22.0.0/16; 192.168.202.2/32; 192.168.1.0/24; };\n\n    zone \"adrianj.gonzalonazareno.org\" {\n        type master;\n        file \"/etc/bind/db.externa.adrianj.gonzalonazareno.org\";\n    };\n\n};\n\nview dmz {\n\n    match-clients { 172.16.0.0/16; };\n\n    zone \"adrianj.gonzalonazareno.org\" {\n        type master;\n        file \"/etc/bind/db.dmz.adrianj.gonzalonazareno.org\";\n    };\n\n    zone \"16.172.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.172.16\";\n    };\n\n    zone \"1.0.10.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.10.0.1\";\n    };\n\n    include \"/etc/bind/zones.rfc1918\";\n    include \"/etc/bind/named.conf.default-zones\";\n\n};\n\nview interna {\n\n    match-clients { 10.0.1.0/24; 127.0.0.1/32; };\n\n    zone \"adrianj.gonzalonazareno.org\" {\n        type master;\n        file \"/etc/bind/db.interna.adrianj.gonzalonazareno.org\";\n    };\n\n    zone \"1.0.10.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.10.0.1\";\n    };\n\n    zone \"16.172.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.172.16\";\n    };\n\n    include \"/etc/bind/zones.rfc1918\";\n    include \"/etc/bind/named.conf.default-zones\";\n\n};\n</code></pre> (en la vista externa he a\u00f1adido la red de mi casa)</p> <p><code>db.externa.adrianj.gonzalonazareno.org</code>: <pre><code>$ORIGIN adrianj.gonzalonazareno.org.\n$TTL 86400\n@     IN     SOA    zeus.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      zeus.adrianj.gonzalonazareno.org.\n\n; zeus           IN    A       172.22.0.213 ; clase\nzeus           IN    A       192.168.1.106 ; casa-eth\nwww            IN    CNAME   zeus\n</code></pre> (la IP externa cambia seg\u00fan est\u00e9 en clase o en casa)</p> <p><code>db.dmz.adrianj.gonzalonazareno.org</code>: <pre><code>$ORIGIN adrianj.gonzalonazareno.org.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      apolo.adrianj.gonzalonazareno.org.\n\nzeus           IN    A       172.16.0.1\nhera           IN    A       172.16.0.200\napolo          IN    A       10.0.1.102\nares           IN    A       10.0.1.101\n\nwww            IN    CNAME   hera\nbd             IN    CNAME   ares\n</code></pre></p> <p><code>db.interna.adrianj.gonzalonazareno.org</code>: <pre><code>$ORIGIN adrianj.gonzalonazareno.org.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@              IN    NS      apolo.adrianj.gonzalonazareno.org.\n\nzeus           IN    A       10.0.1.1\napolo          IN    A       10.0.1.102\nares           IN    A       10.0.1.101\nhera           IN    A       172.16.0.200\n\nwww            IN    CNAME   hera\nbd             IN    CNAME   ares\n</code></pre></p> <p><code>db.172.16</code>: <pre><code>$ORIGIN 16.172.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062502 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@                            IN     NS     apolo.adrianj.gonzalonazareno.org.\n\n1.0                          IN     PTR    zeus.adrianj.gonzalonazareno.org.\n200.0                        IN     PTR    hera.adrianj.gonzalonazareno.org.\n</code></pre></p> <p><code>db.10.0.1</code>: <pre><code>$ORIGIN 1.0.10.in-addr.arpa.\n$TTL 86400\n@     IN     SOA    apolo.adrianj.gonzalonazareno.org.     admin.adrianj.gonzalonazareno.org. (\n                    2001062501 ; serial\n                    21600      ; refresh after 6 hours\n                    3600       ; retry after 1 hour\n                    604800     ; expire after 1 week\n                    86400 )    ; minimum TTL of 1 day\n\n@        IN     NS     apolo.adrianj.gonzalonazareno.org.\n\n1        IN     PTR    zeus.adrianj.gonzalonazareno.org.\n102      IN     PTR    apolo.adrianj.gonzalonazareno.org.\n101      IN     PTR    ares.adrianj.gonzalonazareno.org.\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#servidor-web-hera","title":"Servidor Web (hera)","text":""},{"location":"sri/practica-web-bd-dns-escenario/#parte-1_2","title":"Parte 1","text":"<p>Instalar Apache</p> <pre><code>sudo dnf install httpd\nsystemctl enable --now  httpd\n</code></pre>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-2_2","title":"Parte 2","text":"<p>Instalar php + PHP-FPM</p> <p><pre><code>sudo dnf install php\n</code></pre> (instala PHP-FPM por dependencia)</p> <p>En <code>/var/www/www</code> descargo: <pre><code>sudo wget https://gist.githubusercontent.com/SyntaxC4/5648247/raw/94277156638f9c309f2e36e19bff378ba7364907/info.php\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-3_2","title":"Parte 3","text":"<p>Crear VirtualHost</p> <p><code>/etc/httpd/conf.d/www.conf</code>: <pre><code>&lt;VirtualHost *:80&gt;\n\n    ServerName www.adrianj.gonzalonazareno.org\n    DocumentRoot /var/www/www\n\n&lt;/VirtualHost&gt;\n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-4_1","title":"Parte 4","text":"<p>Reiniciar Apache</p> <pre><code>sudo systemctl restart httpd\n</code></pre>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-5_1","title":"Parte 5","text":"<p>Instalar cliente MariaDB (para entrega parte 5)</p> <pre><code>curl -LsS https://downloads.mariadb.com/MariaDB/mariadb_repo_setup | sudo bash\nsudo dnf install MariaDB-client\n</code></pre>"},{"location":"sri/practica-web-bd-dns-escenario/#servidor-de-bd-ares","title":"Servidor de BD (ares)","text":""},{"location":"sri/practica-web-bd-dns-escenario/#parte-1_3","title":"Parte 1","text":"<p>Instalar MariaDB</p> <pre><code>sudo apt install mariadb-server\n</code></pre>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-2_3","title":"Parte 2","text":"<p>Habilitar conexiones remotas</p> <p><code>/etc/mysql/mariadb.conf.d/50-server.cnf</code>: <pre><code>bind-address            = 0.0.0.0  \n</code></pre></p>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-3_3","title":"Parte 3","text":"<p>Habilitar root con acceso remoto</p> <pre><code>use mysql;\nupdate user set plugin='' where User='root';\ngrant all privileges on *.* to 'root'@'%' identified by '1234';\nflush privileges;\n</code></pre>"},{"location":"sri/practica-web-bd-dns-escenario/#parte-4_2","title":"Parte 4","text":"<p>Reiniciar</p> <pre><code>sudo systemctl restart mariadb\n</code></pre>"},{"location":"sri/practica3-LEMP-VPS/","title":"Pr\u00e1ctica : Instalaci\u00f3n de un servidor LEMP en nuestra VPS","text":""},{"location":"sri/practica3-LEMP-VPS/#instalacion","title":"Instalaci\u00f3n","text":""},{"location":"sri/practica3-LEMP-VPS/#ejercicio-1","title":"Ejercicio 1","text":"<p>Instalar Nginx</p> <pre><code>sudo apt update\nsudo apt install curl gnupg2 ca-certificates lsb-release\nsudo apt install nginx\n</code></pre>"},{"location":"sri/practica3-LEMP-VPS/#ejercicio-2","title":"Ejercicio 2","text":"<p>Instalar servidor MariaDB</p> <pre><code>sudo apt install mariadb-server\n</code></pre> <p>Ejecutar <code>mysql_secure_installation</code></p> <pre><code>sudo mysql_secure_installation\n</code></pre> <pre><code>Enter current password for root (enter for none):\n\nSwitch to unix_socket authentication [Y/n] n\n\nChange the root password? [Y/n] n\n\nRemove anonymous users? [Y/n] y\n\nDisallow root login remotely? [Y/n] y\n\nRemove test database and access to it? [Y/n] y\n\nReload privilege tables now? [Y/n] y\n</code></pre> <p>Muestro s\u00f3lo mis respuestas durante el script, el resto del output innecesario lo he borrado.</p>"},{"location":"sri/practica3-LEMP-VPS/#ejercicio-3","title":"Ejercicio 3","text":"<p>Instalar un servidor de aplicaciones PHP-FPM</p> <pre><code>sudo apt install php-fpm\n</code></pre>"},{"location":"sri/practica3-LEMP-VPS/#virtualhosting","title":"VirtualHosting","text":""},{"location":"sri/practica3-LEMP-VPS/#ejercicio-1_1","title":"Ejercicio 1","text":"<p>Crear VirtualHost con <code>server_name</code> <code>www.adrianjaramillo.tk</code></p> <p>Creo <code>/etc/nginx/sites-available/www.conf</code>: <pre><code>server {\n    listen 80;\n    server_name www.adrianjaramillo.tk;\n\n    location / {\n        root   /var/www/www;\n        index  index.html index.htm;\n    }\n}\n</code></pre></p> <p>Lo habilito: <pre><code>sudo ln -s /etc/nginx/sites-available/www.conf /etc/nginx/sites-enabled/\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Crear nuevo registro CNAME en la zona DNS p\u00fablica para <code>www.adrianjaramillo.tk</code></p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#ejercicio-2_1","title":"Ejercicio 2","text":"<p>Redirige el VirtualHost por defecto <code>default</code> al VirtualHost de <code>www.adrianjaramillo.tk</code></p> <p>A\u00f1ado la siguiente l\u00ednea a <code>/etc/nginx/sites-available/default</code>: <pre><code>return 301 $scheme://www.adrianjaramillo.tk$request_uri;\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Muestro que funciona la redirecci\u00f3n:</p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#mapeo-de-url","title":"Mapeo de URL","text":""},{"location":"sri/practica3-LEMP-VPS/#ejercicio-1_2","title":"Ejercicio 1","text":"<p>Redigir <code>www.adrianjaramillo.tk</code> a <code>www.adrianjaramillo.tk/principal</code></p> <p>A\u00f1ado la siguiente l\u00ednea a <code>/etc/nginx/sites-available/www.conf</code>: <pre><code>rewrite ^/$ http://www.adrianjaramillo.tk/principal permanent;\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>En <code>principal</code>, creo un <code>index.html</code> de prueba.</p> <p>Muestro que funciona la redirecci\u00f3n:</p> <p></p> <p>En <code>principal</code> no se permite:</p> <ul> <li>Listar ficheros</li> <li>Enlaces simb\u00f3licos</li> </ul> <p>Antes de nada, borro el <code>/var/www/www/principal/index.html</code> que previamente cre\u00e9.</p> <p>\u00bfRaz\u00f3n? <code>ngx_http_autoindex_module</code> s\u00f3lo empieza a funcionar cuando no encuentra un <code>index.html</code>.</p> <p>Creo la siguiente estructura de prueba en <code>principal</code>: <pre><code>blackmamba@kampe:/var/www/www/principal$ ls -la\ntotal 16\ndrwxr-xr-x 2 root root 4096 Nov  9 22:23 .\ndrwxr-xr-x 3 root root 4096 Nov  9 19:55 ..\n-rw-r--r-- 1 root root    9 Nov  9 19:55 fich1.txt\n-rw-r--r-- 1 root root    9 Nov  9 19:56 fich2.txt\nlrwxrwxrwx 1 root root    9 Nov  9 19:58 motd -&gt; /etc/motd\n</code></pre></p> <p>Modifico <code>/etc/nginx/sites-available/www.conf</code>: <pre><code>server {\n\n    listen 80;\n    server_name www.adrianjaramillo.tk;\n    root /var/www/www;\n\n    rewrite ^/$ http://www.adrianjaramillo.tk/principal permanent;\n\n    location / {\n        index index.html index.htm;\n    }\n\n    location /principal {\n        autoindex off;\n        disable_symlinks on;\n    }\n\n}\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Muestro que <code>autoindex off</code> funciona:</p> <p></p> <p>Intento acceder al enlace simb\u00f3lico para mostrar que <code>disable_symlinks on</code> funciona:</p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#ejercicio-2_2","title":"Ejercicio 2","text":"<p>En <code>www.adrianjaramillo.tk/principal</code>, bajar una plantilla de <code>index.html</code> con tu nombre, y una lista de enlaces a las aplicaciones que desplegaremos</p> <p>Me bajo la plantilla en <code>principal</code>: <pre><code>sudo apt install unzip\nsudo wget https://www.free-css.com/assets/files/free-css-templates/download/page270/univers.zip\nsudo unzip univers.zip\n</code></pre></p> <p>Muestro que funciona y tiene mi nombre:</p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#ejercicio-3_1","title":"Ejercicio 3","text":"<p>Al acceder a <code>www.adrianjaramillo.tk/principal/documentos</code> se visualizar\u00e1 <code>/srv/doc</code>  Se permitir\u00e1:</p> <ul> <li>Listar ficheros</li> <li>Enlaces simb\u00f3licos</li> </ul> <p>Creo la siguiente estructura en <code>/srv/doc</code>: <pre><code>blackmamba@kampe:/srv/doc$ ls -la\ntotal 28\ndrwxr-xr-x 2 root root  4096 Nov 10 09:58 .\ndrwxr-xr-x 3 root root  4096 Nov 10 09:25 ..\n-rw-r--r-- 1 root root 13264 Aug 27  2007 dummy.pdf\nlrwxrwxrwx 1 root root    32 Nov 10 09:58 fich1.txt -&gt; /var/www/www/principal/fich1.txt\n-rw-r--r-- 1 root root  3028 Feb 24  2017 sample.pdf\n</code></pre></p> <p>A\u00f1ado lo siguiente a <code>/etc/nginx/sites-available/www.conf</code>: <pre><code>location /principal/documentos {\n    alias /srv/doc;\n    autoindex on;\n    disable_symlinks off;\n}\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Muestro que funciona <code>autoindex</code>:</p> <p></p> <p>Muestro que se ven los ficheros:</p> <p></p> <p>Muestro que se ve el enlace simb\u00f3lico:</p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#ejercicio-4","title":"Ejercicio 4","text":"<p>Redirigir errores 404 y 403 para todo el VirtualHost <code>www.adrianjaramillo.tk</code>. Crear 2 html dentro del directorio error.</p> <p>Creo la siguiente estructura en <code>/error</code>: <pre><code>blackmamba@kampe:/var/www/www/error$ ls -la\ntotal 24\ndrwxr-xr-x 2 root root 4096 Nov 10 11:43 .\ndrwxr-xr-x 4 root root 4096 Nov 10 11:12 ..\n-rw-r--r-- 1 root root 2518 Nov 10 11:43 403.html\n-rw-r--r-- 1 root root 8788 Nov 10 11:22 404.html\n</code></pre></p> <p>A\u00f1ado lo siguiente a <code>/etc/nginx/sites-available/www.conf</code>: <pre><code>error_page 404 /error/404.html;\nerror_page 403 /error/403.html;  \n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Muestro que el error 404 funciona accediendo a <code>/noexiste</code>:</p> <p></p> <p>Muestro que el error 403 funciona accediendo al enlace simb\u00f3lico dentro de <code>/principal</code> (recordamos que en ese directorio ten\u00edamos <code>disable_symlinks on</code>):</p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#autenticacion","title":"Autenticaci\u00f3n","text":""},{"location":"sri/practica3-LEMP-VPS/#ejercicio-1_3","title":"Ejercicio 1","text":"<p>Autenticaci\u00f3n b\u00e1sica en <code>www.adrianjaramillo.tk/secreto</code></p> <p>Creo la siguiente estructura en <code>/var/www/www/secreto</code>: <pre><code>blackmamba@kampe:/var/www/www/secreto$ ls -la\ntotal 12\ndrwxr-xr-x 2 root root 4096 Nov 10 17:44 .\ndrwxr-xr-x 5 root root 4096 Nov 10 17:39 ..\n-rw-r--r-- 1 root root  235 Nov 10 17:44 index.html\n</code></pre></p> <p>Instalo el paquete que nos proporciona el binario <code>htpasswd</code>, que necesitaremos: <pre><code>sudo apt install apache2-utils\n</code></pre></p> <p>Creo el fichero de credenciales, a\u00f1adiendo un usuario <code>admin</code> con contrase\u00f1a <code>admin</code>: <pre><code>sudo htpasswd -c /etc/nginx/.htpasswd admin\n</code></pre></p> <p>A\u00f1ado lo siguiente a <code>/etc/nginx/sites-available/www.conf</code>: <pre><code>location /secreto {\n    auth_basic \"Acceso restringido\";\n    auth_basic_user_file /etc/nginx/.htpasswd;\n}\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p> <p>Muestro que funciona:</p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#php","title":"PHP","text":""},{"location":"sri/practica3-LEMP-VPS/#ejercicio-1_4","title":"Ejercicio 1","text":"<p>Comprobar la configuraci\u00f3n de PHP-FPM por defecto (socket unix o socket TCP)</p> <p>Para comprobarlo, ejecuto: <pre><code>cat /etc/php/7.4/fpm/pool.d/www.conf | grep \"listen =\"\n</code></pre> <pre><code>listen = /run/php/php7.4-fpm.sock\n</code></pre> Vemos que por defecto PHP-FPM se configura escuchando en un socket unix.</p> <p>Configurar VirtualHost <code>www.adrianjaramillo.tk</code> para que pueda ejecutar PHP</p> <p>A\u00f1ado lo siguiente a <code>/etc/nginx/sites-available/www.conf</code>: <pre><code>location ~ \\.php$ {\n    fastcgi_pass   unix:/run/php/php7.4-fpm.sock;\n    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    include        fastcgi_params;\n}\n</code></pre></p> <p>Reinicio Nginx: <pre><code>sudo systemctl restart nginx\n</code></pre></p>"},{"location":"sri/practica3-LEMP-VPS/#ejercicio-2_3","title":"Ejercicio 2","text":"<p>Crear un <code>info.php</code> que demuestre que funciona la ejecuci\u00f3n PHP</p> <p>En <code>/var/www/www/principal</code> me descargo un <code>info.php</code> de prueba: <pre><code>sudo wget https://gist.githubusercontent.com/SyntaxC4/5648247/raw/94277156638f9c309f2e36e19bff378ba7364907/info.php\n</code></pre></p> <p>Muestro que funciona:</p> <p></p>"},{"location":"sri/practica3-LEMP-VPS/#ansible","title":"Ansible","text":"<p>Hacer configuraci\u00f3n b\u00e1sica de Nginx con ansible, partiendo de: https://fp.josedomingo.org/sri2122/u03/doc/ejercicio_proxy/ejercicio_proxy.zip</p> <p>Repositorio con mi configuraci\u00f3n: https://github.com/adriasir123/ansible-nginx</p>"}]}